function _extends(){return _extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},_extends.apply(this,arguments)}function _objectWithoutPropertiesLoose(e,t){if(null==e)return{};var n,i,r={},o=Object.keys(e);for(i=0;i<o.length;i++)n=o[i],t.indexOf(n)>=0||(r[n]=e[n]);return r}function b64_sha1(e){return binb2b64(core_sha1(str2binb(e),8*e.length))}function str_sha1(e){return binb2str(core_sha1(str2binb(e),8*e.length))}function b64_hmac_sha1(e,t){return binb2b64(core_hmac_sha1(e,t))}function str_hmac_sha1(e,t){return binb2str(core_hmac_sha1(e,t))}function core_sha1(e,t){e[t>>5]|=128<<24-t%32,e[(t+64>>9<<4)+15]=t;var n,i,r,o,a,s,c,l,u=new Array(80),d=1732584193,p=-271733879,h=-1732584194,f=271733878,g=-1009589776;for(n=0;n<e.length;n+=16){for(o=d,a=p,s=h,c=f,l=g,i=0;i<80;i++)i<16?u[i]=e[n+i]:u[i]=rol(u[i-3]^u[i-8]^u[i-14]^u[i-16],1),r=safe_add(safe_add(rol(d,5),sha1_ft(i,p,h,f)),safe_add(safe_add(g,u[i]),sha1_kt(i))),g=f,f=h,h=rol(p,30),p=d,d=r;d=safe_add(d,o),p=safe_add(p,a),h=safe_add(h,s),f=safe_add(f,c),g=safe_add(g,l)}return[d,p,h,f,g]}function sha1_ft(e,t,n,i){return e<20?t&n|~t&i:e<40?t^n^i:e<60?t&n|t&i|n&i:t^n^i}function sha1_kt(e){return e<20?1518500249:e<40?1859775393:e<60?-1894007588:-899497514}function core_hmac_sha1(e,t){var n=str2binb(e);n.length>16&&(n=core_sha1(n,8*e.length));for(var i=new Array(16),r=new Array(16),o=0;o<16;o++)i[o]=909522486^n[o],r[o]=1549556828^n[o];var a=core_sha1(i.concat(str2binb(t)),512+8*t.length);return core_sha1(r.concat(a),672)}function safe_add(e,t){var n=(65535&e)+(65535&t),i=(e>>16)+(t>>16)+(n>>16);return i<<16|65535&n}function rol(e,t){return e<<t|e>>>32-t}function str2binb(e){for(var t=[],n=255,i=0;i<8*e.length;i+=8)t[i>>5]|=(e.charCodeAt(i/8)&n)<<24-i%32;return t}function binb2str(e){for(var t="",n=255,i=0;i<32*e.length;i+=8)t+=String.fromCharCode(e[i>>5]>>>24-i%32&n);return t}function binb2b64(e){for(var t,n,i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",r="",o=0;o<4*e.length;o+=3)for(t=(e[o>>2]>>8*(3-o%4)&255)<<16|(e[o+1>>2]>>8*(3-(o+1)%4)&255)<<8|e[o+2>>2]>>8*(3-(o+2)%4)&255,n=0;n<4;n++)r+=8*o+6*n>32*e.length?"=":i.charAt(t>>6*(3-n)&63);return r}function initVirtualConsoleEvent(){for(var e=0,t=500,n=1e3,i=3e3,r=[1,2,3],o=0,a=0;a<r.length;a++)o+=r[a];var s=null,c=[];document.addEventListener("touchstart",function l(a){if(c.length<o?c.push(Date.now()):c=[],c.length===o){for(var u=[],d=0,p=0;p<r.length;p++)u.push(c.slice(d,d+r[p])),d+=r[p];var h=!0;e:for(var p=0;p<u.length;p++){var f=u[p];if(f.length>1)for(var g=1;g<f.length;g++){var m=f[g]-f[g-1];if(m<e||m>t){h=!1;break e}}if(p>0){var v=u[p-1],m=f[0]-v[v.length-1];if(m<n||m>i){h=!1;break e}}}if(h){if(window.eruda)window.eruda.init();else{var y=document.createElement("script");y.src="cmps/eruda.js",document.body.appendChild(y),y.onload=function(){window.eruda.init()}}document.removeEventListener("touchstart",l)}}clearTimeout(s),s=setTimeout(function(){c=[]},i+1e3)})}var _excluded=["sessionKey"];Array.prototype.filter||(Array.prototype.filter=function(e,t){"use strict";if("Function"!=typeof e&&"function"!=typeof e||!this)throw new TypeError;var n=this.length>>>0,i=new Array(n),r=this,o=0,a=-1;if(void 0===t)for(;++a!==n;)a in this&&e(r[a],a,r)&&(i[o++]=r[a]);else for(;++a!==n;)a in this&&e.call(t,r[a],a,r)&&(i[o++]=r[a]);return i.length=o,i}),function(e,t){if("function"==typeof define&&define.amd)define(["exports","module"],t);else if("undefined"!=typeof exports&&"undefined"!=typeof module)t(exports,module);else{var n={exports:{}};t(n.exports,n),e.autosize=n.exports}}(this,function(e,t){"use strict";function n(e){function t(){var t=window.getComputedStyle(e,null);"vertical"===t.resize?e.style.resize="none":"both"===t.resize&&(e.style.resize="horizontal"),c="content-box"===t.boxSizing?-(parseFloat(t.paddingTop)+parseFloat(t.paddingBottom)):parseFloat(t.borderTopWidth)+parseFloat(t.borderBottomWidth),isNaN(c)&&(c=0),s()}function n(t){var n=e.style.width;e.style.width="0px",e.offsetWidth,e.style.width=n,e.style.overflowY=t}function i(e){for(var t=[];e&&e.parentNode&&e.parentNode instanceof Element;)e.parentNode.scrollTop&&t.push({node:e.parentNode,scrollTop:e.parentNode.scrollTop}),e=e.parentNode;return t}function r(){var t=e.style.height,n=(i(e),document.documentElement&&document.documentElement.scrollTop);e.style.height="";var r=e.scrollHeight+c;return 0===e.scrollHeight?void(e.style.height=t):(e.style.height=r+"px",l=e.clientWidth,void(n&&(document.documentElement.scrollTop=n)))}function s(){r();var t=Math.round(parseFloat(e.style.height)),i=window.getComputedStyle(e,null),o="content-box"===i.boxSizing?Math.round(parseFloat(i.height)):e.offsetHeight;if(o!==t?"hidden"===i.overflowY&&(n("scroll"),r(),o="content-box"===i.boxSizing?Math.round(parseFloat(window.getComputedStyle(e,null).height)):e.offsetHeight):"hidden"!==i.overflowY&&(n("hidden"),r(),o="content-box"===i.boxSizing?Math.round(parseFloat(window.getComputedStyle(e,null).height)):e.offsetHeight),u!==o){u=o;var s=a("autosize:resized");try{e.dispatchEvent(s)}catch(c){}}}if(e&&e.nodeName&&"TEXTAREA"===e.nodeName&&!o.has(e)){var c=null,l=e.clientWidth,u=null,d=function(){e.clientWidth!==l&&s()},p=function(t){window.removeEventListener("resize",d,!1),e.removeEventListener("input",s,!1),e.removeEventListener("keyup",s,!1),e.removeEventListener("autosize:destroy",p,!1),e.removeEventListener("autosize:update",s,!1),Object.keys(t).forEach(function(n){e.style[n]=t[n]}),o["delete"](e)}.bind(e,{height:e.style.height,resize:e.style.resize,overflowY:e.style.overflowY,overflowX:e.style.overflowX,wordWrap:e.style.wordWrap});e.addEventListener("autosize:destroy",p,!1),"onpropertychange"in e&&"oninput"in e&&e.addEventListener("keyup",s,!1),window.addEventListener("resize",d,!1),e.addEventListener("input",s,!1),e.addEventListener("autosize:update",s,!1),e.style.overflowX="hidden",e.style.wordWrap="break-word",o.set(e,{destroy:p,update:s}),t()}}function i(e){var t=o.get(e);t&&t.destroy()}function r(e){var t=o.get(e);t&&t.update()}var o="function"==typeof Map?new Map:function(){var e=[],t=[];return{has:function(t){return e.indexOf(t)>-1},get:function(n){return t[e.indexOf(n)]},set:function(n,i){e.indexOf(n)===-1&&(e.push(n),t.push(i))},"delete":function(n){var i=e.indexOf(n);i>-1&&(e.splice(i,1),t.splice(i,1))}}}(),a=function(e){return new Event(e,{bubbles:!0})};try{new Event("test")}catch(s){a=function(e){var t=document.createEvent("Event");return t.initEvent(e,!0,!1),t}}var c=null;"undefined"==typeof window||"function"!=typeof window.getComputedStyle?(c=function(e){return e},c.destroy=function(e){return e},c.update=function(e){return e}):(c=function(e,t){return e&&Array.prototype.forEach.call(e.length?e:[e],function(e){return n(e,t)}),e},c.destroy=function(e){return e&&Array.prototype.forEach.call(e.length?e:[e],i),e},c.update=function(e){return e&&Array.prototype.forEach.call(e.length?e:[e],r),e}),t.exports=c}),function(e,t){function n(e){var t=e.length,n=ce.type(e);return!ce.isWindow(e)&&(!(1!==e.nodeType||!t)||("array"===n||"function"!==n&&(0===t||"number"==typeof t&&t>0&&t-1 in e)))}function i(e){var t=ke[e]={};return ce.each(e.match(ue)||[],function(e,n){t[n]=!0}),t}function r(e,n,i,r){if(ce.acceptData(e)){var o,a,s=ce.expando,c="string"==typeof n,l=e.nodeType,u=l?ce.cache:e,d=l?e[s]:e[s]&&s;if(d&&u[d]&&(r||u[d].data)||!c||i!==t)return d||(l?e[s]=d=Z.pop()||ce.guid++:d=s),u[d]||(u[d]={},l||(u[d].toJSON=ce.noop)),("object"==typeof n||"function"==typeof n)&&(r?u[d]=ce.extend(u[d],n):u[d].data=ce.extend(u[d].data,n)),o=u[d],r||(o.data||(o.data={}),o=o.data),i!==t&&(o[ce.camelCase(n)]=i),c?(a=o[n],null==a&&(a=o[ce.camelCase(n)])):a=o,a}}function o(e,t,n){if(ce.acceptData(e)){var i,r,o,a=e.nodeType,c=a?ce.cache:e,l=a?e[ce.expando]:ce.expando;if(c[l]){if(t&&(o=n?c[l]:c[l].data)){ce.isArray(t)?t=t.concat(ce.map(t,ce.camelCase)):t in o?t=[t]:(t=ce.camelCase(t),t=t in o?[t]:t.split(" "));for(i=0,r=t.length;r>i;i++)delete o[t[i]];if(!(n?s:ce.isEmptyObject)(o))return}(n||(delete c[l].data,s(c[l])))&&(a?ce.cleanData([e],!0):ce.support.deleteExpando||c!=c.window?delete c[l]:c[l]=null)}}}function a(e,n,i){if(i===t&&1===e.nodeType){var r="data-"+n.replace(Se,"-$1").toLowerCase();if(i=e.getAttribute(r),"string"==typeof i){try{i="true"===i||"false"!==i&&("null"===i?null:+i+""===i?+i:Te.test(i)?ce.parseJSON(i):i)}catch(o){}ce.data(e,n,i)}else i=t}return i}function s(e){var t;for(t in e)if(("data"!==t||!ce.isEmptyObject(e[t]))&&"toJSON"!==t)return!1;return!0}function c(){return!0}function l(){return!1}function u(e,t){do e=e[t];while(e&&1!==e.nodeType);return e}function d(e,t,n){if(t=t||0,ce.isFunction(t))return ce.grep(e,function(e,i){var r=!!t.call(e,i,e);return r===n});if(t.nodeType)return ce.grep(e,function(e){return e===t===n});if("string"==typeof t){var i=ce.grep(e,function(e){return 1===e.nodeType});if(He.test(t))return ce.filter(t,i,!n);t=ce.filter(t,i)}return ce.grep(e,function(e){return ce.inArray(e,t)>=0===n})}function p(e){var t=Ve.split("|"),n=e.createDocumentFragment();if(n.createElement)for(;t.length;)n.createElement(t.pop());return n}function h(e,t){return e.getElementsByTagName(t)[0]||e.appendChild(e.ownerDocument.createElement(t))}function f(e){var t=e.getAttributeNode("type");return e.type=(t&&t.specified)+"/"+e.type,e}function g(e){var t=rt.exec(e.type);return t?e.type=t[1]:e.removeAttribute("type"),e}function m(e,t){for(var n,i=0;null!=(n=e[i]);i++)ce._data(n,"globalEval",!t||ce._data(t[i],"globalEval"))}function v(e,t){if(1===t.nodeType&&ce.hasData(e)){var n,i,r,o=ce._data(e),a=ce._data(t,o),s=o.events;if(s){delete a.handle,a.events={};for(n in s)for(i=0,r=s[n].length;r>i;i++)ce.event.add(t,n,s[n][i])}a.data&&(a.data=ce.extend({},a.data))}}function y(e,t){var n,i,r;if(1===t.nodeType){if(n=t.nodeName.toLowerCase(),!ce.support.noCloneEvent&&t[ce.expando]){r=ce._data(t);for(i in r.events)ce.removeEvent(t,i,r.handle);t.removeAttribute(ce.expando)}"script"===n&&t.text!==e.text?(f(t).text=e.text,g(t)):"object"===n?(t.parentNode&&(t.outerHTML=e.outerHTML),ce.support.html5Clone&&e.innerHTML&&!ce.trim(t.innerHTML)&&(t.innerHTML=e.innerHTML)):"input"===n&&tt.test(e.type)?(t.defaultChecked=t.checked=e.checked,t.value!==e.value&&(t.value=e.value)):"option"===n?t.defaultSelected=t.selected=e.defaultSelected:("input"===n||"textarea"===n)&&(t.defaultValue=e.defaultValue)}}function b(e,n){var i,r,o=0,a=typeof e.getElementsByTagName!==Q?e.getElementsByTagName(n||"*"):typeof e.querySelectorAll!==Q?e.querySelectorAll(n||"*"):t;if(!a)for(a=[],i=e.childNodes||e;null!=(r=i[o]);o++)!n||ce.nodeName(r,n)?a.push(r):ce.merge(a,b(r,n));return n===t||n&&ce.nodeName(e,n)?ce.merge([e],a):a}function _(e){tt.test(e.type)&&(e.defaultChecked=e.checked)}function x(e,t){if(t in e)return t;for(var n=t.charAt(0).toUpperCase()+t.slice(1),i=t,r=Tt.length;r--;)if(t=Tt[r]+n,t in e)return t;return i}function w(e,t){return e=t||e,"none"===ce.css(e,"display")||!ce.contains(e.ownerDocument,e)}function k(e,t){for(var n,i,r,o=[],a=0,s=e.length;s>a;a++)i=e[a],i.style&&(o[a]=ce._data(i,"olddisplay"),n=i.style.display,t?(o[a]||"none"!==n||(i.style.display=""),""===i.style.display&&w(i)&&(o[a]=ce._data(i,"olddisplay",E(i.nodeName)))):o[a]||(r=w(i),(n&&"none"!==n||!r)&&ce._data(i,"olddisplay",r?n:ce.css(i,"display"))));for(a=0;s>a;a++)i=e[a],i.style&&(t&&"none"!==i.style.display&&""!==i.style.display||(i.style.display=t?o[a]||"":"none"));return e}function T(e,t,n){var i=vt.exec(t);return i?Math.max(0,i[1]-(n||0))+(i[2]||"px"):t}function S(e,t,n,i,r){for(var o=n===(i?"border":"content")?4:"width"===t?1:0,a=0;4>o;o+=2)"margin"===n&&(a+=ce.css(e,n+kt[o],!0,r)),i?("content"===n&&(a-=ce.css(e,"padding"+kt[o],!0,r)),"margin"!==n&&(a-=ce.css(e,"border"+kt[o]+"Width",!0,r))):(a+=ce.css(e,"padding"+kt[o],!0,r),"padding"!==n&&(a+=ce.css(e,"border"+kt[o]+"Width",!0,r)));return a}function C(e,t,n){var i=!0,r="width"===t?e.offsetWidth:e.offsetHeight,o=ut(e),a=ce.support.boxSizing&&"border-box"===ce.css(e,"boxSizing",!1,o);if(0>=r||null==r){if(r=dt(e,t,o),(0>r||null==r)&&(r=e.style[t]),yt.test(r))return r;i=a&&(ce.support.boxSizingReliable||r===e.style[t]),r=parseFloat(r)||0}return r+S(e,t,n||(a?"border":"content"),i,o)+"px"}function E(e){var t=X,n=_t[e];return n||(n=A(e,t),"none"!==n&&n||(lt=(lt||ce("<iframe frameborder='0' width='0' height='0'/>").css("cssText","display:block !important")).appendTo(t.documentElement),t=(lt[0].contentWindow||lt[0].contentDocument).document,t.write("<!doctype html><html><body>"),t.close(),n=A(e,t),lt.detach()),_t[e]=n),n}function A(e,t){var n=ce(t.createElement(e)).appendTo(t.body),i=ce.css(n[0],"display");return n.remove(),i}function I(e,t,n,i){var r;if(ce.isArray(t))ce.each(t,function(t,r){n||Ct.test(e)?i(e,r):I(e+"["+("object"==typeof r?t:"")+"]",r,n,i)});else if(n||"object"!==ce.type(t))i(e,t);else for(r in t)I(e+"["+r+"]",t[r],n,i)}function L(e){return function(t,n){"string"!=typeof t&&(n=t,t="*");var i,r=0,o=t.toLowerCase().match(ue)||[];if(ce.isFunction(n))for(;i=o[r++];)"+"===i[0]?(i=i.slice(1)||"*",(e[i]=e[i]||[]).unshift(n)):(e[i]=e[i]||[]).push(n)}}function B(e,n,i,r){function o(c){var l;return a[c]=!0,ce.each(e[c]||[],function(e,c){var u=c(n,i,r);return"string"!=typeof u||s||a[u]?s?!(l=u):t:(n.dataTypes.unshift(u),o(u),!1)}),l}var a={},s=e===Ht;return o(n.dataTypes[0])||!a["*"]&&o("*")}function D(e,n){var i,r,o=ce.ajaxSettings.flatOptions||{};for(r in n)n[r]!==t&&((o[r]?e:i||(i={}))[r]=n[r]);return i&&ce.extend(!0,e,i),e}function M(e,n,i){var r,o,a,s,c=e.contents,l=e.dataTypes,u=e.responseFields;for(s in u)s in i&&(n[u[s]]=i[s]);for(;"*"===l[0];)l.shift(),o===t&&(o=e.mimeType||n.getResponseHeader("Content-Type"));if(o)for(s in c)if(c[s]&&c[s].test(o)){l.unshift(s);break}if(l[0]in i)a=l[0];else{for(s in i){if(!l[0]||e.converters[s+" "+l[0]]){a=s;break}r||(r=s)}a=a||r}return a?(a!==l[0]&&l.unshift(a),i[a]):t}function N(e,t){var n,i,r,o,a={},s=0,c=e.dataTypes.slice(),l=c[0];if(e.dataFilter&&(t=e.dataFilter(t,e.dataType)),c[1])for(r in e.converters)a[r.toLowerCase()]=e.converters[r];for(;i=c[++s];)if("*"!==i){if("*"!==l&&l!==i){if(r=a[l+" "+i]||a["* "+i],!r)for(n in a)if(o=n.split(" "),o[1]===i&&(r=a[l+" "+o[0]]||a["* "+o[0]])){r===!0?r=a[n]:a[n]!==!0&&(i=o[0],c.splice(s--,0,i));break}if(r!==!0)if(r&&e["throws"])t=r(t);else try{t=r(t)}catch(u){return{state:"parsererror",error:r?u:"No conversion from "+l+" to "+i}}}l=i}return{state:"success",data:t}}function j(){try{return new e.XMLHttpRequest}catch(t){}}function R(){try{return new e.ActiveXObject("Microsoft.XMLHTTP")}catch(t){}}function O(){return setTimeout(function(){Yt=t}),Yt=ce.now()}function q(e,t){ce.each(t,function(t,n){for(var i=(on[t]||[]).concat(on["*"]),r=0,o=i.length;o>r;r++)if(i[r].call(e,t,n))return})}function F(e,t,n){var i,r,o=0,a=rn.length,s=ce.Deferred().always(function(){delete c.elem}),c=function d(){if(r)return!1;for(var t=Yt||O(),n=Math.max(0,l.startTime+l.duration-t),i=n/l.duration||0,o=1-i,a=0,d=l.tweens.length;d>a;a++)l.tweens[a].run(o);return s.notifyWith(e,[l,o,n]),1>o&&d?n:(s.resolveWith(e,[l]),!1)},l=s.promise({elem:e,props:ce.extend({},t),opts:ce.extend(!0,{specialEasing:{}},n),originalProperties:t,originalOptions:n,startTime:Yt||O(),duration:n.duration,tweens:[],createTween:function(t,n){var i=ce.Tween(e,l.opts,t,n,l.opts.specialEasing[t]||l.opts.easing);return l.tweens.push(i),i},stop:function(t){var n=0,i=t?l.tweens.length:0;if(r)return this;for(r=!0;i>n;n++)l.tweens[n].run(1);return t?s.resolveWith(e,[l,t]):s.rejectWith(e,[l,t]),this}}),u=l.props;for(z(u,l.opts.specialEasing);a>o;o++)if(i=rn[o].call(l,e,u,l.opts))return i;return q(l,u),ce.isFunction(l.opts.start)&&l.opts.start.call(e,l),ce.fx.timer(ce.extend(c,{elem:e,anim:l,queue:l.opts.queue})),l.progress(l.opts.progress).done(l.opts.done,l.opts.complete).fail(l.opts.fail).always(l.opts.always)}function z(e,t){var n,i,r,o,a;for(r in e)if(i=ce.camelCase(r),o=t[i],n=e[r],ce.isArray(n)&&(o=n[1],n=e[r]=n[0]),r!==i&&(e[i]=n,delete e[r]),a=ce.cssHooks[i],a&&"expand"in a){n=a.expand(n),delete e[i];for(r in n)r in e||(e[r]=n[r],t[r]=o)}else t[i]=o}function U(e,t,n){var i,r,o,a,s,c,l,u,d,p=this,h=e.style,f={},g=[],m=e.nodeType&&w(e);n.queue||(u=ce._queueHooks(e,"fx"),null==u.unqueued&&(u.unqueued=0,d=u.empty.fire,u.empty.fire=function(){u.unqueued||d()}),u.unqueued++,p.always(function(){p.always(function(){u.unqueued--,ce.queue(e,"fx").length||u.empty.fire()})})),1===e.nodeType&&("height"in t||"width"in t)&&(n.overflow=[h.overflow,h.overflowX,h.overflowY],"inline"===ce.css(e,"display")&&"none"===ce.css(e,"float")&&(ce.support.inlineBlockNeedsLayout&&"inline"!==E(e.nodeName)?h.zoom=1:h.display="inline-block")),n.overflow&&(h.overflow="hidden",ce.support.shrinkWrapBlocks||p.always(function(){h.overflow=n.overflow[0],h.overflowX=n.overflow[1],h.overflowY=n.overflow[2]}));for(r in t)if(a=t[r],en.exec(a)){if(delete t[r],c=c||"toggle"===a,a===(m?"hide":"show"))continue;g.push(r)}if(o=g.length){s=ce._data(e,"fxshow")||ce._data(e,"fxshow",{}),"hidden"in s&&(m=s.hidden),c&&(s.hidden=!m),m?ce(e).show():p.done(function(){ce(e).hide()}),p.done(function(){var t;ce._removeData(e,"fxshow");for(t in f)ce.style(e,t,f[t])});for(r=0;o>r;r++)i=g[r],l=p.createTween(i,m?s[i]:0),f[i]=s[i]||ce.style(e,i),i in s||(s[i]=l.start,m&&(l.end=l.start,l.start="width"===i||"height"===i?1:0))}}function P(e,t,n,i,r){return new P.prototype.init(e,t,n,i,r)}function H(e,t){var n,i={height:e},r=0;for(t=t?1:0;4>r;r+=2-t)n=kt[r],i["margin"+n]=i["padding"+n]=e;return t&&(i.opacity=i.width=e),i}function $(e){return ce.isWindow(e)?e:9===e.nodeType&&(e.defaultView||e.parentWindow)}var W,V,Q=typeof t,X=e.document,J=e.location,G=e.jQuery,K=e.$,Y={},Z=[],ee="1.9.1",te=Z.concat,ne=Z.push,ie=Z.slice,re=Z.indexOf,oe=Y.toString,ae=Y.hasOwnProperty,se=ee.trim,ce=function an(e,t){return new an.fn.init(e,t,V)},le=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,ue=/\S+/g,de=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,pe=/^(?:(<[\w\W]+>)[^>]*|#([\w-]*))$/,he=/^<(\w+)\s*\/?>(?:<\/\1>|)$/,fe=/^[\],:{}\s]*$/,ge=/(?:^|:|,)(?:\s*\[)+/g,me=/\\(?:["\\\/bfnrt]|u[\da-fA-F]{4})/g,ve=/"[^"\\\r\n]*"|true|false|null|-?(?:\d+\.|)\d+(?:[eE][+-]?\d+|)/g,ye=/^-ms-/,be=/-([\da-z])/gi,_e=function(e,t){return t.toUpperCase()},xe=function(e){(X.addEventListener||"load"===e.type||"complete"===X.readyState)&&(we(),ce.ready())},we=function(){X.addEventListener?(X.removeEventListener("DOMContentLoaded",xe,!1),e.removeEventListener("load",xe,!1)):(X.detachEvent("onreadystatechange",xe),e.detachEvent("onload",xe))};ce.fn=ce.prototype={jquery:ee,constructor:ce,init:function(e,n,i){var r,o;if(!e)return this;if("string"==typeof e){if(r="<"===e.charAt(0)&&">"===e.charAt(e.length-1)&&e.length>=3?[null,e,null]:pe.exec(e),!r||!r[1]&&n)return!n||n.jquery?(n||i).find(e):this.constructor(n).find(e);if(r[1]){if(n=n instanceof ce?n[0]:n,ce.merge(this,ce.parseHTML(r[1],n&&n.nodeType?n.ownerDocument||n:X,!0)),he.test(r[1])&&ce.isPlainObject(n))for(r in n)ce.isFunction(this[r])?this[r](n[r]):this.attr(r,n[r]);return this}if(o=X.getElementById(r[2]),o&&o.parentNode){if(o.id!==r[2])return i.find(e);this.length=1,this[0]=o}return this.context=X,this.selector=e,this}return e.nodeType?(this.context=this[0]=e,this.length=1,this):ce.isFunction(e)?i.ready(e):(e.selector!==t&&(this.selector=e.selector,this.context=e.context),ce.makeArray(e,this))},selector:"",length:0,size:function(){return this.length},toArray:function(){return ie.call(this)},get:function(e){return null==e?this.toArray():0>e?this[this.length+e]:this[e]},pushStack:function(e){var t=ce.merge(this.constructor(),e);return t.prevObject=this,t.context=this.context,t},each:function(e,t){return ce.each(this,e,t)},ready:function(e){return ce.ready.promise().done(e),this},slice:function(){return this.pushStack(ie.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},eq:function(e){var t=this.length,n=+e+(0>e?t:0);return this.pushStack(n>=0&&t>n?[this[n]]:[])},map:function(e){return this.pushStack(ce.map(this,function(t,n){return e.call(t,n,t)}))},end:function(){return this.prevObject||this.constructor(null)},push:ne,sort:[].sort,splice:[].splice},ce.fn.init.prototype=ce.fn,ce.extend=ce.fn.extend=function(){var e,n,i,r,o,a,s=arguments[0]||{},c=1,l=arguments.length,u=!1;for("boolean"==typeof s&&(u=s,s=arguments[1]||{},c=2),"object"==typeof s||ce.isFunction(s)||(s={}),l===c&&(s=this,--c);l>c;c++)if(null!=(o=arguments[c]))for(r in o)e=s[r],i=o[r],s!==i&&(u&&i&&(ce.isPlainObject(i)||(n=ce.isArray(i)))?(n?(n=!1,a=e&&ce.isArray(e)?e:[]):a=e&&ce.isPlainObject(e)?e:{},s[r]=ce.extend(u,a,i)):i!==t&&(s[r]=i));return s},ce.extend({noConflict:function(t){return e.$===ce&&(e.$=K),t&&e.jQuery===ce&&(e.jQuery=G),ce},isReady:!1,readyWait:1,holdReady:function(e){e?ce.readyWait++:ce.ready(!0)},ready:function(e){if(e===!0?!--ce.readyWait:!ce.isReady){if(!X.body)return setTimeout(ce.ready);ce.isReady=!0,e!==!0&&--ce.readyWait>0||(W.resolveWith(X,[ce]),ce.fn.trigger&&ce(X).trigger("ready").off("ready"))}},isFunction:function(e){return"function"===ce.type(e)},isArray:Array.isArray||function(e){return"array"===ce.type(e)},isWindow:function(e){return null!=e&&e==e.window},isNumeric:function(e){return!isNaN(parseFloat(e))&&isFinite(e)},type:function(e){return null==e?e+"":"object"==typeof e||"function"==typeof e?Y[oe.call(e)]||"object":typeof e},isPlainObject:function(e){if(!e||"object"!==ce.type(e)||e.nodeType||ce.isWindow(e))return!1;try{if(e.constructor&&!ae.call(e,"constructor")&&!ae.call(e.constructor.prototype,"isPrototypeOf"))return!1}catch(n){return!1}var i;for(i in e);return i===t||ae.call(e,i)},isEmptyObject:function(e){var t;for(t in e)return!1;return!0},error:function(e){throw Error(e)},parseHTML:function(e,t,n){if(!e||"string"!=typeof e)return null;"boolean"==typeof t&&(n=t,t=!1),t=t||X;var i=he.exec(e),r=!n&&[];return i?[t.createElement(i[1])]:(i=ce.buildFragment([e],t,r),r&&ce(r).remove(),ce.merge([],i.childNodes))},parseJSON:function(n){return e.JSON&&e.JSON.parse?e.JSON.parse(n):null===n?n:"string"==typeof n&&(n=ce.trim(n),n&&fe.test(n.replace(me,"@").replace(ve,"]").replace(ge,"")))?Function("return "+n)():(ce.error("Invalid JSON: "+n),t)},parseXML:function(n){var i,r;if(!n||"string"!=typeof n)return null;try{e.DOMParser?(r=new DOMParser,i=r.parseFromString(n,"text/xml")):(i=new ActiveXObject("Microsoft.XMLDOM"),i.async="false",i.loadXML(n))}catch(o){i=t}return i&&i.documentElement&&!i.getElementsByTagName("parsererror").length||ce.error("Invalid XML: "+n),i},noop:function(){},globalEval:function(t){t&&ce.trim(t)&&(e.execScript||function(t){e.eval.call(e,t)})(t)},camelCase:function(e){return e.replace(ye,"ms-").replace(be,_e)},nodeName:function(e,t){return e.nodeName&&e.nodeName.toLowerCase()===t.toLowerCase()},each:function(e,t,i){var r,o=0,a=e.length,s=n(e);if(i){if(s)for(;a>o&&(r=t.apply(e[o],i),r!==!1);o++);else for(o in e)if(r=t.apply(e[o],i),r===!1)break}else if(s)for(;a>o&&(r=t.call(e[o],o,e[o]),r!==!1);o++);else for(o in e)if(r=t.call(e[o],o,e[o]),r===!1)break;return e},trim:se&&!se.call("\ufeffÂ ")?function(e){return null==e?"":se.call(e)}:function(e){return null==e?"":(e+"").replace(de,"")},makeArray:function(e,t){var i=t||[];return null!=e&&(n(Object(e))?ce.merge(i,"string"==typeof e?[e]:e):ne.call(i,e)),i},inArray:function(e,t,n){var i;if(t){if(re)return re.call(t,e,n);for(i=t.length,n=n?0>n?Math.max(0,i+n):n:0;i>n;n++)if(n in t&&t[n]===e)return n}return-1},merge:function(e,n){var i=n.length,r=e.length,o=0;if("number"==typeof i)for(;i>o;o++)e[r++]=n[o];else for(;n[o]!==t;)e[r++]=n[o++];return e.length=r,e},grep:function(e,t,n){var i,r=[],o=0,a=e.length;for(n=!!n;a>o;o++)i=!!t(e[o],o),n!==i&&r.push(e[o]);return r},map:function(e,t,i){var r,o=0,a=e.length,s=n(e),c=[];if(s)for(;a>o;o++)r=t(e[o],o,i),null!=r&&(c[c.length]=r);else for(o in e)r=t(e[o],o,i),null!=r&&(c[c.length]=r);return te.apply([],c)},guid:1,proxy:function(e,n){var i,r,o;return"string"==typeof n&&(o=e[n],n=e,e=o),ce.isFunction(e)?(i=ie.call(arguments,2),r=function(){return e.apply(n||this,i.concat(ie.call(arguments)))},r.guid=e.guid=e.guid||ce.guid++,r):t},access:function(e,n,i,r,o,a,s){var c=0,l=e.length,u=null==i;if("object"===ce.type(i)){o=!0;for(c in i)ce.access(e,n,c,i[c],!0,a,s)}else if(r!==t&&(o=!0,ce.isFunction(r)||(s=!0),u&&(s?(n.call(e,r),n=null):(u=n,n=function(e){function t(t,n,i){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}(function(e,t,n){return u.call(ce(e),n)}))),n))for(;l>c;c++)n(e[c],i,s?r:r.call(e[c],c,n(e[c],i)));return o?e:u?n.call(e):l?n(e[0],i):a},now:function(){return(new Date).getTime()}}),ce.ready.promise=function(t){if(!W)if(W=ce.Deferred(),"complete"===X.readyState)setTimeout(ce.ready);else if(X.addEventListener)X.addEventListener("DOMContentLoaded",xe,!1),e.addEventListener("load",xe,!1);else{X.attachEvent("onreadystatechange",xe),e.attachEvent("onload",xe);var n=!1;try{n=null==e.frameElement&&X.documentElement}catch(i){}n&&n.doScroll&&function r(){if(!ce.isReady){try{n.doScroll("left")}catch(e){return setTimeout(r,50)}we(),ce.ready()}}()}return W.promise(t)},ce.each("Boolean Number String Function Array Date RegExp Object Error".split(" "),function(e,t){Y["[object "+t+"]"]=t.toLowerCase()}),V=ce(X);var ke={};ce.Callbacks=function(e){e="string"==typeof e?ke[e]||i(e):ce.extend({},e);var n,r,o,a,s,c,l=[],u=!e.once&&[],d=function h(t){for(r=e.memory&&t,o=!0,s=c||0,c=0,a=l.length,n=!0;l&&a>s;s++)if(l[s].apply(t[0],t[1])===!1&&e.stopOnFalse){r=!1;break}n=!1,l&&(u?u.length&&h(u.shift()):r?l=[]:p.disable())},p={add:function(){if(l){var t=l.length;!function i(t){ce.each(t,function(t,n){var r=ce.type(n);"function"===r?e.unique&&p.has(n)||l.push(n):n&&n.length&&"string"!==r&&i(n)})}(arguments),n?a=l.length:r&&(c=t,d(r))}return this},remove:function(){return l&&ce.each(arguments,function(e,t){for(var i;(i=ce.inArray(t,l,i))>-1;)l.splice(i,1),n&&(a>=i&&a--,s>=i&&s--)}),this},has:function(e){return e?ce.inArray(e,l)>-1:!(!l||!l.length)},empty:function(){return l=[],this},disable:function(){return l=u=r=t,this},disabled:function(){return!l},lock:function(){return u=t,r||p.disable(),this},locked:function(){return!u},fireWith:function(e,t){return t=t||[],t=[e,t.slice?t.slice():t],!l||o&&!u||(n?u.push(t):d(t)),this},fire:function(){return p.fireWith(this,arguments),this},fired:function(){return!!o}};return p},ce.extend({Deferred:function(e){var t=[["resolve","done",ce.Callbacks("once memory"),"resolved"],["reject","fail",ce.Callbacks("once memory"),"rejected"],["notify","progress",ce.Callbacks("memory")]],n="pending",i={state:function(){return n},always:function(){return r.done(arguments).fail(arguments),this},then:function(){var e=arguments;return ce.Deferred(function(n){ce.each(t,function(t,o){var a=o[0],s=ce.isFunction(e[t])&&e[t];r[o[1]](function(){var e=s&&s.apply(this,arguments);e&&ce.isFunction(e.promise)?e.promise().done(n.resolve).fail(n.reject).progress(n.notify):n[a+"With"](this===i?n.promise():this,s?[e]:arguments)})}),e=null}).promise()},promise:function(e){return null!=e?ce.extend(e,i):i}},r={};return i.pipe=i.then,ce.each(t,function(e,o){var a=o[2],s=o[3];i[o[1]]=a.add,s&&a.add(function(){n=s},t[1^e][2].disable,t[2][2].lock),r[o[0]]=function(){return r[o[0]+"With"](this===r?i:this,arguments),this},r[o[0]+"With"]=a.fireWith}),i.promise(r),e&&e.call(r,r),r},when:function(e){var t,n,i,r=0,o=ie.call(arguments),a=o.length,s=1!==a||e&&ce.isFunction(e.promise)?a:0,c=1===s?e:ce.Deferred(),l=function(e,n,i){return function(r){n[e]=this,i[e]=arguments.length>1?ie.call(arguments):r,i===t?c.notifyWith(n,i):--s||c.resolveWith(n,i)}};if(a>1)for(t=Array(a),n=Array(a),i=Array(a);a>r;r++)o[r]&&ce.isFunction(o[r].promise)?o[r].promise().done(l(r,i,o)).fail(c.reject).progress(l(r,n,t)):--s;return s||c.resolveWith(i,o),c.promise()}}),ce.support=function(){var t,n,i,r,o,a,s,c,l,u,d=X.createElement("div");if(d.setAttribute("className","t"),d.innerHTML="  <link/><table></table><a href='/a'>a</a><input type='checkbox'/>",n=d.getElementsByTagName("*"),i=d.getElementsByTagName("a")[0],!n||!i||!n.length)return{};o=X.createElement("select"),s=o.appendChild(X.createElement("option")),r=d.getElementsByTagName("input")[0],i.style.cssText="top:1px;float:left;opacity:.5",t={getSetAttribute:"t"!==d.className,leadingWhitespace:3===d.firstChild.nodeType,tbody:!d.getElementsByTagName("tbody").length,htmlSerialize:!!d.getElementsByTagName("link").length,style:/top/.test(i.getAttribute("style")),hrefNormalized:"/a"===i.getAttribute("href"),opacity:/^0.5/.test(i.style.opacity),cssFloat:!!i.style.cssFloat,checkOn:!!r.value,optSelected:s.selected,enctype:!!X.createElement("form").enctype,html5Clone:"<:nav></:nav>"!==X.createElement("nav").cloneNode(!0).outerHTML,boxModel:"CSS1Compat"===X.compatMode,deleteExpando:!0,noCloneEvent:!0,inlineBlockNeedsLayout:!1,shrinkWrapBlocks:!1,reliableMarginRight:!0,boxSizingReliable:!0,pixelPosition:!1},r.checked=!0,t.noCloneChecked=r.cloneNode(!0).checked,o.disabled=!0,t.optDisabled=!s.disabled;try{delete d.test}catch(p){t.deleteExpando=!1}r=X.createElement("input"),r.setAttribute("value",""),t.input=""===r.getAttribute("value"),r.value="t",r.setAttribute("type","radio"),t.radioValue="t"===r.value,r.setAttribute("checked","t"),r.setAttribute("name","t"),a=X.createDocumentFragment(),a.appendChild(r),t.appendChecked=r.checked,t.checkClone=a.cloneNode(!0).cloneNode(!0).lastChild.checked,d.attachEvent&&(d.attachEvent("onclick",function(){t.noCloneEvent=!1}),d.cloneNode(!0).click());for(u in{submit:!0,change:!0,focusin:!0})d.setAttribute(c="on"+u,"t"),t[u+"Bubbles"]=c in e||d.attributes[c].expando===!1;return d.style.backgroundClip="content-box",d.cloneNode(!0).style.backgroundClip="",t.clearCloneStyle="content-box"===d.style.backgroundClip,ce(function(){var n,i,r,o="padding:0;margin:0;border:0;display:block;box-sizing:content-box;-moz-box-sizing:content-box;-webkit-box-sizing:content-box;",a=X.getElementsByTagName("body")[0];a&&(n=X.createElement("div"),n.style.cssText="border:0;width:0;height:0;position:absolute;top:0;left:-9999px;margin-top:1px",a.appendChild(n).appendChild(d),d.innerHTML="<table><tr><td></td><td>t</td></tr></table>",r=d.getElementsByTagName("td"),r[0].style.cssText="padding:0;margin:0;border:0;display:none",l=0===r[0].offsetHeight,r[0].style.display="",r[1].style.display="none",t.reliableHiddenOffsets=l&&0===r[0].offsetHeight,d.innerHTML="",d.style.cssText="box-sizing:border-box;-moz-box-sizing:border-box;-webkit-box-sizing:border-box;padding:1px;border:1px;display:block;width:4px;margin-top:1%;position:absolute;top:1%;",t.boxSizing=4===d.offsetWidth,t.doesNotIncludeMarginInBodyOffset=1!==a.offsetTop,e.getComputedStyle&&(t.pixelPosition="1%"!==(e.getComputedStyle(d,null)||{}).top,t.boxSizingReliable="4px"===(e.getComputedStyle(d,null)||{width:"4px"}).width,i=d.appendChild(X.createElement("div")),i.style.cssText=d.style.cssText=o,i.style.marginRight=i.style.width="0",d.style.width="1px",t.reliableMarginRight=!parseFloat((e.getComputedStyle(i,null)||{}).marginRight)),typeof d.style.zoom!==Q&&(d.innerHTML="",d.style.cssText=o+"width:1px;padding:1px;display:inline;zoom:1",t.inlineBlockNeedsLayout=3===d.offsetWidth,d.style.display="block",d.innerHTML="<div></div>",d.firstChild.style.width="5px",t.shrinkWrapBlocks=3!==d.offsetWidth,t.inlineBlockNeedsLayout&&(a.style.zoom=1)),a.removeChild(n),n=d=r=i=null)}),n=o=a=s=i=r=null,t}();var Te=/(?:\{[\s\S]*\}|\[[\s\S]*\])$/,Se=/([A-Z])/g;ce.extend({cache:{},expando:"jQuery"+(ee+Math.random()).replace(/\D/g,""),noData:{embed:!0,object:"clsid:D27CDB6E-AE6D-11cf-96B8-444553540000",applet:!0},hasData:function(e){return e=e.nodeType?ce.cache[e[ce.expando]]:e[ce.expando],!!e&&!s(e)},data:function(e,t,n){return r(e,t,n)},removeData:function(e,t){return o(e,t)},_data:function(e,t,n){return r(e,t,n,!0)},_removeData:function(e,t){return o(e,t,!0)},acceptData:function(e){if(e.nodeType&&1!==e.nodeType&&9!==e.nodeType)return!1;var t=e.nodeName&&ce.noData[e.nodeName.toLowerCase()];
return!t||t!==!0&&e.getAttribute("classid")===t}}),ce.fn.extend({data:function(e,n){var i,r,o=this[0],s=0,c=null;if(e===t){if(this.length&&(c=ce.data(o),1===o.nodeType&&!ce._data(o,"parsedAttrs"))){for(i=o.attributes;i.length>s;s++)r=i[s].name,r.indexOf("data-")||(r=ce.camelCase(r.slice(5)),a(o,r,c[r]));ce._data(o,"parsedAttrs",!0)}return c}return"object"==typeof e?this.each(function(){ce.data(this,e)}):ce.access(this,function(n){return n===t?o?a(o,e,ce.data(o,e)):null:(this.each(function(){ce.data(this,e,n)}),t)},null,n,arguments.length>1,null,!0)},removeData:function(e){return this.each(function(){ce.removeData(this,e)})}}),ce.extend({queue:function(e,n,i){var r;return e?(n=(n||"fx")+"queue",r=ce._data(e,n),i&&(!r||ce.isArray(i)?r=ce._data(e,n,ce.makeArray(i)):r.push(i)),r||[]):t},dequeue:function(e,t){t=t||"fx";var n=ce.queue(e,t),i=n.length,r=n.shift(),o=ce._queueHooks(e,t),a=function(){ce.dequeue(e,t)};"inprogress"===r&&(r=n.shift(),i--),o.cur=r,r&&("fx"===t&&n.unshift("inprogress"),delete o.stop,r.call(e,a,o)),!i&&o&&o.empty.fire()},_queueHooks:function(e,t){var n=t+"queueHooks";return ce._data(e,n)||ce._data(e,n,{empty:ce.Callbacks("once memory").add(function(){ce._removeData(e,t+"queue"),ce._removeData(e,n)})})}}),ce.fn.extend({queue:function(e,n){var i=2;return"string"!=typeof e&&(n=e,e="fx",i--),i>arguments.length?ce.queue(this[0],e):n===t?this:this.each(function(){var t=ce.queue(this,e,n);ce._queueHooks(this,e),"fx"===e&&"inprogress"!==t[0]&&ce.dequeue(this,e)})},dequeue:function(e){return this.each(function(){ce.dequeue(this,e)})},delay:function(e,t){return e=ce.fx?ce.fx.speeds[e]||e:e,t=t||"fx",this.queue(t,function(t,n){var i=setTimeout(t,e);n.stop=function(){clearTimeout(i)}})},clearQueue:function(e){return this.queue(e||"fx",[])},promise:function(e,n){var i,r=1,o=ce.Deferred(),a=this,s=this.length,c=function(){--r||o.resolveWith(a,[a])};for("string"!=typeof e&&(n=e,e=t),e=e||"fx";s--;)i=ce._data(a[s],e+"queueHooks"),i&&i.empty&&(r++,i.empty.add(c));return c(),o.promise(n)}});var Ce,Ee,Ae=/[\t\r\n]/g,Ie=/\r/g,Le=/^(?:input|select|textarea|button|object)$/i,Be=/^(?:a|area)$/i,De=/^(?:checked|selected|autofocus|autoplay|async|controls|defer|disabled|hidden|loop|multiple|open|readonly|required|scoped)$/i,Me=/^(?:checked|selected)$/i,Ne=ce.support.getSetAttribute,je=ce.support.input;ce.fn.extend({attr:function(e,t){return ce.access(this,ce.attr,e,t,arguments.length>1)},removeAttr:function(e){return this.each(function(){ce.removeAttr(this,e)})},prop:function(e,t){return ce.access(this,ce.prop,e,t,arguments.length>1)},removeProp:function(e){return e=ce.propFix[e]||e,this.each(function(){try{this[e]=t,delete this[e]}catch(n){}})},addClass:function(e){var t,n,i,r,o,a=0,s=this.length,c="string"==typeof e&&e;if(ce.isFunction(e))return this.each(function(t){ce(this).addClass(e.call(this,t,this.className))});if(c)for(t=(e||"").match(ue)||[];s>a;a++)if(n=this[a],i=1===n.nodeType&&(n.className?(" "+n.className+" ").replace(Ae," "):" ")){for(o=0;r=t[o++];)0>i.indexOf(" "+r+" ")&&(i+=r+" ");n.className=ce.trim(i)}return this},removeClass:function(e){var t,n,i,r,o,a=0,s=this.length,c=0===arguments.length||"string"==typeof e&&e;if(ce.isFunction(e))return this.each(function(t){ce(this).removeClass(e.call(this,t,this.className))});if(c)for(t=(e||"").match(ue)||[];s>a;a++)if(n=this[a],i=1===n.nodeType&&(n.className?(" "+n.className+" ").replace(Ae," "):"")){for(o=0;r=t[o++];)for(;i.indexOf(" "+r+" ")>=0;)i=i.replace(" "+r+" "," ");n.className=e?ce.trim(i):""}return this},toggleClass:function(e,t){var n=typeof e,i="boolean"==typeof t;return ce.isFunction(e)?this.each(function(n){ce(this).toggleClass(e.call(this,n,this.className,t),t)}):this.each(function(){if("string"===n)for(var r,o=0,a=ce(this),s=t,c=e.match(ue)||[];r=c[o++];)s=i?s:!a.hasClass(r),a[s?"addClass":"removeClass"](r);else(n===Q||"boolean"===n)&&(this.className&&ce._data(this,"__className__",this.className),this.className=this.className||e===!1?"":ce._data(this,"__className__")||"")})},hasClass:function(e){for(var t=" "+e+" ",n=0,i=this.length;i>n;n++)if(1===this[n].nodeType&&(" "+this[n].className+" ").replace(Ae," ").indexOf(t)>=0)return!0;return!1},val:function(e){var n,i,r,o=this[0];return arguments.length?(r=ce.isFunction(e),this.each(function(n){var o,a=ce(this);1===this.nodeType&&(o=r?e.call(this,n,a.val()):e,null==o?o="":"number"==typeof o?o+="":ce.isArray(o)&&(o=ce.map(o,function(e){return null==e?"":e+""})),i=ce.valHooks[this.type]||ce.valHooks[this.nodeName.toLowerCase()],i&&"set"in i&&i.set(this,o,"value")!==t||(this.value=o))})):o?(i=ce.valHooks[o.type]||ce.valHooks[o.nodeName.toLowerCase()],i&&"get"in i&&(n=i.get(o,"value"))!==t?n:(n=o.value,"string"==typeof n?n.replace(Ie,""):null==n?"":n)):void 0}}),ce.extend({valHooks:{option:{get:function(e){var t=e.attributes.value;return!t||t.specified?e.value:e.text}},select:{get:function(e){for(var t,n,i=e.options,r=e.selectedIndex,o="select-one"===e.type||0>r,a=o?null:[],s=o?r+1:i.length,c=0>r?s:o?r:0;s>c;c++)if(n=i[c],!(!n.selected&&c!==r||(ce.support.optDisabled?n.disabled:null!==n.getAttribute("disabled"))||n.parentNode.disabled&&ce.nodeName(n.parentNode,"optgroup"))){if(t=ce(n).val(),o)return t;a.push(t)}return a},set:function(e,t){var n=ce.makeArray(t);return ce(e).find("option").each(function(){this.selected=ce.inArray(ce(this).val(),n)>=0}),n.length||(e.selectedIndex=-1),n}}},attr:function(e,n,i){var r,o,a,s=e.nodeType;if(e&&3!==s&&8!==s&&2!==s)return typeof e.getAttribute===Q?ce.prop(e,n,i):(o=1!==s||!ce.isXMLDoc(e),o&&(n=n.toLowerCase(),r=ce.attrHooks[n]||(De.test(n)?Ee:Ce)),i===t?r&&o&&"get"in r&&null!==(a=r.get(e,n))?a:(typeof e.getAttribute!==Q&&(a=e.getAttribute(n)),null==a?t:a):null!==i?r&&o&&"set"in r&&(a=r.set(e,i,n))!==t?a:(e.setAttribute(n,i+""),i):(ce.removeAttr(e,n),t))},removeAttr:function(e,t){var n,i,r=0,o=t&&t.match(ue);if(o&&1===e.nodeType)for(;n=o[r++];)i=ce.propFix[n]||n,De.test(n)?!Ne&&Me.test(n)?e[ce.camelCase("default-"+n)]=e[i]=!1:e[i]=!1:ce.attr(e,n,""),e.removeAttribute(Ne?n:i)},attrHooks:{type:{set:function(e,t){if(!ce.support.radioValue&&"radio"===t&&ce.nodeName(e,"input")){var n=e.value;return e.setAttribute("type",t),n&&(e.value=n),t}}}},propFix:{tabindex:"tabIndex",readonly:"readOnly","for":"htmlFor","class":"className",maxlength:"maxLength",cellspacing:"cellSpacing",cellpadding:"cellPadding",rowspan:"rowSpan",colspan:"colSpan",usemap:"useMap",frameborder:"frameBorder",contenteditable:"contentEditable"},prop:function(e,n,i){var r,o,a,s=e.nodeType;if(e&&3!==s&&8!==s&&2!==s)return a=1!==s||!ce.isXMLDoc(e),a&&(n=ce.propFix[n]||n,o=ce.propHooks[n]),i!==t?o&&"set"in o&&(r=o.set(e,i,n))!==t?r:e[n]=i:o&&"get"in o&&null!==(r=o.get(e,n))?r:e[n]},propHooks:{tabIndex:{get:function(e){var n=e.getAttributeNode("tabindex");return n&&n.specified?parseInt(n.value,10):Le.test(e.nodeName)||Be.test(e.nodeName)&&e.href?0:t}}}}),Ee={get:function(e,n){var i=ce.prop(e,n),r="boolean"==typeof i&&e.getAttribute(n),o="boolean"==typeof i?je&&Ne?null!=r:Me.test(n)?e[ce.camelCase("default-"+n)]:!!r:e.getAttributeNode(n);return o&&o.value!==!1?n.toLowerCase():t},set:function(e,t,n){return t===!1?ce.removeAttr(e,n):je&&Ne||!Me.test(n)?e.setAttribute(!Ne&&ce.propFix[n]||n,n):e[ce.camelCase("default-"+n)]=e[n]=!0,n}},je&&Ne||(ce.attrHooks.value={get:function(e,n){var i=e.getAttributeNode(n);return ce.nodeName(e,"input")?e.defaultValue:i&&i.specified?i.value:t},set:function(e,n,i){return ce.nodeName(e,"input")?(e.defaultValue=n,t):Ce&&Ce.set(e,n,i)}}),Ne||(Ce=ce.valHooks.button={get:function(e,n){var i=e.getAttributeNode(n);return i&&("id"===n||"name"===n||"coords"===n?""!==i.value:i.specified)?i.value:t},set:function(e,n,i){var r=e.getAttributeNode(i);return r||e.setAttributeNode(r=e.ownerDocument.createAttribute(i)),r.value=n+="","value"===i||n===e.getAttribute(i)?n:t}},ce.attrHooks.contenteditable={get:Ce.get,set:function(e,t,n){Ce.set(e,""!==t&&t,n)}},ce.each(["width","height"],function(e,n){ce.attrHooks[n]=ce.extend(ce.attrHooks[n],{set:function(e,i){return""===i?(e.setAttribute(n,"auto"),i):t}})})),ce.support.hrefNormalized||(ce.each(["href","src","width","height"],function(e,n){ce.attrHooks[n]=ce.extend(ce.attrHooks[n],{get:function(e){var i=e.getAttribute(n,2);return null==i?t:i}})}),ce.each(["href","src"],function(e,t){ce.propHooks[t]={get:function(e){return e.getAttribute(t,4)}}})),ce.support.style||(ce.attrHooks.style={get:function(e){return e.style.cssText||t},set:function(e,t){return e.style.cssText=t+""}}),ce.support.optSelected||(ce.propHooks.selected=ce.extend(ce.propHooks.selected,{get:function(e){var t=e.parentNode;return t&&(t.selectedIndex,t.parentNode&&t.parentNode.selectedIndex),null}})),ce.support.enctype||(ce.propFix.enctype="encoding"),ce.support.checkOn||ce.each(["radio","checkbox"],function(){ce.valHooks[this]={get:function(e){return null===e.getAttribute("value")?"on":e.value}}}),ce.each(["radio","checkbox"],function(){ce.valHooks[this]=ce.extend(ce.valHooks[this],{set:function(e,n){return ce.isArray(n)?e.checked=ce.inArray(ce(e).val(),n)>=0:t}})});var Re=/^(?:input|select|textarea)$/i,Oe=/^key/,qe=/^(?:mouse|contextmenu)|click/,Fe=/^(?:focusinfocus|focusoutblur)$/,ze=/^([^.]*)(?:\.(.+)|)$/;ce.event={global:{},add:function(e,n,i,r,o){var a,s,c,l,u,d,p,h,f,g,m,v=ce._data(e);if(v){for(i.handler&&(l=i,i=l.handler,o=l.selector),i.guid||(i.guid=ce.guid++),(s=v.events)||(s=v.events={}),(d=v.handle)||(d=v.handle=function(e){return typeof ce===Q||e&&ce.event.triggered===e.type?t:ce.event.dispatch.apply(d.elem,arguments)},d.elem=e),n=(n||"").match(ue)||[""],c=n.length;c--;)a=ze.exec(n[c])||[],f=m=a[1],g=(a[2]||"").split(".").sort(),u=ce.event.special[f]||{},f=(o?u.delegateType:u.bindType)||f,u=ce.event.special[f]||{},p=ce.extend({type:f,origType:m,data:r,handler:i,guid:i.guid,selector:o,needsContext:o&&ce.expr.match.needsContext.test(o),namespace:g.join(".")},l),(h=s[f])||(h=s[f]=[],h.delegateCount=0,u.setup&&u.setup.call(e,r,g,d)!==!1||(e.addEventListener?e.addEventListener(f,d,!1):e.attachEvent&&e.attachEvent("on"+f,d))),u.add&&(u.add.call(e,p),p.handler.guid||(p.handler.guid=i.guid)),o?h.splice(h.delegateCount++,0,p):h.push(p),ce.event.global[f]=!0;e=null}},remove:function(e,t,n,i,r){var o,a,s,c,l,u,d,p,h,f,g,m=ce.hasData(e)&&ce._data(e);if(m&&(u=m.events)){for(t=(t||"").match(ue)||[""],l=t.length;l--;)if(s=ze.exec(t[l])||[],h=g=s[1],f=(s[2]||"").split(".").sort(),h){for(d=ce.event.special[h]||{},h=(i?d.delegateType:d.bindType)||h,p=u[h]||[],s=s[2]&&RegExp("(^|\\.)"+f.join("\\.(?:.*\\.|)")+"(\\.|$)"),c=o=p.length;o--;)a=p[o],!r&&g!==a.origType||n&&n.guid!==a.guid||s&&!s.test(a.namespace)||i&&i!==a.selector&&("**"!==i||!a.selector)||(p.splice(o,1),a.selector&&p.delegateCount--,d.remove&&d.remove.call(e,a));c&&!p.length&&(d.teardown&&d.teardown.call(e,f,m.handle)!==!1||ce.removeEvent(e,h,m.handle),delete u[h])}else for(h in u)ce.event.remove(e,h+t[l],n,i,!0);ce.isEmptyObject(u)&&(delete m.handle,ce._removeData(e,"events"))}},trigger:function(n,i,r,o){var a,s,c,l,u,d,p,h=[r||X],f=ae.call(n,"type")?n.type:n,g=ae.call(n,"namespace")?n.namespace.split("."):[];if(c=d=r=r||X,3!==r.nodeType&&8!==r.nodeType&&!Fe.test(f+ce.event.triggered)&&(f.indexOf(".")>=0&&(g=f.split("."),f=g.shift(),g.sort()),s=0>f.indexOf(":")&&"on"+f,n=n[ce.expando]?n:new ce.Event(f,"object"==typeof n&&n),n.isTrigger=!0,n.namespace=g.join("."),n.namespace_re=n.namespace?RegExp("(^|\\.)"+g.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,n.result=t,n.target||(n.target=r),i=null==i?[n]:ce.makeArray(i,[n]),u=ce.event.special[f]||{},o||!u.trigger||u.trigger.apply(r,i)!==!1)){if(!o&&!u.noBubble&&!ce.isWindow(r)){for(l=u.delegateType||f,Fe.test(l+f)||(c=c.parentNode);c;c=c.parentNode)h.push(c),d=c;d===(r.ownerDocument||X)&&h.push(d.defaultView||d.parentWindow||e)}for(p=0;(c=h[p++])&&!n.isPropagationStopped();)n.type=p>1?l:u.bindType||f,a=(ce._data(c,"events")||{})[n.type]&&ce._data(c,"handle"),a&&a.apply(c,i),a=s&&c[s],a&&ce.acceptData(c)&&a.apply&&a.apply(c,i)===!1&&n.preventDefault();if(n.type=f,!(o||n.isDefaultPrevented()||u._default&&u._default.apply(r.ownerDocument,i)!==!1||"click"===f&&ce.nodeName(r,"a")||!ce.acceptData(r)||!s||!r[f]||ce.isWindow(r))){d=r[s],d&&(r[s]=null),ce.event.triggered=f;try{r[f]()}catch(m){}ce.event.triggered=t,d&&(r[s]=d)}return n.result}},dispatch:function(e){e=ce.event.fix(e);var n,i,r,o,a,s=[],c=ie.call(arguments),l=(ce._data(this,"events")||{})[e.type]||[],u=ce.event.special[e.type]||{};if(c[0]=e,e.delegateTarget=this,!u.preDispatch||u.preDispatch.call(this,e)!==!1){for(s=ce.event.handlers.call(this,e,l),n=0;(o=s[n++])&&!e.isPropagationStopped();)for(e.currentTarget=o.elem,a=0;(r=o.handlers[a++])&&!e.isImmediatePropagationStopped();)(!e.namespace_re||e.namespace_re.test(r.namespace))&&(e.handleObj=r,e.data=r.data,i=((ce.event.special[r.origType]||{}).handle||r.handler).apply(o.elem,c),i!==t&&(e.result=i)===!1&&(e.preventDefault(),e.stopPropagation()));return u.postDispatch&&u.postDispatch.call(this,e),e.result}},handlers:function(e,n){var i,r,o,a,s=[],c=n.delegateCount,l=e.target;if(c&&l.nodeType&&(!e.button||"click"!==e.type))for(;l!=this;l=l.parentNode||this)if(1===l.nodeType&&(l.disabled!==!0||"click"!==e.type)){for(o=[],a=0;c>a;a++)r=n[a],i=r.selector+" ",o[i]===t&&(o[i]=r.needsContext?ce(i,this).index(l)>=0:ce.find(i,this,null,[l]).length),o[i]&&o.push(r);o.length&&s.push({elem:l,handlers:o})}return n.length>c&&s.push({elem:this,handlers:n.slice(c)}),s},fix:function(e){if(e[ce.expando])return e;var t,n,i,r=e.type,o=e,a=this.fixHooks[r];for(a||(this.fixHooks[r]=a=qe.test(r)?this.mouseHooks:Oe.test(r)?this.keyHooks:{}),i=a.props?this.props.concat(a.props):this.props,e=new ce.Event(o),t=i.length;t--;)n=i[t],e[n]=o[n];return e.target||(e.target=o.srcElement||X),3===e.target.nodeType&&(e.target=e.target.parentNode),e.metaKey=!!e.metaKey,a.filter?a.filter(e,o):e},props:"altKey bubbles cancelable ctrlKey currentTarget eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "),fixHooks:{},keyHooks:{props:"char charCode key keyCode".split(" "),filter:function(e,t){return null==e.which&&(e.which=null!=t.charCode?t.charCode:t.keyCode),e}},mouseHooks:{props:"button buttons clientX clientY fromElement offsetX offsetY pageX pageY screenX screenY toElement".split(" "),filter:function(e,n){var i,r,o,a=n.button,s=n.fromElement;return null==e.pageX&&null!=n.clientX&&(r=e.target.ownerDocument||X,o=r.documentElement,i=r.body,e.pageX=n.clientX+(o&&o.scrollLeft||i&&i.scrollLeft||0)-(o&&o.clientLeft||i&&i.clientLeft||0),e.pageY=n.clientY+(o&&o.scrollTop||i&&i.scrollTop||0)-(o&&o.clientTop||i&&i.clientTop||0)),!e.relatedTarget&&s&&(e.relatedTarget=s===e.target?n.toElement:s),e.which||a===t||(e.which=1&a?1:2&a?3:4&a?2:0),e}},special:{load:{noBubble:!0},click:{trigger:function(){return ce.nodeName(this,"input")&&"checkbox"===this.type&&this.click?(this.click(),!1):t}},focus:{trigger:function(){if(this!==X.activeElement&&this.focus)try{return this.focus(),!1}catch(e){}},delegateType:"focusin"},blur:{trigger:function(){return this===X.activeElement&&this.blur?(this.blur(),!1):t},delegateType:"focusout"},beforeunload:{postDispatch:function(e){e.result!==t&&(e.originalEvent.returnValue=e.result)}}},simulate:function(e,t,n,i){var r=ce.extend(new ce.Event,n,{type:e,isSimulated:!0,originalEvent:{}});i?ce.event.trigger(r,null,t):ce.event.dispatch.call(t,r),r.isDefaultPrevented()&&n.preventDefault()}},ce.removeEvent=X.removeEventListener?function(e,t,n){e.removeEventListener&&e.removeEventListener(t,n,!1)}:function(e,t,n){var i="on"+t;e.detachEvent&&(typeof e[i]===Q&&(e[i]=null),e.detachEvent(i,n))},ce.Event=function(e,n){return this instanceof ce.Event?(e&&e.type?(this.originalEvent=e,this.type=e.type,this.isDefaultPrevented=e.defaultPrevented||e.returnValue===!1||e.getPreventDefault&&e.getPreventDefault()?c:l):this.type=e,n&&ce.extend(this,n),this.timeStamp=e&&e.timeStamp||ce.now(),this[ce.expando]=!0,t):new ce.Event(e,n)},ce.Event.prototype={isDefaultPrevented:l,isPropagationStopped:l,isImmediatePropagationStopped:l,preventDefault:function(){var e=this.originalEvent;this.isDefaultPrevented=c,e&&(e.preventDefault?e.preventDefault():e.returnValue=!1)},stopPropagation:function(){var e=this.originalEvent;this.isPropagationStopped=c,e&&(e.stopPropagation&&e.stopPropagation(),e.cancelBubble=!0)},stopImmediatePropagation:function(){this.isImmediatePropagationStopped=c,this.stopPropagation()}},ce.each({mouseenter:"mouseover",mouseleave:"mouseout"},function(e,t){ce.event.special[e]={delegateType:t,bindType:t,handle:function(e){var n,i=this,r=e.relatedTarget,o=e.handleObj;return(!r||r!==i&&!ce.contains(i,r))&&(e.type=o.origType,n=o.handler.apply(this,arguments),e.type=t),n}}}),ce.support.submitBubbles||(ce.event.special.submit={setup:function(){return!ce.nodeName(this,"form")&&(ce.event.add(this,"click._submit keypress._submit",function(e){var n=e.target,i=ce.nodeName(n,"input")||ce.nodeName(n,"button")?n.form:t;i&&!ce._data(i,"submitBubbles")&&(ce.event.add(i,"submit._submit",function(e){e._submit_bubble=!0}),ce._data(i,"submitBubbles",!0))}),t)},postDispatch:function(e){e._submit_bubble&&(delete e._submit_bubble,this.parentNode&&!e.isTrigger&&ce.event.simulate("submit",this.parentNode,e,!0))},teardown:function(){return!ce.nodeName(this,"form")&&(ce.event.remove(this,"._submit"),t)}}),ce.support.changeBubbles||(ce.event.special.change={setup:function(){return Re.test(this.nodeName)?(("checkbox"===this.type||"radio"===this.type)&&(ce.event.add(this,"propertychange._change",function(e){"checked"===e.originalEvent.propertyName&&(this._just_changed=!0)}),ce.event.add(this,"click._change",function(e){this._just_changed&&!e.isTrigger&&(this._just_changed=!1),ce.event.simulate("change",this,e,!0)})),!1):(ce.event.add(this,"beforeactivate._change",function(e){var t=e.target;Re.test(t.nodeName)&&!ce._data(t,"changeBubbles")&&(ce.event.add(t,"change._change",function(e){!this.parentNode||e.isSimulated||e.isTrigger||ce.event.simulate("change",this.parentNode,e,!0)}),ce._data(t,"changeBubbles",!0))}),t)},handle:function(e){var n=e.target;return this!==n||e.isSimulated||e.isTrigger||"radio"!==n.type&&"checkbox"!==n.type?e.handleObj.handler.apply(this,arguments):t},teardown:function(){return ce.event.remove(this,"._change"),!Re.test(this.nodeName)}}),ce.support.focusinBubbles||ce.each({focus:"focusin",blur:"focusout"},function(e,t){var n=0,i=function(e){ce.event.simulate(t,e.target,ce.event.fix(e),!0)};ce.event.special[t]={setup:function(){0===n++&&X.addEventListener(e,i,!0)},teardown:function(){0===--n&&X.removeEventListener(e,i,!0)}}}),ce.fn.extend({on:function(e,n,i,r,o){var a,s;if("object"==typeof e){"string"!=typeof n&&(i=i||n,n=t);for(a in e)this.on(a,n,i,e[a],o);return this}if(null==i&&null==r?(r=n,i=n=t):null==r&&("string"==typeof n?(r=i,i=t):(r=i,i=n,n=t)),r===!1)r=l;else if(!r)return this;return 1===o&&(s=r,r=function(e){return ce().off(e),s.apply(this,arguments)},r.guid=s.guid||(s.guid=ce.guid++)),this.each(function(){ce.event.add(this,e,r,i,n)})},one:function(e,t,n,i){return this.on(e,t,n,i,1)},off:function(e,n,i){var r,o;if(e&&e.preventDefault&&e.handleObj)return r=e.handleObj,ce(e.delegateTarget).off(r.namespace?r.origType+"."+r.namespace:r.origType,r.selector,r.handler),this;if("object"==typeof e){for(o in e)this.off(o,n,e[o]);return this}return(n===!1||"function"==typeof n)&&(i=n,n=t),i===!1&&(i=l),this.each(function(){ce.event.remove(this,e,i,n)})},bind:function(e,t,n){return this.on(e,null,t,n)},unbind:function(e,t){return this.off(e,null,t)},delegate:function(e,t,n,i){return this.on(t,e,n,i)},undelegate:function(e,t,n){return 1===arguments.length?this.off(e,"**"):this.off(t,e||"**",n)},trigger:function(e,t){return this.each(function(){ce.event.trigger(e,t,this)})},triggerHandler:function(e,n){var i=this[0];return i?ce.event.trigger(e,n,i,!0):t}}),function(e,t){function n(e){return fe.test(e+"")}function i(){var e,t=[];return e=function(n,i){return t.push(n+=" ")>T.cacheLength&&delete e[t.shift()],e[n]=i}}function r(e){return e[F]=!0,e}function o(e){var t=B.createElement("div");try{return e(t)}catch(n){return!1}finally{t=null}}function a(e,t,n,i){var r,o,a,s,c,l,u,h,f,g;if((t?t.ownerDocument||t:z)!==B&&L(t),t=t||B,n=n||[],!e||"string"!=typeof e)return n;if(1!==(s=t.nodeType)&&9!==s)return[];if(!M&&!i){if(r=ge.exec(e))if(a=r[1]){if(9===s){if(o=t.getElementById(a),!o||!o.parentNode)return n;if(o.id===a)return n.push(o),n}else if(t.ownerDocument&&(o=t.ownerDocument.getElementById(a))&&O(t,o)&&o.id===a)return n.push(o),n}else{if(r[2])return K.apply(n,Y.call(t.getElementsByTagName(e),0)),n;if((a=r[3])&&U.getByClassName&&t.getElementsByClassName)return K.apply(n,Y.call(t.getElementsByClassName(a),0)),n}if(U.qsa&&!N.test(e)){if(u=!0,h=F,f=t,g=9===s&&e,1===s&&"object"!==t.nodeName.toLowerCase()){for(l=d(e),(u=t.getAttribute("id"))?h=u.replace(ye,"\\$&"):t.setAttribute("id",h),h="[id='"+h+"'] ",c=l.length;c--;)l[c]=h+p(l[c]);f=he.test(e)&&t.parentNode||t,g=l.join(",")}if(g)try{return K.apply(n,Y.call(f.querySelectorAll(g),0)),n}catch(m){}finally{u||t.removeAttribute("id")}}}return _(e.replace(ae,"$1"),t,n,i)}function s(e,t){var n=t&&e,i=n&&(~t.sourceIndex||X)-(~e.sourceIndex||X);if(i)return i;if(n)for(;n=n.nextSibling;)if(n===t)return-1;return e?1:-1}function c(e){return function(t){var n=t.nodeName.toLowerCase();return"input"===n&&t.type===e}}function l(e){return function(t){var n=t.nodeName.toLowerCase();return("input"===n||"button"===n)&&t.type===e}}function u(e){return r(function(t){return t=+t,r(function(n,i){for(var r,o=e([],n.length,t),a=o.length;a--;)n[r=o[a]]&&(n[r]=!(i[r]=n[r]))})})}function d(e,t){var n,i,r,o,s,c,l,u=W[e+" "];if(u)return t?0:u.slice(0);for(s=e,c=[],l=T.preFilter;s;){(!n||(i=se.exec(s)))&&(i&&(s=s.slice(i[0].length)||s),c.push(r=[])),n=!1,(i=le.exec(s))&&(n=i.shift(),r.push({value:n,type:i[0].replace(ae," ")}),s=s.slice(n.length));for(o in T.filter)!(i=pe[o].exec(s))||l[o]&&!(i=l[o](i))||(n=i.shift(),r.push({value:n,type:o,matches:i}),s=s.slice(n.length));if(!n)break}return t?s.length:s?a.error(e):W(e,c).slice(0)}function p(e){for(var t=0,n=e.length,i="";n>t;t++)i+=e[t].value;return i}function h(e,t,n){var i=t.dir,r=n&&"parentNode"===i,o=H++;return t.first?function(t,n,o){for(;t=t[i];)if(1===t.nodeType||r)return e(t,n,o)}:function(t,n,a){var s,c,l,u=P+" "+o;if(a){for(;t=t[i];)if((1===t.nodeType||r)&&e(t,n,a))return!0}else for(;t=t[i];)if(1===t.nodeType||r)if(l=t[F]||(t[F]={}),(c=l[i])&&c[0]===u){if((s=c[1])===!0||s===k)return s===!0}else if(c=l[i]=[u],c[1]=e(t,n,a)||k,c[1]===!0)return!0}}function f(e){return e.length>1?function(t,n,i){for(var r=e.length;r--;)if(!e[r](t,n,i))return!1;return!0}:e[0]}function g(e,t,n,i,r){for(var o,a=[],s=0,c=e.length,l=null!=t;c>s;s++)(o=e[s])&&(!n||n(o,i,r))&&(a.push(o),l&&t.push(s));return a}function m(e,t,n,i,o,a){return i&&!i[F]&&(i=m(i)),o&&!o[F]&&(o=m(o,a)),r(function(r,a,s,c){var l,u,d,p=[],h=[],f=a.length,m=r||b(t||"*",s.nodeType?[s]:s,[]),v=!e||!r&&t?m:g(m,p,e,s,c),y=n?o||(r?e:f||i)?[]:a:v;if(n&&n(v,y,s,c),i)for(l=g(y,h),i(l,[],s,c),u=l.length;u--;)(d=l[u])&&(y[h[u]]=!(v[h[u]]=d));if(r){if(o||e){if(o){for(l=[],u=y.length;u--;)(d=y[u])&&l.push(v[u]=d);o(null,y=[],l,c)}for(u=y.length;u--;)(d=y[u])&&(l=o?Z.call(r,d):p[u])>-1&&(r[l]=!(a[l]=d))}}else y=g(y===a?y.splice(f,y.length):y),o?o(null,a,y,c):K.apply(a,y)})}function v(e){for(var t,n,i,r=e.length,o=T.relative[e[0].type],a=o||T.relative[" "],s=o?1:0,c=h(function(e){return e===t},a,!0),l=h(function(e){return Z.call(t,e)>-1},a,!0),u=[function(e,n,i){return!o&&(i||n!==I)||((t=n).nodeType?c(e,n,i):l(e,n,i))}];r>s;s++)if(n=T.relative[e[s].type])u=[h(f(u),n)];else{if(n=T.filter[e[s].type].apply(null,e[s].matches),n[F]){for(i=++s;r>i&&!T.relative[e[i].type];i++);return m(s>1&&f(u),s>1&&p(e.slice(0,s-1)).replace(ae,"$1"),n,i>s&&v(e.slice(s,i)),r>i&&v(e=e.slice(i)),r>i&&p(e))}u.push(n)}return f(u)}function y(e,t){var n=0,i=t.length>0,o=e.length>0,s=function(r,s,c,l,u){var d,p,h,f=[],m=0,v="0",y=r&&[],b=null!=u,_=I,x=r||o&&T.find.TAG("*",u&&s.parentNode||s),w=P+=null==_?1:Math.random()||.1;for(b&&(I=s!==B&&s,k=n);null!=(d=x[v]);v++){if(o&&d){for(p=0;h=e[p++];)if(h(d,s,c)){l.push(d);break}b&&(P=w,k=++n)}i&&((d=!h&&d)&&m--,r&&y.push(d))}if(m+=v,i&&v!==m){for(p=0;h=t[p++];)h(y,f,s,c);if(r){if(m>0)for(;v--;)y[v]||f[v]||(f[v]=G.call(l));f=g(f)}K.apply(l,f),b&&!r&&f.length>0&&m+t.length>1&&a.uniqueSort(l)}return b&&(P=w,I=_),y};return i?r(s):s}function b(e,t,n){for(var i=0,r=t.length;r>i;i++)a(e,t[i],n);return n}function _(e,t,n,i){var r,o,a,s,c,l=d(e);if(!i&&1===l.length){if(o=l[0]=l[0].slice(0),o.length>2&&"ID"===(a=o[0]).type&&9===t.nodeType&&!M&&T.relative[o[1].type]){if(t=T.find.ID(a.matches[0].replace(_e,xe),t)[0],!t)return n;e=e.slice(o.shift().value.length)}for(r=pe.needsContext.test(e)?0:o.length;r--&&(a=o[r],!T.relative[s=a.type]);)if((c=T.find[s])&&(i=c(a.matches[0].replace(_e,xe),he.test(o[0].type)&&t.parentNode||t))){if(o.splice(r,1),e=i.length&&p(o),!e)return K.apply(n,Y.call(i,0)),n;break}}return E(e,l)(i,t,M,n,he.test(e)),n}function x(){}var w,k,T,S,C,E,A,I,L,B,D,M,N,j,R,O,q,F="sizzle"+-new Date,z=e.document,U={},P=0,H=0,$=i(),W=i(),V=i(),Q=typeof t,X=1<<31,J=[],G=J.pop,K=J.push,Y=J.slice,Z=J.indexOf||function(e){for(var t=0,n=this.length;n>t;t++)if(this[t]===e)return t;return-1},ee="[\\x20\\t\\r\\n\\f]",te="(?:\\\\.|[\\w-]|[^\\x00-\\xa0])+",ne=te.replace("w","w#"),ie="([*^$|!~]?=)",re="\\["+ee+"*("+te+")"+ee+"*(?:"+ie+ee+"*(?:(['\"])((?:\\\\.|[^\\\\])*?)\\3|("+ne+")|)|)"+ee+"*\\]",oe=":("+te+")(?:\\(((['\"])((?:\\\\.|[^\\\\])*?)\\3|((?:\\\\.|[^\\\\()[\\]]|"+re.replace(3,8)+")*)|.*)\\)|)",ae=RegExp("^"+ee+"+|((?:^|[^\\\\])(?:\\\\.)*)"+ee+"+$","g"),se=RegExp("^"+ee+"*,"+ee+"*"),le=RegExp("^"+ee+"*([\\x20\\t\\r\\n\\f>+~])"+ee+"*"),ue=RegExp(oe),de=RegExp("^"+ne+"$"),pe={ID:RegExp("^#("+te+")"),CLASS:RegExp("^\\.("+te+")"),NAME:RegExp("^\\[name=['\"]?("+te+")['\"]?\\]"),TAG:RegExp("^("+te.replace("w","w*")+")"),ATTR:RegExp("^"+re),PSEUDO:RegExp("^"+oe),CHILD:RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+ee+"*(even|odd|(([+-]|)(\\d*)n|)"+ee+"*(?:([+-]|)"+ee+"*(\\d+)|))"+ee+"*\\)|)","i"),needsContext:RegExp("^"+ee+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+ee+"*((?:-\\d)?\\d*)"+ee+"*\\)|)(?=[^-]|$)","i")},he=/[\x20\t\r\n\f]*[+~]/,fe=/^[^{]+\{\s*\[native code/,ge=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,me=/^(?:input|select|textarea|button)$/i,ve=/^h\d$/i,ye=/'|\\/g,be=/\=[\x20\t\r\n\f]*([^'"\]]*)[\x20\t\r\n\f]*\]/g,_e=/\\([\da-fA-F]{1,6}[\x20\t\r\n\f]?|.)/g,xe=function(e,t){var n="0x"+t-65536;return n!==n?t:0>n?String.fromCharCode(n+65536):String.fromCharCode(55296|n>>10,56320|1023&n)};try{Y.call(z.documentElement.childNodes,0)[0].nodeType}catch(we){Y=function(e){for(var t,n=[];t=this[e++];)n.push(t);return n}}C=a.isXML=function(e){var t=e&&(e.ownerDocument||e).documentElement;return!!t&&"HTML"!==t.nodeName},L=a.setDocument=function(e){var i=e?e.ownerDocument||e:z;return i!==B&&9===i.nodeType&&i.documentElement?(B=i,D=i.documentElement,M=C(i),U.tagNameNoComments=o(function(e){return e.appendChild(i.createComment("")),!e.getElementsByTagName("*").length}),U.attributes=o(function(e){e.innerHTML="<select></select>";var t=typeof e.lastChild.getAttribute("multiple");return"boolean"!==t&&"string"!==t}),U.getByClassName=o(function(e){return e.innerHTML="<div class='hidden e'></div><div class='hidden'></div>",!(!e.getElementsByClassName||!e.getElementsByClassName("e").length)&&(e.lastChild.className="e",2===e.getElementsByClassName("e").length)}),U.getByName=o(function(e){e.id=F+0,e.innerHTML="<a name='"+F+"'></a><div name='"+F+"'></div>",D.insertBefore(e,D.firstChild);var t=i.getElementsByName&&i.getElementsByName(F).length===2+i.getElementsByName(F+0).length;return U.getIdNotName=!i.getElementById(F),D.removeChild(e),t}),T.attrHandle=o(function(e){return e.innerHTML="<a href='#'></a>",e.firstChild&&typeof e.firstChild.getAttribute!==Q&&"#"===e.firstChild.getAttribute("href")})?{}:{href:function(e){return e.getAttribute("href",2)},type:function(e){return e.getAttribute("type")}},U.getIdNotName?(T.find.ID=function(e,t){if(typeof t.getElementById!==Q&&!M){var n=t.getElementById(e);return n&&n.parentNode?[n]:[]}},T.filter.ID=function(e){var t=e.replace(_e,xe);return function(e){return e.getAttribute("id")===t}}):(T.find.ID=function(e,n){if(typeof n.getElementById!==Q&&!M){var i=n.getElementById(e);return i?i.id===e||typeof i.getAttributeNode!==Q&&i.getAttributeNode("id").value===e?[i]:t:[]}},T.filter.ID=function(e){var t=e.replace(_e,xe);return function(e){var n=typeof e.getAttributeNode!==Q&&e.getAttributeNode("id");return n&&n.value===t}}),T.find.TAG=U.tagNameNoComments?function(e,n){return typeof n.getElementsByTagName!==Q?n.getElementsByTagName(e):t}:function(e,t){var n,i=[],r=0,o=t.getElementsByTagName(e);if("*"===e){for(;n=o[r++];)1===n.nodeType&&i.push(n);return i}return o},T.find.NAME=U.getByName&&function(e,n){return typeof n.getElementsByName!==Q?n.getElementsByName(name):t},T.find.CLASS=U.getByClassName&&function(e,n){return typeof n.getElementsByClassName===Q||M?t:n.getElementsByClassName(e)},j=[],N=[":focus"],(U.qsa=n(i.querySelectorAll))&&(o(function(e){e.innerHTML="<select><option selected=''></option></select>",e.querySelectorAll("[selected]").length||N.push("\\["+ee+"*(?:checked|disabled|ismap|multiple|readonly|selected|value)"),e.querySelectorAll(":checked").length||N.push(":checked")}),o(function(e){e.innerHTML="<input type='hidden' i=''/>",e.querySelectorAll("[i^='']").length&&N.push("[*^$]="+ee+"*(?:\"\"|'')"),e.querySelectorAll(":enabled").length||N.push(":enabled",":disabled"),e.querySelectorAll("*,:x"),N.push(",.*:")})),(U.matchesSelector=n(R=D.matchesSelector||D.mozMatchesSelector||D.webkitMatchesSelector||D.oMatchesSelector||D.msMatchesSelector))&&o(function(e){U.disconnectedMatch=R.call(e,"div"),R.call(e,"[s!='']:x"),j.push("!=",oe)}),N=RegExp(N.join("|")),j=RegExp(j.join("|")),O=n(D.contains)||D.compareDocumentPosition?function(e,t){var n=9===e.nodeType?e.documentElement:e,i=t&&t.parentNode;return e===i||!(!i||1!==i.nodeType||!(n.contains?n.contains(i):e.compareDocumentPosition&&16&e.compareDocumentPosition(i)))}:function(e,t){if(t)for(;t=t.parentNode;)if(t===e)return!0;return!1},q=D.compareDocumentPosition?function(e,t){var n;return e===t?(A=!0,0):(n=t.compareDocumentPosition&&e.compareDocumentPosition&&e.compareDocumentPosition(t))?1&n||e.parentNode&&11===e.parentNode.nodeType?e===i||O(z,e)?-1:t===i||O(z,t)?1:0:4&n?-1:1:e.compareDocumentPosition?-1:1}:function(e,t){var n,r=0,o=e.parentNode,a=t.parentNode,c=[e],l=[t];if(e===t)return A=!0,0;if(!o||!a)return e===i?-1:t===i?1:o?-1:a?1:0;if(o===a)return s(e,t);for(n=e;n=n.parentNode;)c.unshift(n);for(n=t;n=n.parentNode;)l.unshift(n);for(;c[r]===l[r];)r++;return r?s(c[r],l[r]):c[r]===z?-1:l[r]===z?1:0},A=!1,[0,0].sort(q),U.detectDuplicates=A,B):B},a.matches=function(e,t){return a(e,null,null,t)},a.matchesSelector=function(e,t){if((e.ownerDocument||e)!==B&&L(e),t=t.replace(be,"='$1']"),!(!U.matchesSelector||M||j&&j.test(t)||N.test(t)))try{var n=R.call(e,t);if(n||U.disconnectedMatch||e.document&&11!==e.document.nodeType)return n}catch(i){}return a(t,B,null,[e]).length>0},a.contains=function(e,t){return(e.ownerDocument||e)!==B&&L(e),O(e,t)},a.attr=function(e,t){var n;return(e.ownerDocument||e)!==B&&L(e),M||(t=t.toLowerCase()),(n=T.attrHandle[t])?n(e):M||U.attributes?e.getAttribute(t):((n=e.getAttributeNode(t))||e.getAttribute(t))&&e[t]===!0?t:n&&n.specified?n.value:null},a.error=function(e){throw Error("Syntax error, unrecognized expression: "+e)},a.uniqueSort=function(e){var t,n=[],i=1,r=0;if(A=!U.detectDuplicates,e.sort(q),A){for(;t=e[i];i++)t===e[i-1]&&(r=n.push(i));for(;r--;)e.splice(n[r],1)}return e},S=a.getText=function(e){var t,n="",i=0,r=e.nodeType;if(r){if(1===r||9===r||11===r){if("string"==typeof e.textContent)return e.textContent;for(e=e.firstChild;e;e=e.nextSibling)n+=S(e)}else if(3===r||4===r)return e.nodeValue}else for(;t=e[i];i++)n+=S(t);return n},T=a.selectors={cacheLength:50,
createPseudo:r,match:pe,find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(e){return e[1]=e[1].replace(_e,xe),e[3]=(e[4]||e[5]||"").replace(_e,xe),"~="===e[2]&&(e[3]=" "+e[3]+" "),e.slice(0,4)},CHILD:function(e){return e[1]=e[1].toLowerCase(),"nth"===e[1].slice(0,3)?(e[3]||a.error(e[0]),e[4]=+(e[4]?e[5]+(e[6]||1):2*("even"===e[3]||"odd"===e[3])),e[5]=+(e[7]+e[8]||"odd"===e[3])):e[3]&&a.error(e[0]),e},PSEUDO:function(e){var t,n=!e[5]&&e[2];return pe.CHILD.test(e[0])?null:(e[4]?e[2]=e[4]:n&&ue.test(n)&&(t=d(n,!0))&&(t=n.indexOf(")",n.length-t)-n.length)&&(e[0]=e[0].slice(0,t),e[2]=n.slice(0,t)),e.slice(0,3))}},filter:{TAG:function(e){return"*"===e?function(){return!0}:(e=e.replace(_e,xe).toLowerCase(),function(t){return t.nodeName&&t.nodeName.toLowerCase()===e})},CLASS:function(e){var t=$[e+" "];return t||(t=RegExp("(^|"+ee+")"+e+"("+ee+"|$)"))&&$(e,function(e){return t.test(e.className||typeof e.getAttribute!==Q&&e.getAttribute("class")||"")})},ATTR:function(e,t,n){return function(i){var r=a.attr(i,e);return null==r?"!="===t:!t||(r+="","="===t?r===n:"!="===t?r!==n:"^="===t?n&&0===r.indexOf(n):"*="===t?n&&r.indexOf(n)>-1:"$="===t?n&&r.slice(-n.length)===n:"~="===t?(" "+r+" ").indexOf(n)>-1:"|="===t&&(r===n||r.slice(0,n.length+1)===n+"-"))}},CHILD:function(e,t,n,i,r){var o="nth"!==e.slice(0,3),a="last"!==e.slice(-4),s="of-type"===t;return 1===i&&0===r?function(e){return!!e.parentNode}:function(t,n,c){var l,u,d,p,h,f,g=o!==a?"nextSibling":"previousSibling",m=t.parentNode,v=s&&t.nodeName.toLowerCase(),y=!c&&!s;if(m){if(o){for(;g;){for(d=t;d=d[g];)if(s?d.nodeName.toLowerCase()===v:1===d.nodeType)return!1;f=g="only"===e&&!f&&"nextSibling"}return!0}if(f=[a?m.firstChild:m.lastChild],a&&y){for(u=m[F]||(m[F]={}),l=u[e]||[],h=l[0]===P&&l[1],p=l[0]===P&&l[2],d=h&&m.childNodes[h];d=++h&&d&&d[g]||(p=h=0)||f.pop();)if(1===d.nodeType&&++p&&d===t){u[e]=[P,h,p];break}}else if(y&&(l=(t[F]||(t[F]={}))[e])&&l[0]===P)p=l[1];else for(;(d=++h&&d&&d[g]||(p=h=0)||f.pop())&&((s?d.nodeName.toLowerCase()!==v:1!==d.nodeType)||!++p||(y&&((d[F]||(d[F]={}))[e]=[P,p]),d!==t)););return p-=r,p===i||0===p%i&&p/i>=0}}},PSEUDO:function(e,t){var n,i=T.pseudos[e]||T.setFilters[e.toLowerCase()]||a.error("unsupported pseudo: "+e);return i[F]?i(t):i.length>1?(n=[e,e,"",t],T.setFilters.hasOwnProperty(e.toLowerCase())?r(function(e,n){for(var r,o=i(e,t),a=o.length;a--;)r=Z.call(e,o[a]),e[r]=!(n[r]=o[a])}):function(e){return i(e,0,n)}):i}},pseudos:{not:r(function(e){var t=[],n=[],i=E(e.replace(ae,"$1"));return i[F]?r(function(e,t,n,r){for(var o,a=i(e,null,r,[]),s=e.length;s--;)(o=a[s])&&(e[s]=!(t[s]=o))}):function(e,r,o){return t[0]=e,i(t,null,o,n),!n.pop()}}),has:r(function(e){return function(t){return a(e,t).length>0}}),contains:r(function(e){return function(t){return(t.textContent||t.innerText||S(t)).indexOf(e)>-1}}),lang:r(function(e){return de.test(e||"")||a.error("unsupported lang: "+e),e=e.replace(_e,xe).toLowerCase(),function(t){var n;do if(n=M?t.getAttribute("xml:lang")||t.getAttribute("lang"):t.lang)return n=n.toLowerCase(),n===e||0===n.indexOf(e+"-");while((t=t.parentNode)&&1===t.nodeType);return!1}}),target:function(t){var n=e.location&&e.location.hash;return n&&n.slice(1)===t.id},root:function(e){return e===D},focus:function(e){return e===B.activeElement&&(!B.hasFocus||B.hasFocus())&&!!(e.type||e.href||~e.tabIndex)},enabled:function(e){return e.disabled===!1},disabled:function(e){return e.disabled===!0},checked:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&!!e.checked||"option"===t&&!!e.selected},selected:function(e){return e.parentNode&&e.parentNode.selectedIndex,e.selected===!0},empty:function(e){for(e=e.firstChild;e;e=e.nextSibling)if(e.nodeName>"@"||3===e.nodeType||4===e.nodeType)return!1;return!0},parent:function(e){return!T.pseudos.empty(e)},header:function(e){return ve.test(e.nodeName)},input:function(e){return me.test(e.nodeName)},button:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&"button"===e.type||"button"===t},text:function(e){var t;return"input"===e.nodeName.toLowerCase()&&"text"===e.type&&(null==(t=e.getAttribute("type"))||t.toLowerCase()===e.type)},first:u(function(){return[0]}),last:u(function(e,t){return[t-1]}),eq:u(function(e,t,n){return[0>n?n+t:n]}),even:u(function(e,t){for(var n=0;t>n;n+=2)e.push(n);return e}),odd:u(function(e,t){for(var n=1;t>n;n+=2)e.push(n);return e}),lt:u(function(e,t,n){for(var i=0>n?n+t:n;--i>=0;)e.push(i);return e}),gt:u(function(e,t,n){for(var i=0>n?n+t:n;t>++i;)e.push(i);return e})}};for(w in{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})T.pseudos[w]=c(w);for(w in{submit:!0,reset:!0})T.pseudos[w]=l(w);E=a.compile=function(e,t){var n,i=[],r=[],o=V[e+" "];if(!o){for(t||(t=d(e)),n=t.length;n--;)o=v(t[n]),o[F]?i.push(o):r.push(o);o=V(e,y(r,i))}return o},T.pseudos.nth=T.pseudos.eq,T.filters=x.prototype=T.pseudos,T.setFilters=new x,L(),a.attr=ce.attr,ce.find=a,ce.expr=a.selectors,ce.expr[":"]=ce.expr.pseudos,ce.unique=a.uniqueSort,ce.text=a.getText,ce.isXMLDoc=a.isXML,ce.contains=a.contains}(e);var Ue=/Until$/,Pe=/^(?:parents|prev(?:Until|All))/,He=/^.[^:#\[\.,]*$/,$e=ce.expr.match.needsContext,We={children:!0,contents:!0,next:!0,prev:!0};ce.fn.extend({find:function(e){var t,n,i,r=this.length;if("string"!=typeof e)return i=this,this.pushStack(ce(e).filter(function(){for(t=0;r>t;t++)if(ce.contains(i[t],this))return!0}));for(n=[],t=0;r>t;t++)ce.find(e,this[t],n);return n=this.pushStack(r>1?ce.unique(n):n),n.selector=(this.selector?this.selector+" ":"")+e,n},has:function(e){var t,n=ce(e,this),i=n.length;return this.filter(function(){for(t=0;i>t;t++)if(ce.contains(this,n[t]))return!0})},not:function(e){return this.pushStack(d(this,e,!1))},filter:function(e){return this.pushStack(d(this,e,!0))},is:function(e){return!!e&&("string"==typeof e?$e.test(e)?ce(e,this.context).index(this[0])>=0:ce.filter(e,this).length>0:this.filter(e).length>0)},closest:function(e,t){for(var n,i=0,r=this.length,o=[],a=$e.test(e)||"string"!=typeof e?ce(e,t||this.context):0;r>i;i++)for(n=this[i];n&&n.ownerDocument&&n!==t&&11!==n.nodeType;){if(a?a.index(n)>-1:ce.find.matchesSelector(n,e)){o.push(n);break}n=n.parentNode}return this.pushStack(o.length>1?ce.unique(o):o)},index:function(e){return e?"string"==typeof e?ce.inArray(this[0],ce(e)):ce.inArray(e.jquery?e[0]:e,this):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(e,t){var n="string"==typeof e?ce(e,t):ce.makeArray(e&&e.nodeType?[e]:e),i=ce.merge(this.get(),n);return this.pushStack(ce.unique(i))},addBack:function(e){return this.add(null==e?this.prevObject:this.prevObject.filter(e))}}),ce.fn.andSelf=ce.fn.addBack,ce.each({parent:function(e){var t=e.parentNode;return t&&11!==t.nodeType?t:null},parents:function(e){return ce.dir(e,"parentNode")},parentsUntil:function(e,t,n){return ce.dir(e,"parentNode",n)},next:function(e){return u(e,"nextSibling")},prev:function(e){return u(e,"previousSibling")},nextAll:function(e){return ce.dir(e,"nextSibling")},prevAll:function(e){return ce.dir(e,"previousSibling")},nextUntil:function(e,t,n){return ce.dir(e,"nextSibling",n)},prevUntil:function(e,t,n){return ce.dir(e,"previousSibling",n)},siblings:function(e){return ce.sibling((e.parentNode||{}).firstChild,e)},children:function(e){return ce.sibling(e.firstChild)},contents:function(e){return ce.nodeName(e,"iframe")?e.contentDocument||e.contentWindow.document:ce.merge([],e.childNodes)}},function(e,t){ce.fn[e]=function(n,i){var r=ce.map(this,t,n);return Ue.test(e)||(i=n),i&&"string"==typeof i&&(r=ce.filter(i,r)),r=this.length>1&&!We[e]?ce.unique(r):r,this.length>1&&Pe.test(e)&&(r=r.reverse()),this.pushStack(r)}}),ce.extend({filter:function(e,t,n){return n&&(e=":not("+e+")"),1===t.length?ce.find.matchesSelector(t[0],e)?[t[0]]:[]:ce.find.matches(e,t)},dir:function(e,n,i){for(var r=[],o=e[n];o&&9!==o.nodeType&&(i===t||1!==o.nodeType||!ce(o).is(i));)1===o.nodeType&&r.push(o),o=o[n];return r},sibling:function(e,t){for(var n=[];e;e=e.nextSibling)1===e.nodeType&&e!==t&&n.push(e);return n}});var Ve="abbr|article|aside|audio|bdi|canvas|data|datalist|details|figcaption|figure|footer|header|hgroup|mark|meter|nav|output|progress|section|summary|time|video",Qe=/ jQuery\d+="(?:null|\d+)"/g,Xe=RegExp("<(?:"+Ve+")[\\s/>]","i"),Je=/^\s+/,Ge=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi,Ke=/<([\w:]+)/,Ye=/<tbody/i,Ze=/<|&#?\w+;/,et=/<(?:script|style|link)/i,tt=/^(?:checkbox|radio)$/i,nt=/checked\s*(?:[^=]|=\s*.checked.)/i,it=/^$|\/(?:java|ecma)script/i,rt=/^true\/(.*)/,ot=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g,at={option:[1,"<select multiple='multiple'>","</select>"],legend:[1,"<fieldset>","</fieldset>"],area:[1,"<map>","</map>"],param:[1,"<object>","</object>"],thead:[1,"<table>","</table>"],tr:[2,"<table><tbody>","</tbody></table>"],col:[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:ce.support.htmlSerialize?[0,"",""]:[1,"X<div>","</div>"]},st=p(X),ct=st.appendChild(X.createElement("div"));at.optgroup=at.option,at.tbody=at.tfoot=at.colgroup=at.caption=at.thead,at.th=at.td,ce.fn.extend({text:function(e){return ce.access(this,function(e){return e===t?ce.text(this):this.empty().append((this[0]&&this[0].ownerDocument||X).createTextNode(e))},null,e,arguments.length)},wrapAll:function(e){if(ce.isFunction(e))return this.each(function(t){ce(this).wrapAll(e.call(this,t))});if(this[0]){var t=ce(e,this[0].ownerDocument).eq(0).clone(!0);this[0].parentNode&&t.insertBefore(this[0]),t.map(function(){for(var e=this;e.firstChild&&1===e.firstChild.nodeType;)e=e.firstChild;return e}).append(this)}return this},wrapInner:function(e){return ce.isFunction(e)?this.each(function(t){ce(this).wrapInner(e.call(this,t))}):this.each(function(){var t=ce(this),n=t.contents();n.length?n.wrapAll(e):t.append(e)})},wrap:function(e){var t=ce.isFunction(e);return this.each(function(n){ce(this).wrapAll(t?e.call(this,n):e)})},unwrap:function(){return this.parent().each(function(){ce.nodeName(this,"body")||ce(this).replaceWith(this.childNodes)}).end()},append:function(){return this.domManip(arguments,!0,function(e){(1===this.nodeType||11===this.nodeType||9===this.nodeType)&&this.appendChild(e)})},prepend:function(){return this.domManip(arguments,!0,function(e){(1===this.nodeType||11===this.nodeType||9===this.nodeType)&&this.insertBefore(e,this.firstChild)})},before:function(){return this.domManip(arguments,!1,function(e){this.parentNode&&this.parentNode.insertBefore(e,this)})},after:function(){return this.domManip(arguments,!1,function(e){this.parentNode&&this.parentNode.insertBefore(e,this.nextSibling)})},remove:function(e,t){for(var n,i=0;null!=(n=this[i]);i++)(!e||ce.filter(e,[n]).length>0)&&(t||1!==n.nodeType||ce.cleanData(b(n)),n.parentNode&&(t&&ce.contains(n.ownerDocument,n)&&m(b(n,"script")),n.parentNode.removeChild(n)));return this},empty:function(){for(var e,t=0;null!=(e=this[t]);t++){for(1===e.nodeType&&ce.cleanData(b(e,!1));e.firstChild;)e.removeChild(e.firstChild);e.options&&ce.nodeName(e,"select")&&(e.options.length=0)}return this},clone:function(e,t){return e=null!=e&&e,t=null==t?e:t,this.map(function(){return ce.clone(this,e,t)})},html:function(e){return ce.access(this,function(e){var n=this[0]||{},i=0,r=this.length;if(e===t)return 1===n.nodeType?n.innerHTML.replace(Qe,""):t;if(!("string"!=typeof e||et.test(e)||!ce.support.htmlSerialize&&Xe.test(e)||!ce.support.leadingWhitespace&&Je.test(e)||at[(Ke.exec(e)||["",""])[1].toLowerCase()])){e=e.replace(Ge,"<$1></$2>");try{for(;r>i;i++)n=this[i]||{},1===n.nodeType&&(ce.cleanData(b(n,!1)),n.innerHTML=e);n=0}catch(o){}}n&&this.empty().append(e)},null,e,arguments.length)},replaceWith:function(e){var t=ce.isFunction(e);return t||"string"==typeof e||(e=ce(e).not(this).detach()),this.domManip([e],!0,function(e){var t=this.nextSibling,n=this.parentNode;n&&(ce(this).remove(),n.insertBefore(e,t))})},detach:function(e){return this.remove(e,!0)},domManip:function(e,n,i){e=te.apply([],e);var r,o,a,s,c,l,u=0,d=this.length,p=this,m=d-1,v=e[0],y=ce.isFunction(v);if(y||!(1>=d||"string"!=typeof v||ce.support.checkClone)&&nt.test(v))return this.each(function(r){var o=p.eq(r);y&&(e[0]=v.call(this,r,n?o.html():t)),o.domManip(e,n,i)});if(d&&(l=ce.buildFragment(e,this[0].ownerDocument,!1,this),r=l.firstChild,1===l.childNodes.length&&(l=r),r)){for(n=n&&ce.nodeName(r,"tr"),s=ce.map(b(l,"script"),f),a=s.length;d>u;u++)o=l,u!==m&&(o=ce.clone(o,!0,!0),a&&ce.merge(s,b(o,"script"))),i.call(n&&ce.nodeName(this[u],"table")?h(this[u],"tbody"):this[u],o,u);if(a)for(c=s[s.length-1].ownerDocument,ce.map(s,g),u=0;a>u;u++)o=s[u],it.test(o.type||"")&&!ce._data(o,"globalEval")&&ce.contains(c,o)&&(o.src?ce.ajax({url:o.src,type:"GET",dataType:"script",async:!1,global:!1,"throws":!0}):ce.globalEval((o.text||o.textContent||o.innerHTML||"").replace(ot,"")));l=r=null}return this}}),ce.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(e,t){ce.fn[e]=function(e){for(var n,i=0,r=[],o=ce(e),a=o.length-1;a>=i;i++)n=i===a?this:this.clone(!0),ce(o[i])[t](n),ne.apply(r,n.get());return this.pushStack(r)}}),ce.extend({clone:function(e,t,n){var i,r,o,a,s,c=ce.contains(e.ownerDocument,e);if(ce.support.html5Clone||ce.isXMLDoc(e)||!Xe.test("<"+e.nodeName+">")?o=e.cloneNode(!0):(ct.innerHTML=e.outerHTML,ct.removeChild(o=ct.firstChild)),!(ce.support.noCloneEvent&&ce.support.noCloneChecked||1!==e.nodeType&&11!==e.nodeType||ce.isXMLDoc(e)))for(i=b(o),s=b(e),a=0;null!=(r=s[a]);++a)i[a]&&y(r,i[a]);if(t)if(n)for(s=s||b(e),i=i||b(o),a=0;null!=(r=s[a]);a++)v(r,i[a]);else v(e,o);return i=b(o,"script"),i.length>0&&m(i,!c&&b(e,"script")),i=s=r=null,o},buildFragment:function(e,t,n,i){for(var r,o,a,s,c,l,u,d=e.length,h=p(t),f=[],g=0;d>g;g++)if(o=e[g],o||0===o)if("object"===ce.type(o))ce.merge(f,o.nodeType?[o]:o);else if(Ze.test(o)){for(s=s||h.appendChild(t.createElement("div")),c=(Ke.exec(o)||["",""])[1].toLowerCase(),u=at[c]||at._default,s.innerHTML=u[1]+o.replace(Ge,"<$1></$2>")+u[2],r=u[0];r--;)s=s.lastChild;if(!ce.support.leadingWhitespace&&Je.test(o)&&f.push(t.createTextNode(Je.exec(o)[0])),!ce.support.tbody)for(o="table"!==c||Ye.test(o)?"<table>"!==u[1]||Ye.test(o)?0:s:s.firstChild,r=o&&o.childNodes.length;r--;)ce.nodeName(l=o.childNodes[r],"tbody")&&!l.childNodes.length&&o.removeChild(l);for(ce.merge(f,s.childNodes),s.textContent="";s.firstChild;)s.removeChild(s.firstChild);s=h.lastChild}else f.push(t.createTextNode(o));for(s&&h.removeChild(s),ce.support.appendChecked||ce.grep(b(f,"input"),_),g=0;o=f[g++];)if((!i||-1===ce.inArray(o,i))&&(a=ce.contains(o.ownerDocument,o),s=b(h.appendChild(o),"script"),a&&m(s),n))for(r=0;o=s[r++];)it.test(o.type||"")&&n.push(o);return s=null,h},cleanData:function(e,t){for(var n,i,r,o,a=0,s=ce.expando,c=ce.cache,l=ce.support.deleteExpando,u=ce.event.special;null!=(n=e[a]);a++)if((t||ce.acceptData(n))&&(r=n[s],o=r&&c[r])){if(o.events)for(i in o.events)u[i]?ce.event.remove(n,i):ce.removeEvent(n,i,o.handle);c[r]&&(delete c[r],l?delete n[s]:typeof n.removeAttribute!==Q?n.removeAttribute(s):n[s]=null,Z.push(r))}}});var lt,ut,dt,pt=/alpha\([^)]*\)/i,ht=/opacity\s*=\s*([^)]*)/,ft=/^(top|right|bottom|left)$/,gt=/^(none|table(?!-c[ea]).+)/,mt=/^margin/,vt=RegExp("^("+le+")(.*)$","i"),yt=RegExp("^("+le+")(?!px)[a-z%]+$","i"),bt=RegExp("^([+-])=("+le+")","i"),_t={BODY:"block"},xt={position:"absolute",visibility:"hidden",display:"block"},wt={letterSpacing:0,fontWeight:400},kt=["Top","Right","Bottom","Left"],Tt=["Webkit","O","Moz","ms"];ce.fn.extend({css:function(e,n){return ce.access(this,function(e,n,i){var r,o,a={},s=0;if(ce.isArray(n)){for(o=ut(e),r=n.length;r>s;s++)a[n[s]]=ce.css(e,n[s],!1,o);return a}return i!==t?ce.style(e,n,i):ce.css(e,n)},e,n,arguments.length>1)},show:function(){return k(this,!0)},hide:function(){return k(this)},toggle:function(e){var t="boolean"==typeof e;return this.each(function(){(t?e:w(this))?ce(this).show():ce(this).hide()})}}),ce.extend({cssHooks:{opacity:{get:function(e,t){if(t){var n=dt(e,"opacity");return""===n?"1":n}}}},cssNumber:{columnCount:!0,fillOpacity:!0,fontWeight:!0,lineHeight:!0,opacity:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{"float":ce.support.cssFloat?"cssFloat":"styleFloat"},style:function(e,n,i,r){if(e&&3!==e.nodeType&&8!==e.nodeType&&e.style){var o,a,s,c=ce.camelCase(n),l=e.style;if(n=ce.cssProps[c]||(ce.cssProps[c]=x(l,c)),s=ce.cssHooks[n]||ce.cssHooks[c],i===t)return s&&"get"in s&&(o=s.get(e,!1,r))!==t?o:l[n];if(a=typeof i,"string"===a&&(o=bt.exec(i))&&(i=(o[1]+1)*o[2]+parseFloat(ce.css(e,n)),a="number"),!(null==i||"number"===a&&isNaN(i)||("number"!==a||ce.cssNumber[c]||(i+="px"),ce.support.clearCloneStyle||""!==i||0!==n.indexOf("background")||(l[n]="inherit"),s&&"set"in s&&(i=s.set(e,i,r))===t)))try{l[n]=i}catch(u){}}},css:function(e,n,i,r){var o,a,s,c=ce.camelCase(n);return n=ce.cssProps[c]||(ce.cssProps[c]=x(e.style,c)),s=ce.cssHooks[n]||ce.cssHooks[c],s&&"get"in s&&(a=s.get(e,!0,i)),a===t&&(a=dt(e,n,r)),"normal"===a&&n in wt&&(a=wt[n]),""===i||i?(o=parseFloat(a),i===!0||ce.isNumeric(o)?o||0:a):a},swap:function(e,t,n,i){var r,o,a={};for(o in t)a[o]=e.style[o],e.style[o]=t[o];r=n.apply(e,i||[]);for(o in t)e.style[o]=a[o];return r}}),e.getComputedStyle?(ut=function(t){return e.getComputedStyle(t,null)},dt=function(e,n,i){var r,o,a,s=i||ut(e),c=s?s.getPropertyValue(n)||s[n]:t,l=e.style;return s&&(""!==c||ce.contains(e.ownerDocument,e)||(c=ce.style(e,n)),yt.test(c)&&mt.test(n)&&(r=l.width,o=l.minWidth,a=l.maxWidth,l.minWidth=l.maxWidth=l.width=c,c=s.width,l.width=r,l.minWidth=o,l.maxWidth=a)),c}):X.documentElement.currentStyle&&(ut=function(e){return e.currentStyle},dt=function(e,n,i){var r,o,a,s=i||ut(e),c=s?s[n]:t,l=e.style;return null==c&&l&&l[n]&&(c=l[n]),yt.test(c)&&!ft.test(n)&&(r=l.left,o=e.runtimeStyle,a=o&&o.left,a&&(o.left=e.currentStyle.left),l.left="fontSize"===n?"1em":c,c=l.pixelLeft+"px",l.left=r,a&&(o.left=a)),""===c?"auto":c}),ce.each(["height","width"],function(e,n){ce.cssHooks[n]={get:function(e,i,r){return i?0===e.offsetWidth&&gt.test(ce.css(e,"display"))?ce.swap(e,xt,function(){return C(e,n,r)}):C(e,n,r):t},set:function(e,t,i){var r=i&&ut(e);return T(e,t,i?S(e,n,i,ce.support.boxSizing&&"border-box"===ce.css(e,"boxSizing",!1,r),r):0)}}}),ce.support.opacity||(ce.cssHooks.opacity={get:function(e,t){return ht.test((t&&e.currentStyle?e.currentStyle.filter:e.style.filter)||"")?.01*parseFloat(RegExp.$1)+"":t?"1":""},set:function(e,t){var n=e.style,i=e.currentStyle,r=ce.isNumeric(t)?"alpha(opacity="+100*t+")":"",o=i&&i.filter||n.filter||"";n.zoom=1,(t>=1||""===t)&&""===ce.trim(o.replace(pt,""))&&n.removeAttribute&&(n.removeAttribute("filter"),""===t||i&&!i.filter)||(n.filter=pt.test(o)?o.replace(pt,r):o+" "+r)}}),ce(function(){ce.support.reliableMarginRight||(ce.cssHooks.marginRight={get:function(e,n){return n?ce.swap(e,{display:"inline-block"},dt,[e,"marginRight"]):t}}),!ce.support.pixelPosition&&ce.fn.position&&ce.each(["top","left"],function(e,n){ce.cssHooks[n]={get:function(e,i){return i?(i=dt(e,n),yt.test(i)?ce(e).position()[n]+"px":i):t}}})}),ce.expr&&ce.expr.filters&&(ce.expr.filters.hidden=function(e){return 0>=e.offsetWidth&&0>=e.offsetHeight||!ce.support.reliableHiddenOffsets&&"none"===(e.style&&e.style.display||ce.css(e,"display"))},ce.expr.filters.visible=function(e){return!ce.expr.filters.hidden(e)}),ce.each({margin:"",padding:"",border:"Width"},function(e,t){ce.cssHooks[e+t]={expand:function(n){for(var i=0,r={},o="string"==typeof n?n.split(" "):[n];4>i;i++)r[e+kt[i]+t]=o[i]||o[i-2]||o[0];return r}},mt.test(e)||(ce.cssHooks[e+t].set=T)});var St=/%20/g,Ct=/\[\]$/,Et=/\r?\n/g,At=/^(?:submit|button|image|reset|file)$/i,It=/^(?:input|select|textarea|keygen)/i;ce.fn.extend({serialize:function(){return ce.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var e=ce.prop(this,"elements");return e?ce.makeArray(e):this}).filter(function(){var e=this.type;return this.name&&!ce(this).is(":disabled")&&It.test(this.nodeName)&&!At.test(e)&&(this.checked||!tt.test(e))}).map(function(e,t){var n=ce(this).val();return null==n?null:ce.isArray(n)?ce.map(n,function(e){return{name:t.name,value:e.replace(Et,"\r\n")}}):{name:t.name,value:n.replace(Et,"\r\n")}}).get()}}),ce.param=function(e,n){var i,r=[],o=function(e,t){t=ce.isFunction(t)?t():null==t?"":t,r[r.length]=encodeURIComponent(e)+"="+encodeURIComponent(t)};if(n===t&&(n=ce.ajaxSettings&&ce.ajaxSettings.traditional),ce.isArray(e)||e.jquery&&!ce.isPlainObject(e))ce.each(e,function(){o(this.name,this.value)});else for(i in e)I(i,e[i],n,o);return r.join("&").replace(St,"+")},ce.each("blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error contextmenu".split(" "),function(e,t){ce.fn[t]=function(e,n){return arguments.length>0?this.on(t,null,e,n):this.trigger(t)}}),ce.fn.hover=function(e,t){return this.mouseenter(e).mouseleave(t||e)};var Lt,Bt,Dt=ce.now(),Mt=/\?/,Nt=/#.*$/,jt=/([?&])_=[^&]*/,Rt=/^(.*?):[ \t]*([^\r\n]*)\r?$/gm,Ot=/^(?:about|app|app-storage|.+-extension|file|res|widget):$/,qt=/^(?:GET|HEAD)$/,Ft=/^\/\//,zt=/^([\w.+-]+:)(?:\/\/([^\/?#:]*)(?::(\d+)|)|)/,Ut=ce.fn.load,Pt={},Ht={},$t="*/".concat("*");try{Bt=J.href}catch(Wt){Bt=X.createElement("a"),Bt.href="",Bt=Bt.href}Lt=zt.exec(Bt.toLowerCase())||[],ce.fn.load=function(e,n,i){if("string"!=typeof e&&Ut)return Ut.apply(this,arguments);var r,o,a,s=this,c=e.indexOf(" ");return c>=0&&(r=e.slice(c,e.length),e=e.slice(0,c)),ce.isFunction(n)?(i=n,n=t):n&&"object"==typeof n&&(a="POST"),s.length>0&&ce.ajax({url:e,type:a,dataType:"html",data:n}).done(function(e){o=arguments,s.html(r?ce("<div>").append(ce.parseHTML(e)).find(r):e)}).complete(i&&function(e,t){s.each(i,o||[e.responseText,t,e])}),this},ce.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],function(e,t){ce.fn[t]=function(e){return this.on(t,e)}}),ce.each(["get","post"],function(e,n){ce[n]=function(e,i,r,o){return ce.isFunction(i)&&(o=o||r,r=i,i=t),ce.ajax({url:e,type:n,dataType:o,data:i,success:r})}}),ce.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:Bt,type:"GET",isLocal:Ot.test(Lt[1]),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":$t,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/xml/,html:/html/,json:/json/},responseFields:{xml:"responseXML",text:"responseText"},converters:{"* text":e.String,"text html":!0,"text json":ce.parseJSON,"text xml":ce.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(e,t){return t?D(D(e,ce.ajaxSettings),t):D(ce.ajaxSettings,e)},ajaxPrefilter:L(Pt),ajaxTransport:L(Ht),ajax:function(e,n){function i(e,n,i,r){var o,d,y,b,x,k=n;2!==_&&(_=2,c&&clearTimeout(c),u=t,s=r||"",w.readyState=e>0?4:0,i&&(b=M(p,w,i)),e>=200&&300>e||304===e?(p.ifModified&&(x=w.getResponseHeader("Last-Modified"),x&&(ce.lastModified[a]=x),x=w.getResponseHeader("etag"),x&&(ce.etag[a]=x)),204===e?(o=!0,k="nocontent"):304===e?(o=!0,k="notmodified"):(o=N(p,b),k=o.state,d=o.data,y=o.error,o=!y)):(y=k,(e||!k)&&(k="error",0>e&&(e=0))),w.status=e,w.statusText=(n||k)+"",o?g.resolveWith(h,[d,k,w]):g.rejectWith(h,[w,k,y]),w.statusCode(v),v=t,l&&f.trigger(o?"ajaxSuccess":"ajaxError",[w,p,o?d:y]),m.fireWith(h,[w,k]),l&&(f.trigger("ajaxComplete",[w,p]),--ce.active||ce.event.trigger("ajaxStop")))}"object"==typeof e&&(n=e,e=t),n=n||{};var r,o,a,s,c,l,u,d,p=ce.ajaxSetup({},n),h=p.context||p,f=p.context&&(h.nodeType||h.jquery)?ce(h):ce.event,g=ce.Deferred(),m=ce.Callbacks("once memory"),v=p.statusCode||{},y={},b={},_=0,x="canceled",w={readyState:0,getResponseHeader:function(e){var t;if(2===_){if(!d)for(d={};t=Rt.exec(s);)d[t[1].toLowerCase()]=t[2];t=d[e.toLowerCase()]}return null==t?null:t},getAllResponseHeaders:function(){return 2===_?s:null},setRequestHeader:function(e,t){var n=e.toLowerCase();return _||(e=b[n]=b[n]||e,y[e]=t),this},overrideMimeType:function(e){return _||(p.mimeType=e),this},statusCode:function(e){var t;if(e)if(2>_)for(t in e)v[t]=[v[t],e[t]];else w.always(e[w.status]);return this},abort:function(e){var t=e||x;return u&&u.abort(t),i(0,t),this}};if(g.promise(w).complete=m.add,w.success=w.done,w.error=w.fail,p.url=((e||p.url||Bt)+"").replace(Nt,"").replace(Ft,Lt[1]+"//"),p.type=n.method||n.type||p.method||p.type,p.dataTypes=ce.trim(p.dataType||"*").toLowerCase().match(ue)||[""],null==p.crossDomain&&(r=zt.exec(p.url.toLowerCase()),p.crossDomain=!(!r||r[1]===Lt[1]&&r[2]===Lt[2]&&(r[3]||("http:"===r[1]?80:443))==(Lt[3]||("http:"===Lt[1]?80:443)))),p.data&&p.processData&&"string"!=typeof p.data&&(p.data=ce.param(p.data,p.traditional)),B(Pt,p,n,w),2===_)return w;l=p.global,l&&0===ce.active++&&ce.event.trigger("ajaxStart"),p.type=p.type.toUpperCase(),p.hasContent=!qt.test(p.type),a=p.url,p.hasContent||(p.data&&(a=p.url+=(Mt.test(a)?"&":"?")+p.data,delete p.data),p.cache===!1&&(p.url=jt.test(a)?a.replace(jt,"$1_="+Dt++):a+(Mt.test(a)?"&":"?")+"_="+Dt++)),p.ifModified&&(ce.lastModified[a]&&w.setRequestHeader("If-Modified-Since",ce.lastModified[a]),ce.etag[a]&&w.setRequestHeader("If-None-Match",ce.etag[a])),(p.data&&p.hasContent&&p.contentType!==!1||n.contentType)&&w.setRequestHeader("Content-Type",p.contentType),w.setRequestHeader("Accept",p.dataTypes[0]&&p.accepts[p.dataTypes[0]]?p.accepts[p.dataTypes[0]]+("*"!==p.dataTypes[0]?", "+$t+"; q=0.01":""):p.accepts["*"]);for(o in p.headers)w.setRequestHeader(o,p.headers[o]);if(p.beforeSend&&(p.beforeSend.call(h,w,p)===!1||2===_))return w.abort();x="abort";for(o in{success:1,error:1,complete:1})w[o](p[o]);if(u=B(Ht,p,n,w)){w.readyState=1,l&&f.trigger("ajaxSend",[w,p]),p.async&&p.timeout>0&&(c=setTimeout(function(){w.abort("timeout")},p.timeout));try{_=1,u.send(y,i)}catch(k){if(!(2>_))throw k;i(-1,k)}}else i(-1,"No Transport");return w},getScript:function(e,n){return ce.get(e,t,n,"script")},getJSON:function(e,t,n){return ce.get(e,t,n,"json")}}),ce.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/(?:java|ecma)script/},converters:{"text script":function(e){return ce.globalEval(e),e}}}),ce.ajaxPrefilter("script",function(e){e.cache===t&&(e.cache=!1),e.crossDomain&&(e.type="GET",e.global=!1)}),ce.ajaxTransport("script",function(e){if(e.crossDomain){var n,i=X.head||ce("head")[0]||X.documentElement;return{send:function(t,r){n=X.createElement("script"),n.async=!0,e.scriptCharset&&(n.charset=e.scriptCharset),n.src=e.url,n.onload=n.onreadystatechange=function(e,t){(t||!n.readyState||/loaded|complete/.test(n.readyState))&&(n.onload=n.onreadystatechange=null,n.parentNode&&n.parentNode.removeChild(n),n=null,t||r(200,"success"))},i.insertBefore(n,i.firstChild)},abort:function(){n&&n.onload(t,!0)}}}});var Vt=[],Qt=/(=)\?(?=&|$)|\?\?/;ce.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var e=Vt.pop()||ce.expando+"_"+Dt++;return this[e]=!0,e}}),ce.ajaxPrefilter("json jsonp",function(n,i,r){var o,a,s,c=n.jsonp!==!1&&(Qt.test(n.url)?"url":"string"==typeof n.data&&!(n.contentType||"").indexOf("application/x-www-form-urlencoded")&&Qt.test(n.data)&&"data");return c||"jsonp"===n.dataTypes[0]?(o=n.jsonpCallback=ce.isFunction(n.jsonpCallback)?n.jsonpCallback():n.jsonpCallback,c?n[c]=n[c].replace(Qt,"$1"+o):n.jsonp!==!1&&(n.url+=(Mt.test(n.url)?"&":"?")+n.jsonp+"="+o),n.converters["script json"]=function(){return s||ce.error(o+" was not called"),s[0]},n.dataTypes[0]="json",a=e[o],e[o]=function(){s=arguments},r.always(function(){e[o]=a,n[o]&&(n.jsonpCallback=i.jsonpCallback,Vt.push(o)),s&&ce.isFunction(a)&&a(s[0]),s=a=t}),"script"):t});var Xt,Jt,Gt=0,Kt=e.ActiveXObject&&function(){var e;for(e in Xt)Xt[e](t,!0)};ce.ajaxSettings.xhr=e.ActiveXObject?function(){return!this.isLocal&&j()||R()}:j,Jt=ce.ajaxSettings.xhr(),ce.support.cors=!!Jt&&"withCredentials"in Jt,Jt=ce.support.ajax=!!Jt,Jt&&ce.ajaxTransport(function(n){if(!n.crossDomain||ce.support.cors){var i;return{send:function(r,o){var a,s,c=n.xhr();if(n.username?c.open(n.type,n.url,n.async,n.username,n.password):c.open(n.type,n.url,n.async),n.xhrFields)for(s in n.xhrFields)c[s]=n.xhrFields[s];n.mimeType&&c.overrideMimeType&&c.overrideMimeType(n.mimeType),n.crossDomain||r["X-Requested-With"]||(r["X-Requested-With"]="XMLHttpRequest");try{for(s in r)c.setRequestHeader(s,r[s])}catch(l){}c.send(n.hasContent&&n.data||null),i=function(e,r){var s,l,u,d;try{if(i&&(r||4===c.readyState))if(i=t,a&&(c.onreadystatechange=ce.noop,Kt&&delete Xt[a]),r)4!==c.readyState&&c.abort();else{d={},s=c.status,l=c.getAllResponseHeaders(),"string"==typeof c.responseText&&(d.text=c.responseText);try{u=c.statusText}catch(p){u=""}s||!n.isLocal||n.crossDomain?1223===s&&(s=204):s=d.text?200:404}}catch(h){r||o(-1,h)}d&&o(s,u,d,l)},n.async?4===c.readyState?setTimeout(i):(a=++Gt,Kt&&(Xt||(Xt={},ce(e).unload(Kt)),Xt[a]=i),c.onreadystatechange=i):i()},abort:function(){i&&i(t,!0)}}}});var Yt,Zt,en=/^(?:toggle|show|hide)$/,tn=RegExp("^(?:([+-])=|)("+le+")([a-z%]*)$","i"),nn=/queueHooks$/,rn=[U],on={"*":[function(e,t){var n,i,r=this.createTween(e,t),o=tn.exec(t),a=r.cur(),s=+a||0,c=1,l=20;if(o){if(n=+o[2],i=o[3]||(ce.cssNumber[e]?"":"px"),"px"!==i&&s){s=ce.css(r.elem,e,!0)||n||1;do c=c||".5",s/=c,ce.style(r.elem,e,s+i);while(c!==(c=r.cur()/a)&&1!==c&&--l)}r.unit=i,r.start=s,r.end=o[1]?s+(o[1]+1)*n:n}return r}]};ce.Animation=ce.extend(F,{tweener:function(e,t){ce.isFunction(e)?(t=e,e=["*"]):e=e.split(" ");for(var n,i=0,r=e.length;r>i;i++)n=e[i],on[n]=on[n]||[],on[n].unshift(t)},prefilter:function(e,t){t?rn.unshift(e):rn.push(e)}}),ce.Tween=P,P.prototype={constructor:P,init:function(e,t,n,i,r,o){this.elem=e,this.prop=n,this.easing=r||"swing",this.options=t,this.start=this.now=this.cur(),this.end=i,this.unit=o||(ce.cssNumber[n]?"":"px")},cur:function(){var e=P.propHooks[this.prop];return e&&e.get?e.get(this):P.propHooks._default.get(this)},run:function(e){var t,n=P.propHooks[this.prop];return this.pos=t=this.options.duration?ce.easing[this.easing](e,this.options.duration*e,0,1,this.options.duration):e,this.now=(this.end-this.start)*t+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),n&&n.set?n.set(this):P.propHooks._default.set(this),this}},P.prototype.init.prototype=P.prototype,P.propHooks={_default:{get:function(e){var t;return null==e.elem[e.prop]||e.elem.style&&null!=e.elem.style[e.prop]?(t=ce.css(e.elem,e.prop,""),t&&"auto"!==t?t:0):e.elem[e.prop]},set:function(e){ce.fx.step[e.prop]?ce.fx.step[e.prop](e):e.elem.style&&(null!=e.elem.style[ce.cssProps[e.prop]]||ce.cssHooks[e.prop])?ce.style(e.elem,e.prop,e.now+e.unit):e.elem[e.prop]=e.now}}},P.propHooks.scrollTop=P.propHooks.scrollLeft={set:function(e){e.elem.nodeType&&e.elem.parentNode&&(e.elem[e.prop]=e.now)}},ce.each(["toggle","show","hide"],function(e,t){var n=ce.fn[t];ce.fn[t]=function(e,i,r){return null==e||"boolean"==typeof e?n.apply(this,arguments):this.animate(H(t,!0),e,i,r)}}),ce.fn.extend({fadeTo:function(e,t,n,i){return this.filter(w).css("opacity",0).show().end().animate({opacity:t},e,n,i)},animate:function(e,t,n,i){var r=ce.isEmptyObject(e),o=ce.speed(t,n,i),a=function s(){var t=F(this,ce.extend({},e),o);s.finish=function(){t.stop(!0)},(r||ce._data(this,"finish"))&&t.stop(!0)};return a.finish=a,r||o.queue===!1?this.each(a):this.queue(o.queue,a)},stop:function(e,n,i){var r=function(e){var t=e.stop;delete e.stop,t(i)};return"string"!=typeof e&&(i=n,n=e,e=t),n&&e!==!1&&this.queue(e||"fx",[]),this.each(function(){var t=!0,n=null!=e&&e+"queueHooks",o=ce.timers,a=ce._data(this);if(n)a[n]&&a[n].stop&&r(a[n]);else for(n in a)a[n]&&a[n].stop&&nn.test(n)&&r(a[n]);for(n=o.length;n--;)o[n].elem!==this||null!=e&&o[n].queue!==e||(o[n].anim.stop(i),t=!1,o.splice(n,1));(t||!i)&&ce.dequeue(this,e)})},finish:function(e){
return e!==!1&&(e=e||"fx"),this.each(function(){var t,n=ce._data(this),i=n[e+"queue"],r=n[e+"queueHooks"],o=ce.timers,a=i?i.length:0;for(n.finish=!0,ce.queue(this,e,[]),r&&r.cur&&r.cur.finish&&r.cur.finish.call(this),t=o.length;t--;)o[t].elem===this&&o[t].queue===e&&(o[t].anim.stop(!0),o.splice(t,1));for(t=0;a>t;t++)i[t]&&i[t].finish&&i[t].finish.call(this);delete n.finish})}}),ce.each({slideDown:H("show"),slideUp:H("hide"),slideToggle:H("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(e,t){ce.fn[e]=function(e,n,i){return this.animate(t,e,n,i)}}),ce.speed=function(e,t,n){var i=e&&"object"==typeof e?ce.extend({},e):{complete:n||!n&&t||ce.isFunction(e)&&e,duration:e,easing:n&&t||t&&!ce.isFunction(t)&&t};return i.duration=ce.fx.off?0:"number"==typeof i.duration?i.duration:i.duration in ce.fx.speeds?ce.fx.speeds[i.duration]:ce.fx.speeds._default,(null==i.queue||i.queue===!0)&&(i.queue="fx"),i.old=i.complete,i.complete=function(){ce.isFunction(i.old)&&i.old.call(this),i.queue&&ce.dequeue(this,i.queue)},i},ce.easing={linear:function(e){return e},swing:function(e){return.5-Math.cos(e*Math.PI)/2}},ce.timers=[],ce.fx=P.prototype.init,ce.fx.tick=function(){var e,n=ce.timers,i=0;for(Yt=ce.now();n.length>i;i++)e=n[i],e()||n[i]!==e||n.splice(i--,1);n.length||ce.fx.stop(),Yt=t},ce.fx.timer=function(e){e()&&ce.timers.push(e)&&ce.fx.start()},ce.fx.interval=13,ce.fx.start=function(){Zt||(Zt=setInterval(ce.fx.tick,ce.fx.interval))},ce.fx.stop=function(){clearInterval(Zt),Zt=null},ce.fx.speeds={slow:600,fast:200,_default:400},ce.fx.step={},ce.expr&&ce.expr.filters&&(ce.expr.filters.animated=function(e){return ce.grep(ce.timers,function(t){return e===t.elem}).length}),ce.fn.offset=function(e){if(arguments.length)return e===t?this:this.each(function(t){ce.offset.setOffset(this,e,t)});var n,i,r={top:0,left:0},o=this[0],a=o&&o.ownerDocument;return a?(n=a.documentElement,ce.contains(n,o)?(typeof o.getBoundingClientRect!==Q&&(r=o.getBoundingClientRect()),i=$(a),{top:r.top+(i.pageYOffset||n.scrollTop)-(n.clientTop||0),left:r.left+(i.pageXOffset||n.scrollLeft)-(n.clientLeft||0)}):r):void 0},ce.offset={setOffset:function(e,t,n){var i=ce.css(e,"position");"static"===i&&(e.style.position="relative");var r,o,a=ce(e),s=a.offset(),c=ce.css(e,"top"),l=ce.css(e,"left"),u=("absolute"===i||"fixed"===i)&&ce.inArray("auto",[c,l])>-1,d={},p={};u?(p=a.position(),r=p.top,o=p.left):(r=parseFloat(c)||0,o=parseFloat(l)||0),ce.isFunction(t)&&(t=t.call(e,n,s)),null!=t.top&&(d.top=t.top-s.top+r),null!=t.left&&(d.left=t.left-s.left+o),"using"in t?t.using.call(e,d):a.css(d)}},ce.fn.extend({position:function(){if(this[0]){var e,t,n={top:0,left:0},i=this[0];return"fixed"===ce.css(i,"position")?t=i.getBoundingClientRect():(e=this.offsetParent(),t=this.offset(),ce.nodeName(e[0],"html")||(n=e.offset()),n.top+=ce.css(e[0],"borderTopWidth",!0),n.left+=ce.css(e[0],"borderLeftWidth",!0)),{top:t.top-n.top-ce.css(i,"marginTop",!0),left:t.left-n.left-ce.css(i,"marginLeft",!0)}}},offsetParent:function(){return this.map(function(){for(var e=this.offsetParent||X.documentElement;e&&!ce.nodeName(e,"html")&&"static"===ce.css(e,"position");)e=e.offsetParent;return e||X.documentElement})}}),ce.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(e,n){var i=/Y/.test(n);ce.fn[e]=function(r){return ce.access(this,function(e,r,o){var a=$(e);return o===t?a?n in a?a[n]:a.document.documentElement[r]:e[r]:(a?a.scrollTo(i?ce(a).scrollLeft():o,i?o:ce(a).scrollTop()):e[r]=o,t)},e,r,arguments.length,null)}}),ce.each({Height:"height",Width:"width"},function(e,n){ce.each({padding:"inner"+e,content:n,"":"outer"+e},function(i,r){ce.fn[r]=function(r,o){var a=arguments.length&&(i||"boolean"!=typeof r),s=i||(r===!0||o===!0?"margin":"border");return ce.access(this,function(n,i,r){var o;return ce.isWindow(n)?n.document.documentElement["client"+e]:9===n.nodeType?(o=n.documentElement,Math.max(n.body["scroll"+e],o["scroll"+e],n.body["offset"+e],o["offset"+e],o["client"+e])):r===t?ce.css(n,i,s):ce.style(n,i,r,s)},n,a?r:t,a,null)}})}),e.jQuery=e.$=ce,"function"==typeof define&&define.amd&&define.amd.jQuery&&define("jquery",[],function(){return ce})}(window),+function(e){"use strict";function t(){var e=document.createElement("bootstrap"),t={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd otransitionend",transition:"transitionend"};for(var n in t)if(void 0!==e.style[n])return{end:t[n]};return!1}e.fn.emulateTransitionEnd=function(t){var n=!1,i=this;e(this).one("bsTransitionEnd",function(){n=!0});var r=function(){n||e(i).trigger(e.support.transition.end)};return setTimeout(r,t),this},e(function(){e.support.transition=t(),e.support.transition&&(e.event.special.bsTransitionEnd={bindType:e.support.transition.end,delegateType:e.support.transition.end,handle:function(t){if(e(t.target).is(this))return t.handleObj.handler.apply(this,arguments)}})})}(jQuery),+function(e){"use strict";function t(t){return this.each(function(){var i=e(this),r=i.data("bs.tooltip"),o="object"==typeof t&&t;!r&&/destroy|hide/.test(t)||(r||i.data("bs.tooltip",r=new n(this,o)),"string"==typeof t&&r[t]())})}var n=function(e,t){this.type=null,this.options=null,this.enabled=null,this.timeout=null,this.hoverState=null,this.$element=null,this.inState=null,this.init("tooltip",e,t)};n.VERSION="3.3.6",n.TRANSITION_DURATION=150,n.DEFAULTS={animation:!0,placement:"top",selector:!1,template:'<div class="tooltip" role="tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner"></div></div>',trigger:"hover focus",title:"",delay:0,html:!1,container:!1,viewport:{selector:"body",padding:0}},n.prototype.init=function(t,n,i){if(this.enabled=!0,this.type=t,this.$element=e(n),this.options=this.getOptions(i),this.$viewport=this.options.viewport&&e(e.isFunction(this.options.viewport)?this.options.viewport.call(this,this.$element):this.options.viewport.selector||this.options.viewport),this.inState={click:!1,hover:!1,focus:!1},this.$element[0]instanceof document.constructor&&!this.options.selector)throw new Error("`selector` option must be specified when initializing "+this.type+" on the window.document object!");for(var r=this.options.trigger.split(" "),o=r.length;o--;){var a=r[o];if("click"==a)this.$element.on("click."+this.type,this.options.selector,e.proxy(this.toggle,this));else if("manual"!=a){var s="hover"==a?"mouseenter":"focusin",c="hover"==a?"mouseleave":"focusout";this.$element.on(s+"."+this.type,this.options.selector,e.proxy(this.enter,this)),this.$element.on(c+"."+this.type,this.options.selector,e.proxy(this.leave,this))}}this.options.selector?this._options=e.extend({},this.options,{trigger:"manual",selector:""}):this.fixTitle()},n.prototype.getDefaults=function(){return n.DEFAULTS},n.prototype.getOptions=function(t){return t=e.extend({},this.getDefaults(),this.$element.data(),t),t.delay&&"number"==typeof t.delay&&(t.delay={show:t.delay,hide:t.delay}),t},n.prototype.getDelegateOptions=function(){var t={},n=this.getDefaults();return this._options&&e.each(this._options,function(e,i){n[e]!=i&&(t[e]=i)}),t},n.prototype.enter=function(t){var n=t instanceof this.constructor?t:e(t.currentTarget).data("bs."+this.type);return n||(n=new this.constructor(t.currentTarget,this.getDelegateOptions()),e(t.currentTarget).data("bs."+this.type,n)),t instanceof e.Event&&(n.inState["focusin"==t.type?"focus":"hover"]=!0),n.tip().hasClass("in")||"in"==n.hoverState?void(n.hoverState="in"):(clearTimeout(n.timeout),n.hoverState="in",n.options.delay&&n.options.delay.show?void(n.timeout=setTimeout(function(){"in"==n.hoverState&&n.show()},n.options.delay.show)):n.show())},n.prototype.isInStateTrue=function(){for(var e in this.inState)if(this.inState[e])return!0;return!1},n.prototype.leave=function(t){var n=t instanceof this.constructor?t:e(t.currentTarget).data("bs."+this.type);if(n||(n=new this.constructor(t.currentTarget,this.getDelegateOptions()),e(t.currentTarget).data("bs."+this.type,n)),t instanceof e.Event&&(n.inState["focusout"==t.type?"focus":"hover"]=!1),!n.isInStateTrue())return clearTimeout(n.timeout),n.hoverState="out",n.options.delay&&n.options.delay.hide?void(n.timeout=setTimeout(function(){"out"==n.hoverState&&n.hide()},n.options.delay.hide)):n.hide()},n.prototype.show=function(){var t=e.Event("show.bs."+this.type);if(this.hasContent()&&this.enabled){this.$element.trigger(t);var i=e.contains(this.$element[0].ownerDocument.documentElement,this.$element[0]);if(t.isDefaultPrevented()||!i)return;var r=this,o=this.tip(),a=this.getUID(this.type);this.setContent(),o.attr("id",a),this.$element.attr("aria-describedby",a),this.options.animation&&o.addClass("fade");var s="function"==typeof this.options.placement?this.options.placement.call(this,o[0],this.$element[0]):this.options.placement,c=/\s?auto?\s?/i,l=c.test(s);l&&(s=s.replace(c,"")||"top"),o.detach().css({top:0,left:0,display:"block"}).addClass(s).data("bs."+this.type,this),this.options.container?o.appendTo(this.options.container):o.insertAfter(this.$element),this.$element.trigger("inserted.bs."+this.type);var u=this.getPosition(),d=o[0].offsetWidth,p=o[0].offsetHeight;if(l){var h=s,f=this.getPosition(this.$viewport);s="bottom"==s&&u.bottom+p>f.bottom?"top":"top"==s&&u.top-p<f.top?"bottom":"right"==s&&u.right+d>f.width?"left":"left"==s&&u.left-d<f.left?"right":s,o.removeClass(h).addClass(s)}var g=this.getCalculatedOffset(s,u,d,p);this.applyPlacement(g,s);var m=function(){var e=r.hoverState;r.$element.trigger("shown.bs."+r.type),r.hoverState=null,"out"==e&&r.leave(r)};e.support.transition&&this.$tip.hasClass("fade")?o.one("bsTransitionEnd",m).emulateTransitionEnd(n.TRANSITION_DURATION):m()}},n.prototype.applyPlacement=function(t,n){var i=this.tip(),r=i[0].offsetWidth,o=i[0].offsetHeight,a=parseInt(i.css("margin-top"),10),s=parseInt(i.css("margin-left"),10);isNaN(a)&&(a=0),isNaN(s)&&(s=0),t.top+=a,t.left+=s,e.offset.setOffset(i[0],e.extend({using:function(e){i.css({top:Math.round(e.top),left:Math.round(e.left)})}},t),0),i.addClass("in");var c=i[0].offsetWidth,l=i[0].offsetHeight;"top"==n&&l!=o&&(t.top=t.top+o-l);var u=this.getViewportAdjustedDelta(n,t,c,l);u.left?t.left+=u.left:t.top+=u.top;var d=/top|bottom/.test(n),p=d?2*u.left-r+c:2*u.top-o+l,h=d?"offsetWidth":"offsetHeight";i.offset(t),this.replaceArrow(p,i[0][h],d)},n.prototype.replaceArrow=function(e,t,n){this.arrow().css(n?"left":"top",50*(1-e/t)+"%").css(n?"top":"left","")},n.prototype.setContent=function(){var e=this.tip(),t=this.getTitle();e.find(".tooltip-inner")[this.options.html?"html":"text"](t),e.removeClass("fade in top bottom left right")},n.prototype.hide=function(t){function i(){"in"!=r.hoverState&&o.detach(),r.$element.removeAttr("aria-describedby").trigger("hidden.bs."+r.type),t&&t()}var r=this,o=e(this.$tip),a=e.Event("hide.bs."+this.type);if(this.$element.trigger(a),!a.isDefaultPrevented())return o.removeClass("in"),e.support.transition&&o.hasClass("fade")?o.one("bsTransitionEnd",i).emulateTransitionEnd(n.TRANSITION_DURATION):i(),this.hoverState=null,this},n.prototype.fixTitle=function(){var e=this.$element;(e.attr("title")||"string"!=typeof e.attr("data-original-title"))&&e.attr("data-original-title",e.attr("title")||"").attr("title","")},n.prototype.hasContent=function(){return this.getTitle()},n.prototype.getPosition=function(t){t=t||this.$element;var n=t[0],i="BODY"==n.tagName,r=n.getBoundingClientRect();null==r.width&&(r=e.extend({},r,{width:r.right-r.left,height:r.bottom-r.top}));var o=i?{top:0,left:0}:t.offset(),a={scroll:i?document.documentElement.scrollTop||document.body.scrollTop:t.scrollTop()},s=i?{width:e(window).width(),height:e(window).height()}:null;return e.extend({},r,a,s,o)},n.prototype.getCalculatedOffset=function(e,t,n,i){return"bottom"==e?{top:t.top+t.height,left:t.left+t.width/2-n/2}:"top"==e?{top:t.top-i,left:t.left+t.width/2-n/2}:"left"==e?{top:t.top+t.height/2-i/2,left:t.left-n}:{top:t.top+t.height/2-i/2,left:t.left+t.width}},n.prototype.getViewportAdjustedDelta=function(e,t,n,i){var r={top:0,left:0};if(!this.$viewport)return r;var o=this.options.viewport&&this.options.viewport.padding||0,a=this.getPosition(this.$viewport);if(/right|left/.test(e)){var s=t.top-o-a.scroll,c=t.top+o-a.scroll+i;s<a.top?r.top=a.top-s:c>a.top+a.height&&(r.top=a.top+a.height-c)}else{var l=t.left-o,u=t.left+o+n;l<a.left?r.left=a.left-l:u>a.right&&(r.left=a.left+a.width-u)}return r},n.prototype.getTitle=function(){var e,t=this.$element,n=this.options;return e=t.attr("data-original-title")||("function"==typeof n.title?n.title.call(t[0]):n.title)},n.prototype.getUID=function(e){do e+=~~(1e6*Math.random());while(document.getElementById(e));return e},n.prototype.tip=function(){if(!this.$tip&&(this.$tip=e(this.options.template),1!=this.$tip.length))throw new Error(this.type+" `template` option must consist of exactly 1 top-level element!");return this.$tip},n.prototype.arrow=function(){return this.$arrow=this.$arrow||this.tip().find(".tooltip-arrow")},n.prototype.enable=function(){this.enabled=!0},n.prototype.disable=function(){this.enabled=!1},n.prototype.toggleEnabled=function(){this.enabled=!this.enabled},n.prototype.toggle=function(t){var n=this;t&&(n=e(t.currentTarget).data("bs."+this.type),n||(n=new this.constructor(t.currentTarget,this.getDelegateOptions()),e(t.currentTarget).data("bs."+this.type,n))),t?(n.inState.click=!n.inState.click,n.isInStateTrue()?n.enter(n):n.leave(n)):n.tip().hasClass("in")?n.leave(n):n.enter(n)},n.prototype.destroy=function(){var e=this;clearTimeout(this.timeout),this.hide(function(){e.$element.off("."+e.type).removeData("bs."+e.type),e.$tip&&e.$tip.detach(),e.$tip=null,e.$arrow=null,e.$viewport=null})};var i=e.fn.tooltip;e.fn.tooltip=t,e.fn.tooltip.Constructor=n,e.fn.tooltip.noConflict=function(){return e.fn.tooltip=i,this}}(jQuery),+function(e){"use strict";function t(t){var n=t.attr("data-target");n||(n=t.attr("href"),n=n&&/#[A-Za-z]/.test(n)&&n.replace(/.*(?=#[^\s]*$)/,""));var i=n&&e(n);return i&&i.length?i:t.parent()}function n(n){n&&3===n.which||(e(r).remove(),e(o).each(function(){var i=e(this),r=t(i),o={relatedTarget:this};r.hasClass("open")&&(n&&"click"==n.type&&/input|textarea/i.test(n.target.tagName)&&e.contains(r[0],n.target)||(r.trigger(n=e.Event("hide.bs.dropdown",o)),n.isDefaultPrevented()||(i.attr("aria-expanded","false"),r.removeClass("open").trigger(e.Event("hidden.bs.dropdown",o)))))}))}function i(t){return this.each(function(){var n=e(this),i=n.data("bs.dropdown");i||n.data("bs.dropdown",i=new a(this)),"string"==typeof t&&i[t].call(n)})}var r=".dropdown-backdrop",o='[data-toggle="dropdown"]',a=function(t){e(t).on("click.bs.dropdown",this.toggle)};a.VERSION="3.3.6",a.prototype.toggle=function(i){var r=e(this);if(!r.is(".disabled, :disabled")){var o=t(r),a=o.hasClass("open");if(n(),!a){"ontouchstart"in document.documentElement&&!o.closest(".navbar-nav").length&&e(document.createElement("div")).addClass("dropdown-backdrop").insertAfter(e(this)).on("click",n);var s={relatedTarget:this};if(o.trigger(i=e.Event("show.bs.dropdown",s)),i.isDefaultPrevented())return;r.trigger("focus").attr("aria-expanded","true"),o.toggleClass("open").trigger(e.Event("shown.bs.dropdown",s))}return!1}},a.prototype.keydown=function(n){if(/(38|40|27|32)/.test(n.which)&&!/input|textarea/i.test(n.target.tagName)){var i=e(this);if(n.preventDefault(),n.stopPropagation(),!i.is(".disabled, :disabled")){var r=t(i),a=r.hasClass("open");if(!a&&27!=n.which||a&&27==n.which)return 27==n.which&&r.find(o).trigger("focus"),i.trigger("click");var s=" li:not(.disabled):visible a",c=r.find(".dropdown-menu"+s);if(c.length){var l=c.index(n.target);38==n.which&&l>0&&l--,40==n.which&&l<c.length-1&&l++,~l||(l=0),c.eq(l).trigger("focus")}}}};var s=e.fn.dropdown;e.fn.dropdown=i,e.fn.dropdown.Constructor=a,e.fn.dropdown.noConflict=function(){return e.fn.dropdown=s,this},e(document).on("click.bs.dropdown.data-api",n).on("click.bs.dropdown.data-api",".dropdown form",function(e){e.stopPropagation()}).on("click.bs.dropdown.data-api",o,a.prototype.toggle).on("keydown.bs.dropdown.data-api",o,a.prototype.keydown).on("keydown.bs.dropdown.data-api",".dropdown-menu",a.prototype.keydown)}(jQuery),+function(e){"use strict";function t(t){return this.each(function(){var i=e(this),r=i.data("bs.tab");r||i.data("bs.tab",r=new n(this)),"string"==typeof t&&r[t]()})}var n=function(t){this.element=e(t)};n.VERSION="3.3.6",n.TRANSITION_DURATION=150,n.prototype.show=function(){var t=this.element,n=t.closest("ul:not(.dropdown-menu)"),i=t.data("target");if(i||(i=t.attr("href"),i=i&&i.replace(/.*(?=#[^\s]*$)/,"")),!t.parent("li").hasClass("active")){var r=n.find(".active:last a"),o=e.Event("hide.bs.tab",{relatedTarget:t[0]}),a=e.Event("show.bs.tab",{relatedTarget:r[0]});if(r.trigger(o),t.trigger(a),!a.isDefaultPrevented()&&!o.isDefaultPrevented()){var s=e(i);this.activate(t.closest("li"),n),this.activate(s,s.parent(),function(){r.trigger({type:"hidden.bs.tab",relatedTarget:t[0]}),t.trigger({type:"shown.bs.tab",relatedTarget:r[0]})})}}},n.prototype.activate=function(t,i,r){function o(){a.removeClass("active").find("> .dropdown-menu > .active").removeClass("active").end().find('[data-toggle="tab"]').attr("aria-expanded",!1),t.addClass("active").find('[data-toggle="tab"]').attr("aria-expanded",!0),s?(t[0].offsetWidth,t.addClass("in")):t.removeClass("fade"),t.parent(".dropdown-menu").length&&t.closest("li.dropdown").addClass("active").end().find('[data-toggle="tab"]').attr("aria-expanded",!0),r&&r()}var a=i.find("> .active"),s=r&&e.support.transition&&(a.length&&a.hasClass("fade")||!!i.find("> .fade").length);a.length&&s?a.one("bsTransitionEnd",o).emulateTransitionEnd(n.TRANSITION_DURATION):o(),a.removeClass("in")};var i=e.fn.tab;e.fn.tab=t,e.fn.tab.Constructor=n,e.fn.tab.noConflict=function(){return e.fn.tab=i,this};var r=function(n){n.preventDefault(),t.call(e(this),"show")};e(document).on("click.bs.tab.data-api",'[data-toggle="tab"]',r).on("click.bs.tab.data-api",'[data-toggle="pill"]',r)}(jQuery),function(e,t,n){var i=function(){for(var e=/audio(.min)?.js.*/,t=document.getElementsByTagName("script"),n=0,i=t.length;n<i;n++){var r=t[n].getAttribute("src");if(e.test(r))return r.replace(e,"")}}();n[e]={instanceCount:0,instances:{},flashSource:'      <object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" id="$1" width="1" height="1" name="$1" style="position: absolute; left: -1px;">         <param name="movie" value="$2?playerInstance='+e+'.instances[\'$1\']&datetime=$3">         <param name="allowscriptaccess" value="always">         <embed name="$1" src="$2?playerInstance='+e+'.instances[\'$1\']&datetime=$3" width="1" height="1" allowscriptaccess="always">       </object>',settings:{autoplay:!1,loop:!1,preload:!0,imageLocation:i+"player-graphics.gif",swfLocation:i+"audiojs.swf",useFlash:function(){var e=document.createElement("audio");return!(e.canPlayType&&e.canPlayType("audio/mpeg;").replace(/no/,""))}(),hasFlash:function(){if(navigator.plugins&&navigator.plugins.length&&navigator.plugins["Shockwave Flash"])return!0;if(navigator.mimeTypes&&navigator.mimeTypes.length){var e=navigator.mimeTypes["application/x-shockwave-flash"];return e&&e.enabledPlugin}try{return new ActiveXObject("ShockwaveFlash.ShockwaveFlash"),!0}catch(t){}return!1}(),createPlayer:{markup:'          <div class="play-pause">             <p class="play"></p>             <p class="pause"></p>             <p class="loading"></p>             <p class="error"></p>           </div>           <div class="scrubber">             <div class="progress"></div>             <div class="loaded"></div>           </div>           <div class="time">             <em class="played">00:00</em>/<strong class="duration">00:00</strong>           </div>           <div class="error-message"></div>',playPauseClass:"play-pause",scrubberClass:"scrubber",progressClass:"progress",loaderClass:"loaded",timeClass:"time",durationClass:"duration",playedClass:"played",errorMessageClass:"error-message",playingClass:"playing",loadingClass:"loading",errorClass:"error"},css:'        .audiojs audio { position: absolute; left: -1px; }         .audiojs { width: 460px; height: 36px; background: #404040; overflow: hidden; font-family: monospace; font-size: 12px;           background-image: -webkit-gradient(linear, left top, left bottom, color-stop(0, #444), color-stop(0.5, #555), color-stop(0.51, #444), color-stop(1, #444));           background-image: -moz-linear-gradient(center top, #444 0%, #555 50%, #444 51%, #444 100%);           -webkit-box-shadow: 1px 1px 8px rgba(0, 0, 0, 0.3); -moz-box-shadow: 1px 1px 8px rgba(0, 0, 0, 0.3);           -o-box-shadow: 1px 1px 8px rgba(0, 0, 0, 0.3); box-shadow: 1px 1px 8px rgba(0, 0, 0, 0.3); }         .audiojs .play-pause { width: 25px; height: 40px; padding: 4px 6px; margin: 0px; float: left; overflow: hidden; border-right: 1px solid #000; }         .audiojs p { display: none; width: 25px; height: 40px; margin: 0px; cursor: pointer; }         .audiojs .play { display: block; }         .audiojs .scrubber { position: relative; float: left; width: 280px; background: #5a5a5a; height: 14px; margin: 10px; border-top: 1px solid #3f3f3f; border-left: 0px; border-bottom: 0px; overflow: hidden; }         .audiojs .progress { position: absolute; top: 0px; left: 0px; height: 14px; width: 0px; background: #ccc; z-index: 1;           background-image: -webkit-gradient(linear, left top, left bottom, color-stop(0, #ccc), color-stop(0.5, #ddd), color-stop(0.51, #ccc), color-stop(1, #ccc));           background-image: -moz-linear-gradient(center top, #ccc 0%, #ddd 50%, #ccc 51%, #ccc 100%); }         .audiojs .loaded { position: absolute; top: 0px; left: 0px; height: 14px; width: 0px; background: #000;           background-image: -webkit-gradient(linear, left top, left bottom, color-stop(0, #222), color-stop(0.5, #333), color-stop(0.51, #222), color-stop(1, #222));           background-image: -moz-linear-gradient(center top, #222 0%, #333 50%, #222 51%, #222 100%); }         .audiojs .time { float: left; height: 36px; line-height: 36px; margin: 0px 0px 0px 6px; padding: 0px 6px 0px 12px; border-left: 1px solid #000; color: #ddd; text-shadow: 1px 1px 0px rgba(0, 0, 0, 0.5); }         .audiojs .time em { padding: 0px 2px 0px 0px; color: #f9f9f9; font-style: normal; }         .audiojs .time strong { padding: 0px 0px 0px 2px; font-weight: normal; }         .audiojs .error-message { float: left; display: none; margin: 0px 10px; height: 36px; width: 400px; overflow: hidden; line-height: 36px; white-space: nowrap; color: #fff;           text-overflow: ellipsis; -o-text-overflow: ellipsis; -icab-text-overflow: ellipsis; -khtml-text-overflow: ellipsis; -moz-text-overflow: ellipsis; -webkit-text-overflow: ellipsis; }         .audiojs .error-message a { color: #eee; text-decoration: none; padding-bottom: 1px; border-bottom: 1px solid #999; white-space: wrap; }                 .audiojs .play { background: url("$1") -2px -1px no-repeat; }         .audiojs .loading { background: url("$1") -2px -31px no-repeat; }         .audiojs .error { background: url("$1") -2px -61px no-repeat; }         .audiojs .pause { background: url("$1") -2px -91px no-repeat; }                 .playing .play, .playing .loading, .playing .error { display: none; }         .playing .pause { display: block; }                 .loading .play, .loading .pause, .loading .error { display: none; }         .loading .loading { display: block; }                 .error .time, .error .play, .error .pause, .error .scrubber, .error .loading { display: none; }         .error .error { display: block; }         .error .play-pause p { cursor: auto; }         .error .error-message { display: block; }',trackEnded:function(){},flashError:function(){var t=this.settings.createPlayer,i=r(t.errorMessageClass,this.wrapper),o='Missing <a href="http://get.adobe.com/flashplayer/">flash player</a> plugin.';this.mp3&&(o+=' <a href="'+this.mp3+'">Download audio file</a>.'),n[e].helpers.removeClass(this.wrapper,t.loadingClass),n[e].helpers.addClass(this.wrapper,t.errorClass),i.innerHTML=o},loadError:function(){var t=this.settings.createPlayer,i=r(t.errorMessageClass,this.wrapper);n[e].helpers.removeClass(this.wrapper,t.loadingClass),n[e].helpers.addClass(this.wrapper,t.errorClass),i.innerHTML='Error loading: "'+this.mp3+'"'},init:function(){n[e].helpers.addClass(this.wrapper,this.settings.createPlayer.loadingClass)},loadStarted:function(){var t=this.settings.createPlayer,i=r(t.durationClass,this.wrapper),o=Math.floor(this.duration/60),a=Math.floor(this.duration%60);n[e].helpers.removeClass(this.wrapper,t.loadingClass),i.innerHTML=(o<10?"0":"")+o+":"+(a<10?"0":"")+a},loadProgress:function(e){var t=this.settings.createPlayer,n=r(t.scrubberClass,this.wrapper);r(t.loaderClass,this.wrapper).style.width=n.offsetWidth*e+"px"},playPause:function(){this.playing?this.settings.play():this.settings.pause()},play:function(){n[e].helpers.addClass(this.wrapper,this.settings.createPlayer.playingClass)},pause:function(){n[e].helpers.removeClass(this.wrapper,this.settings.createPlayer.playingClass)},updatePlayhead:function(e){var t=this.settings.createPlayer,n=r(t.scrubberClass,this.wrapper);r(t.progressClass,this.wrapper).style.width=n.offsetWidth*e+"px",t=r(t.playedClass,this.wrapper),n=this.duration*e,e=Math.floor(n/60),n=Math.floor(n%60),t.innerHTML=(e<10?"0":"")+e+":"+(n<10?"0":"")+n}},create:function(e,t){return t=t||{},e.length?this.createAll(t,e):this.newInstance(e,t)},createAll:function(e,t){var n=t||document.getElementsByTagName("audio"),i=[];e=e||{};for(var r=0,o=n.length;r<o;r++)i.push(this.newInstance(n[r],e));return i},newInstance:function(e,i){var r=this.helpers.clone(this.settings),o="audiojs"+this.instanceCount,a="audiojs_wrapper"+this.instanceCount;return this.instanceCount++,null!=e.getAttribute("autoplay")&&(r.autoplay=!0),null!=e.getAttribute("loop")&&(r.loop=!0),"none"==e.getAttribute("preload")&&(r.preload=!1),i&&this.helpers.merge(r,i),r.createPlayer.markup?e=this.createPlayer(e,r.createPlayer,a):e.parentNode.setAttribute("id",a),a=new n[t](e,r),r.css&&this.helpers.injectCss(a,r.css),r.useFlash&&r.hasFlash?(this.injectFlash(a,o),this.attachFlashEvents(a.wrapper,a)):r.useFlash&&!r.hasFlash&&this.settings.flashError.apply(a),(!r.useFlash||r.useFlash&&r.hasFlash)&&this.attachEvents(a.wrapper,a),this.instances[o]=a},createPlayer:function(e,t,n){var i=document.createElement("div"),r=e.cloneNode(!0);return i.setAttribute("class","audiojs"),i.setAttribute("className","audiojs"),i.setAttribute("id",n),r.outerHTML&&!document.createElement("audio").canPlayType?(r=this.helpers.cloneHtml5Node(e),i.innerHTML=t.markup,i.appendChild(r),e.outerHTML=i.outerHTML,i=document.getElementById(n)):(i.appendChild(r),i.innerHTML+=t.markup,e.parentNode.replaceChild(i,e)),i.getElementsByTagName("audio")[0]},attachEvents:function(t,i){if(i.settings.createPlayer){var o=i.settings.createPlayer,a=r(o.playPauseClass,t),s=r(o.scrubberClass,t);n[e].events.addListener(a,"click",function(){i.playPause.apply(i)}),n[e].events.addListener(s,"click",function(e){e=e.clientX;var t=this,n=0;if(t.offsetParent)do n+=t.offsetLeft;while(t=t.offsetParent);i.skipTo((e-n)/s.offsetWidth)}),i.settings.useFlash||(n[e].events.trackLoadProgress(i),n[e].events.addListener(i.element,"timeupdate",function(){i.updatePlayhead.apply(i)}),n[e].events.addListener(i.element,"ended",function(){i.trackEnded.apply(i)}),n[e].events.addListener(i.source,"error",function(){clearInterval(i.readyTimer),clearInterval(i.loadTimer),i.settings.loadError.apply(i)}))}},attachFlashEvents:function(e,t){t.swfReady=!1,t.load=function(e){t.mp3=e,t.swfReady&&t.element.load(e)},t.loadProgress=function(e,n){t.loadedPercent=e,t.duration=n,t.settings.loadStarted.apply(t),t.settings.loadProgress.apply(t,[e])},t.skipTo=function(e){e>t.loadedPercent||(t.updatePlayhead.call(t,[e]),t.element.skipTo(e))},t.updatePlayhead=function(e){t.settings.updatePlayhead.apply(t,[e])},t.play=function(){t.settings.preload||(t.settings.preload=!0,t.element.init(t.mp3)),t.playing=!0,t.element.pplay(),t.settings.play.apply(t)},t.pause=function(){t.playing=!1,t.element.ppause(),t.settings.pause.apply(t)},t.setVolume=function(e){t.element.setVolume(e)},t.loadStarted=function(){t.swfReady=!0,t.settings.preload&&t.element.init(t.mp3),t.settings.autoplay&&t.play.apply(t)}},injectFlash:function(e,t){var n=this.flashSource.replace(/\$1/g,t);n=n.replace(/\$2/g,e.settings.swfLocation),n=n.replace(/\$3/g,+new Date+Math.random());var i=e.wrapper.innerHTML,r=document.createElement("div");r.innerHTML=n+i,e.wrapper.innerHTML=r.innerHTML,e.element=this.helpers.getSwf(t)},helpers:{merge:function(e,t){for(attr in t)(e.hasOwnProperty(attr)||t.hasOwnProperty(attr))&&(e[attr]=t[attr])},clone:function(e){if(null==e||"object"!=typeof e)return e;var t,n=new e.constructor;for(t in e)n[t]=arguments.callee(e[t]);return n},addClass:function(e,t){RegExp("(\\s|^)"+t+"(\\s|$)").test(e.className)||(e.className+=" "+t)},removeClass:function(e,t){e.className=e.className.replace(RegExp("(\\s|^)"+t+"(\\s|$)")," ")},injectCss:function(e,t){for(var n="",i=document.getElementsByTagName("style"),r=t.replace(/\$1/g,e.settings.imageLocation),o=0,a=i.length;o<a;o++){var s=i[o].getAttribute("title");if(s&&~s.indexOf("audiojs")){if(a=i[o],a.innerHTML===r)return;n=a.innerHTML;break}}i=document.getElementsByTagName("head")[0],o=i.firstChild,a=document.createElement("style"),i&&(a.setAttribute("type","text/css"),a.setAttribute("title","audiojs"),a.styleSheet?a.styleSheet.cssText=n+r:a.appendChild(document.createTextNode(n+r)),o?i.insertBefore(a,o):i.appendChild(styleElement))},cloneHtml5Node:function(e){var t=document.createDocumentFragment(),n=t.createElement?t:document;return n.createElement("audio"),n=n.createElement("div"),t.appendChild(n),n.innerHTML=e.outerHTML,n.firstChild},getSwf:function(e){return e=document[e]||window[e],e.length>1?e[e.length-1]:e}},events:{memoryLeaking:!1,listeners:[],addListener:function(t,i,r){t.addEventListener?t.addEventListener(i,r,!1):t.attachEvent&&(this.listeners.push(t),this.memoryLeaking||(window.attachEvent("onunload",function(){if(this.listeners)for(var t=0,i=this.listeners.length;t<i;t++)n[e].events.purge(this.listeners[t])}),this.memoryLeaking=!0),t.attachEvent("on"+i,function(){r.call(t,window.event)}))},trackLoadProgress:function(e){if(e.settings.preload){var t,n;e=e;var i=/(ipod|iphone|ipad)/i.test(navigator.userAgent);t=setInterval(function(){e.element.readyState>-1&&(i||e.init.apply(e)),e.element.readyState>1&&(e.settings.autoplay&&e.play.apply(e),clearInterval(t),n=setInterval(function(){e.loadProgress.apply(e),e.loadedPercent>=1&&clearInterval(n)}))},10),e.readyTimer=t,e.loadTimer=n}},purge:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}(function(e){var t,n=e.attributes;if(n)for(t=0;t<n.length;t+=1)"function"==typeof e[n[t].name]&&(e[n[t].name]=null);if(n=e.childNodes)for(t=0;t<n.length;t+=1)purge(e.childNodes[t])}),ready:function(){return function(e){var t=window,n=!1,i=!0,r=t.document,o=r.documentElement,a=r.addEventListener?"addEventListener":"attachEvent",s=r.addEventListener?"removeEventListener":"detachEvent",c=r.addEventListener?"":"on",l=function p(i){"readystatechange"==i.type&&"complete"!=r.readyState||(("load"==i.type?t:r)[s](c+i.type,p,!1),!n&&(n=!0)&&e.call(t,i.type||i))},u=function h(){try{o.doScroll("left")}catch(e){return void setTimeout(h,50)}l("poll")};if("complete"==r.readyState)e.call(t,"lazy");else{if(r.createEventObject&&o.doScroll){try{i=!t.frameElement}catch(d){}i&&u()}r[a](c+"DOMContentLoaded",l,!1),r[a](c+"readystatechange",l,!1),t[a](c+"load",l,!1)}}}()}},n[t]=function(e,t){this.element=e,this.wrapper=e.parentNode,this.source=e.getElementsByTagName("source")[0]||e,this.mp3=function(e){var t=e.getElementsByTagName("source")[0];return e.getAttribute("src")||(t?t.getAttribute("src"):null)}(e),this.settings=t,this.loadStartedCalled=!1,this.loadedPercent=0,this.duration=1,
this.playing=!1},n[t].prototype={updatePlayhead:function(){this.settings.updatePlayhead.apply(this,[this.element.currentTime/this.duration])},skipTo:function(e){e>this.loadedPercent||(this.element.currentTime=this.duration*e,this.updatePlayhead())},load:function(t){this.loadStartedCalled=!1,this.source.setAttribute("src",t),this.element.load(),this.mp3=t,n[e].events.trackLoadProgress(this)},loadError:function(){this.settings.loadError.apply(this)},init:function(){this.settings.init.apply(this)},loadStarted:function(){return!!this.element.duration&&(this.duration=this.element.duration,this.updatePlayhead(),void this.settings.loadStarted.apply(this))},loadProgress:function(){null!=this.element.buffered&&this.element.buffered.length&&(this.loadStartedCalled||(this.loadStartedCalled=this.loadStarted()),this.loadedPercent=this.element.buffered.end(this.element.buffered.length-1)/this.duration,this.settings.loadProgress.apply(this,[this.loadedPercent]))},playPause:function(){this.playing?this.pause():this.play()},play:function(){/(ipod|iphone|ipad)/i.test(navigator.userAgent)&&0==this.element.readyState&&this.init.apply(this),this.settings.preload||(this.settings.preload=!0,this.element.setAttribute("preload","auto"),n[e].events.trackLoadProgress(this)),this.playing=!0,this.element.play(),this.settings.play.apply(this)},pause:function(){this.playing=!1,this.element.pause(),this.settings.pause.apply(this)},setVolume:function(e){this.element.volume=e},trackEnded:function(){this.skipTo.apply(this,[0]),this.settings.loop||this.pause.apply(this),this.settings.trackEnded.apply(this)}};var r=function(e,t){var n=[];if(t=t||document,t.getElementsByClassName)n=t.getElementsByClassName(e);else{var i,r,o=t.getElementsByTagName("*"),a=RegExp("(^|\\s)"+e+"(\\s|$)");for(i=0,r=o.length;i<r;i++)a.test(o[i].className)&&n.push(o[i])}return n.length>1?n:n[0]}}("audiojs","audiojsInstance",this),function(e,t){var n,i={},r=function(e,t){var n,i,r;if("string"==typeof e)return s(e);for(n=[],i=e.length,r=0;r<i;r++)n.push(s(e[r]));return t.apply(null,n)},o=function(e,t,n){2===arguments.length&&(n=t,t=null),r(t||[],function(){a(e,n,arguments)})},a=function(e,t,n){var o,a={exports:t};"function"==typeof t&&(n.length||(n=[r,a.exports,a]),o=t.apply(null,n),void 0!==o&&(a.exports=o)),i[e]=a.exports},s=function(t){var n=i[t]||e[t];if(!n)throw new Error("`"+t+"` is undefined");return n},c=function(e){var t,n,r,o,a,s;s=function(e){return e&&e.charAt(0).toUpperCase()+e.substr(1)};for(t in i)if(n=e,i.hasOwnProperty(t)){for(r=t.split("/"),a=s(r.pop());o=s(r.shift());)n[o]=n[o]||{},n=n[o];n[a]=i[t]}return e},l=function(n){return e.__dollar=n,c(t(e,o,r))};"object"==typeof module&&"object"==typeof module.exports?module.exports=l():"function"==typeof define&&define.amd?define(["jquery"],l):(n=e.WebUploader,e.WebUploader=l(),e.WebUploader.noConflict=function(){e.WebUploader=n})}(window,function(e,t,n){return t("dollar-third",[],function(){var t=e.__dollar||e.jQuery||e.Zepto;if(!t)throw new Error("jQuery or Zepto not found!");return t}),t("dollar",["dollar-third"],function(e){return e}),t("promise-third",["dollar"],function(e){return{Deferred:e.Deferred,when:e.when,isPromise:function(e){return e&&"function"==typeof e.then}}}),t("promise",["promise-third"],function(e){return e}),t("base",["dollar","promise"],function(t,n){function i(e){return function(){return s.apply(e,arguments)}}function r(e,t){return function(){return e.apply(t,arguments)}}function o(e){var t;return Object.create?Object.create(e):(t=function(){},t.prototype=e,new t)}var a=function(){},s=Function.call;return{version:"0.1.5",$:t,Deferred:n.Deferred,isPromise:n.isPromise,when:n.when,browser:function(e){var t={},n=e.match(/WebKit\/([\d.]+)/),i=e.match(/Chrome\/([\d.]+)/)||e.match(/CriOS\/([\d.]+)/),r=e.match(/MSIE\s([\d\.]+)/)||e.match(/(?:trident)(?:.*rv:([\w.]+))?/i),o=e.match(/Firefox\/([\d.]+)/),a=e.match(/Safari\/([\d.]+)/),s=e.match(/OPR\/([\d.]+)/);return n&&(t.webkit=parseFloat(n[1])),i&&(t.chrome=parseFloat(i[1])),r&&(t.ie=parseFloat(r[1])),o&&(t.firefox=parseFloat(o[1])),a&&(t.safari=parseFloat(a[1])),s&&(t.opera=parseFloat(s[1])),t}(navigator.userAgent),os:function(e){var t={},n=e.match(/(?:Android);?[\s\/]+([\d.]+)?/),i=e.match(/(?:iPad|iPod|iPhone).*OS\s([\d_]+)/);return n&&(t.android=parseFloat(n[1])),i&&(t.ios=parseFloat(i[1].replace(/_/g,"."))),t}(navigator.userAgent),inherits:function(e,n,i){var r;return"function"==typeof n?(r=n,n=null):r=n&&n.hasOwnProperty("constructor")?n.constructor:function(){return e.apply(this,arguments)},t.extend(!0,r,e,i||{}),r.__super__=e.prototype,r.prototype=o(e.prototype),n&&t.extend(!0,r.prototype,n),r},noop:a,bindFn:r,log:function(){return e.console?r(console.log,console):a}(),nextTick:function(){return function(e){setTimeout(e,1)}}(),slice:i([].slice),guid:function(){var e=0;return function(t){for(var n=(+new Date).toString(32),i=0;i<5;i++)n+=Math.floor(65535*Math.random()).toString(32);return(t||"wu_")+n+(e++).toString(32)}}(),formatSize:function(e,t,n){var i;for(n=n||["B","K","M","G","TB"];(i=n.shift())&&e>1024;)e/=1024;return("B"===i?e:e.toFixed(t||2))+i}}}),t("mediator",["base"],function(e){function t(e,t,n,i){return o.grep(e,function(e){return e&&(!t||e.e===t)&&(!n||e.cb===n||e.cb._cb===n)&&(!i||e.ctx===i)})}function n(e,t,n){o.each((e||"").split(s),function(e,i){n(i,t)})}function i(e,t){for(var n,i=!1,r=-1,o=e.length;++r<o;)if(n=e[r],n.cb.apply(n.ctx2,t)===!1){i=!0;break}return!i}var r,o=e.$,a=[].slice,s=/\s+/;return r={on:function(e,t,i){var r,o=this;return t?(r=this._events||(this._events=[]),n(e,t,function(e,t){var n={e:e};n.cb=t,n.ctx=i,n.ctx2=i||o,n.id=r.length,r.push(n)}),this):this},once:function(e,t,i){var r=this;return t?(n(e,t,function(e,t){var n=function o(){return r.off(e,o),t.apply(i||r,arguments)};n._cb=t,r.on(e,n,i)}),r):r},off:function(e,i,r){var a=this._events;return a?e||i||r?(n(e,i,function(e,n){o.each(t(a,e,n,r),function(){delete a[this.id]})}),this):(this._events=[],this):this},trigger:function(e){var n,r,o;return this._events&&e?(n=a.call(arguments,1),r=t(this._events,e),o=t(this._events,"all"),i(r,n)&&i(o,arguments)):this}},o.extend({installTo:function(e){return o.extend(e,r)}},r)}),t("uploader",["base","mediator"],function(e,t){function n(e){this.options=i.extend(!0,{},n.options,e),this._init(this.options)}var i=e.$;return n.options={},t.installTo(n.prototype),i.each({upload:"start-upload",stop:"stop-upload",getFile:"get-file",getFiles:"get-files",addFile:"add-file",addFiles:"add-file",sort:"sort-files",removeFile:"remove-file",cancelFile:"cancel-file",skipFile:"skip-file",retry:"retry",isInProgress:"is-in-progress",makeThumb:"make-thumb",md5File:"md5-file",getDimension:"get-dimension",addButton:"add-btn",predictRuntimeType:"predict-runtime-type",refresh:"refresh",disable:"disable",enable:"enable",reset:"reset"},function(e,t){n.prototype[e]=function(){return this.request(t,arguments)}}),i.extend(n.prototype,{state:"pending",_init:function(e){var t=this;t.request("init",e,function(){t.state="ready",t.trigger("ready")})},option:function(e,t){var n=this.options;return arguments.length>1?void(i.isPlainObject(t)&&i.isPlainObject(n[e])?i.extend(n[e],t):n[e]=t):e?n[e]:n},getStats:function(){var e=this.request("get-stats");return e?{successNum:e.numOfSuccess,progressNum:e.numOfProgress,cancelNum:e.numOfCancel,invalidNum:e.numOfInvalid,uploadFailNum:e.numOfUploadFailed,queueNum:e.numOfQueue,interruptNum:e.numofInterrupt}:{}},trigger:function(e){var n=[].slice.call(arguments,1),r=this.options,o="on"+e.substring(0,1).toUpperCase()+e.substring(1);return!(t.trigger.apply(this,arguments)===!1||i.isFunction(r[o])&&r[o].apply(this,n)===!1||i.isFunction(this[o])&&this[o].apply(this,n)===!1||t.trigger.apply(t,[this,e].concat(n))===!1)},destroy:function(){this.request("destroy",arguments),this.off()},request:e.noop}),e.create=n.create=function(e){return new n(e)},e.Uploader=n,n}),t("runtime/runtime",["base","mediator"],function(e,t){function n(t){this.options=i.extend({container:document.body},t),this.uid=e.guid("rt_")}var i=e.$,r={},o=function(e){for(var t in e)if(e.hasOwnProperty(t))return t;return null};return i.extend(n.prototype,{getContainer:function(){var e,t,n=this.options;return this._container?this._container:(e=i(n.container||document.body),t=i(document.createElement("div")),t.attr("id","rt_"+this.uid),t.css({position:"absolute",top:"0px",left:"0px",width:"1px",height:"1px",overflow:"hidden"}),e.append(t),e.addClass("webuploader-container"),this._container=t,this._parent=e,t)},init:e.noop,exec:e.noop,destroy:function(){this._container&&this._container.remove(),this._parent&&this._parent.removeClass("webuploader-container"),this.off()}}),n.orders="html5,flash",n.addRuntime=function(e,t){r[e]=t},n.hasRuntime=function(e){return!!(e?r[e]:o(r))},n.create=function(e,t){var a,s;if(t=t||n.orders,i.each(t.split(/\s*,\s*/g),function(){if(r[this])return a=this,!1}),a=a||o(r),!a)throw new Error("Runtime Error");return s=new r[a](e)},t.installTo(n.prototype),n}),t("runtime/client",["base","mediator","runtime/runtime"],function(e,t,n){function i(t,i){var o,a=e.Deferred();this.uid=e.guid("client_"),this.runtimeReady=function(e){return a.done(e)},this.connectRuntime=function(t,s){if(o)throw new Error("already connected!");return a.done(s),"string"==typeof t&&r.get(t)&&(o=r.get(t)),o=o||r.get(null,i),o?(e.$.extend(o.options,t),o.__promise.then(a.resolve),o.__client++):(o=n.create(t,t.runtimeOrder),o.__promise=a.promise(),o.once("ready",a.resolve),o.init(),r.add(o),o.__client=1),i&&(o.__standalone=i),o},this.getRuntime=function(){return o},this.disconnectRuntime=function(){o&&(o.__client--,o.__client<=0&&(r.remove(o),delete o.__promise,o.destroy()),o=null)},this.exec=function(){if(o){var n=e.slice(arguments);return t&&n.unshift(t),o.exec.apply(this,n)}},this.getRuid=function(){return o&&o.uid},this.destroy=function(e){return function(){e&&e.apply(this,arguments),this.trigger("destroy"),this.off(),this.exec("destroy"),this.disconnectRuntime()}}(this.destroy)}var r;return r=function(){var e={};return{add:function(t){e[t.uid]=t},get:function(t,n){var i;if(t)return e[t];for(i in e)if(!n||!e[i].__standalone)return e[i];return null},remove:function(t){delete e[t.uid]}}}(),t.installTo(i.prototype),i}),t("lib/dnd",["base","mediator","runtime/client"],function(e,t,n){function i(e){e=this.options=r.extend({},i.options,e),e.container=r(e.container),e.container.length&&n.call(this,"DragAndDrop")}var r=e.$;return i.options={accept:null,disableGlobalDnd:!1},e.inherits(n,{constructor:i,init:function(){var e=this;e.connectRuntime(e.options,function(){e.exec("init"),e.trigger("ready")})}}),t.installTo(i.prototype),i}),t("widgets/widget",["base","uploader"],function(e,t){function n(e){if(!e)return!1;var t=e.length,n=r.type(e);return!(1!==e.nodeType||!t)||("array"===n||"function"!==n&&"string"!==n&&(0===t||"number"==typeof t&&t>0&&t-1 in e))}function i(e){this.owner=e,this.options=e.options}var r=e.$,o=t.prototype._init,a=t.prototype.destroy,s={},c=[];return r.extend(i.prototype,{init:e.noop,invoke:function(e,t){var n=this.responseMap;return n&&e in n&&n[e]in this&&r.isFunction(this[n[e]])?this[n[e]].apply(this,t):s},request:function(){return this.owner.request.apply(this.owner,arguments)}}),r.extend(t.prototype,{_init:function(){var e=this,t=e._widgets=[],n=e.options.disableWidgets||"";return r.each(c,function(i,r){(!n||!~n.indexOf(r._name))&&t.push(new r(e))}),o.apply(e,arguments)},request:function(t,i,r){var o,a,c,l,u=0,d=this._widgets,p=d&&d.length,h=[],f=[];for(i=n(i)?i:[i];u<p;u++)o=d[u],a=o.invoke(t,i),a!==s&&(e.isPromise(a)?f.push(a):h.push(a));return r||f.length?(c=e.when.apply(e,f),l=c.pipe?"pipe":"then",c[l](function(){var t=e.Deferred(),n=arguments;return 1===n.length&&(n=n[0]),setTimeout(function(){t.resolve(n)},1),t.promise()})[r?l:"done"](r||e.noop)):h[0]},destroy:function(){a.apply(this,arguments),this._widgets=null}}),t.register=i.register=function(t,n){var o,a={init:"init",destroy:"destroy",name:"anonymous"};return 1===arguments.length?(n=t,r.each(n,function(e){return"_"===e[0]||"name"===e?void("name"===e&&(a.name=n.name)):void(a[e.replace(/[A-Z]/g,"-$&").toLowerCase()]=e)})):a=r.extend(a,t),n.responseMap=a,o=e.inherits(i,n),o._name=a.name,c.push(o),o},t.unRegister=i.unRegister=function(e){if(e&&"anonymous"!==e)for(var t=c.length;t--;)c[t]._name===e&&c.splice(t,1)},i}),t("widgets/filednd",["base","uploader","lib/dnd","widgets/widget"],function(e,t,n){var i=e.$;return t.options.dnd="",t.register({name:"dnd",init:function(t){if(t.dnd&&"html5"===this.request("predict-runtime-type")){var r,o=this,a=e.Deferred(),s=i.extend({},{disableGlobalDnd:t.disableGlobalDnd,container:t.dnd,accept:t.accept});return this.dnd=r=new n(s),r.once("ready",a.resolve),r.on("drop",function(e){o.request("add-file",[e])}),r.on("accept",function(e){return o.owner.trigger("dndAccept",e)}),r.init(),a.promise()}},destroy:function(){this.dnd&&this.dnd.destroy()}})}),t("lib/filepaste",["base","mediator","runtime/client"],function(e,t,n){function i(e){e=this.options=r.extend({},e),e.container=r(e.container||document.body),n.call(this,"FilePaste")}var r=e.$;return e.inherits(n,{constructor:i,init:function(){var e=this;e.connectRuntime(e.options,function(){e.exec("init"),e.trigger("ready")})}}),t.installTo(i.prototype),i}),t("widgets/filepaste",["base","uploader","lib/filepaste","widgets/widget"],function(e,t,n){var i=e.$;return t.register({name:"paste",init:function(t){if(t.paste&&"html5"===this.request("predict-runtime-type")){var r,o=this,a=e.Deferred(),s=i.extend({},{container:t.paste,accept:t.accept});return this.paste=r=new n(s),r.once("ready",a.resolve),r.on("paste",function(e){o.owner.request("add-file",[e])}),r.init(),a.promise()}},destroy:function(){this.paste&&this.paste.destroy()}})}),t("lib/blob",["base","runtime/client"],function(e,t){function n(e,n){var i=this;i.source=n,i.ruid=e,this.size=n.size||0,!n.type&&this.ext&&~"jpg,jpeg,png,gif,bmp".indexOf(this.ext)?this.type="image/"+("jpg"===this.ext?"jpeg":this.ext):this.type=n.type||"application/octet-stream",t.call(i,"Blob"),this.uid=n.uid||this.uid,e&&i.connectRuntime(e)}return e.inherits(t,{constructor:n,slice:function(e,t){return this.exec("slice",e,t)},getSource:function(){return this.source}}),n}),t("lib/file",["base","lib/blob"],function(e,t){function n(e,n){var o;this.name=n.name||"untitled"+i++,o=r.exec(n.name)?RegExp.$1.toLowerCase():"",!o&&n.type&&(o=/\/(jpg|jpeg|png|gif|bmp)$/i.exec(n.type)?RegExp.$1.toLowerCase():"",this.name+="."+o),this.ext=o,this.lastModifiedDate=n.lastModifiedDate||(new Date).toLocaleString(),t.apply(this,arguments)}var i=1,r=/\.([^.]+)$/;return e.inherits(t,n)}),t("lib/filepicker",["base","runtime/client","lib/file"],function(t,n,i){function r(e){if(e=this.options=o.extend({},r.options,e),e.container=o(e.id),!e.container.length)throw new Error("æé®æå®éè¯¯");e.innerHTML=e.innerHTML||e.label||e.container.html()||"",e.button=o(e.button||document.createElement("div")),e.button.html(e.innerHTML),e.container.html(e.button),n.call(this,"FilePicker",!0)}var o=t.$;return r.options={button:null,container:null,label:null,innerHTML:null,multiple:!0,accept:null,name:"file"},t.inherits(n,{constructor:r,init:function(){var n=this,r=n.options,a=r.button;a.addClass("webuploader-pick"),n.on("all",function(e){var t;switch(e){case"mouseenter":a.addClass("webuploader-pick-hover");break;case"mouseleave":a.removeClass("webuploader-pick-hover");break;case"change":t=n.exec("getFiles"),n.trigger("select",o.map(t,function(e){return e=new i(n.getRuid(),e),e._refer=r.container,e}),r.container)}}),n.connectRuntime(r,function(){n.refresh(),n.exec("init",r),n.trigger("ready")}),this._resizeHandler=t.bindFn(this.refresh,this),o(e).on("resize",this._resizeHandler)},refresh:function(){var e=this.getRuntime().getContainer(),t=this.options.button,n=t.outerWidth?t.outerWidth():t.width(),i=t.outerHeight?t.outerHeight():t.height(),r=t.offset();n&&i&&e.css({bottom:"auto",right:"auto",width:n+"px",height:i+"px"}).offset(r)},enable:function(){var e=this.options.button;e.removeClass("webuploader-pick-disable"),this.refresh()},disable:function(){var e=this.options.button;this.getRuntime().getContainer().css({top:"-99999px"}),e.addClass("webuploader-pick-disable")},destroy:function(){var t=this.options.button;o(e).off("resize",this._resizeHandler),t.removeClass("webuploader-pick-disable webuploader-pick-hover webuploader-pick")}}),r}),t("widgets/filepicker",["base","uploader","lib/filepicker","widgets/widget"],function(e,t,n){var i=e.$;return i.extend(t.options,{pick:null,accept:null}),t.register({name:"picker",init:function(e){return this.pickers=[],e.pick&&this.addBtn(e.pick)},refresh:function(){i.each(this.pickers,function(){this.refresh()})},addBtn:function(t){var r=this,o=r.options,a=o.accept,s=[];if(t)return i.isPlainObject(t)||(t={id:t}),i(t.id).each(function(){var c,l,u;u=e.Deferred(),c=i.extend({},t,{accept:i.isPlainObject(a)?[a]:a,swf:o.swf,runtimeOrder:o.runtimeOrder,id:this}),l=new n(c),l.once("ready",u.resolve),l.on("select",function(e){r.owner.request("add-file",[e])}),l.init(),r.pickers.push(l),s.push(u.promise())}),e.when.apply(e,s)},disable:function(){i.each(this.pickers,function(){this.disable()})},enable:function(){i.each(this.pickers,function(){this.enable()})},destroy:function(){i.each(this.pickers,function(){this.destroy()}),this.pickers=null}})}),t("lib/image",["base","runtime/client","lib/blob"],function(e,t,n){function i(e){this.options=r.extend({},i.options,e),t.call(this,"Image"),this.on("load",function(){this._info=this.exec("info"),this._meta=this.exec("meta")})}var r=e.$;return i.options={quality:90,crop:!1,preserveHeaders:!1,allowMagnify:!1},e.inherits(t,{constructor:i,info:function(e){return e?(this._info=e,this):this._info},meta:function(e){return e?(this._meta=e,this):this._meta},loadFromBlob:function(e){var t=this,n=e.getRuid();this.connectRuntime(n,function(){t.exec("init",t.options),t.exec("loadFromBlob",e)})},resize:function(){var t=e.slice(arguments);return this.exec.apply(this,["resize"].concat(t))},crop:function(){var t=e.slice(arguments);return this.exec.apply(this,["crop"].concat(t))},getAsDataUrl:function(e){return this.exec("getAsDataUrl",e)},getAsBlob:function(e){var t=this.exec("getAsBlob",e);return new n(this.getRuid(),t)}}),i}),t("widgets/image",["base","uploader","lib/image","widgets/widget"],function(e,t,n){var i,r=e.$;return i=function(e){var t=0,n=[],i=function(){for(var i;n.length&&t<e;)i=n.shift(),t+=i[0],i[1]()};return function(e,r,o){n.push([r,o]),e.once("destroy",function(){t-=r,setTimeout(i,1)}),setTimeout(i,1)}}(5242880),r.extend(t.options,{thumb:{width:110,height:110,quality:70,allowMagnify:!0,crop:!0,preserveHeaders:!1,type:"image/jpeg"},compress:{width:1600,height:1600,quality:90,allowMagnify:!1,crop:!1,preserveHeaders:!0}}),t.register({name:"image",makeThumb:function(e,t,o,a){var s,c;return e=this.request("get-file",e),e.type.match(/^image/)?(s=r.extend({},this.options.thumb),r.isPlainObject(o)&&(s=r.extend(s,o),o=null),o=o||s.width,a=a||s.height,c=new n(s),c.once("load",function(){e._info=e._info||c.info(),e._meta=e._meta||c.meta(),o<=1&&o>0&&(o=e._info.width*o),a<=1&&a>0&&(a=e._info.height*a),c.resize(o,a)}),c.once("complete",function(){t(!1,c.getAsDataUrl(s.type)),c.destroy()}),c.once("error",function(e){t(e||!0),c.destroy()}),void i(c,e.source.size,function(){e._info&&c.info(e._info),e._meta&&c.meta(e._meta),c.loadFromBlob(e.source)})):void t(!0)},beforeSendFile:function(t){var i,o,a=this.options.compress||this.options.resize,s=a&&a.compressSize||0,c=a&&a.noCompressIfLarger||!1;if(t=this.request("get-file",t),a&&~"image/jpeg,image/jpg".indexOf(t.type)&&!(t.size<s)&&!t._compressed)return a=r.extend({},a),o=e.Deferred(),i=new n(a),o.always(function(){i.destroy(),i=null}),i.once("error",o.reject),i.once("load",function(){var e=a.width,n=a.height;t._info=t._info||i.info(),t._meta=t._meta||i.meta(),e<=1&&e>0&&(e=t._info.width*e),n<=1&&n>0&&(n=t._info.height*n),i.resize(e,n)}),i.once("complete",function(){var e,n;try{e=i.getAsBlob(a.type),n=t.size,(!c||e.size<n)&&(t.source=e,t.size=e.size,t.trigger("resize",e.size,n)),t._compressed=!0,o.resolve()}catch(r){o.resolve()}}),t._info&&i.info(t._info),t._meta&&i.meta(t._meta),i.loadFromBlob(t.source),o.promise()}})}),t("file",["base","mediator"],function(e,t){function n(){return o+a++}function i(e){this.name=e.name||"Untitled",this.size=e.size||0,this.type=e.type||"application/octet-stream",this.lastModifiedDate=e.lastModifiedDate||1*new Date,this.id=n(),this.ext=s.exec(this.name)?RegExp.$1:"",this.statusText="",c[this.id]=i.Status.INITED,this.source=e,this.loaded=0,this.on("error",function(e){this.setStatus(i.Status.ERROR,e)})}var r=e.$,o="WU_FILE_",a=0,s=/\.([^.]+)$/,c={};return r.extend(i.prototype,{setStatus:function(e,t){var n=c[this.id];"undefined"!=typeof t&&(this.statusText=t),e!==n&&(c[this.id]=e,this.trigger("statuschange",e,n))},getStatus:function(){return c[this.id]},getSource:function(){return this.source},destroy:function(){this.off(),delete c[this.id]}}),t.installTo(i.prototype),i.Status={INITED:"inited",QUEUED:"queued",PROGRESS:"progress",ERROR:"error",COMPLETE:"complete",CANCELLED:"cancelled",INTERRUPT:"interrupt",INVALID:"invalid"},i}),t("queue",["base","mediator","file"],function(e,t,n){function i(){this.stats={numOfQueue:0,numOfSuccess:0,numOfCancel:0,numOfProgress:0,numOfUploadFailed:0,numOfInvalid:0,numofDeleted:0,numofInterrupt:0},this._queue=[],this._map={}}var r=e.$,o=n.Status;return r.extend(i.prototype,{append:function(e){return this._queue.push(e),this._fileAdded(e),this},prepend:function(e){return this._queue.unshift(e),this._fileAdded(e),this},getFile:function(e){return"string"!=typeof e?e:this._map[e]},fetch:function(e){var t,n,i=this._queue.length;for(e=e||o.QUEUED,t=0;t<i;t++)if(n=this._queue[t],e===n.getStatus())return n;return null},sort:function(e){"function"==typeof e&&this._queue.sort(e)},getFiles:function(){for(var e,t=[].slice.call(arguments,0),n=[],i=0,o=this._queue.length;i<o;i++)e=this._queue[i],t.length&&!~r.inArray(e.getStatus(),t)||n.push(e);return n},removeFile:function(e){var t=this._map[e.id];t&&(delete this._map[e.id],e.destroy(),this.stats.numofDeleted++)},_fileAdded:function(e){var t=this,n=this._map[e.id];n||(this._map[e.id]=e,e.on("statuschange",function(e,n){t._onFileStatusChange(e,n)}))},_onFileStatusChange:function(e,t){var n=this.stats;switch(t){case o.PROGRESS:n.numOfProgress--;break;case o.QUEUED:n.numOfQueue--;break;case o.ERROR:n.numOfUploadFailed--;break;case o.INVALID:n.numOfInvalid--;break;case o.INTERRUPT:n.numofInterrupt--}switch(e){case o.QUEUED:n.numOfQueue++;break;case o.PROGRESS:n.numOfProgress++;break;case o.ERROR:n.numOfUploadFailed++;break;case o.COMPLETE:n.numOfSuccess++;break;case o.CANCELLED:n.numOfCancel++;break;case o.INVALID:n.numOfInvalid++;break;case o.INTERRUPT:n.numofInterrupt++}}}),t.installTo(i.prototype),i}),t("widgets/queue",["base","uploader","queue","file","lib/file","runtime/client","widgets/widget"],function(e,t,n,i,r,o){var a=e.$,s=/\.\w+$/,c=i.Status;return t.register({name:"queue",init:function(t){var i,r,s,c,l,u,d,p=this;if(a.isPlainObject(t.accept)&&(t.accept=[t.accept]),t.accept){for(l=[],s=0,r=t.accept.length;s<r;s++)c=t.accept[s].extensions,c&&l.push(c);l.length&&(u="\\."+l.join(",").replace(/,/g,"$|\\.").replace(/\*/g,".*")+"$"),p.accept=new RegExp(u,"i")}if(p.queue=new n,p.stats=p.queue.stats,"html5"===this.request("predict-runtime-type"))return i=e.Deferred(),this.placeholder=d=new o("Placeholder"),d.connectRuntime({runtimeOrder:"html5"},function(){p._ruid=d.getRuid(),i.resolve()}),i.promise()},_wrapFile:function(e){if(!(e instanceof i)){if(!(e instanceof r)){if(!this._ruid)throw new Error("Can't add external files.");e=new r(this._ruid,e)}e=new i(e)}return e},acceptFile:function(e){var t=!e||!e.size||this.accept&&s.exec(e.name)&&!this.accept.test(e.name);return!t},_addFile:function(e){var t=this;if(e=t._wrapFile(e),t.owner.trigger("beforeFileQueued",e))return t.acceptFile(e)?(t.queue.append(e),t.owner.trigger("fileQueued",e),e):void t.owner.trigger("error","Q_TYPE_DENIED",e)},getFile:function(e){return this.queue.getFile(e)},addFile:function(e){var t=this;e.length||(e=[e]),e=a.map(e,function(e){return t._addFile(e)}),t.owner.trigger("filesQueued",e),t.options.auto&&setTimeout(function(){t.request("start-upload")},20)},getStats:function(){return this.stats},removeFile:function(e,t){var n=this;e=e.id?e:n.queue.getFile(e),this.request("cancel-file",e),t&&this.queue.removeFile(e)},getFiles:function(){return this.queue.getFiles.apply(this.queue,arguments)},fetchFile:function(){return this.queue.fetch.apply(this.queue,arguments)},retry:function(e,t){var n,i,r,o=this;if(e)return e=e.id?e:o.queue.getFile(e),e.setStatus(c.QUEUED),void(t||o.request("start-upload"));for(n=o.queue.getFiles(c.ERROR),i=0,r=n.length;i<r;i++)e=n[i],e.setStatus(c.QUEUED);o.request("start-upload")},sortFiles:function(){return this.queue.sort.apply(this.queue,arguments)},reset:function(){this.owner.trigger("reset"),this.queue=new n,this.stats=this.queue.stats},destroy:function(){this.reset(),this.placeholder&&this.placeholder.destroy()}})}),t("widgets/runtime",["uploader","runtime/runtime","widgets/widget"],function(e,t){return e.support=function(){return t.hasRuntime.apply(t,arguments)},e.register({name:"runtime",init:function(){if(!this.predictRuntimeType())throw Error("Runtime Error")},predictRuntimeType:function(){var e,n,i=this.options.runtimeOrder||t.orders,r=this.type;if(!r)for(i=i.split(/\s*,\s*/g),e=0,n=i.length;e<n;e++)if(t.hasRuntime(i[e])){this.type=r=i[e];break}return r}})}),t("lib/transport",["base","runtime/client","mediator"],function(e,t,n){function i(e){var n=this;e=n.options=r.extend(!0,{},i.options,e||{}),t.call(this,"Transport"),this._blob=null,this._formData=e.formData||{},this._headers=e.headers||{},this.on("progress",this._timeout),this.on("load error",function(){n.trigger("progress",1),clearTimeout(n._timer)})}var r=e.$;return i.options={server:"",method:"POST",withCredentials:!1,fileVal:"file",timeout:12e4,formData:{},headers:{},sendAsBinary:!1},r.extend(i.prototype,{appendBlob:function(e,t,n){var i=this,r=i.options;i.getRuid()&&i.disconnectRuntime(),i.connectRuntime(t.ruid,function(){i.exec("init")}),i._blob=t,r.fileVal=e||r.fileVal,r.filename=n||r.filename},append:function(e,t){"object"==typeof e?r.extend(this._formData,e):this._formData[e]=t},setRequestHeader:function(e,t){"object"==typeof e?r.extend(this._headers,e):this._headers[e]=t},send:function(e){this.exec("send",e),this._timeout()},abort:function(){return clearTimeout(this._timer),this.exec("abort")},destroy:function(){this.trigger("destroy"),this.off(),this.exec("destroy"),this.disconnectRuntime()},getResponse:function(){return this.exec("getResponse")},getResponseAsJson:function(){return this.exec("getResponseAsJson")},getStatus:function(){return this.exec("getStatus")},_timeout:function(){var e=this,t=e.options.timeout;t&&(clearTimeout(e._timer),e._timer=setTimeout(function(){e.abort(),e.trigger("error","timeout")},t))}}),n.installTo(i.prototype),i}),t("widgets/upload",["base","uploader","file","lib/transport","widgets/widget"],function(e,t,n,i){function r(e,t){var n,i,r=[],o=e.source,a=o.size,s=t?Math.ceil(a/t):1,c=0,l=0;for(i={file:e,has:function(){return!!r.length},shift:function(){return r.shift()},unshift:function(e){r.unshift(e)}};l<s;)n=Math.min(t,a-c),r.push({file:e,start:c,end:t?c+n:a,total:a,chunks:s,chunk:l++,cuted:i}),c+=n;return e.blocks=r.concat(),e.remaning=r.length,i}var o=e.$,a=e.isPromise,s=n.Status;o.extend(t.options,{prepareNextFile:!1,chunked:!1,chunkSize:5242880,chunkRetry:2,threads:3,formData:{}}),t.register({name:"upload",init:function(){var t=this.owner,n=this;this.runing=!1,this.progress=!1,t.on("startUpload",function(){n.progress=!0}).on("uploadFinished",function(){n.progress=!1}),this.pool=[],this.stack=[],this.pending=[],this.remaning=0,this.__tick=e.bindFn(this._tick,this),t.on("uploadComplete",function(e){e.blocks&&o.each(e.blocks,function(e,t){t.transport&&(t.transport.abort(),t.transport.destroy()),delete t.transport}),delete e.blocks,delete e.remaning})},reset:function(){this.request("stop-upload",!0),this.runing=!1,this.pool=[],this.stack=[],this.pending=[],this.remaning=0,this._trigged=!1,this._promise=null},startUpload:function(t){var n=this;if(o.each(n.request("get-files",s.INVALID),function(){n.request("remove-file",this)}),t)if(t=t.id?t:n.request("get-file",t),t.getStatus()===s.INTERRUPT)o.each(n.pool,function(e,n){n.file===t&&n.transport&&n.transport.send()}),t.setStatus(s.QUEUED);else{if(t.getStatus()===s.PROGRESS)return;t.setStatus(s.QUEUED)}else o.each(n.request("get-files",[s.INITED]),function(){this.setStatus(s.QUEUED)});if(!n.runing){n.runing=!0;var i=[];o.each(n.pool,function(e,t){var r=t.file;r.getStatus()===s.INTERRUPT&&(i.push(r),n._trigged=!1,t.transport&&t.transport.send())});for(var t;t=i.shift();)t.setStatus(s.PROGRESS);t||o.each(n.request("get-files",s.INTERRUPT),function(){this.setStatus(s.PROGRESS)}),n._trigged=!1,e.nextTick(n.__tick),n.owner.trigger("startUpload")}},stopUpload:function(t,n){var i=this;if(t===!0&&(n=t,t=null),i.runing!==!1){if(t){if(t=t.id?t:i.request("get-file",t),t.getStatus()!==s.PROGRESS&&t.getStatus()!==s.QUEUED)return;return t.setStatus(s.INTERRUPT),o.each(i.pool,function(e,n){n.file===t&&(n.transport&&n.transport.abort(),i._putback(n),i._popBlock(n))}),e.nextTick(i.__tick)}i.runing=!1,this._promise&&this._promise.file&&this._promise.file.setStatus(s.INTERRUPT),n&&o.each(i.pool,function(e,t){t.transport&&t.transport.abort(),t.file.setStatus(s.INTERRUPT)}),i.owner.trigger("stopUpload")}},cancelFile:function(e){e=e.id?e:this.request("get-file",e),e.blocks&&o.each(e.blocks,function(e,t){var n=t.transport;n&&(n.abort(),n.destroy(),delete t.transport)}),e.setStatus(s.CANCELLED),this.owner.trigger("fileDequeued",e)},isInProgress:function(){return!!this.progress},_getStats:function(){return this.request("get-stats")},skipFile:function(e,t){e=e.id?e:this.request("get-file",e),e.setStatus(t||s.COMPLETE),e.skipped=!0,e.blocks&&o.each(e.blocks,function(e,t){var n=t.transport;n&&(n.abort(),n.destroy(),delete t.transport)}),this.owner.trigger("uploadSkip",e)},_tick:function(){var t,n,i=this,r=i.options;return i._promise?i._promise.always(i.__tick):void(i.pool.length<r.threads&&(n=i._nextBlock())?(i._trigged=!1,t=function(t){i._promise=null,t&&t.file&&i._startSend(t),e.nextTick(i.__tick)},i._promise=a(n)?n.always(t):t(n)):i.remaning||i._getStats().numOfQueue||i._getStats().numofInterrupt||(i.runing=!1,i._trigged||e.nextTick(function(){i.owner.trigger("uploadFinished")}),i._trigged=!0))},_putback:function(e){var t;e.cuted.unshift(e),t=this.stack.indexOf(e.cuted),~t||this.stack.unshift(e.cuted)},_getStack:function(){for(var e,t=0;e=this.stack[t++];){if(e.has()&&e.file.getStatus()===s.PROGRESS)return e;(!e.has()||e.file.getStatus()!==s.PROGRESS&&e.file.getStatus()!==s.INTERRUPT)&&this.stack.splice(--t,1)}return null},_nextBlock:function(){var e,t,n,i,o=this,s=o.options;return(e=this._getStack())?(s.prepareNextFile&&!o.pending.length&&o._prepareNextFile(),e.shift()):o.runing?(!o.pending.length&&o._getStats().numOfQueue&&o._prepareNextFile(),t=o.pending.shift(),n=function(t){return t?(e=r(t,s.chunked?s.chunkSize:0),o.stack.push(e),e.shift()):null},a(t)?(i=t.file,t=t[t.pipe?"pipe":"then"](n),t.file=i,t):n(t)):void 0},_prepareNextFile:function(){var e,t=this,n=t.request("fetch-file"),i=t.pending;n&&(e=t.request("before-send-file",n,function(){return n.getStatus()===s.PROGRESS||n.getStatus()===s.INTERRUPT?n:t._finishFile(n)}),t.owner.trigger("uploadStart",n),n.setStatus(s.PROGRESS),e.file=n,e.done(function(){var t=o.inArray(e,i);~t&&i.splice(t,1,n)}),e.fail(function(e){n.setStatus(s.ERROR,e),t.owner.trigger("uploadError",n,e),t.owner.trigger("uploadComplete",n)}),i.push(e))},_popBlock:function(e){var t=o.inArray(e,this.pool);this.pool.splice(t,1),e.file.remaning--,this.remaning--},_startSend:function(t){
var n,i=this,r=t.file;return r.getStatus()!==s.PROGRESS?void(r.getStatus()===s.INTERRUPT&&i._putback(t)):(i.pool.push(t),i.remaning++,t.blob=1===t.chunks?r.source:r.source.slice(t.start,t.end),n=i.request("before-send",t,function(){r.getStatus()===s.PROGRESS?i._doSend(t):(i._popBlock(t),e.nextTick(i.__tick))}),void n.fail(function(){1===r.remaning?i._finishFile(r).always(function(){t.percentage=1,i._popBlock(t),i.owner.trigger("uploadComplete",r),e.nextTick(i.__tick)}):(t.percentage=1,i.updateFileProgress(r),i._popBlock(t),e.nextTick(i.__tick))}))},_doSend:function(t){var n,r,a=this,c=a.owner,l=a.options,u=t.file,d=new i(l),p=o.extend({},l.formData),h=o.extend({},l.headers);t.transport=d,d.on("destroy",function(){delete t.transport,a._popBlock(t),e.nextTick(a.__tick)}),d.on("progress",function(e){t.percentage=e,a.updateFileProgress(u)}),n=function(e){var n;return r=d.getResponseAsJson()||{},r._raw=d.getResponse(),n=function(t){e=t},c.trigger("uploadAccept",t,r,n)||(e=e||"server"),e},d.on("error",function(e,i){t.retried=t.retried||0,t.chunks>1&&~"http,abort".indexOf(e)&&t.retried<l.chunkRetry?(t.retried++,d.send()):(i||"server"!==e||(e=n(e)),u.setStatus(s.ERROR,e),c.trigger("uploadError",u,e),c.trigger("uploadComplete",u))}),d.on("load",function(){var e;return(e=n())?void d.trigger("error",e,!0):void(1===u.remaning?a._finishFile(u,r):d.destroy())}),p=o.extend(p,{id:u.id,name:u.name,type:u.type,lastModifiedDate:u.lastModifiedDate,size:u.size}),t.chunks>1&&o.extend(p,{chunks:t.chunks,chunk:t.chunk}),c.trigger("uploadBeforeSend",t,p,h),d.appendBlob(l.fileVal,t.blob,u.name),d.append(p),d.setRequestHeader(h),d.send()},_finishFile:function(e,t,n){var i=this.owner;return i.request("after-send-file",arguments,function(){e.setStatus(s.COMPLETE),i.trigger("uploadSuccess",e,t,n)}).fail(function(t){e.getStatus()===s.PROGRESS&&e.setStatus(s.ERROR,t),i.trigger("uploadError",e,t)}).always(function(){i.trigger("uploadComplete",e)})},updateFileProgress:function(e){var t=0,n=0;e.blocks&&(o.each(e.blocks,function(e,t){n+=(t.percentage||0)*(t.end-t.start)}),t=n/e.size,this.owner.trigger("uploadProgress",e,t||0))}})}),t("widgets/validator",["base","uploader","file","widgets/widget"],function(e,t,n){var i,r=e.$,o={};return i={addValidator:function(e,t){o[e]=t},removeValidator:function(e){delete o[e]}},t.register({name:"validator",init:function(){var t=this;e.nextTick(function(){r.each(o,function(){this.call(t.owner)})})}}),i.addValidator("fileNumLimit",function(){var e=this,t=e.options,n=0,i=parseInt(t.fileNumLimit,10),r=!0;i&&(e.on("beforeFileQueued",function(e){return n>=i&&r&&(r=!1,this.trigger("error","Q_EXCEED_NUM_LIMIT",i,e),setTimeout(function(){r=!0},1)),!(n>=i)}),e.on("fileQueued",function(){n++}),e.on("fileDequeued",function(){n--}),e.on("reset",function(){n=0}))}),i.addValidator("fileSizeLimit",function(){var e=this,t=e.options,n=0,i=parseInt(t.fileSizeLimit,10),r=!0;i&&(e.on("beforeFileQueued",function(e){var t=n+e.size>i;return t&&r&&(r=!1,this.trigger("error","Q_EXCEED_SIZE_LIMIT",i,e),setTimeout(function(){r=!0},1)),!t}),e.on("fileQueued",function(e){n+=e.size}),e.on("fileDequeued",function(e){n-=e.size}),e.on("reset",function(){n=0}))}),i.addValidator("fileSingleSizeLimit",function(){var e=this,t=e.options,i=t.fileSingleSizeLimit;i&&e.on("beforeFileQueued",function(e){if(e.size>i)return e.setStatus(n.Status.INVALID,"exceed_size"),this.trigger("error","F_EXCEED_SIZE",i,e),!1})}),i.addValidator("duplicate",function(){function e(e){for(var t,n=0,i=0,r=e.length;i<r;i++)t=e.charCodeAt(i),n=t+(n<<6)+(n<<16)-n;return n}var t=this,n=t.options,i={};n.duplicate||(t.on("beforeFileQueued",function(t){var n=t.__hash||(t.__hash=e(t.name+t.size+t.lastModifiedDate));if(i[n])return this.trigger("error","F_DUPLICATE",t),!1}),t.on("fileQueued",function(e){var t=e.__hash;t&&(i[t]=!0)}),t.on("fileDequeued",function(e){var t=e.__hash;t&&delete i[t]}),t.on("reset",function(){i={}}))}),i}),t("lib/md5",["runtime/client","mediator"],function(e,t){function n(){e.call(this,"Md5")}return t.installTo(n.prototype),n.prototype.loadFromBlob=function(e){var t=this;t.getRuid()&&t.disconnectRuntime(),t.connectRuntime(e.ruid,function(){t.exec("init"),t.exec("loadFromBlob",e)})},n.prototype.getResult=function(){return this.exec("getResult")},n}),t("widgets/md5",["base","uploader","lib/md5","lib/blob","widgets/widget"],function(e,t,n,i){return t.register({name:"md5",md5File:function(t,r,o){var a=new n,s=e.Deferred(),c=t instanceof i?t:this.request("get-file",t).source;return a.on("progress load",function(e){e=e||{},s.notify(e.total?e.loaded/e.total:1)}),a.on("complete",function(){s.resolve(a.getResult())}),a.on("error",function(e){s.reject(e)}),arguments.length>1&&(r=r||0,o=o||0,r<0&&(r=c.size+r),o<0&&(o=c.size+o),o=Math.min(o,c.size),c=c.slice(r,o)),a.loadFromBlob(c),s.promise()}})}),t("runtime/compbase",[],function(){function e(e,t){this.owner=e,this.options=e.options,this.getRuntime=function(){return t},this.getRuid=function(){return t.uid},this.trigger=function(){return e.trigger.apply(e,arguments)}}return e}),t("runtime/html5/runtime",["base","runtime/runtime","runtime/compbase"],function(t,n,i){function r(){var e={},i=this,r=this.destroy;n.apply(i,arguments),i.type=o,i.exec=function(n,r){var o,s=this,c=s.uid,l=t.slice(arguments,2);if(a[n]&&(o=e[c]=e[c]||new a[n](s,i),o[r]))return o[r].apply(o,l)},i.destroy=function(){return r&&r.apply(this,arguments)}}var o="html5",a={};return t.inherits(n,{constructor:r,init:function(){var e=this;setTimeout(function(){e.trigger("ready")},1)}}),r.register=function(e,n){var r=a[e]=t.inherits(i,n);return r},e.Blob&&e.FileReader&&e.DataView&&n.addRuntime(o,r),r}),t("runtime/html5/blob",["runtime/html5/runtime","lib/blob"],function(e,t){return e.register("Blob",{slice:function n(e,i){var r=this.owner.source,n=r.slice||r.webkitSlice||r.mozSlice;return r=n.call(r,e,i),new t(this.getRuid(),r)}})}),t("runtime/html5/dnd",["base","runtime/html5/runtime","lib/file"],function(e,t,n){var i=e.$,r="webuploader-dnd-";return t.register("DragAndDrop",{init:function(){var t=this.elem=this.options.container;this.dragEnterHandler=e.bindFn(this._dragEnterHandler,this),this.dragOverHandler=e.bindFn(this._dragOverHandler,this),this.dragLeaveHandler=e.bindFn(this._dragLeaveHandler,this),this.dropHandler=e.bindFn(this._dropHandler,this),this.dndOver=!1,t.on("dragenter",this.dragEnterHandler),t.on("dragover",this.dragOverHandler),t.on("dragleave",this.dragLeaveHandler),t.on("drop",this.dropHandler),this.options.disableGlobalDnd&&(i(document).on("dragover",this.dragOverHandler),i(document).on("drop",this.dropHandler))},_dragEnterHandler:function(e){var t,n=this,i=n._denied||!1;return e=e.originalEvent||e,n.dndOver||(n.dndOver=!0,t=e.dataTransfer.items,t&&t.length&&(n._denied=i=!n.trigger("accept",t)),n.elem.addClass(r+"over"),n.elem[i?"addClass":"removeClass"](r+"denied")),e.dataTransfer.dropEffect=i?"none":"copy",!1},_dragOverHandler:function(e){var t=this.elem.parent().get(0);return!(t&&!i.contains(t,e.currentTarget))&&(clearTimeout(this._leaveTimer),this._dragEnterHandler.call(this,e),!1)},_dragLeaveHandler:function(){var e,t=this;return e=function(){t.dndOver=!1,t.elem.removeClass(r+"over "+r+"denied")},clearTimeout(t._leaveTimer),t._leaveTimer=setTimeout(e,100),!1},_dropHandler:function(e){var t,o,a=this,s=a.getRuid(),c=a.elem.parent().get(0);if(c&&!i.contains(c,e.currentTarget))return!1;e=e.originalEvent||e,t=e.dataTransfer;try{o=t.getData("text/html")}catch(l){}return o?void 0:(a._getTansferFiles(t,function(e){a.trigger("drop",i.map(e,function(e){return new n(s,e)}))}),a.dndOver=!1,a.elem.removeClass(r+"over"),!1)},_getTansferFiles:function(t,n){var i,r,o,a,s,c,l,u=[],d=[];for(i=t.items,r=t.files,l=!(!i||!i[0].webkitGetAsEntry),s=0,c=r.length;s<c;s++)o=r[s],a=i&&i[s],l&&a.webkitGetAsEntry().isDirectory?d.push(this._traverseDirectoryTree(a.webkitGetAsEntry(),u)):u.push(o);e.when.apply(e,d).done(function(){u.length&&n(u)})},_traverseDirectoryTree:function(t,n){var i=e.Deferred(),r=this;return t.isFile?t.file(function(e){n.push(e),i.resolve()}):t.isDirectory&&t.createReader().readEntries(function(t){var o,a=t.length,s=[],c=[];for(o=0;o<a;o++)s.push(r._traverseDirectoryTree(t[o],c));e.when.apply(e,s).then(function(){n.push.apply(n,c),i.resolve()},i.reject)}),i.promise()},destroy:function(){var e=this.elem;e&&(e.off("dragenter",this.dragEnterHandler),e.off("dragover",this.dragOverHandler),e.off("dragleave",this.dragLeaveHandler),e.off("drop",this.dropHandler),this.options.disableGlobalDnd&&(i(document).off("dragover",this.dragOverHandler),i(document).off("drop",this.dropHandler)))}})}),t("runtime/html5/filepaste",["base","runtime/html5/runtime","lib/file"],function(e,t,n){return t.register("FilePaste",{init:function(){var t,n,i,r,o=this.options,a=this.elem=o.container,s=".*";if(o.accept){for(t=[],n=0,i=o.accept.length;n<i;n++)r=o.accept[n].mimeTypes,r&&t.push(r);t.length&&(s=t.join(","),s=s.replace(/,/g,"|").replace(/\*/g,".*"))}this.accept=s=new RegExp(s,"i"),this.hander=e.bindFn(this._pasteHander,this),a.on("paste",this.hander)},_pasteHander:function(e){var t,i,r,o,a,s=[],c=this.getRuid();for(e=e.originalEvent||e,t=e.clipboardData.items,o=0,a=t.length;o<a;o++)i=t[o],"file"===i.kind&&(r=i.getAsFile())&&s.push(new n(c,r));s.length&&(e.preventDefault(),e.stopPropagation(),this.trigger("paste",s))},destroy:function(){this.elem.off("paste",this.hander)}})}),t("runtime/html5/filepicker",["base","runtime/html5/runtime"],function(e,t){var n=e.$;return t.register("FilePicker",{init:function(){var e,t,i,r,o=this.getRuntime().getContainer(),a=this,s=a.owner,c=a.options,l=this.label=n(document.createElement("label")),u=this.input=n(document.createElement("input"));if(c.capture&&u.attr("capture",c.capture),c._accept&&u.attr("accept",c._accept),u.attr("type","file"),u.attr("name",c.name),u.addClass("webuploader-element-invisible"),l.on("click",function(){u.trigger("click")}),l.css({opacity:0,width:"100%",height:"100%",display:"block",cursor:"pointer",background:"#ffffff"}),c.multiple&&u.attr("multiple","multiple"),c.accept&&c.accept.length>0){for(e=[],t=0,i=c.accept.length;t<i;t++)e.push(c.accept[t].mimeTypes);u.attr("accept",e.join(","))}o.append(u),o.append(l),r=function(e){s.trigger(e.type)},u.on("change",function(e){var t,i=arguments.callee;a.files=e.target.files,t=this.cloneNode(!0),t.value=null,this.parentNode.replaceChild(t,this),u.off(),u=n(t).on("change",i).on("mouseenter mouseleave",r),s.trigger("change")}),l.on("mouseenter mouseleave",r)},getFiles:function(){return this.files},destroy:function(){this.input.off(),this.label.off()}})}),t("runtime/html5/util",["base"],function(t){var n=e.createObjectURL&&e||e.URL&&URL.revokeObjectURL&&URL||e.webkitURL,i=t.noop,r=i;return n&&(i=function(){return n.createObjectURL.apply(n,arguments)},r=function(){return n.revokeObjectURL.apply(n,arguments)}),{createObjectURL:i,revokeObjectURL:r,dataURL2Blob:function(e){var t,n,i,r,o,a;for(a=e.split(","),t=~a[0].indexOf("base64")?atob(a[1]):decodeURIComponent(a[1]),i=new ArrayBuffer(t.length),n=new Uint8Array(i),r=0;r<t.length;r++)n[r]=t.charCodeAt(r);return o=a[0].split(":")[1].split(";")[0],this.arrayBufferToBlob(i,o)},dataURL2ArrayBuffer:function(e){var t,n,i,r;for(r=e.split(","),t=~r[0].indexOf("base64")?atob(r[1]):decodeURIComponent(r[1]),n=new Uint8Array(t.length),i=0;i<t.length;i++)n[i]=t.charCodeAt(i);return n.buffer},arrayBufferToBlob:function(t,n){var i,r=e.BlobBuilder||e.WebKitBlobBuilder;return r?(i=new r,i.append(t),i.getBlob(n)):new Blob([t],n?{type:n}:{})},canvasToDataUrl:function(e,t,n){return e.toDataURL(t,n/100)},parseMeta:function(e,t){t(!1,{})},updateImageHead:function(e){return e}}}),t("runtime/html5/imagemeta",["runtime/html5/util"],function(e){var t;return t={parsers:{65505:[]},maxMetaDataSize:262144,parse:function(e,t){var n=this,i=new FileReader;i.onload=function(){t(!1,n._parse(this.result)),i=i.onload=i.onerror=null},i.onerror=function(e){t(e.message),i=i.onload=i.onerror=null},e=e.slice(0,n.maxMetaDataSize),i.readAsArrayBuffer(e.getSource())},_parse:function(e,n){if(!(e.byteLength<6)){var i,r,o,a,s=new DataView(e),c=2,l=s.byteLength-4,u=c,d={};if(65496===s.getUint16(0)){for(;c<l&&(i=s.getUint16(c),i>=65504&&i<=65519||65534===i)&&(r=s.getUint16(c+2)+2,!(c+r>s.byteLength));){if(o=t.parsers[i],!n&&o)for(a=0;a<o.length;a+=1)o[a].call(t,s,c,r,d);c+=r,u=c}u>6&&(e.slice?d.imageHead=e.slice(2,u):d.imageHead=new Uint8Array(e).subarray(2,u))}return d}},updateImageHead:function(e,t){var n,i,r,o=this._parse(e,!0);return r=2,o.imageHead&&(r=2+o.imageHead.byteLength),i=e.slice?e.slice(r):new Uint8Array(e).subarray(r),n=new Uint8Array(t.byteLength+2+i.byteLength),n[0]=255,n[1]=216,n.set(new Uint8Array(t),2),n.set(new Uint8Array(i),t.byteLength+2),n.buffer}},e.parseMeta=function(){return t.parse.apply(t,arguments)},e.updateImageHead=function(){return t.updateImageHead.apply(t,arguments)},t}),t("runtime/html5/imagemeta/exif",["base","runtime/html5/imagemeta"],function(e,t){var n={};return n.ExifMap=function(){return this},n.ExifMap.prototype.map={Orientation:274},n.ExifMap.prototype.get=function(e){return this[e]||this[this.map[e]]},n.exifTagTypes={1:{getValue:function(e,t){return e.getUint8(t)},size:1},2:{getValue:function(e,t){return String.fromCharCode(e.getUint8(t))},size:1,ascii:!0},3:{getValue:function(e,t,n){return e.getUint16(t,n)},size:2},4:{getValue:function(e,t,n){return e.getUint32(t,n)},size:4},5:{getValue:function(e,t,n){return e.getUint32(t,n)/e.getUint32(t+4,n)},size:8},9:{getValue:function(e,t,n){return e.getInt32(t,n)},size:4},10:{getValue:function(e,t,n){return e.getInt32(t,n)/e.getInt32(t+4,n)},size:8}},n.exifTagTypes[7]=n.exifTagTypes[1],n.getExifValue=function(t,i,r,o,a,s){var c,l,u,d,p,h,f=n.exifTagTypes[o];if(!f)return void e.log("Invalid Exif data: Invalid tag type.");if(c=f.size*a,l=c>4?i+t.getUint32(r+8,s):r+8,l+c>t.byteLength)return void e.log("Invalid Exif data: Invalid data offset.");if(1===a)return f.getValue(t,l,s);for(u=[],d=0;d<a;d+=1)u[d]=f.getValue(t,l+d*f.size,s);if(f.ascii){for(p="",d=0;d<u.length&&(h=u[d],"\0"!==h);d+=1)p+=h;return p}return u},n.parseExifTag=function(e,t,i,r,o){var a=e.getUint16(i,r);o.exif[a]=n.getExifValue(e,t,i,e.getUint16(i+2,r),e.getUint32(i+4,r),r)},n.parseExifTags=function(t,n,i,r,o){var a,s,c;if(i+6>t.byteLength)return void e.log("Invalid Exif data: Invalid directory offset.");if(a=t.getUint16(i,r),s=i+2+12*a,s+4>t.byteLength)return void e.log("Invalid Exif data: Invalid directory size.");for(c=0;c<a;c+=1)this.parseExifTag(t,n,i+2+12*c,r,o);return t.getUint32(s,r)},n.parseExifData=function(t,i,r,o){var a,s,c=i+10;if(1165519206===t.getUint32(i+4)){if(c+8>t.byteLength)return void e.log("Invalid Exif data: Invalid segment size.");if(0!==t.getUint16(i+8))return void e.log("Invalid Exif data: Missing byte alignment offset.");switch(t.getUint16(c)){case 18761:a=!0;break;case 19789:a=!1;break;default:return void e.log("Invalid Exif data: Invalid byte alignment marker.")}if(42!==t.getUint16(c+2,a))return void e.log("Invalid Exif data: Missing TIFF marker.");s=t.getUint32(c+4,a),o.exif=new n.ExifMap,s=n.parseExifTags(t,c,c+s,a,o)}},t.parsers[65505].push(n.parseExifData),n}),t("runtime/html5/jpegencoder",[],function(e,t,n){function i(e){function t(e){for(var t=[16,11,10,16,24,40,51,61,12,12,14,19,26,58,60,55,14,13,16,24,40,57,69,56,14,17,22,29,51,87,80,62,18,22,37,56,68,109,103,77,24,35,55,64,81,104,113,92,49,64,78,87,103,121,120,101,72,92,95,98,112,100,103,99],n=0;n<64;n++){var i=T((t[n]*e+50)/100);i<1?i=1:i>255&&(i=255),S[U[n]]=i}for(var r=[17,18,24,47,99,99,99,99,18,21,26,66,99,99,99,99,24,26,56,99,99,99,99,99,47,66,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99],o=0;o<64;o++){var a=T((r[o]*e+50)/100);a<1?a=1:a>255&&(a=255),C[U[o]]=a}for(var s=[1,1.387039845,1.306562965,1.175875602,1,.785694958,.5411961,.275899379],c=0,l=0;l<8;l++)for(var u=0;u<8;u++)E[c]=1/(S[U[c]]*s[l]*s[u]*8),A[c]=1/(C[U[c]]*s[l]*s[u]*8),c++}function n(e,t){for(var n=0,i=0,r=new Array,o=1;o<=16;o++){for(var a=1;a<=e[o];a++)r[t[i]]=[],r[t[i]][0]=n,r[t[i]][1]=o,i++,n++;n*=2}return r}function i(){b=n(P,H),_=n(V,Q),x=n($,W),w=n(X,J)}function r(){for(var e=1,t=2,n=1;n<=15;n++){for(var i=e;i<t;i++)L[32767+i]=n,I[32767+i]=[],I[32767+i][1]=n,I[32767+i][0]=i;for(var r=-(t-1);r<=-e;r++)L[32767+r]=n,I[32767+r]=[],I[32767+r][1]=n,I[32767+r][0]=t-1+r;e<<=1,t<<=1}}function o(){for(var e=0;e<256;e++)z[e]=19595*e,z[e+256>>0]=38470*e,z[e+512>>0]=7471*e+32768,z[e+768>>0]=-11059*e,z[e+1024>>0]=-21709*e,z[e+1280>>0]=32768*e+8421375,z[e+1536>>0]=-27439*e,z[e+1792>>0]=-5329*e}function a(e){for(var t=e[0],n=e[1]-1;n>=0;)t&1<<n&&(N|=1<<j),n--,j--,j<0&&(255==N?(s(255),s(0)):s(N),j=7,N=0)}function s(e){M.push(F[e])}function c(e){s(e>>8&255),s(255&e)}function l(e,t){var n,i,r,o,a,s,c,l,u,d=0,p=8,h=64;for(u=0;u<p;++u){n=e[d],i=e[d+1],r=e[d+2],o=e[d+3],a=e[d+4],s=e[d+5],c=e[d+6],l=e[d+7];var f=n+l,g=n-l,m=i+c,v=i-c,y=r+s,b=r-s,_=o+a,x=o-a,w=f+_,k=f-_,T=m+y,S=m-y;e[d]=w+T,e[d+4]=w-T;var C=.707106781*(S+k);e[d+2]=k+C,e[d+6]=k-C,w=x+b,T=b+v,S=v+g;var E=.382683433*(w-S),A=.5411961*w+E,I=1.306562965*S+E,L=.707106781*T,D=g+L,M=g-L;e[d+5]=M+A,e[d+3]=M-A,e[d+1]=D+I,e[d+7]=D-I,d+=8}for(d=0,u=0;u<p;++u){n=e[d],i=e[d+8],r=e[d+16],o=e[d+24],a=e[d+32],s=e[d+40],c=e[d+48],l=e[d+56];var N=n+l,j=n-l,R=i+c,O=i-c,q=r+s,F=r-s,z=o+a,U=o-a,P=N+z,H=N-z,$=R+q,W=R-q;e[d]=P+$,e[d+32]=P-$;var V=.707106781*(W+H);e[d+16]=H+V,e[d+48]=H-V,P=U+F,$=F+O,W=O+j;var Q=.382683433*(P-W),X=.5411961*P+Q,J=1.306562965*W+Q,G=.707106781*$,K=j+G,Y=j-G;e[d+40]=Y+X,e[d+24]=Y-X,e[d+8]=K+J,e[d+56]=K-J,d++}var Z;for(u=0;u<h;++u)Z=e[u]*t[u],B[u]=Z>0?Z+.5|0:Z-.5|0;return B}function u(){c(65504),c(16),s(74),s(70),s(73),s(70),s(0),s(1),s(1),s(0),c(1),c(1),s(0),s(0)}function d(e,t){c(65472),c(17),s(8),c(t),c(e),s(3),s(1),s(17),s(0),s(2),s(17),s(1),s(3),s(17),s(1)}function p(){c(65499),c(132),s(0);for(var e=0;e<64;e++)s(S[e]);s(1);for(var t=0;t<64;t++)s(C[t])}function h(){c(65476),c(418),s(0);for(var e=0;e<16;e++)s(P[e+1]);for(var t=0;t<=11;t++)s(H[t]);s(16);for(var n=0;n<16;n++)s($[n+1]);for(var i=0;i<=161;i++)s(W[i]);s(1);for(var r=0;r<16;r++)s(V[r+1]);for(var o=0;o<=11;o++)s(Q[o]);s(17);for(var a=0;a<16;a++)s(X[a+1]);for(var l=0;l<=161;l++)s(J[l])}function f(){c(65498),c(12),s(3),s(1),s(0),s(2),s(17),s(3),s(17),s(0),s(63),s(0)}function g(e,t,n,i,r){for(var o,s=r[0],c=r[240],u=16,d=63,p=64,h=l(e,t),f=0;f<p;++f)D[U[f]]=h[f];var g=D[0]-n;n=D[0],0==g?a(i[0]):(o=32767+g,a(i[L[o]]),a(I[o]));for(var m=63;m>0&&0==D[m];m--);if(0==m)return a(s),n;for(var v,y=1;y<=m;){for(var b=y;0==D[y]&&y<=m;++y);var _=y-b;if(_>=u){v=_>>4;for(var x=1;x<=v;++x)a(c);_=15&_}o=32767+D[y],a(r[(_<<4)+L[o]]),a(I[o]),y++}return m!=d&&a(s),n}function m(){for(var e=String.fromCharCode,t=0;t<256;t++)F[t]=e(t)}function v(e){if(e<=0&&(e=1),e>100&&(e=100),k!=e){var n=0;n=e<50?Math.floor(5e3/e):Math.floor(200-2*e),t(n),k=e}}function y(){e||(e=50),m(),i(),r(),o(),v(e)}var b,_,x,w,k,T=(Math.round,Math.floor),S=new Array(64),C=new Array(64),E=new Array(64),A=new Array(64),I=new Array(65535),L=new Array(65535),B=new Array(64),D=new Array(64),M=[],N=0,j=7,R=new Array(64),O=new Array(64),q=new Array(64),F=new Array(256),z=new Array(2048),U=[0,1,5,6,14,15,27,28,2,4,7,13,16,26,29,42,3,8,12,17,25,30,41,43,9,11,18,24,31,40,44,53,10,19,23,32,39,45,52,54,20,22,33,38,46,51,55,60,21,34,37,47,50,56,59,61,35,36,48,49,57,58,62,63],P=[0,0,1,5,1,1,1,1,1,1,0,0,0,0,0,0,0],H=[0,1,2,3,4,5,6,7,8,9,10,11],$=[0,0,2,1,3,3,2,4,3,5,5,4,4,0,0,1,125],W=[1,2,3,0,4,17,5,18,33,49,65,6,19,81,97,7,34,113,20,50,129,145,161,8,35,66,177,193,21,82,209,240,36,51,98,114,130,9,10,22,23,24,25,26,37,38,39,40,41,42,52,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,225,226,227,228,229,230,231,232,233,234,241,242,243,244,245,246,247,248,249,250],V=[0,0,3,1,1,1,1,1,1,1,1,1,0,0,0,0,0],Q=[0,1,2,3,4,5,6,7,8,9,10,11],X=[0,0,2,1,2,4,4,3,4,7,5,4,4,0,1,2,119],J=[0,1,2,3,17,4,5,33,49,6,18,65,81,7,97,113,19,34,50,129,8,20,66,145,161,177,193,9,35,51,82,240,21,98,114,209,10,22,36,52,225,37,241,23,24,25,26,38,39,40,41,42,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,130,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,226,227,228,229,230,231,232,233,234,242,243,244,245,246,247,248,249,250];this.encode=function(e,t){t&&v(t),M=new Array,N=0,j=7,c(65496),u(),p(),d(e.width,e.height),h(),f();var n=0,i=0,r=0;N=0,j=7,this.encode.displayName="_encode_";for(var o,s,l,m,y,k,T,S,C,I=e.data,L=e.width,B=e.height,D=4*L,F=0;F<B;){for(o=0;o<D;){for(y=D*F+o,k=y,T=-1,S=0,C=0;C<64;C++)S=C>>3,T=4*(7&C),k=y+S*D+T,F+S>=B&&(k-=D*(F+1+S-B)),o+T>=D&&(k-=o+T-D+4),s=I[k++],l=I[k++],m=I[k++],R[C]=(z[s]+z[l+256>>0]+z[m+512>>0]>>16)-128,O[C]=(z[s+768>>0]+z[l+1024>>0]+z[m+1280>>0]>>16)-128,q[C]=(z[s+1280>>0]+z[l+1536>>0]+z[m+1792>>0]>>16)-128;n=g(R,E,n,b,x),i=g(O,A,i,_,w),r=g(q,A,r,_,w),o+=32}F+=8}if(j>=0){var U=[];U[1]=j+1,U[0]=(1<<j+1)-1,a(U)}c(65497);var P="data:image/jpeg;base64,"+btoa(M.join(""));return M=[],P},y()}return i.encode=function(e,t){var n=new i(t);return n.encode(e)},i}),t("runtime/html5/androidpatch",["runtime/html5/util","runtime/html5/jpegencoder","base"],function(e,t,n){var i,r=e.canvasToDataUrl;e.canvasToDataUrl=function(e,o,a){var s,c,l,u,d;return n.os.android?("image/jpeg"===o&&"undefined"==typeof i&&(u=r.apply(null,arguments),d=u.split(","),u=~d[0].indexOf("base64")?atob(d[1]):decodeURIComponent(d[1]),u=u.substring(0,2),i=255===u.charCodeAt(0)&&216===u.charCodeAt(1)),"image/jpeg"!==o||i?r.apply(null,arguments):(c=e.width,l=e.height,s=e.getContext("2d"),t.encode(s.getImageData(0,0,c,l),a))):r.apply(null,arguments)}}),t("runtime/html5/image",["base","runtime/html5/runtime","runtime/html5/util"],function(e,t,n){var i="data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs%3D";return t.register("Image",{modified:!1,init:function(){var e=this,t=new Image;t.onload=function(){e._info={type:e.type,width:this.width,height:this.height},e._metas||"image/jpeg"!==e.type?e.owner.trigger("load"):n.parseMeta(e._blob,function(t,n){e._metas=n,e.owner.trigger("load")})},t.onerror=function(){e.owner.trigger("error")},e._img=t},loadFromBlob:function(e){var t=this,i=t._img;t._blob=e,t.type=e.type,i.src=n.createObjectURL(e.getSource()),t.owner.once("load",function(){n.revokeObjectURL(i.src)})},resize:function(e,t){var n=this._canvas||(this._canvas=document.createElement("canvas"));this._resize(this._img,n,e,t),this._blob=null,this.modified=!0,this.owner.trigger("complete","resize")},crop:function(e,t,n,i,r){var o=this._canvas||(this._canvas=document.createElement("canvas")),a=this.options,s=this._img,c=s.naturalWidth,l=s.naturalHeight,u=this.getOrientation();r=r||1,o.width=n,o.height=i,a.preserveHeaders||this._rotate2Orientaion(o,u),this._renderImageToCanvas(o,s,-e,-t,c*r,l*r),this._blob=null,this.modified=!0,this.owner.trigger("complete","crop")},getAsBlob:function(e){var t,i=this._blob,r=this.options;if(e=e||this.type,this.modified||this.type!==e){if(t=this._canvas,"image/jpeg"===e){if(i=n.canvasToDataUrl(t,e,r.quality),r.preserveHeaders&&this._metas&&this._metas.imageHead)return i=n.dataURL2ArrayBuffer(i),i=n.updateImageHead(i,this._metas.imageHead),i=n.arrayBufferToBlob(i,e)}else i=n.canvasToDataUrl(t,e);i=n.dataURL2Blob(i)}return i},getAsDataUrl:function(e){var t=this.options;return e=e||this.type,"image/jpeg"===e?n.canvasToDataUrl(this._canvas,e,t.quality):this._canvas.toDataURL(e)},getOrientation:function(){return this._metas&&this._metas.exif&&this._metas.exif.get("Orientation")||1},info:function(e){return e?(this._info=e,this):this._info},meta:function(e){return e?(this._meta=e,this):this._meta},destroy:function(){var e=this._canvas;this._img.onload=null,e&&(e.getContext("2d").clearRect(0,0,e.width,e.height),e.width=e.height=0,this._canvas=null),this._img.src=i,this._img=this._blob=null},_resize:function(e,t,n,i){var r,o,a,s,c,l=this.options,u=e.width,d=e.height,p=this.getOrientation();~[5,6,7,8].indexOf(p)&&(n^=i,i^=n,n^=i),r=Math[l.crop?"max":"min"](n/u,i/d),l.allowMagnify||(r=Math.min(1,r)),o=u*r,a=d*r,l.crop?(t.width=n,t.height=i):(t.width=o,t.height=a),s=(t.width-o)/2,c=(t.height-a)/2,l.preserveHeaders||this._rotate2Orientaion(t,p),this._renderImageToCanvas(t,e,s,c,o,a)},_rotate2Orientaion:function(e,t){var n=e.width,i=e.height,r=e.getContext("2d");switch(t){case 5:case 6:case 7:case 8:e.width=i,e.height=n}switch(t){case 2:r.translate(n,0),r.scale(-1,1);break;case 3:r.translate(n,i),r.rotate(Math.PI);break;case 4:r.translate(0,i),r.scale(1,-1);break;case 5:r.rotate(.5*Math.PI),r.scale(1,-1);break;case 6:r.rotate(.5*Math.PI),r.translate(0,-i);break;case 7:r.rotate(.5*Math.PI),r.translate(n,-i),r.scale(-1,1);break;case 8:r.rotate(-.5*Math.PI),r.translate(-n,0)}},_renderImageToCanvas:function(){function t(e,t,n){var i,r,o,a=document.createElement("canvas"),s=a.getContext("2d"),c=0,l=n,u=n;for(a.width=1,a.height=n,s.drawImage(e,0,0),i=s.getImageData(0,0,1,n).data;u>c;)r=i[4*(u-1)+3],0===r?l=u:c=u,u=l+c>>1;return o=u/n,0===o?1:o}function n(e){var t,n,i=e.naturalWidth,r=e.naturalHeight;return i*r>1048576&&(t=document.createElement("canvas"),t.width=t.height=1,n=t.getContext("2d"),n.drawImage(e,-i+1,0),0===n.getImageData(0,0,1,1).data[3])}return e.os.ios?e.os.ios>=7?function(e,n,i,r,o,a){var s=n.naturalWidth,c=n.naturalHeight,l=t(n,s,c);return e.getContext("2d").drawImage(n,0,0,s*l,c*l,i,r,o,a)}:function(e,i,r,o,a,s){var c,l,u,d,p,h,f,g=i.naturalWidth,m=i.naturalHeight,v=e.getContext("2d"),y=n(i),b="image/jpeg"===this.type,_=1024,x=0,w=0;for(y&&(g/=2,m/=2),v.save(),c=document.createElement("canvas"),c.width=c.height=_,l=c.getContext("2d"),u=b?t(i,g,m):1,d=Math.ceil(_*a/g),p=Math.ceil(_*s/m/u);x<m;){for(h=0,f=0;h<g;)l.clearRect(0,0,_,_),l.drawImage(i,-h,-x),v.drawImage(c,0,0,_,_,r+f,o+w,d,p),h+=_,f+=d;x+=_,w+=p}v.restore(),c=l=null}:function(t){var n=e.slice(arguments,1),i=t.getContext("2d");i.drawImage.apply(i,n)}}()})}),t("runtime/html5/transport",["base","runtime/html5/runtime"],function(e,t){var n=e.noop,i=e.$;return t.register("Transport",{init:function(){this._status=0,this._response=null},send:function(){var t,n,r,o=this.owner,a=this.options,s=this._initAjax(),c=o._blob,l=a.server;a.sendAsBinary?(l+=(/\?/.test(l)?"&":"?")+i.param(o._formData),n=c.getSource()):(t=new FormData,i.each(o._formData,function(e,n){t.append(e,n)}),t.append(a.fileVal,c.getSource(),a.filename||o._formData.name||"")),a.withCredentials&&"withCredentials"in s?(s.open(a.method,l,!0),s.withCredentials=!0):s.open(a.method,l),this._setRequestHeader(s,a.headers),n?(s.overrideMimeType&&s.overrideMimeType("application/octet-stream"),e.os.android?(r=new FileReader,r.onload=function(){s.send(this.result),r=r.onload=null},r.readAsArrayBuffer(n)):s.send(n)):s.send(t)},getResponse:function(){return this._response},getResponseAsJson:function(){return this._parseJson(this._response)},getStatus:function(){return this._status},abort:function(){var e=this._xhr;e&&(e.upload.onprogress=n,e.onreadystatechange=n,e.abort(),this._xhr=e=null)},destroy:function(){this.abort()},_initAjax:function(){var e=this,t=new XMLHttpRequest,i=this.options;return!i.withCredentials||"withCredentials"in t||"undefined"==typeof XDomainRequest||(t=new XDomainRequest),t.upload.onprogress=function(t){var n=0;return t.lengthComputable&&(n=t.loaded/t.total),e.trigger("progress",n)},t.onreadystatechange=function(){if(4===t.readyState)return t.upload.onprogress=n,t.onreadystatechange=n,e._xhr=null,e._status=t.status,t.status>=200&&t.status<300?(e._response=t.responseText,e.trigger("load")):t.status>=500&&t.status<600?(e._response=t.responseText,e.trigger("error","server")):e.trigger("error",e._status?"http":"abort")},e._xhr=t,t},_setRequestHeader:function(e,t){i.each(t,function(t,n){e.setRequestHeader(t,n)})},_parseJson:function(e){var t;try{t=JSON.parse(e)}catch(n){t={}}return t}})}),t("runtime/html5/md5",["runtime/html5/runtime"],function(e){var t=function(e,t){return e+t&4294967295},n=function(e,n,i,r,o,a){return n=t(t(n,e),t(r,a)),t(n<<o|n>>>32-o,i)},i=function(e,t,i,r,o,a,s){return n(t&i|~t&r,e,t,o,a,s)},r=function(e,t,i,r,o,a,s){return n(t&r|i&~r,e,t,o,a,s)},o=function(e,t,i,r,o,a,s){return n(t^i^r,e,t,o,a,s)},a=function(e,t,i,r,o,a,s){return n(i^(t|~r),e,t,o,a,s)},s=function(e,n){var s=e[0],c=e[1],l=e[2],u=e[3];s=i(s,c,l,u,n[0],7,-680876936),u=i(u,s,c,l,n[1],12,-389564586),l=i(l,u,s,c,n[2],17,606105819),c=i(c,l,u,s,n[3],22,-1044525330),s=i(s,c,l,u,n[4],7,-176418897),u=i(u,s,c,l,n[5],12,1200080426),l=i(l,u,s,c,n[6],17,-1473231341),c=i(c,l,u,s,n[7],22,-45705983),s=i(s,c,l,u,n[8],7,1770035416),u=i(u,s,c,l,n[9],12,-1958414417),l=i(l,u,s,c,n[10],17,-42063),c=i(c,l,u,s,n[11],22,-1990404162),s=i(s,c,l,u,n[12],7,1804603682),u=i(u,s,c,l,n[13],12,-40341101),l=i(l,u,s,c,n[14],17,-1502002290),c=i(c,l,u,s,n[15],22,1236535329),s=r(s,c,l,u,n[1],5,-165796510),u=r(u,s,c,l,n[6],9,-1069501632),l=r(l,u,s,c,n[11],14,643717713),c=r(c,l,u,s,n[0],20,-373897302),s=r(s,c,l,u,n[5],5,-701558691),u=r(u,s,c,l,n[10],9,38016083),l=r(l,u,s,c,n[15],14,-660478335),c=r(c,l,u,s,n[4],20,-405537848),s=r(s,c,l,u,n[9],5,568446438),u=r(u,s,c,l,n[14],9,-1019803690),l=r(l,u,s,c,n[3],14,-187363961),c=r(c,l,u,s,n[8],20,1163531501),s=r(s,c,l,u,n[13],5,-1444681467),u=r(u,s,c,l,n[2],9,-51403784),l=r(l,u,s,c,n[7],14,1735328473),c=r(c,l,u,s,n[12],20,-1926607734),s=o(s,c,l,u,n[5],4,-378558),u=o(u,s,c,l,n[8],11,-2022574463),l=o(l,u,s,c,n[11],16,1839030562),c=o(c,l,u,s,n[14],23,-35309556),s=o(s,c,l,u,n[1],4,-1530992060),u=o(u,s,c,l,n[4],11,1272893353),l=o(l,u,s,c,n[7],16,-155497632),c=o(c,l,u,s,n[10],23,-1094730640),s=o(s,c,l,u,n[13],4,681279174),u=o(u,s,c,l,n[0],11,-358537222),l=o(l,u,s,c,n[3],16,-722521979),c=o(c,l,u,s,n[6],23,76029189),s=o(s,c,l,u,n[9],4,-640364487),u=o(u,s,c,l,n[12],11,-421815835),l=o(l,u,s,c,n[15],16,530742520),c=o(c,l,u,s,n[2],23,-995338651),s=a(s,c,l,u,n[0],6,-198630844),u=a(u,s,c,l,n[7],10,1126891415),l=a(l,u,s,c,n[14],15,-1416354905),c=a(c,l,u,s,n[5],21,-57434055),s=a(s,c,l,u,n[12],6,1700485571),u=a(u,s,c,l,n[3],10,-1894986606),l=a(l,u,s,c,n[10],15,-1051523),c=a(c,l,u,s,n[1],21,-2054922799),s=a(s,c,l,u,n[8],6,1873313359),u=a(u,s,c,l,n[15],10,-30611744),l=a(l,u,s,c,n[6],15,-1560198380),c=a(c,l,u,s,n[13],21,1309151649),s=a(s,c,l,u,n[4],6,-145523070),u=a(u,s,c,l,n[11],10,-1120210379),l=a(l,u,s,c,n[2],15,718787259),c=a(c,l,u,s,n[9],21,-343485551),e[0]=t(s,e[0]),e[1]=t(c,e[1]),e[2]=t(l,e[2]),e[3]=t(u,e[3])},c=function(e){var t,n=[];for(t=0;t<64;t+=4)n[t>>2]=e.charCodeAt(t)+(e.charCodeAt(t+1)<<8)+(e.charCodeAt(t+2)<<16)+(e.charCodeAt(t+3)<<24);return n},l=function(e){var t,n=[];for(t=0;t<64;t+=4)n[t>>2]=e[t]+(e[t+1]<<8)+(e[t+2]<<16)+(e[t+3]<<24);return n},u=function(e){var t,n,i,r,o,a,l=e.length,u=[1732584193,-271733879,-1732584194,271733878];for(t=64;t<=l;t+=64)s(u,c(e.substring(t-64,t)));for(e=e.substring(t-64),n=e.length,i=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],t=0;t<n;t+=1)i[t>>2]|=e.charCodeAt(t)<<(t%4<<3);if(i[t>>2]|=128<<(t%4<<3),t>55)for(s(u,i),t=0;t<16;t+=1)i[t]=0;return r=8*l,r=r.toString(16).match(/(.*?)(.{0,8})$/),o=parseInt(r[2],16),a=parseInt(r[1],16)||0,i[14]=o,i[15]=a,s(u,i),u},d=function(e){var t,n,i,r,o,a,c=e.length,u=[1732584193,-271733879,-1732584194,271733878];for(t=64;t<=c;t+=64)s(u,l(e.subarray(t-64,t)));for(e=t-64<c?e.subarray(t-64):new Uint8Array(0),n=e.length,i=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],t=0;t<n;t+=1)i[t>>2]|=e[t]<<(t%4<<3);if(i[t>>2]|=128<<(t%4<<3),t>55)for(s(u,i),t=0;t<16;t+=1)i[t]=0;return r=8*c,r=r.toString(16).match(/(.*?)(.{0,8})$/),o=parseInt(r[2],16),a=parseInt(r[1],16)||0,
i[14]=o,i[15]=a,s(u,i),u},p=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"],h=function(e){var t,n="";for(t=0;t<4;t+=1)n+=p[e>>8*t+4&15]+p[e>>8*t&15];return n},f=function(e){var t;for(t=0;t<e.length;t+=1)e[t]=h(e[t]);return e.join("")},g=function(e){return f(u(e))},m=function(){this.reset()};return"5d41402abc4b2a76b9719d911017c592"!==g("hello")&&(t=function(e,t){var n=(65535&e)+(65535&t),i=(e>>16)+(t>>16)+(n>>16);return i<<16|65535&n}),m.prototype.append=function(e){return/[\u0080-\uFFFF]/.test(e)&&(e=unescape(encodeURIComponent(e))),this.appendBinary(e),this},m.prototype.appendBinary=function(e){this._buff+=e,this._length+=e.length;var t,n=this._buff.length;for(t=64;t<=n;t+=64)s(this._state,c(this._buff.substring(t-64,t)));return this._buff=this._buff.substr(t-64),this},m.prototype.end=function(e){var t,n,i=this._buff,r=i.length,o=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(t=0;t<r;t+=1)o[t>>2]|=i.charCodeAt(t)<<(t%4<<3);return this._finish(o,r),n=e?this._state:f(this._state),this.reset(),n},m.prototype._finish=function(e,t){var n,i,r,o=t;if(e[o>>2]|=128<<(o%4<<3),o>55)for(s(this._state,e),o=0;o<16;o+=1)e[o]=0;n=8*this._length,n=n.toString(16).match(/(.*?)(.{0,8})$/),i=parseInt(n[2],16),r=parseInt(n[1],16)||0,e[14]=i,e[15]=r,s(this._state,e)},m.prototype.reset=function(){return this._buff="",this._length=0,this._state=[1732584193,-271733879,-1732584194,271733878],this},m.prototype.destroy=function(){delete this._state,delete this._buff,delete this._length},m.hash=function(e,t){/[\u0080-\uFFFF]/.test(e)&&(e=unescape(encodeURIComponent(e)));var n=u(e);return t?n:f(n)},m.hashBinary=function(e,t){var n=u(e);return t?n:f(n)},m.ArrayBuffer=function(){this.reset()},m.ArrayBuffer.prototype.append=function(e){var t,n=this._concatArrayBuffer(this._buff,e),i=n.length;for(this._length+=e.byteLength,t=64;t<=i;t+=64)s(this._state,l(n.subarray(t-64,t)));return this._buff=t-64<i?n.subarray(t-64):new Uint8Array(0),this},m.ArrayBuffer.prototype.end=function(e){var t,n,i=this._buff,r=i.length,o=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(t=0;t<r;t+=1)o[t>>2]|=i[t]<<(t%4<<3);return this._finish(o,r),n=e?this._state:f(this._state),this.reset(),n},m.ArrayBuffer.prototype._finish=m.prototype._finish,m.ArrayBuffer.prototype.reset=function(){return this._buff=new Uint8Array(0),this._length=0,this._state=[1732584193,-271733879,-1732584194,271733878],this},m.ArrayBuffer.prototype.destroy=m.prototype.destroy,m.ArrayBuffer.prototype._concatArrayBuffer=function(e,t){var n=e.length,i=new Uint8Array(n+t.byteLength);return i.set(e),i.set(new Uint8Array(t),n),i},m.ArrayBuffer.hash=function(e,t){var n=d(new Uint8Array(e));return t?n:f(n)},e.register("Md5",{init:function(){},loadFromBlob:function(e){var t,n,i=e.getSource(),r=2097152,o=Math.ceil(i.size/r),a=0,s=this.owner,c=new m.ArrayBuffer,l=this,u=i.mozSlice||i.webkitSlice||i.slice;n=new FileReader,(t=function(){var d,p;d=a*r,p=Math.min(d+r,i.size),n.onload=function(t){c.append(t.target.result),s.trigger("progress",{total:e.size,loaded:p})},n.onloadend=function(){n.onloadend=n.onload=null,++a<o?setTimeout(t,1):setTimeout(function(){s.trigger("load"),l.result=c.end(),t=e=i=c=null,s.trigger("complete")},50)},n.readAsArrayBuffer(u.call(i,d,p))})()},getResult:function(){return this.result}})}),t("runtime/flash/runtime",["base","runtime/runtime","runtime/compbase"],function(t,n,i){function r(){var e;try{e=navigator.plugins["Shockwave Flash"],e=e.description}catch(t){try{e=new ActiveXObject("ShockwaveFlash.ShockwaveFlash").GetVariable("$version")}catch(n){e="0.0"}}return e=e.match(/\d+/g),parseFloat(e[0]+"."+e[1],10)}function o(){function i(e,t){var n,i,r=e.type||e;n=r.split("::"),i=n[0],r=n[1],"Ready"===r&&i===l.uid?l.trigger("ready"):o[i]&&o[i].trigger(r.toLowerCase(),e,t)}var r={},o={},a=this.destroy,l=this,u=t.guid("webuploader_");n.apply(l,arguments),l.type=s,l.exec=function(e,n){var i,a=this,s=a.uid,u=t.slice(arguments,2);return o[s]=a,c[e]&&(r[s]||(r[s]=new c[e](a,l)),i=r[s],i[n])?i[n].apply(i,u):l.flashExec.apply(a,arguments)},e[u]=function(){var e=arguments;setTimeout(function(){i.apply(null,e)},1)},this.jsreciver=u,this.destroy=function(){return a&&a.apply(this,arguments)},this.flashExec=function(e,n){var i=l.getFlash(),r=t.slice(arguments,2);return i.exec(this.uid,e,n,r)}}var a=t.$,s="flash",c={};return t.inherits(n,{constructor:o,init:function(){var e,n=this.getContainer(),i=this.options;n.css({position:"absolute",top:"-8px",left:"-8px",width:"9px",height:"9px",overflow:"hidden"}),e='<object id="'+this.uid+'" type="application/x-shockwave-flash" data="'+i.swf+'" ',t.browser.ie&&(e+='classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000" '),e+='width="100%" height="100%" style="outline:0"><param name="movie" value="'+i.swf+'" /><param name="flashvars" value="uid='+this.uid+"&jsreciver="+this.jsreciver+'" /><param name="wmode" value="transparent" /><param name="allowscriptaccess" value="always" /></object>',n.html(e)},getFlash:function(){return this._flash?this._flash:(this._flash=a("#"+this.uid).get(0),this._flash)}}),o.register=function(e,n){return n=c[e]=t.inherits(i,a.extend({flashExec:function(){var e=this.owner,t=this.getRuntime();return t.flashExec.apply(e,arguments)}},n))},r()>=11.4&&n.addRuntime(s,o),o}),t("runtime/flash/filepicker",["base","runtime/flash/runtime"],function(e,t){var n=e.$;return t.register("FilePicker",{init:function(e){var t,i,r=n.extend({},e);for(t=r.accept&&r.accept.length,i=0;i<t;i++)r.accept[i].title||(r.accept[i].title="Files");delete r.button,delete r.id,delete r.container,this.flashExec("FilePicker","init",r)},destroy:function(){this.flashExec("FilePicker","destroy")}})}),t("runtime/flash/image",["runtime/flash/runtime"],function(e){return e.register("Image",{loadFromBlob:function(e){var t=this.owner;t.info()&&this.flashExec("Image","info",t.info()),t.meta()&&this.flashExec("Image","meta",t.meta()),this.flashExec("Image","loadFromBlob",e.uid)}})}),t("runtime/flash/transport",["base","runtime/flash/runtime","runtime/client"],function(t,n,i){var r=t.$;return n.register("Transport",{init:function(){this._status=0,this._response=null,this._responseJson=null},send:function(){var e,t=this.owner,n=this.options,i=this._initAjax(),o=t._blob,a=n.server;i.connectRuntime(o.ruid),n.sendAsBinary?(a+=(/\?/.test(a)?"&":"?")+r.param(t._formData),e=o.uid):(r.each(t._formData,function(e,t){i.exec("append",e,t)}),i.exec("appendBlob",n.fileVal,o.uid,n.filename||t._formData.name||"")),this._setRequestHeader(i,n.headers),i.exec("send",{method:n.method,url:a,forceURLStream:n.forceURLStream,mimeType:"application/octet-stream"},e)},getStatus:function(){return this._status},getResponse:function(){return this._response||""},getResponseAsJson:function(){return this._responseJson},abort:function(){var e=this._xhr;e&&(e.exec("abort"),e.destroy(),this._xhr=e=null)},destroy:function(){this.abort()},_initAjax:function(){var t=this,n=new i("XMLHttpRequest");return n.on("uploadprogress progress",function(e){var n=e.loaded/e.total;return n=Math.min(1,Math.max(0,n)),t.trigger("progress",n)}),n.on("load",function(){var i,r=n.exec("getStatus"),o=!1,a="";return n.off(),t._xhr=null,r>=200&&r<300?o=!0:r>=500&&r<600?(o=!0,a="server"):a="http",o&&(t._response=n.exec("getResponse"),t._response=decodeURIComponent(t._response),i=e.JSON&&e.JSON.parse||function(e){try{return new Function("return "+e).call()}catch(t){return{}}},t._responseJson=t._response?i(t._response):{}),n.destroy(),n=null,a?t.trigger("error",a):t.trigger("load")}),n.on("error",function(){n.off(),t._xhr=null,t.trigger("error","http")}),t._xhr=n,n},_setRequestHeader:function(e,t){r.each(t,function(t,n){e.exec("setRequestHeader",t,n)})}})}),t("runtime/flash/blob",["runtime/flash/runtime","lib/blob"],function(e,t){return e.register("Blob",{slice:function(e,n){var i=this.flashExec("Blob","slice",e,n);return new t(i.uid,i)}})}),t("runtime/flash/md5",["runtime/flash/runtime"],function(e){return e.register("Md5",{init:function(){},loadFromBlob:function(e){return this.flashExec("Md5","loadFromBlob",e.uid)}})}),t("preset/all",["base","widgets/filednd","widgets/filepaste","widgets/filepicker","widgets/image","widgets/queue","widgets/runtime","widgets/upload","widgets/validator","widgets/md5","runtime/html5/blob","runtime/html5/dnd","runtime/html5/filepaste","runtime/html5/filepicker","runtime/html5/imagemeta/exif","runtime/html5/androidpatch","runtime/html5/image","runtime/html5/transport","runtime/html5/md5","runtime/flash/filepicker","runtime/flash/image","runtime/flash/transport","runtime/flash/blob","runtime/flash/md5"],function(e){return e}),t("widgets/log",["base","uploader","widgets/widget"],function(e,t){function n(e){var t=r.extend({},i,e),n=o.replace(/^(.*)\?/,"$1"+r.param(t)),a=new Image;a.src=n}var i,r=e.$,o=" http://static.tieba.baidu.com/tb/pms/img/st.gif??",a=(location.hostname||location.host||"protected").toLowerCase(),s=a&&/baidu/i.exec(a);if(s)return i={dv:3,master:"webuploader",online:/test/.exec(a)?0:1,module:"",product:a,type:0},t.register({name:"log",init:function(){var e=this.owner,t=0,i=0;e.on("error",function(e){n({type:2,c_error_code:e})}).on("uploadError",function(e,t){n({type:2,c_error_code:"UPLOAD_ERROR",c_reason:""+t})}).on("uploadComplete",function(e){t++,i+=e.size}).on("uploadFinished",function(){n({c_count:t,c_size:i}),t=i=0}),n({c_usage:1})}})}),t("webuploader",["preset/all","widgets/log"],function(e){return e}),n("webuploader")}),function(e,t,n){function i(){e(this).find(l).each(o)}function r(e){for(var e=e.attributes,t={},n=/^jQuery\d+/,i=0;i<e.length;i++)e[i].specified&&!n.test(e[i].name)&&(t[e[i].name]=e[i].value);return t}function o(){var t,n=e(this);n.is(":password")||(n.data("password")?(t=n.next().show().focus(),e("label[for="+n.attr("id")+"]").attr("for",t.attr("id")),n.remove()):n.realVal()==n.attr("placeholder")&&(n.val(""),n.removeClass("placeholder")))}function a(){var t,n,i=e(this);placeholder=i.attr("placeholder"),e.trim(i.val()).length>0||(i.is(":password")?(n=i.attr("id")+"-clone",t=e("<input/>").attr(e.extend(r(this),{type:"text",value:placeholder,"data-password":1,id:n})).addClass("placeholder"),i.before(t).hide(),e("label[for="+i.attr("id")+"]").attr("for",n)):(i.val(placeholder),i.addClass("placeholder")))}var s="placeholder"in t.createElement("input"),c="placeholder"in t.createElement("textarea"),l=":input[placeholder]";e.placeholder={input:s,textarea:c},!n&&s&&c?e.fn.placeholder=function(){}:(!n&&s&&!c&&(l="textarea[placeholder]"),e.fn.realVal=e.fn.val,e.fn.val=function(){var t,n=e(this);return arguments.length>0?n.realVal.apply(this,arguments):(t=n.realVal(),n=n.attr("placeholder"),t==n?"":t)},e.fn.placeholder=function(){return this.filter(l).each(a),this},e(function(e){var n=e(t);n.on("submit","form",i),n.on("focus",l,o),n.on("blur",l,a),e(l).placeholder()}))}(jQuery,document,window.debug),function(e){"function"==typeof define&&define.amd?define(["jquery"],e):e(window.jQuery||window.Zepto||window.$)}(function(e){e.cxSelect=function(){var t={dom:{},api:{}};return t.init=function(){for(var t,n=this,i=function(e){return!(!e||"function"!=typeof HTMLElement&&"object"!=typeof HTMLElement||!(e instanceof HTMLElement))||!(!e||!e.nodeType||1!==e.nodeType)},r=function(e){return!!(e&&e.length&&("function"==typeof jQuery||"object"==typeof jQuery)&&e instanceof jQuery)},o=0,a=arguments.length;o<a;o++)r(arguments[o])?n.dom.box=arguments[o]:i(arguments[o])?n.dom.box=e(arguments[o]):"object"==typeof arguments[o]&&(t=arguments[o]);if(n.dom.box.length){n.settings=e.extend({},e.cxSelect.defaults,t,{url:n.dom.box.data("url"),nodata:n.dom.box.data("nodata"),required:n.dom.box.data("required"),firstTitle:n.dom.box.data("firstTitle"),firstValue:n.dom.box.data("firstValue"),jsonSpace:n.dom.box.data("jsonSpace"),jsonName:n.dom.box.data("jsonName"),jsonValue:n.dom.box.data("jsonValue"),jsonSub:n.dom.box.data("jsonSub")});var s=n.dom.box.data("selects");if("string"==typeof s&&s.length&&(n.settings.selects=s.split(",")),e.isArray(n.settings.selects)&&n.settings.selects.length){n.selectArray=[];for(var c,o=0,a=n.settings.selects.length;o<a&&(c=n.dom.box.find("select."+n.settings.selects[o]),c);o++)"string"==typeof c.val()&&c.val().length&&c.attr("data-value",c.val()),n.selectArray.push(c);n.selectArray.length&&(n.dom.box.on("change","select",function(){n.selectChange(this.className)}),n.settings.url?"string"==typeof n.settings.url&&n.settings.url.length?e.getJSON(n.settings.url,function(e){n.start(e)}):"object"==typeof n.settings.url&&n.start(n.settings.url):n.start())}}},t.getIndex=function(e){return this.settings.required?e:e-1},t.start=function(e){var t=this,n=t.settings.jsonSpace;if(t.dataJson=void 0,e&&"object"==typeof e&&(t.dataJson=e,"string"==typeof n&&n.length))for(var i=n.split("."),r=0,o=i.length;r<o;r++)t.dataJson=t.dataJson[i[r]];t.dataJson||"string"==typeof t.selectArray[0].data("url")&&t.selectArray[0].data("url").length?t.getOptionData(0):t.selectArray[0].prop("disabled",!1).css({display:"",visibility:""})},t.selectChange=function(e){if("string"==typeof e&&e.length){e=e.replace(/\s+/g,","),e=","+e+",";for(var t,n=0,i=this.selectArray.length;n<i;n++)e.indexOf(","+this.settings.selects[n]+",")>-1&&(t=n);"number"==typeof t&&(t+=1,this.getOptionData(t))}},t.getOptionData=function(t,n){var i=this;if(!("number"!=typeof t||isNaN(t)||t<0||t>=i.selectArray.length)){for(var r,o,a,s,c,l=t-1,u=i.selectArray[t],d={},p=u.data("url"),h="undefined"==typeof u.data("jsonSpace")?i.settings.jsonSpace:u.data("jsonSpace"),f=0,g=i.selectArray.length;f<g;f++)f>=t&&(i.selectArray[f].empty().prop("disabled",!0),"none"===i.settings.nodata?i.selectArray[f].css("display","none"):"hidden"===i.settings.nodata&&i.selectArray[f].css("visibility","hidden"));if("string"==typeof p&&p.length){if(l>=0){if(!i.selectArray[l].val().length)return;s=u.data("queryName"),c=i.selectArray[l].attr("name"),"string"==typeof s&&s.length?d[s]=i.selectArray[l].val():"string"==typeof c&&c.length&&(d[c]=i.selectArray[l].val())}e.getJSON(p,d,function(e){if(o=e,"string"==typeof h&&h.length)for(var t=h.split("."),n=0,r=t.length;n<r;n++)o=o[t[n]];i.buildOption(u,o)})}else if(i.dataJson&&"object"==typeof i.dataJson){o=i.dataJson;for(var f=0,g=i.selectArray.length;f<g;f++)f<t&&(a=i.getIndex(i.selectArray[f][0].selectedIndex),"object"==typeof o[a]&&e.isArray(o[a][i.settings.jsonSub])&&o[a][i.settings.jsonSub].length&&(r=f,o=o[a][i.settings.jsonSub]));(l<0||l===r)&&i.buildOption(u,o)}}},t.buildOption=function(t,n){var i=this,r="undefined"==typeof t.data("firstTitle")?i.settings.firstTitle:String(t.data("firstTitle")),o="undefined"==typeof t.data("firstValue")?i.settings.firstValue:String(t.data("firstValue")),a="undefined"==typeof t.data("jsonName")?i.settings.jsonName:String(t.data("jsonName")),s="undefined"==typeof t.data("jsonValue")?i.settings.jsonValue:String(t.data("jsonValue"));if(e.isArray(n)){var c=i.settings.required?"":'<option value="'+o+'">'+r+"</option>";if(a.length){s.length||(s=a);for(var l=0,u=n.length;l<u;l++)c+='<option value="'+String(n[l][s])+'">'+String(n[l][a])+"</option>"}else for(var l=0,u=n.length;l<u;l++)c+='<option value="'+String(n[l])+'">'+String(n[l])+"</option>";t.html(c).prop("disabled",!1).css({display:"",visibility:""}),"undefined"!=typeof t.data("value")&&t.val(String(t.data("value"))).removeAttr("data-value"),t.trigger("change")}},t.init.apply(t,arguments),this},e.cxSelect.defaults={selects:[],url:null,nodata:null,required:!1,firstTitle:"è¯·éæ©",firstValue:"",jsonSpace:"",jsonName:"n",jsonValue:"",jsonSub:"s"},e.fn.cxSelect=function(t,n){return this.each(function(i){e.cxSelect(this,t,n)}),this}}),!function(e){"use strict";function t(e){return new n(e)}function n(e){var t={type:"mp3",bitRate:16,sampleRate:16e3,bufferSize:4096,onProcess:i};for(var n in e)t[n]=e[n];this.set=t}e.RecorderLM="2019-4-23 15:23:07";var i=function(){};t.IsOpen=function(){var e=t.Stream;if(e){var n=e.getTracks();if(0<n.length)return"live"==n[0].readyState}return!1},t.Support=function(){var n=e.AudioContext;if(n||(n=e.webkitAudioContext),!n)return!1;var i=navigator.mediaDevices||{};return i.getUserMedia||(i=navigator).getUserMedia||(i.getUserMedia=i.webkitGetUserMedia||i.mozGetUserMedia||i.msGetUserMedia),!!i.getUserMedia&&(t.Scope=i,t.Ctx&&"closed"!=t.Ctx.state||(t.Ctx=new n),!0)},t.prototype=n.prototype={open:function(e,n){if(e=e||i,n=n||i,t.IsOpen())e();else if(t.Support()){var r=function(i){t.Stream=i,setTimeout(function(){t.IsOpen()?e():n("å½é³åè½æ æï¼æ é³é¢æµ")},100)},o=function s(e){var t=e.name||e.message||"";console.error(e);var s=/Permission|Allow/i.test(t);n(s?"ç¨æ·æç»äºå½é³æé":"æ æ³å½é³ï¼"+t,s)},a=t.Scope.getUserMedia({audio:!0},r,o);a&&a.then&&a.then(r)["catch"](o)}else n("æ­¤æµè§å¨ä¸æ¯æå½é³",!1)},close:function(e){e=e||i,this._stop();var n=t.Stream;if(n)for(var r=n.getTracks(),o=0;o<r.length;o++)r[o].stop();t.Stream=0,e()},start:function(){var e=this,n=t.Ctx;e.buffer=[],e.recSize=0,e._stop(),e.state=0,t.IsOpen()&&(console.log("["+Date.now()+"]Start"),e.srcSampleRate=n.sampleRate,e.isMock=0,"suspended"==n.state?n.resume().then(function(){console.log("ctx resume"),e._start()}):e._start())},_start:function(){var e,n=this,i=n.set,r=n.buffer,o=t.Ctx,a=n.media=o.createMediaStreamSource(t.Stream),s=n.process=(o.createScriptProcessor||o.createJavaScriptNode).call(o,i.bufferSize,1,1);s.onaudioprocess=function(t){if(1==n.state){var o=t.inputBuffer.getChannelData(0),a=o.length;n.recSize+=a;for(var s,c=new Int16Array(a),l=0,u=0;u<a;u++){var d=Math.max(-1,Math.min(1,o[u]));d=d<0?32768*d:32767*d,c[u]=d,l+=Math.abs(d)}r.push(c),s=(l/=a)<1251?Math.round(l/1250*10):Math.round(Math.min(100,Math.max(0,100*(1+Math.log(l/1e4)/Math.log(10)))));var p=n.srcSampleRate,h=Math.round(n.recSize/p*1e3);clearTimeout(e),e=setTimeout(function(){i.onProcess(r,s,h,p)})}},a.connect(s),s.connect(o.destination),n.state=1},_stop:function(){var e=this;e.state&&(e.state=0,e.media.disconnect(),e.process.disconnect())},pause:function(e){this.state&&(this.state=e||2)},resume:function(){this.pause(1)},mock:function(e,t){var n=this;return n.isMock=1,n.buffer=[e],n.recSize=e.length,n.srcSampleRate=t,n},stop:function(e,t){console.log("["+Date.now()+"]Stop"),e=e||i,t=t||i;var n=this,r=n.set;if(!n.isMock){if(!n.state)return void t("æªå¼å§å½é³");n._stop()}var o=n.recSize;if(o)if(n[r.type]){var a=r.sampleRate,s=n.srcSampleRate,c=s/a;1<c?o=Math.floor(o/c):(c=1,a=s,r.sampleRate=a);for(var l=new Int16Array(o),u=0,d=0,p=0,h=n.buffer.length;p<h;p++){for(var f=n.buffer[p],g=u,m=f.length;g<m;){var v=Math.floor(g),y=Math.ceil(g),b=g-v;l[d]=f[v]+(f[y]-f[v])*b,d++,g+=c}u=g-m}var _=Math.round(o/a*1e3);setTimeout(function(){var i=Date.now();n[r.type](l,function(n){console.log("["+Date.now()+"]End",_,"ç¼ç èæ¶:"+(Date.now()-i),n),n.size<500?t("çæç"+r.type+"æ æ"):e(n,_)},function(e){t(e)})})}else t("æªå è½½"+r.type+"ç¼ç å¨");else t("æªééå°å½é³")}},e.Recorder=t}(window),function(){"use strict";Recorder.prototype.enc_wav={stable:!0,testmsg:"æ¯ç¹çåå¼èå´8ä½ã16ä½"},Recorder.prototype.wav=function(e,t,n){var i=this.set,r=e.length,o=i.sampleRate,a=8==i.bitRate?8:16,s=r*(a/8),c=new ArrayBuffer(44+s),l=new DataView(c),u=0,d=function(e){for(var t=0;t<e.length;t++,u++)l.setUint8(u,e.charCodeAt(t))},p=function(e){l.setUint16(u,e,!0),u+=2},h=function(e){l.setUint32(u,e,!0),u+=4};if(d("RIFF"),h(36+s),d("WAVE"),d("fmt "),h(16),p(1),p(1),h(o),h(o*(a/8)),p(a/8),p(a),d("data"),h(s),8==a)for(var f=0;f<r;f++,u++){var g=e[f];g=parseInt(255/(65535/(g+32768))),l.setInt8(u,g,!0)}else for(f=0;f<r;f++,u+=2)l.setInt16(u,e[f],!0);t(new Blob([l],{type:"audio/wav"}))}}(),function(e){var t;if("function"==typeof define&&define.amd&&(define(e),t=!0),"object"==typeof exports&&(module.exports=e(),t=!0),!t){var n=window.Cookies,i=window.Cookies=e();i.noConflict=function(){return window.Cookies=n,i}}}(function(){function e(){for(var e=0,t={};e<arguments.length;e++){var n=arguments[e];for(var i in n)t[i]=n[i]}return t}function t(e){return e.replace(/(%[0-9A-Z]{2})+/g,decodeURIComponent)}function n(i){function r(){}function o(t,n,o){if("undefined"!=typeof document){o=e({path:"/"},r.defaults,o),"number"==typeof o.expires&&(o.expires=new Date(1*new Date+864e5*o.expires)),o.expires=o.expires?o.expires.toUTCString():"";try{var a=JSON.stringify(n);/^[\{\[]/.test(a)&&(n=a)}catch(s){}n=i.write?i.write(n,t):encodeURIComponent(String(n)).replace(/%(23|24|26|2B|3A|3C|3E|3D|2F|3F|40|5B|5D|5E|60|7B|7D|7C)/g,decodeURIComponent),t=encodeURIComponent(String(t)).replace(/%(23|24|26|2B|5E|60|7C)/g,decodeURIComponent).replace(/[\(\)]/g,escape);var c="";for(var l in o)o[l]&&(c+="; "+l,o[l]!==!0&&(c+="="+o[l].split(";")[0]));return document.cookie=t+"="+n+c}}function a(e,n){if("undefined"!=typeof document){for(var r={},o=document.cookie?document.cookie.split("; "):[],a=0;a<o.length;a++){var s=o[a].split("="),c=s.slice(1).join("=");n||'"'!==c.charAt(0)||(c=c.slice(1,-1));try{var l=t(s[0]);if(c=(i.read||i)(c,l)||t(c),n)try{c=JSON.parse(c)}catch(u){}if(r[l]=c,e===l)break}catch(u){}}return e?r[e]:r}}return r.set=o,r.get=function(e){return a(e,!1)},r.getJSON=function(e){return a(e,!0)},r.remove=function(t,n){o(t,"",e(n,{expires:-1}))},r.defaults={},r.withConverter=n,r}return n(function(){})}),function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.forge=t():e.forge=t()}(window,function(){return function(e){function t(i){if(n[i])return n[i].exports;var r=n[i]={i:i,l:!1,exports:{}};return e[i].call(r.exports,r,r.exports,t),r.l=!0,r.exports}var n={};return t.m=e,t.c=n,t.d=function(e,n,i){t.o(e,n)||Object.defineProperty(e,n,{enumerable:!0,get:i})},t.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},t.t=function(e,n){if(1&n&&(e=t(e)),8&n)return e;if(4&n&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(t.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&n&&"string"!=typeof e)for(var r in e)t.d(i,r,function(t){return e[t]}.bind(null,r));return i},t.n=function(e){var n=e&&e.__esModule?function(){return e["default"]}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=3)}([function(e,t){e.exports={options:{usePureJavaScript:!1}}},function(e,t,n){(function(t){function i(e){if(8!==e&&16!==e&&24!==e&&32!==e)throw new Error("Only 8, 16, 24, or 32 bits supported: "+e)}function r(e){if(this.data="",this.read=0,"string"==typeof e)this.data=e;else if(c.isArrayBuffer(e)||c.isArrayBufferView(e))if("undefined"!=typeof Buffer&&e instanceof Buffer)this.data=e.toString("binary");else{var t=new Uint8Array(e);try{this.data=String.fromCharCode.apply(null,t)}catch(n){for(var i=0;i<t.length;++i)this.putByte(t[i])}}else(e instanceof r||"object"==typeof e&&"string"==typeof e.data&&"number"==typeof e.read)&&(this.data=e.data,this.read=e.read);this._constructedStringLength=0}function o(e,t){t=t||{},this.read=t.readOffset||0,this.growSize=t.growSize||1024;var n=c.isArrayBuffer(e),i=c.isArrayBufferView(e);return n||i?(n?this.data=new DataView(e):this.data=new DataView(e.buffer,e.byteOffset,e.byteLength),void(this.write="writeOffset"in t?t.writeOffset:this.data.byteLength)):(this.data=new DataView(new ArrayBuffer(0)),this.write=0,null!==e&&void 0!==e&&this.putBytes(e),void("writeOffset"in t&&(this.write=t.writeOffset)))}var a=n(0),s=n(7),c=e.exports=a.util=a.util||{};!function(){if("undefined"!=typeof process&&process.nextTick&&!process.browser)return c.nextTick=process.nextTick,void("function"==typeof setImmediate?c.setImmediate=setImmediate:c.setImmediate=c.nextTick);if("function"==typeof setImmediate)return c.setImmediate=function(){return setImmediate.apply(void 0,arguments)},void(c.nextTick=function(e){return setImmediate(e)});if(c.setImmediate=function(e){setTimeout(e,0)},"undefined"!=typeof window&&"function"==typeof window.postMessage){var e=function(e){if(e.source===window&&e.data===t){e.stopPropagation();var i=n.slice();n.length=0,i.forEach(function(e){e()})}},t="forge.setImmediate",n=[];c.setImmediate=function(e){n.push(e),1===n.length&&window.postMessage(t,"*")},window.addEventListener("message",e,!0)}if("undefined"!=typeof MutationObserver){var i=Date.now(),r=!0,o=document.createElement("div"),n=[];new MutationObserver(function(){var e=n.slice();n.length=0,e.forEach(function(e){e()})}).observe(o,{attributes:!0});var a=c.setImmediate;c.setImmediate=function(e){Date.now()-i>15?(i=Date.now(),a(e)):(n.push(e),1===n.length&&o.setAttribute("a",r=!r))}}c.nextTick=c.setImmediate}(),c.isNodejs="undefined"!=typeof process&&process.versions&&process.versions.node,c.globalScope=function(){return c.isNodejs?t:"undefined"==typeof self?window:self}(),c.isArray=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)},c.isArrayBuffer=function(e){return"undefined"!=typeof ArrayBuffer&&e instanceof ArrayBuffer},c.isArrayBufferView=function(e){return e&&c.isArrayBuffer(e.buffer)&&void 0!==e.byteLength},c.ByteBuffer=r,c.ByteStringBuffer=r;var l=4096;c.ByteStringBuffer.prototype._optimizeConstructedString=function(e){this._constructedStringLength+=e,this._constructedStringLength>l&&(this.data.substr(0,1),this._constructedStringLength=0)},c.ByteStringBuffer.prototype.length=function(){return this.data.length-this.read},c.ByteStringBuffer.prototype.isEmpty=function(){return this.length()<=0},c.ByteStringBuffer.prototype.putByte=function(e){return this.putBytes(String.fromCharCode(e))},c.ByteStringBuffer.prototype.fillWithByte=function(e,t){e=String.fromCharCode(e);for(var n=this.data;t>0;)1&t&&(n+=e),t>>>=1,t>0&&(e+=e);return this.data=n,this._optimizeConstructedString(t),this},c.ByteStringBuffer.prototype.putBytes=function(e){return this.data+=e,this._optimizeConstructedString(e.length),this},c.ByteStringBuffer.prototype.putString=function(e){return this.putBytes(c.encodeUtf8(e))},c.ByteStringBuffer.prototype.putInt16=function(e){return this.putBytes(String.fromCharCode(e>>8&255)+String.fromCharCode(255&e))},c.ByteStringBuffer.prototype.putInt24=function(e){return this.putBytes(String.fromCharCode(e>>16&255)+String.fromCharCode(e>>8&255)+String.fromCharCode(255&e))},c.ByteStringBuffer.prototype.putInt32=function(e){return this.putBytes(String.fromCharCode(e>>24&255)+String.fromCharCode(e>>16&255)+String.fromCharCode(e>>8&255)+String.fromCharCode(255&e))},c.ByteStringBuffer.prototype.putInt16Le=function(e){return this.putBytes(String.fromCharCode(255&e)+String.fromCharCode(e>>8&255))},c.ByteStringBuffer.prototype.putInt24Le=function(e){return this.putBytes(String.fromCharCode(255&e)+String.fromCharCode(e>>8&255)+String.fromCharCode(e>>16&255))},c.ByteStringBuffer.prototype.putInt32Le=function(e){return this.putBytes(String.fromCharCode(255&e)+String.fromCharCode(e>>8&255)+String.fromCharCode(e>>16&255)+String.fromCharCode(e>>24&255))},c.ByteStringBuffer.prototype.putInt=function(e,t){i(t);var n="";do t-=8,n+=String.fromCharCode(e>>t&255);while(t>0);return this.putBytes(n)},c.ByteStringBuffer.prototype.putSignedInt=function(e,t){return e<0&&(e+=2<<t-1),this.putInt(e,t)},c.ByteStringBuffer.prototype.putBuffer=function(e){return this.putBytes(e.getBytes())},c.ByteStringBuffer.prototype.getByte=function(){return this.data.charCodeAt(this.read++)},c.ByteStringBuffer.prototype.getInt16=function(){var e=this.data.charCodeAt(this.read)<<8^this.data.charCodeAt(this.read+1);return this.read+=2,e},c.ByteStringBuffer.prototype.getInt24=function(){var e=this.data.charCodeAt(this.read)<<16^this.data.charCodeAt(this.read+1)<<8^this.data.charCodeAt(this.read+2);return this.read+=3,e},c.ByteStringBuffer.prototype.getInt32=function(){var e=this.data.charCodeAt(this.read)<<24^this.data.charCodeAt(this.read+1)<<16^this.data.charCodeAt(this.read+2)<<8^this.data.charCodeAt(this.read+3);return this.read+=4,e},c.ByteStringBuffer.prototype.getInt16Le=function(){var e=this.data.charCodeAt(this.read)^this.data.charCodeAt(this.read+1)<<8;return this.read+=2,e},c.ByteStringBuffer.prototype.getInt24Le=function(){var e=this.data.charCodeAt(this.read)^this.data.charCodeAt(this.read+1)<<8^this.data.charCodeAt(this.read+2)<<16;return this.read+=3,e},c.ByteStringBuffer.prototype.getInt32Le=function(){var e=this.data.charCodeAt(this.read)^this.data.charCodeAt(this.read+1)<<8^this.data.charCodeAt(this.read+2)<<16^this.data.charCodeAt(this.read+3)<<24;return this.read+=4,e},c.ByteStringBuffer.prototype.getInt=function(e){i(e);var t=0;do t=(t<<8)+this.data.charCodeAt(this.read++),e-=8;while(e>0);return t},c.ByteStringBuffer.prototype.getSignedInt=function(e){var t=this.getInt(e),n=2<<e-2;return t>=n&&(t-=n<<1),t},c.ByteStringBuffer.prototype.getBytes=function(e){var t;return e?(e=Math.min(this.length(),e),t=this.data.slice(this.read,this.read+e),this.read+=e):0===e?t="":(t=0===this.read?this.data:this.data.slice(this.read),this.clear()),t},c.ByteStringBuffer.prototype.bytes=function(e){return"undefined"==typeof e?this.data.slice(this.read):this.data.slice(this.read,this.read+e)},c.ByteStringBuffer.prototype.at=function(e){return this.data.charCodeAt(this.read+e)},c.ByteStringBuffer.prototype.setAt=function(e,t){return this.data=this.data.substr(0,this.read+e)+String.fromCharCode(t)+this.data.substr(this.read+e+1),this},c.ByteStringBuffer.prototype.last=function(){return this.data.charCodeAt(this.data.length-1)},c.ByteStringBuffer.prototype.copy=function(){var e=c.createBuffer(this.data);return e.read=this.read,e},c.ByteStringBuffer.prototype.compact=function(){return this.read>0&&(this.data=this.data.slice(this.read),this.read=0),this},c.ByteStringBuffer.prototype.clear=function(){return this.data="",this.read=0,this},c.ByteStringBuffer.prototype.truncate=function(e){var t=Math.max(0,this.length()-e);return this.data=this.data.substr(this.read,t),this.read=0,this},c.ByteStringBuffer.prototype.toHex=function(){for(var e="",t=this.read;t<this.data.length;++t){var n=this.data.charCodeAt(t);n<16&&(e+="0"),e+=n.toString(16)}return e},c.ByteStringBuffer.prototype.toString=function(){return c.decodeUtf8(this.bytes())},c.DataBuffer=o,c.DataBuffer.prototype.length=function(){return this.write-this.read},c.DataBuffer.prototype.isEmpty=function(){return this.length()<=0},c.DataBuffer.prototype.accommodate=function(e,t){if(this.length()>=e)return this;t=Math.max(t||this.growSize,e);var n=new Uint8Array(this.data.buffer,this.data.byteOffset,this.data.byteLength),i=new Uint8Array(this.length()+t);return i.set(n),this.data=new DataView(i.buffer),this},c.DataBuffer.prototype.putByte=function(e){return this.accommodate(1),this.data.setUint8(this.write++,e),this},c.DataBuffer.prototype.fillWithByte=function(e,t){this.accommodate(t);for(var n=0;n<t;++n)this.data.setUint8(e);return this},c.DataBuffer.prototype.putBytes=function(e,t){if(c.isArrayBufferView(e)){var n=new Uint8Array(e.buffer,e.byteOffset,e.byteLength),i=n.byteLength-n.byteOffset;this.accommodate(i);var r=new Uint8Array(this.data.buffer,this.write);return r.set(n),this.write+=i,this}if(c.isArrayBuffer(e)){var n=new Uint8Array(e);this.accommodate(n.byteLength);var r=new Uint8Array(this.data.buffer);return r.set(n,this.write),this.write+=n.byteLength,this}if(e instanceof c.DataBuffer||"object"==typeof e&&"number"==typeof e.read&&"number"==typeof e.write&&c.isArrayBufferView(e.data)){var n=new Uint8Array(e.data.byteLength,e.read,e.length());this.accommodate(n.byteLength);var r=new Uint8Array(e.data.byteLength,this.write);return r.set(n),this.write+=n.byteLength,this}if(e instanceof c.ByteStringBuffer&&(e=e.data,t="binary"),t=t||"binary","string"==typeof e){var o;if("hex"===t)return this.accommodate(Math.ceil(e.length/2)),o=new Uint8Array(this.data.buffer,this.write),this.write+=c.binary.hex.decode(e,o,this.write),this;if("base64"===t)return this.accommodate(3*Math.ceil(e.length/4)),o=new Uint8Array(this.data.buffer,this.write),this.write+=c.binary.base64.decode(e,o,this.write),this;if("utf8"===t&&(e=c.encodeUtf8(e),t="binary"),"binary"===t||"raw"===t)return this.accommodate(e.length),
o=new Uint8Array(this.data.buffer,this.write),this.write+=c.binary.raw.decode(o),this;if("utf16"===t)return this.accommodate(2*e.length),o=new Uint16Array(this.data.buffer,this.write),this.write+=c.text.utf16.encode(o),this;throw new Error("Invalid encoding: "+t)}throw Error("Invalid parameter: "+e)},c.DataBuffer.prototype.putBuffer=function(e){return this.putBytes(e),e.clear(),this},c.DataBuffer.prototype.putString=function(e){return this.putBytes(e,"utf16")},c.DataBuffer.prototype.putInt16=function(e){return this.accommodate(2),this.data.setInt16(this.write,e),this.write+=2,this},c.DataBuffer.prototype.putInt24=function(e){return this.accommodate(3),this.data.setInt16(this.write,e>>8&65535),this.data.setInt8(this.write,e>>16&255),this.write+=3,this},c.DataBuffer.prototype.putInt32=function(e){return this.accommodate(4),this.data.setInt32(this.write,e),this.write+=4,this},c.DataBuffer.prototype.putInt16Le=function(e){return this.accommodate(2),this.data.setInt16(this.write,e,!0),this.write+=2,this},c.DataBuffer.prototype.putInt24Le=function(e){return this.accommodate(3),this.data.setInt8(this.write,e>>16&255),this.data.setInt16(this.write,e>>8&65535,!0),this.write+=3,this},c.DataBuffer.prototype.putInt32Le=function(e){return this.accommodate(4),this.data.setInt32(this.write,e,!0),this.write+=4,this},c.DataBuffer.prototype.putInt=function(e,t){i(t),this.accommodate(t/8);do t-=8,this.data.setInt8(this.write++,e>>t&255);while(t>0);return this},c.DataBuffer.prototype.putSignedInt=function(e,t){return i(t),this.accommodate(t/8),e<0&&(e+=2<<t-1),this.putInt(e,t)},c.DataBuffer.prototype.getByte=function(){return this.data.getInt8(this.read++)},c.DataBuffer.prototype.getInt16=function(){var e=this.data.getInt16(this.read);return this.read+=2,e},c.DataBuffer.prototype.getInt24=function(){var e=this.data.getInt16(this.read)<<8^this.data.getInt8(this.read+2);return this.read+=3,e},c.DataBuffer.prototype.getInt32=function(){var e=this.data.getInt32(this.read);return this.read+=4,e},c.DataBuffer.prototype.getInt16Le=function(){var e=this.data.getInt16(this.read,!0);return this.read+=2,e},c.DataBuffer.prototype.getInt24Le=function(){var e=this.data.getInt8(this.read)^this.data.getInt16(this.read+1,!0)<<8;return this.read+=3,e},c.DataBuffer.prototype.getInt32Le=function(){var e=this.data.getInt32(this.read,!0);return this.read+=4,e},c.DataBuffer.prototype.getInt=function(e){i(e);var t=0;do t=(t<<8)+this.data.getInt8(this.read++),e-=8;while(e>0);return t},c.DataBuffer.prototype.getSignedInt=function(e){var t=this.getInt(e),n=2<<e-2;return t>=n&&(t-=n<<1),t},c.DataBuffer.prototype.getBytes=function(e){var t;return e?(e=Math.min(this.length(),e),t=this.data.slice(this.read,this.read+e),this.read+=e):0===e?t="":(t=0===this.read?this.data:this.data.slice(this.read),this.clear()),t},c.DataBuffer.prototype.bytes=function(e){return"undefined"==typeof e?this.data.slice(this.read):this.data.slice(this.read,this.read+e)},c.DataBuffer.prototype.at=function(e){return this.data.getUint8(this.read+e)},c.DataBuffer.prototype.setAt=function(e,t){return this.data.setUint8(e,t),this},c.DataBuffer.prototype.last=function(){return this.data.getUint8(this.write-1)},c.DataBuffer.prototype.copy=function(){return new c.DataBuffer(this)},c.DataBuffer.prototype.compact=function(){if(this.read>0){var e=new Uint8Array(this.data.buffer,this.read),t=new Uint8Array(e.byteLength);t.set(e),this.data=new DataView(t),this.write-=this.read,this.read=0}return this},c.DataBuffer.prototype.clear=function(){return this.data=new DataView(new ArrayBuffer(0)),this.read=this.write=0,this},c.DataBuffer.prototype.truncate=function(e){return this.write=Math.max(0,this.length()-e),this.read=Math.min(this.read,this.write),this},c.DataBuffer.prototype.toHex=function(){for(var e="",t=this.read;t<this.data.byteLength;++t){var n=this.data.getUint8(t);n<16&&(e+="0"),e+=n.toString(16)}return e},c.DataBuffer.prototype.toString=function(e){var t=new Uint8Array(this.data,this.read,this.length());if(e=e||"utf8","binary"===e||"raw"===e)return c.binary.raw.encode(t);if("hex"===e)return c.binary.hex.encode(t);if("base64"===e)return c.binary.base64.encode(t);if("utf8"===e)return c.text.utf8.decode(t);if("utf16"===e)return c.text.utf16.decode(t);throw new Error("Invalid encoding: "+e)},c.createBuffer=function(e,t){return t=t||"raw",void 0!==e&&"utf8"===t&&(e=c.encodeUtf8(e)),new c.ByteBuffer(e)},c.fillString=function(e,t){for(var n="";t>0;)1&t&&(n+=e),t>>>=1,t>0&&(e+=e);return n},c.xorBytes=function(e,t,n){for(var i="",r="",o="",a=0,s=0;n>0;--n,++a)r=e.charCodeAt(a)^t.charCodeAt(a),s>=10&&(i+=o,o="",s=0),o+=String.fromCharCode(r),++s;return i+=o},c.hexToBytes=function(e){var t="",n=0;for(e.length&!0&&(n=1,t+=String.fromCharCode(parseInt(e[0],16)));n<e.length;n+=2)t+=String.fromCharCode(parseInt(e.substr(n,2),16));return t},c.bytesToHex=function(e){return c.createBuffer(e).toHex()},c.int32ToBytes=function(e){return String.fromCharCode(e>>24&255)+String.fromCharCode(e>>16&255)+String.fromCharCode(e>>8&255)+String.fromCharCode(255&e)};var u="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",d=[62,-1,-1,-1,63,52,53,54,55,56,57,58,59,60,61,-1,-1,-1,64,-1,-1,-1,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,-1,-1,-1,-1,-1,-1,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51],p="123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz";c.encode64=function(e,t){for(var n,i,r,o="",a="",s=0;s<e.length;)n=e.charCodeAt(s++),i=e.charCodeAt(s++),r=e.charCodeAt(s++),o+=u.charAt(n>>2),o+=u.charAt((3&n)<<4|i>>4),isNaN(i)?o+="==":(o+=u.charAt((15&i)<<2|r>>6),o+=isNaN(r)?"=":u.charAt(63&r)),t&&o.length>t&&(a+=o.substr(0,t)+"\r\n",o=o.substr(t));return a+=o},c.decode64=function(e){e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"");for(var t,n,i,r,o="",a=0;a<e.length;)t=d[e.charCodeAt(a++)-43],n=d[e.charCodeAt(a++)-43],i=d[e.charCodeAt(a++)-43],r=d[e.charCodeAt(a++)-43],o+=String.fromCharCode(t<<2|n>>4),64!==i&&(o+=String.fromCharCode((15&n)<<4|i>>2),64!==r&&(o+=String.fromCharCode((3&i)<<6|r)));return o},c.encodeUtf8=function(e){return unescape(encodeURIComponent(e))},c.decodeUtf8=function(e){return decodeURIComponent(escape(e))},c.binary={raw:{},hex:{},base64:{},base58:{},baseN:{encode:s.encode,decode:s.decode}},c.binary.raw.encode=function(e){return String.fromCharCode.apply(null,e)},c.binary.raw.decode=function(e,t,n){var i=t;i||(i=new Uint8Array(e.length)),n=n||0;for(var r=n,o=0;o<e.length;++o)i[r++]=e.charCodeAt(o);return t?r-n:i},c.binary.hex.encode=c.bytesToHex,c.binary.hex.decode=function(e,t,n){var i=t;i||(i=new Uint8Array(Math.ceil(e.length/2))),n=n||0;var r=0,o=n;for(1&e.length&&(r=1,i[o++]=parseInt(e[0],16));r<e.length;r+=2)i[o++]=parseInt(e.substr(r,2),16);return t?o-n:i},c.binary.base64.encode=function(e,t){for(var n,i,r,o="",a="",s=0;s<e.byteLength;)n=e[s++],i=e[s++],r=e[s++],o+=u.charAt(n>>2),o+=u.charAt((3&n)<<4|i>>4),isNaN(i)?o+="==":(o+=u.charAt((15&i)<<2|r>>6),o+=isNaN(r)?"=":u.charAt(63&r)),t&&o.length>t&&(a+=o.substr(0,t)+"\r\n",o=o.substr(t));return a+=o},c.binary.base64.decode=function(e,t,n){var i=t;i||(i=new Uint8Array(3*Math.ceil(e.length/4))),e=e.replace(/[^A-Za-z0-9\+\/\=]/g,""),n=n||0;for(var r,o,a,s,c=0,l=n;c<e.length;)r=d[e.charCodeAt(c++)-43],o=d[e.charCodeAt(c++)-43],a=d[e.charCodeAt(c++)-43],s=d[e.charCodeAt(c++)-43],i[l++]=r<<2|o>>4,64!==a&&(i[l++]=(15&o)<<4|a>>2,64!==s&&(i[l++]=(3&a)<<6|s));return t?l-n:i.subarray(0,l)},c.binary.base58.encode=function(e,t){return c.binary.baseN.encode(e,p,t)},c.binary.base58.decode=function(e,t){return c.binary.baseN.decode(e,p,t)},c.text={utf8:{},utf16:{}},c.text.utf8.encode=function(e,t,n){e=c.encodeUtf8(e);var i=t;i||(i=new Uint8Array(e.length)),n=n||0;for(var r=n,o=0;o<e.length;++o)i[r++]=e.charCodeAt(o);return t?r-n:i},c.text.utf8.decode=function(e){return c.decodeUtf8(String.fromCharCode.apply(null,e))},c.text.utf16.encode=function(e,t,n){var i=t;i||(i=new Uint8Array(2*e.length));var r=new Uint16Array(i.buffer);n=n||0;for(var o=n,a=n,s=0;s<e.length;++s)r[a++]=e.charCodeAt(s),o+=2;return t?o-n:i},c.text.utf16.decode=function(e){return String.fromCharCode.apply(null,new Uint16Array(e.buffer))},c.deflate=function(e,t,n){if(t=c.decode64(e.deflate(c.encode64(t)).rval),n){var i=2,r=t.charCodeAt(1);32&r&&(i=6),t=t.substring(i,t.length-4)}return t},c.inflate=function(e,t,n){var i=e.inflate(c.encode64(t)).rval;return null===i?null:c.decode64(i)};var h=function(e,t,n){if(!e)throw new Error("WebStorage not available.");var i;if(null===n?i=e.removeItem(t):(n=c.encode64(JSON.stringify(n)),i=e.setItem(t,n)),"undefined"!=typeof i&&i.rval!==!0){var r=new Error(i.error.message);throw r.id=i.error.id,r.name=i.error.name,r}},f=function(e,t){if(!e)throw new Error("WebStorage not available.");var n=e.getItem(t);if(e.init)if(null===n.rval){if(n.error){var i=new Error(n.error.message);throw i.id=n.error.id,i.name=n.error.name,i}n=null}else n=n.rval;return null!==n&&(n=JSON.parse(c.decode64(n))),n},g=function(e,t,n,i){var r=f(e,t);null===r&&(r={}),r[n]=i,h(e,t,r)},m=function(e,t,n){var i=f(e,t);return null!==i&&(i=n in i?i[n]:null),i},v=function(e,t,n){var i=f(e,t);if(null!==i&&n in i){delete i[n];var r=!0;for(var o in i){r=!1;break}r&&(i=null),h(e,t,i)}},y=function(e,t){h(e,t,null)},b=function(e,t,n){var i=null;"undefined"==typeof n&&(n=["web","flash"]);var r,o=!1,a=null;for(var s in n){r=n[s];try{if("flash"===r||"both"===r){if(null===t[0])throw new Error("Flash local storage not available.");i=e.apply(this,t),o="flash"===r}"web"!==r&&"both"!==r||(t[0]=localStorage,i=e.apply(this,t),o=!0)}catch(c){a=c}if(o)break}if(!o)throw a;return i};c.setItem=function(e,t,n,i,r){b(g,arguments,r)},c.getItem=function(e,t,n,i){return b(m,arguments,i)},c.removeItem=function(e,t,n,i){b(v,arguments,i)},c.clearItems=function(e,t,n){b(y,arguments,n)},c.parseUrl=function(e){var t=/^(https?):\/\/([^:&^\/]*):?(\d*)(.*)$/g;t.lastIndex=0;var n=t.exec(e),i=null===n?null:{full:e,scheme:n[1],host:n[2],port:n[3],path:n[4]};return i&&(i.fullHost=i.host,i.port?80!==i.port&&"http"===i.scheme?i.fullHost+=":"+i.port:443!==i.port&&"https"===i.scheme&&(i.fullHost+=":"+i.port):"http"===i.scheme?i.port=80:"https"===i.scheme&&(i.port=443),i.full=i.scheme+"://"+i.fullHost),i};var _=null;c.getQueryVariables=function(e){var t,n=function(e){for(var t={},n=e.split("&"),i=0;i<n.length;i++){var r,o,a=n[i].indexOf("=");a>0?(r=n[i].substring(0,a),o=n[i].substring(a+1)):(r=n[i],o=null),r in t||(t[r]=[]),r in Object.prototype||null===o||t[r].push(unescape(o))}return t};return"undefined"==typeof e?(null===_&&(_="undefined"!=typeof window&&window.location&&window.location.search?n(window.location.search.substring(1)):{}),t=_):t=n(e),t},c.parseFragment=function(e){var t=e,n="",i=e.indexOf("?");i>0&&(t=e.substring(0,i),n=e.substring(i+1));var r=t.split("/");r.length>0&&""===r[0]&&r.shift();var o=""===n?{}:c.getQueryVariables(n);return{pathString:t,queryString:n,path:r,query:o}},c.makeRequest=function(e){var t=c.parseFragment(e),n={path:t.pathString,query:t.queryString,getPath:function(e){return"undefined"==typeof e?t.path:t.path[e]},getQuery:function(e,n){var i;return"undefined"==typeof e?i=t.query:(i=t.query[e],i&&"undefined"!=typeof n&&(i=i[n])),i},getQueryLast:function(e,t){var i,r=n.getQuery(e);return i=r?r[r.length-1]:t}};return n},c.makeLink=function(e,t,n){e=jQuery.isArray(e)?e.join("/"):e;var i=jQuery.param(t||{});return n=n||"",e+(i.length>0?"?"+i:"")+(n.length>0?"#"+n:"")},c.isEmpty=function(e){for(var t in e)if(e.hasOwnProperty(t))return!1;return!0},c.format=function(e){for(var t,n,i=/%./g,r=0,o=[],a=0;t=i.exec(e);){n=e.substring(a,i.lastIndex-2),n.length>0&&o.push(n),a=i.lastIndex;var s=t[0][1];switch(s){case"s":case"o":r<arguments.length?o.push(arguments[r++ +1]):o.push("<?>");break;case"%":o.push("%");break;default:o.push("<%"+s+"?>")}}return o.push(e.substring(a)),o.join("")},c.formatNumber=function(e,t,n,i){var r=e,o=isNaN(t=Math.abs(t))?2:t,a=void 0===n?",":n,s=void 0===i?".":i,c=r<0?"-":"",l=parseInt(r=Math.abs(+r||0).toFixed(o),10)+"",u=l.length>3?l.length%3:0;return c+(u?l.substr(0,u)+s:"")+l.substr(u).replace(/(\d{3})(?=\d)/g,"$1"+s)+(o?a+Math.abs(r-l).toFixed(o).slice(2):"")},c.formatSize=function(e){return e=e>=1073741824?c.formatNumber(e/1073741824,2,".","")+" GiB":e>=1048576?c.formatNumber(e/1048576,2,".","")+" MiB":e>=1024?c.formatNumber(e/1024,0)+" KiB":c.formatNumber(e,0)+" bytes"},c.bytesFromIP=function(e){return e.indexOf(".")!==-1?c.bytesFromIPv4(e):e.indexOf(":")!==-1?c.bytesFromIPv6(e):null},c.bytesFromIPv4=function(e){if(e=e.split("."),4!==e.length)return null;for(var t=c.createBuffer(),n=0;n<e.length;++n){var i=parseInt(e[n],10);if(isNaN(i))return null;t.putByte(i)}return t.getBytes()},c.bytesFromIPv6=function(e){var t=0;e=e.split(":").filter(function(e){return 0===e.length&&++t,!0});for(var n=2*(8-e.length+t),i=c.createBuffer(),r=0;r<8;++r)if(e[r]&&0!==e[r].length){var o=c.hexToBytes(e[r]);o.length<2&&i.putByte(0),i.putBytes(o)}else i.fillWithByte(0,n),n=0;return i.getBytes()},c.bytesToIP=function(e){return 4===e.length?c.bytesToIPv4(e):16===e.length?c.bytesToIPv6(e):null},c.bytesToIPv4=function(e){if(4!==e.length)return null;for(var t=[],n=0;n<e.length;++n)t.push(e.charCodeAt(n));return t.join(".")},c.bytesToIPv6=function(e){if(16!==e.length)return null;for(var t=[],n=[],i=0,r=0;r<e.length;r+=2){for(var o=c.bytesToHex(e[r]+e[r+1]);"0"===o[0]&&"0"!==o;)o=o.substr(1);if("0"===o){var a=n[n.length-1],s=t.length;a&&s===a.end+1?(a.end=s,a.end-a.start>n[i].end-n[i].start&&(i=n.length-1)):n.push({start:s,end:s})}t.push(o)}if(n.length>0){var l=n[i];l.end-l.start>0&&(t.splice(l.start,l.end-l.start+1,""),0===l.start&&t.unshift(""),7===l.end&&t.push(""))}return t.join(":")},c.estimateCores=function(e,t){function n(e,a,s){if(0===a){var l=Math.floor(e.reduce(function(e,t){return e+t},0)/e.length);return c.cores=Math.max(1,l),URL.revokeObjectURL(o),t(null,c.cores)}i(s,function(t,i){e.push(r(s,i)),n(e,a-1,s)})}function i(e,t){for(var n=[],i=[],r=0;r<e;++r){var a=new Worker(o);a.addEventListener("message",function(r){if(i.push(r.data),i.length===e){for(var o=0;o<e;++o)n[o].terminate();t(null,i)}}),n.push(a)}for(var r=0;r<e;++r)n[r].postMessage(r)}function r(e,t){for(var n=[],i=0;i<e;++i)for(var r=t[i],o=n[i]=[],a=0;a<e;++a)if(i!==a){var s=t[a];(r.st>s.st&&r.st<s.et||s.st>r.st&&s.st<r.et)&&o.push(a)}return n.reduce(function(e,t){return Math.max(e,t.length)},0)}if("function"==typeof e&&(t=e,e={}),e=e||{},"cores"in c&&!e.update)return t(null,c.cores);if("undefined"!=typeof navigator&&"hardwareConcurrency"in navigator&&navigator.hardwareConcurrency>0)return c.cores=navigator.hardwareConcurrency,t(null,c.cores);if("undefined"==typeof Worker)return c.cores=1,t(null,c.cores);if("undefined"==typeof Blob)return c.cores=2,t(null,c.cores);var o=URL.createObjectURL(new Blob(["(",function(){self.addEventListener("message",function(e){for(var t=Date.now(),n=t+4;Date.now()<n;);self.postMessage({st:t,et:n})})}.toString(),")()"],{type:"application/javascript"}));n([],5,16)}}).call(this,n(6))},function(e,t,n){var i=n(0);e.exports=i.md=i.md||{},i.md.algorithms=i.md.algorithms||{}},function(e,t,n){n(4),n(9),n(10),e.exports=n(0)},function(e,t,n){function i(e,t){var n=function(){return new c.aes.Algorithm(e,t)};c.cipher.registerAlgorithm(e,n)}function r(){f=!0,d=[0,1,2,4,8,16,32,64,128,27,54];for(var e=new Array(256),t=0;t<128;++t)e[t]=t<<1,e[t+128]=t+128<<1^283;l=new Array(256),u=new Array(256),p=new Array(4),h=new Array(4);for(var t=0;t<4;++t)p[t]=new Array(256),h[t]=new Array(256);for(var n,i,r,o,a,s,c,g=0,m=0,t=0;t<256;++t){o=m^m<<1^m<<2^m<<3^m<<4,o=o>>8^255&o^99,l[g]=o,u[o]=g,a=e[o],n=e[g],i=e[n],r=e[i],s=a<<24^o<<16^o<<8^(o^a),c=(n^i^r)<<24^(g^r)<<16^(g^i^r)<<8^(g^n^r);for(var v=0;v<4;++v)p[v][g]=s,h[v][o]=c,s=s<<24|s>>>8,c=c<<24|c>>>8;0===g?g=m=1:(g=n^e[e[e[n^r]]],m^=e[e[m]])}}function o(e,t){for(var n,i=e.slice(0),r=1,o=i.length,a=o+6+1,s=g*a,c=o;c<s;++c)n=i[c-1],c%o===0?(n=l[n>>>16&255]<<24^l[n>>>8&255]<<16^l[255&n]<<8^l[n>>>24]^d[r]<<24,r++):o>6&&c%o===4&&(n=l[n>>>24]<<24^l[n>>>16&255]<<16^l[n>>>8&255]<<8^l[255&n]),i[c]=i[c-o]^n;if(t){var u,p=h[0],f=h[1],m=h[2],v=h[3],y=i.slice(0);s=i.length;for(var c=0,b=s-g;c<s;c+=g,b-=g)if(0===c||c===s-g)y[c]=i[b],y[c+1]=i[b+3],y[c+2]=i[b+2],y[c+3]=i[b+1];else for(var _=0;_<g;++_)u=i[b+_],y[c+(3&-_)]=p[l[u>>>24]]^f[l[u>>>16&255]]^m[l[u>>>8&255]]^v[l[255&u]];i=y}return i}function a(e,t,n,i){var r,o,a,s,c,d=e.length/4-1;i?(r=h[0],o=h[1],a=h[2],s=h[3],c=u):(r=p[0],o=p[1],a=p[2],s=p[3],c=l);var f,g,m,v,y,b,_;f=t[0]^e[0],g=t[i?3:1]^e[1],m=t[2]^e[2],v=t[i?1:3]^e[3];for(var x=3,w=1;w<d;++w)y=r[f>>>24]^o[g>>>16&255]^a[m>>>8&255]^s[255&v]^e[++x],b=r[g>>>24]^o[m>>>16&255]^a[v>>>8&255]^s[255&f]^e[++x],_=r[m>>>24]^o[v>>>16&255]^a[f>>>8&255]^s[255&g]^e[++x],v=r[v>>>24]^o[f>>>16&255]^a[g>>>8&255]^s[255&m]^e[++x],f=y,g=b,m=_;n[0]=c[f>>>24]<<24^c[g>>>16&255]<<16^c[m>>>8&255]<<8^c[255&v]^e[++x],n[i?3:1]=c[g>>>24]<<24^c[m>>>16&255]<<16^c[v>>>8&255]<<8^c[255&f]^e[++x],n[2]=c[m>>>24]<<24^c[v>>>16&255]<<16^c[f>>>8&255]<<8^c[255&g]^e[++x],n[i?1:3]=c[v>>>24]<<24^c[f>>>16&255]<<16^c[g>>>8&255]<<8^c[255&m]^e[++x]}function s(e){e=e||{};var t,n=(e.mode||"CBC").toUpperCase(),i="AES-"+n;t=e.decrypt?c.cipher.createDecipher(i,e.key):c.cipher.createCipher(i,e.key);var r=t.start;return t.start=function(e,n){var i=null;n instanceof c.util.ByteBuffer&&(i=n,n={}),n=n||{},n.output=i,n.iv=e,r.call(t,n)},t}var c=n(0);n(5),n(8),n(1),e.exports=c.aes=c.aes||{},c.aes.startEncrypting=function(e,t,n,i){var r=s({key:e,output:n,decrypt:!1,mode:i});return r.start(t),r},c.aes.createEncryptionCipher=function(e,t){return s({key:e,output:null,decrypt:!1,mode:t})},c.aes.startDecrypting=function(e,t,n,i){var r=s({key:e,output:n,decrypt:!0,mode:i});return r.start(t),r},c.aes.createDecryptionCipher=function(e,t){return s({key:e,output:null,decrypt:!0,mode:t})},c.aes.Algorithm=function(e,t){f||r();var n=this;n.name=e,n.mode=new t({blockSize:16,cipher:{encrypt:function(e,t){return a(n._w,e,t,!1)},decrypt:function(e,t){return a(n._w,e,t,!0)}}}),n._init=!1},c.aes.Algorithm.prototype.initialize=function(e){if(!this._init){var t,n=e.key;if("string"!=typeof n||16!==n.length&&24!==n.length&&32!==n.length){if(c.util.isArray(n)&&(16===n.length||24===n.length||32===n.length)){t=n,n=c.util.createBuffer();for(var i=0;i<t.length;++i)n.putByte(t[i])}}else n=c.util.createBuffer(n);if(!c.util.isArray(n)){t=n,n=[];var r=t.length();if(16===r||24===r||32===r){r>>>=2;for(var i=0;i<r;++i)n.push(t.getInt32())}}if(!c.util.isArray(n)||4!==n.length&&6!==n.length&&8!==n.length)throw new Error("Invalid key parameter.");var a=this.mode.name,s=["CFB","OFB","CTR","GCM"].indexOf(a)!==-1;this._w=o(n,e.decrypt&&!s),this._init=!0}},c.aes._expandKey=function(e,t){return f||r(),o(e,t)},c.aes._updateBlock=a,i("AES-ECB",c.cipher.modes.ecb),i("AES-CBC",c.cipher.modes.cbc),i("AES-CFB",c.cipher.modes.cfb),i("AES-OFB",c.cipher.modes.ofb),i("AES-CTR",c.cipher.modes.ctr),i("AES-GCM",c.cipher.modes.gcm);var l,u,d,p,h,f=!1,g=4},function(e,t,n){var i=n(0);n(1),e.exports=i.cipher=i.cipher||{},i.cipher.algorithms=i.cipher.algorithms||{},i.cipher.createCipher=function(e,t){var n=e;if("string"==typeof n&&(n=i.cipher.getAlgorithm(n),n&&(n=n())),!n)throw new Error("Unsupported algorithm: "+e);return new i.cipher.BlockCipher({algorithm:n,key:t,decrypt:!1})},i.cipher.createDecipher=function(e,t){var n=e;if("string"==typeof n&&(n=i.cipher.getAlgorithm(n),n&&(n=n())),!n)throw new Error("Unsupported algorithm: "+e);return new i.cipher.BlockCipher({algorithm:n,key:t,decrypt:!0})},i.cipher.registerAlgorithm=function(e,t){e=e.toUpperCase(),i.cipher.algorithms[e]=t},i.cipher.getAlgorithm=function(e){return e=e.toUpperCase(),e in i.cipher.algorithms?i.cipher.algorithms[e]:null};var r=i.cipher.BlockCipher=function(e){this.algorithm=e.algorithm,this.mode=this.algorithm.mode,this.blockSize=this.mode.blockSize,this._finish=!1,this._input=null,this.output=null,this._op=e.decrypt?this.mode.decrypt:this.mode.encrypt,this._decrypt=e.decrypt,this.algorithm.initialize(e)};r.prototype.start=function(e){e=e||{};var t={};for(var n in e)t[n]=e[n];t.decrypt=this._decrypt,this._finish=!1,this._input=i.util.createBuffer(),this.output=e.output||i.util.createBuffer(),this.mode.start(t)},r.prototype.update=function(e){for(e&&this._input.putBuffer(e);!this._op.call(this.mode,this._input,this.output,this._finish)&&!this._finish;);this._input.compact()},r.prototype.finish=function(e){!e||"ECB"!==this.mode.name&&"CBC"!==this.mode.name||(this.mode.pad=function(t){return e(this.blockSize,t,!1)},this.mode.unpad=function(t){return e(this.blockSize,t,!0)});var t={};return t.decrypt=this._decrypt,t.overflow=this._input.length()%this.blockSize,!(!this._decrypt&&this.mode.pad&&!this.mode.pad(this._input,t))&&(this._finish=!0,this.update(),!(this._decrypt&&this.mode.unpad&&!this.mode.unpad(this.output,t))&&!(this.mode.afterFinish&&!this.mode.afterFinish(this.output,t)))}},function(e,t){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(i){"object"==typeof window&&(n=window)}e.exports=n},function(e,t){function n(e,t){var n=0,i=t.length,r=t.charAt(0),o=[0];for(n=0;n<e.length();++n){for(var a=0,s=e.at(n);a<o.length;++a)s+=o[a]<<8,o[a]=s%i,s=s/i|0;for(;s>0;)o.push(s%i),s=s/i|0}var c="";for(n=0;0===e.at(n)&&n<e.length()-1;++n)c+=r;for(n=o.length-1;n>=0;--n)c+=t[o[n]];return c}var i={};e.exports=i;var r={};i.encode=function(e,t,i){if("string"!=typeof t)throw new TypeError('"alphabet" must be a string.');if(void 0!==i&&"number"!=typeof i)throw new TypeError('"maxline" must be a number.');var r="";if(e instanceof Uint8Array){var o=0,a=t.length,s=t.charAt(0),c=[0];for(o=0;o<e.length;++o){for(var l=0,u=e[o];l<c.length;++l)u+=c[l]<<8,c[l]=u%a,u=u/a|0;for(;u>0;)c.push(u%a),u=u/a|0}for(o=0;0===e[o]&&o<e.length-1;++o)r+=s;for(o=c.length-1;o>=0;--o)r+=t[c[o]]}else r=n(e,t);if(i){var d=new RegExp(".{1,"+i+"}","g");r=r.match(d).join("\r\n")}return r},i.decode=function(e,t){if("string"!=typeof e)throw new TypeError('"input" must be a string.');if("string"!=typeof t)throw new TypeError('"alphabet" must be a string.');var n=r[t];if(!n){n=r[t]=[];for(var i=0;i<t.length;++i)n[t.charCodeAt(i)]=i}e=e.replace(/\s/g,"");for(var o=t.length,a=t.charAt(0),s=[0],i=0;i<e.length;i++){var c=n[e.charCodeAt(i)];if(void 0===c)return;for(var l=0,u=c;l<s.length;++l)u+=s[l]*o,s[l]=255&u,u>>=8;for(;u>0;)s.push(255&u),u>>=8}for(var d=0;e[d]===a&&d<e.length-1;++d)s.push(0);return"undefined"!=typeof Buffer?Buffer.from(s.reverse()):new Uint8Array(s.reverse())}},function(e,t,n){function i(e,t){if("string"==typeof e&&(e=a.util.createBuffer(e)),a.util.isArray(e)&&e.length>4){var n=e;e=a.util.createBuffer();for(var i=0;i<n.length;++i)e.putByte(n[i])}if(e.length()<t)throw new Error("Invalid IV length; got "+e.length()+" bytes and expected "+t+" bytes.");if(!a.util.isArray(e)){for(var r=[],o=t/4,i=0;i<o;++i)r.push(e.getInt32());e=r}return e}function r(e){e[e.length-1]=e[e.length-1]+1&4294967295}function o(e){return[e/4294967296|0,4294967295&e]}var a=n(0);n(1),a.cipher=a.cipher||{};var s=e.exports=a.cipher.modes=a.cipher.modes||{};s.ecb=function(e){e=e||{},this.name="ECB",this.cipher=e.cipher,this.blockSize=e.blockSize||16,this._ints=this.blockSize/4,this._inBlock=new Array(this._ints),this._outBlock=new Array(this._ints)},s.ecb.prototype.start=function(e){},s.ecb.prototype.encrypt=function(e,t,n){if(e.length()<this.blockSize&&!(n&&e.length()>0))return!0;for(var i=0;i<this._ints;++i)this._inBlock[i]=e.getInt32();this.cipher.encrypt(this._inBlock,this._outBlock);for(var i=0;i<this._ints;++i)t.putInt32(this._outBlock[i])},s.ecb.prototype.decrypt=function(e,t,n){if(e.length()<this.blockSize&&!(n&&e.length()>0))return!0;for(var i=0;i<this._ints;++i)this._inBlock[i]=e.getInt32();this.cipher.decrypt(this._inBlock,this._outBlock);for(var i=0;i<this._ints;++i)t.putInt32(this._outBlock[i])},s.ecb.prototype.pad=function(e,t){var n=e.length()===this.blockSize?this.blockSize:this.blockSize-e.length();return e.fillWithByte(n,n),!0},s.ecb.prototype.unpad=function(e,t){if(t.overflow>0)return!1;var n=e.length(),i=e.at(n-1);return!(i>this.blockSize<<2)&&(e.truncate(i),!0)},s.cbc=function(e){e=e||{},this.name="CBC",this.cipher=e.cipher,this.blockSize=e.blockSize||16,this._ints=this.blockSize/4,this._inBlock=new Array(this._ints),this._outBlock=new Array(this._ints)},s.cbc.prototype.start=function(e){if(null===e.iv){if(!this._prev)throw new Error("Invalid IV parameter.");this._iv=this._prev.slice(0)}else{if(!("iv"in e))throw new Error("Invalid IV parameter.");this._iv=i(e.iv,this.blockSize),this._prev=this._iv.slice(0)}},s.cbc.prototype.encrypt=function(e,t,n){if(e.length()<this.blockSize&&!(n&&e.length()>0))return!0;for(var i=0;i<this._ints;++i)this._inBlock[i]=this._prev[i]^e.getInt32();this.cipher.encrypt(this._inBlock,this._outBlock);for(var i=0;i<this._ints;++i)t.putInt32(this._outBlock[i]);this._prev=this._outBlock},s.cbc.prototype.decrypt=function(e,t,n){if(e.length()<this.blockSize&&!(n&&e.length()>0))return!0;for(var i=0;i<this._ints;++i)this._inBlock[i]=e.getInt32();this.cipher.decrypt(this._inBlock,this._outBlock);for(var i=0;i<this._ints;++i)t.putInt32(this._prev[i]^this._outBlock[i]);this._prev=this._inBlock.slice(0)},s.cbc.prototype.pad=function(e,t){var n=e.length()===this.blockSize?this.blockSize:this.blockSize-e.length();return e.fillWithByte(n,n),!0},s.cbc.prototype.unpad=function(e,t){if(t.overflow>0)return!1;var n=e.length(),i=e.at(n-1);return!(i>this.blockSize<<2)&&(e.truncate(i),!0)},s.cfb=function(e){e=e||{},this.name="CFB",this.cipher=e.cipher,this.blockSize=e.blockSize||16,this._ints=this.blockSize/4,this._inBlock=null,this._outBlock=new Array(this._ints),this._partialBlock=new Array(this._ints),this._partialOutput=a.util.createBuffer(),this._partialBytes=0},s.cfb.prototype.start=function(e){if(!("iv"in e))throw new Error("Invalid IV parameter.");this._iv=i(e.iv,this.blockSize),this._inBlock=this._iv.slice(0),this._partialBytes=0},s.cfb.prototype.encrypt=function(e,t,n){var i=e.length();if(0===i)return!0;if(this.cipher.encrypt(this._inBlock,this._outBlock),0===this._partialBytes&&i>=this.blockSize)for(var r=0;r<this._ints;++r)this._inBlock[r]=e.getInt32()^this._outBlock[r],t.putInt32(this._inBlock[r]);else{var o=(this.blockSize-i)%this.blockSize;o>0&&(o=this.blockSize-o),this._partialOutput.clear();for(var r=0;r<this._ints;++r)this._partialBlock[r]=e.getInt32()^this._outBlock[r],this._partialOutput.putInt32(this._partialBlock[r]);if(o>0)e.read-=this.blockSize;else for(var r=0;r<this._ints;++r)this._inBlock[r]=this._partialBlock[r];if(this._partialBytes>0&&this._partialOutput.getBytes(this._partialBytes),o>0&&!n)return t.putBytes(this._partialOutput.getBytes(o-this._partialBytes)),this._partialBytes=o,!0;t.putBytes(this._partialOutput.getBytes(i-this._partialBytes)),this._partialBytes=0}},s.cfb.prototype.decrypt=function(e,t,n){var i=e.length();if(0===i)return!0;if(this.cipher.encrypt(this._inBlock,this._outBlock),0===this._partialBytes&&i>=this.blockSize)for(var r=0;r<this._ints;++r)this._inBlock[r]=e.getInt32(),t.putInt32(this._inBlock[r]^this._outBlock[r]);else{var o=(this.blockSize-i)%this.blockSize;o>0&&(o=this.blockSize-o),this._partialOutput.clear();for(var r=0;r<this._ints;++r)this._partialBlock[r]=e.getInt32(),this._partialOutput.putInt32(this._partialBlock[r]^this._outBlock[r]);if(o>0)e.read-=this.blockSize;else for(var r=0;r<this._ints;++r)this._inBlock[r]=this._partialBlock[r];if(this._partialBytes>0&&this._partialOutput.getBytes(this._partialBytes),o>0&&!n)return t.putBytes(this._partialOutput.getBytes(o-this._partialBytes)),this._partialBytes=o,!0;t.putBytes(this._partialOutput.getBytes(i-this._partialBytes)),this._partialBytes=0}},s.ofb=function(e){e=e||{},this.name="OFB",this.cipher=e.cipher,this.blockSize=e.blockSize||16,this._ints=this.blockSize/4,this._inBlock=null,this._outBlock=new Array(this._ints),this._partialOutput=a.util.createBuffer(),this._partialBytes=0},s.ofb.prototype.start=function(e){if(!("iv"in e))throw new Error("Invalid IV parameter.");this._iv=i(e.iv,this.blockSize),this._inBlock=this._iv.slice(0),this._partialBytes=0},s.ofb.prototype.encrypt=function(e,t,n){var i=e.length();if(0===e.length())return!0;if(this.cipher.encrypt(this._inBlock,this._outBlock),0===this._partialBytes&&i>=this.blockSize)for(var r=0;r<this._ints;++r)t.putInt32(e.getInt32()^this._outBlock[r]),this._inBlock[r]=this._outBlock[r];else{var o=(this.blockSize-i)%this.blockSize;o>0&&(o=this.blockSize-o),this._partialOutput.clear();for(var r=0;r<this._ints;++r)this._partialOutput.putInt32(e.getInt32()^this._outBlock[r]);if(o>0)e.read-=this.blockSize;else for(var r=0;r<this._ints;++r)this._inBlock[r]=this._outBlock[r];if(this._partialBytes>0&&this._partialOutput.getBytes(this._partialBytes),o>0&&!n)return t.putBytes(this._partialOutput.getBytes(o-this._partialBytes)),this._partialBytes=o,!0;t.putBytes(this._partialOutput.getBytes(i-this._partialBytes)),this._partialBytes=0}},s.ofb.prototype.decrypt=s.ofb.prototype.encrypt,s.ctr=function(e){e=e||{},this.name="CTR",this.cipher=e.cipher,this.blockSize=e.blockSize||16,this._ints=this.blockSize/4,this._inBlock=null,this._outBlock=new Array(this._ints),this._partialOutput=a.util.createBuffer(),this._partialBytes=0},s.ctr.prototype.start=function(e){if(!("iv"in e))throw new Error("Invalid IV parameter.");this._iv=i(e.iv,this.blockSize),this._inBlock=this._iv.slice(0),this._partialBytes=0},s.ctr.prototype.encrypt=function(e,t,n){var i=e.length();if(0===i)return!0;if(this.cipher.encrypt(this._inBlock,this._outBlock),0===this._partialBytes&&i>=this.blockSize)for(var o=0;o<this._ints;++o)t.putInt32(e.getInt32()^this._outBlock[o]);else{var a=(this.blockSize-i)%this.blockSize;a>0&&(a=this.blockSize-a),this._partialOutput.clear();for(var o=0;o<this._ints;++o)this._partialOutput.putInt32(e.getInt32()^this._outBlock[o]);if(a>0&&(e.read-=this.blockSize),this._partialBytes>0&&this._partialOutput.getBytes(this._partialBytes),a>0&&!n)return t.putBytes(this._partialOutput.getBytes(a-this._partialBytes)),this._partialBytes=a,!0;t.putBytes(this._partialOutput.getBytes(i-this._partialBytes)),this._partialBytes=0}r(this._inBlock)},s.ctr.prototype.decrypt=s.ctr.prototype.encrypt,s.gcm=function(e){e=e||{},this.name="GCM",this.cipher=e.cipher,this.blockSize=e.blockSize||16,this._ints=this.blockSize/4,this._inBlock=new Array(this._ints),this._outBlock=new Array(this._ints),this._partialOutput=a.util.createBuffer(),this._partialBytes=0,this._R=3774873600},s.gcm.prototype.start=function(e){if(!("iv"in e))throw new Error("Invalid IV parameter.");var t=a.util.createBuffer(e.iv);this._cipherLength=0;var n;if(n="additionalData"in e?a.util.createBuffer(e.additionalData):a.util.createBuffer(),"tagLength"in e?this._tagLength=e.tagLength:this._tagLength=128,this._tag=null,e.decrypt&&(this._tag=a.util.createBuffer(e.tag).getBytes(),this._tag.length!==this._tagLength/8))throw new Error("Authentication tag does not match tag length.");this._hashBlock=new Array(this._ints),this.tag=null,this._hashSubkey=new Array(this._ints),this.cipher.encrypt([0,0,0,0],this._hashSubkey),this.componentBits=4,this._m=this.generateHashTable(this._hashSubkey,this.componentBits);var i=t.length();if(12===i)this._j0=[t.getInt32(),t.getInt32(),t.getInt32(),1];else{for(this._j0=[0,0,0,0];t.length()>0;)this._j0=this.ghash(this._hashSubkey,this._j0,[t.getInt32(),t.getInt32(),t.getInt32(),t.getInt32()]);this._j0=this.ghash(this._hashSubkey,this._j0,[0,0].concat(o(8*i)))}this._inBlock=this._j0.slice(0),r(this._inBlock),this._partialBytes=0,n=a.util.createBuffer(n),this._aDataLength=o(8*n.length());var s=n.length()%this.blockSize;for(s&&n.fillWithByte(0,this.blockSize-s),this._s=[0,0,0,0];n.length()>0;)this._s=this.ghash(this._hashSubkey,this._s,[n.getInt32(),n.getInt32(),n.getInt32(),n.getInt32()])},s.gcm.prototype.encrypt=function(e,t,n){var i=e.length();if(0===i)return!0;if(this.cipher.encrypt(this._inBlock,this._outBlock),0===this._partialBytes&&i>=this.blockSize){
for(var o=0;o<this._ints;++o)t.putInt32(this._outBlock[o]^=e.getInt32());this._cipherLength+=this.blockSize}else{var a=(this.blockSize-i)%this.blockSize;a>0&&(a=this.blockSize-a),this._partialOutput.clear();for(var o=0;o<this._ints;++o)this._partialOutput.putInt32(e.getInt32()^this._outBlock[o]);if(a<=0||n){if(n){var s=i%this.blockSize;this._cipherLength+=s,this._partialOutput.truncate(this.blockSize-s)}else this._cipherLength+=this.blockSize;for(var o=0;o<this._ints;++o)this._outBlock[o]=this._partialOutput.getInt32();this._partialOutput.read-=this.blockSize}if(this._partialBytes>0&&this._partialOutput.getBytes(this._partialBytes),a>0&&!n)return e.read-=this.blockSize,t.putBytes(this._partialOutput.getBytes(a-this._partialBytes)),this._partialBytes=a,!0;t.putBytes(this._partialOutput.getBytes(i-this._partialBytes)),this._partialBytes=0}this._s=this.ghash(this._hashSubkey,this._s,this._outBlock),r(this._inBlock)},s.gcm.prototype.decrypt=function(e,t,n){var i=e.length();if(i<this.blockSize&&!(n&&i>0))return!0;this.cipher.encrypt(this._inBlock,this._outBlock),r(this._inBlock),this._hashBlock[0]=e.getInt32(),this._hashBlock[1]=e.getInt32(),this._hashBlock[2]=e.getInt32(),this._hashBlock[3]=e.getInt32(),this._s=this.ghash(this._hashSubkey,this._s,this._hashBlock);for(var o=0;o<this._ints;++o)t.putInt32(this._outBlock[o]^this._hashBlock[o]);i<this.blockSize?this._cipherLength+=i%this.blockSize:this._cipherLength+=this.blockSize},s.gcm.prototype.afterFinish=function(e,t){var n=!0;t.decrypt&&t.overflow&&e.truncate(this.blockSize-t.overflow),this.tag=a.util.createBuffer();var i=this._aDataLength.concat(o(8*this._cipherLength));this._s=this.ghash(this._hashSubkey,this._s,i);var r=[];this.cipher.encrypt(this._j0,r);for(var s=0;s<this._ints;++s)this.tag.putInt32(this._s[s]^r[s]);return this.tag.truncate(this.tag.length()%(this._tagLength/8)),t.decrypt&&this.tag.bytes()!==this._tag&&(n=!1),n},s.gcm.prototype.multiply=function(e,t){for(var n=[0,0,0,0],i=t.slice(0),r=0;r<128;++r){var o=e[r/32|0]&1<<31-r%32;o&&(n[0]^=i[0],n[1]^=i[1],n[2]^=i[2],n[3]^=i[3]),this.pow(i,i)}return n},s.gcm.prototype.pow=function(e,t){for(var n=1&e[3],i=3;i>0;--i)t[i]=e[i]>>>1|(1&e[i-1])<<31;t[0]=e[0]>>>1,n&&(t[0]^=this._R)},s.gcm.prototype.tableMultiply=function(e){for(var t=[0,0,0,0],n=0;n<32;++n){var i=n/8|0,r=e[i]>>>4*(7-n%8)&15,o=this._m[n][r];t[0]^=o[0],t[1]^=o[1],t[2]^=o[2],t[3]^=o[3]}return t},s.gcm.prototype.ghash=function(e,t,n){return t[0]^=n[0],t[1]^=n[1],t[2]^=n[2],t[3]^=n[3],this.tableMultiply(t)},s.gcm.prototype.generateHashTable=function(e,t){for(var n=8/t,i=4*n,r=16*n,o=new Array(r),a=0;a<r;++a){var s=[0,0,0,0],c=a/i|0,l=(i-1-a%i)*t;s[c]=1<<t-1<<l,o[a]=this.generateSubHashTable(this.multiply(s,e),t)}return o},s.gcm.prototype.generateSubHashTable=function(e,t){var n=1<<t,i=n>>>1,r=new Array(n);r[i]=e.slice(0);for(var o=i>>>1;o>0;)this.pow(r[2*o],r[o]=[]),o>>=1;for(o=2;o<i;){for(var a=1;a<o;++a){var s=r[o],c=r[a];r[o+a]=[s[0]^c[0],s[1]^c[1],s[2]^c[2],s[3]^c[3]]}o*=2}for(r[0]=[0,0,0,0],o=i+1;o<n;++o){var l=r[o^i];r[o]=[e[0]^l[0],e[1]^l[1],e[2]^l[2],e[3]^l[3]]}return r}},function(e,t,n){function i(){s=String.fromCharCode(128),s+=o.util.fillString(String.fromCharCode(0),64),c=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,1,6,11,0,5,10,15,4,9,14,3,8,13,2,7,12,5,8,11,14,1,4,7,10,13,0,3,6,9,12,15,2,0,7,14,5,12,3,10,1,8,15,6,13,4,11,2,9],l=[7,12,17,22,7,12,17,22,7,12,17,22,7,12,17,22,5,9,14,20,5,9,14,20,5,9,14,20,5,9,14,20,4,11,16,23,4,11,16,23,4,11,16,23,4,11,16,23,6,10,15,21,6,10,15,21,6,10,15,21,6,10,15,21],u=new Array(64);for(var e=0;e<64;++e)u[e]=Math.floor(4294967296*Math.abs(Math.sin(e+1)));d=!0}function r(e,t,n){for(var i,r,o,a,s,d,p,h,f=n.length();f>=64;){for(r=e.h0,o=e.h1,a=e.h2,s=e.h3,h=0;h<16;++h)t[h]=n.getInt32Le(),d=s^o&(a^s),i=r+d+u[h]+t[h],p=l[h],r=s,s=a,a=o,o+=i<<p|i>>>32-p;for(;h<32;++h)d=a^s&(o^a),i=r+d+u[h]+t[c[h]],p=l[h],r=s,s=a,a=o,o+=i<<p|i>>>32-p;for(;h<48;++h)d=o^a^s,i=r+d+u[h]+t[c[h]],p=l[h],r=s,s=a,a=o,o+=i<<p|i>>>32-p;for(;h<64;++h)d=a^(o|~s),i=r+d+u[h]+t[c[h]],p=l[h],r=s,s=a,a=o,o+=i<<p|i>>>32-p;e.h0=e.h0+r|0,e.h1=e.h1+o|0,e.h2=e.h2+a|0,e.h3=e.h3+s|0,f-=64}}var o=n(0);n(2),n(1);var a=e.exports=o.md5=o.md5||{};o.md.md5=o.md.algorithms.md5=a,a.create=function(){d||i();var e=null,t=o.util.createBuffer(),n=new Array(16),a={algorithm:"md5",blockLength:64,digestLength:16,messageLength:0,fullMessageLength:null,messageLengthSize:8};return a.start=function(){a.messageLength=0,a.fullMessageLength=a.messageLength64=[];for(var n=a.messageLengthSize/4,i=0;i<n;++i)a.fullMessageLength.push(0);return t=o.util.createBuffer(),e={h0:1732584193,h1:4023233417,h2:2562383102,h3:271733878},a},a.start(),a.update=function(i,s){"utf8"===s&&(i=o.util.encodeUtf8(i));var c=i.length;a.messageLength+=c,c=[c/4294967296>>>0,c>>>0];for(var l=a.fullMessageLength.length-1;l>=0;--l)a.fullMessageLength[l]+=c[1],c[1]=c[0]+(a.fullMessageLength[l]/4294967296>>>0),a.fullMessageLength[l]=a.fullMessageLength[l]>>>0,c[0]=c[1]/4294967296>>>0;return t.putBytes(i),r(e,n,t),(t.read>2048||0===t.length())&&t.compact(),a},a.digest=function(){var i=o.util.createBuffer();i.putBytes(t.bytes());var c=a.fullMessageLength[a.fullMessageLength.length-1]+a.messageLengthSize,l=c&a.blockLength-1;i.putBytes(s.substr(0,a.blockLength-l));for(var u,d=0,p=a.fullMessageLength.length-1;p>=0;--p)u=8*a.fullMessageLength[p]+d,d=u/4294967296>>>0,i.putInt32Le(u>>>0);var h={h0:e.h0,h1:e.h1,h2:e.h2,h3:e.h3};r(h,n,i);var f=o.util.createBuffer();return f.putInt32Le(h.h0),f.putInt32Le(h.h1),f.putInt32Le(h.h2),f.putInt32Le(h.h3),f},a};var s=null,c=null,l=null,u=null,d=!1},function(e,t,n){function i(){s=String.fromCharCode(128),s+=o.util.fillString(String.fromCharCode(0),64),l=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298],c=!0}function r(e,t,n){for(var i,r,o,a,s,c,u,d,p,h,f,g,m,v,y,b=n.length();b>=64;){for(u=0;u<16;++u)t[u]=n.getInt32();for(;u<64;++u)i=t[u-2],i=(i>>>17|i<<15)^(i>>>19|i<<13)^i>>>10,r=t[u-15],r=(r>>>7|r<<25)^(r>>>18|r<<14)^r>>>3,t[u]=i+t[u-7]+r+t[u-16]|0;for(d=e.h0,p=e.h1,h=e.h2,f=e.h3,g=e.h4,m=e.h5,v=e.h6,y=e.h7,u=0;u<64;++u)a=(g>>>6|g<<26)^(g>>>11|g<<21)^(g>>>25|g<<7),s=v^g&(m^v),o=(d>>>2|d<<30)^(d>>>13|d<<19)^(d>>>22|d<<10),c=d&p|h&(d^p),i=y+a+s+l[u]+t[u],r=o+c,y=v,v=m,m=g,g=f+i>>>0,f=h,h=p,p=d,d=i+r>>>0;e.h0=e.h0+d|0,e.h1=e.h1+p|0,e.h2=e.h2+h|0,e.h3=e.h3+f|0,e.h4=e.h4+g|0,e.h5=e.h5+m|0,e.h6=e.h6+v|0,e.h7=e.h7+y|0,b-=64}}var o=n(0);n(2),n(1);var a=e.exports=o.sha256=o.sha256||{};o.md.sha256=o.md.algorithms.sha256=a,a.create=function(){c||i();var e=null,t=o.util.createBuffer(),n=new Array(64),a={algorithm:"sha256",blockLength:64,digestLength:32,messageLength:0,fullMessageLength:null,messageLengthSize:8};return a.start=function(){a.messageLength=0,a.fullMessageLength=a.messageLength64=[];for(var n=a.messageLengthSize/4,i=0;i<n;++i)a.fullMessageLength.push(0);return t=o.util.createBuffer(),e={h0:1779033703,h1:3144134277,h2:1013904242,h3:2773480762,h4:1359893119,h5:2600822924,h6:528734635,h7:1541459225},a},a.start(),a.update=function(i,s){"utf8"===s&&(i=o.util.encodeUtf8(i));var c=i.length;a.messageLength+=c,c=[c/4294967296>>>0,c>>>0];for(var l=a.fullMessageLength.length-1;l>=0;--l)a.fullMessageLength[l]+=c[1],c[1]=c[0]+(a.fullMessageLength[l]/4294967296>>>0),a.fullMessageLength[l]=a.fullMessageLength[l]>>>0,c[0]=c[1]/4294967296>>>0;return t.putBytes(i),r(e,n,t),(t.read>2048||0===t.length())&&t.compact(),a},a.digest=function(){var i=o.util.createBuffer();i.putBytes(t.bytes());var c=a.fullMessageLength[a.fullMessageLength.length-1]+a.messageLengthSize,l=c&a.blockLength-1;i.putBytes(s.substr(0,a.blockLength-l));for(var u,d,p=8*a.fullMessageLength[0],h=0;h<a.fullMessageLength.length-1;++h)u=8*a.fullMessageLength[h+1],d=u/4294967296>>>0,p+=d,i.putInt32(p>>>0),p=u>>>0;i.putInt32(p);var f={h0:e.h0,h1:e.h1,h2:e.h2,h3:e.h3,h4:e.h4,h5:e.h5,h6:e.h6,h7:e.h7};r(f,n,i);var g=o.util.createBuffer();return g.putInt32(f.h0),g.putInt32(f.h1),g.putInt32(f.h2),g.putInt32(f.h3),g.putInt32(f.h4),g.putInt32(f.h5),g.putInt32(f.h6),g.putInt32(f.h7),g},a};var s=null,c=!1,l=null}])}),function(e){var t,n,i=navigator.userAgent.toLowerCase(),r=e.jQuery||e.zepto||r,o=0,a="UDESK_",s="/im_client/",c=s+"js/",l=s+"css/",u=[],d=["mp4","mov","MOV","m4v","M4V"],p=(t={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},t["'"]="&#39;",t['"']="&quot;",t["\n"]="<br/>",t),h=(n={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#x27;":"'","&#x60;":"`","&#39;":"'"},n["&quot;"]='"',n["<br/>"]="\n",n),f=e.udesk={$:r,rootPath:s,jsRootPath:c,cssRootPath:l,canVideoExts:d,id:function(){return a+ ++o},guid:function(e,t){return f.id()+"_"+(e||"")+ +new Date+(t?"*"+t:"")},ns:function(e,t){if(e){t=t||f;for(var n=e.split("."),i=0,r=n.length;i<r;i++)t=t[n[i]]=t[n[i]]||{}}},extend:function(){var e=this;r.each(arguments,function(){r.extend.call(e,this)})},replaceTpl:function(e,t,n){if(!e)return"";if(!t)return e;n=n||{};var i=n.xss,r=n.omitXss,o=e;"function"==typeof e&&(o=e(t,n));var a;t.moreHtml=t.moreHtml||"";for(var s in t)a=null===t[s]||void 0===t[s]?"":t[s],i?("*"===i||this.hasStr(i,s))&&(a=this.xss(a)):r&&(this.hasStr(r,s)||(a=this.xss(a))),o=o.replace(new RegExp("{"+s+"}","gm"),a);return o},hasStr:function(e,t){return(","+e+",").indexOf(","+t+",")>-1},ifIE:function(e,t){var n=document.createElement("b");return n.innerHTML="<!--[if "+(t||"")+" IE "+(e||"")+"]><i></i><![endif]-->",1===n.getElementsByTagName("i").length},_ifIE:function(){return i.indexOf("compatible")>-1&&i.indexOf("msie")>-1},isIE11:function(){return i.indexOf("trident")>-1&&i.indexOf("rv")>-1},isEdge:function(){var e=this._ifIE();return i.indexOf("edge")>-1&&!e},isAllIE:function(){return this._ifIE()||this.isIE11()||this.isEdge()},isEmptyObj:function(e){if(!e)return!1;for(var t in e)return!1;return!0},toArray:function(e){return Array.prototype.slice.call(e)||[]},isMiniProgram:function(){return/miniprogram/.test(navigator.userAgent)||"miniprogram"===window.__wxjs_environment},isWxWork:function(){return/wxwork/.test(navigator.userAgent)},platform:function(e){if(e){for(var t,n,r,o=new RegExp("(android|iphone|ipod|ios|ipad|webkit|windows phone|micromessenger|qq/|mqq|qqbrowser/|weibo|msie)","g");null!=(n=o.exec(i));)t=!0,r=n[1],e[r]&&e[r](r),e.ios&&/iphone|ipod|ipad/.test(r)&&e.ios(r),e.wp&&/windows phone/.test(r)&&e.wp(r),e.weixin&&/micromessenger/.test(r)&&e.weixin(r),e.mqq&&/mqq|qq\//.test(r)&&e.mqq(r),e.qq&&/qq\/|mqq|qqbrowser\//.test(r)&&e.qq(r),e.weibo&&/weibo/.test(r)&&e.weibo(r);!t&&e.others&&e.others()}},isTestENV:function(){var e=location.host;return/(ud|tiyanudesk|(udesk(.+)?)).com$/i.test(e)||/^localhost/.test(e)},isPC:function(){var e=!0;return this.platform({android:function(){e=!1},ios:function(){e=!1},wp:function(){e=!1}}),e},isMob:function(){return!this.isPC()},isIos:function(){var e=!1;return this.platform({ios:function(){e=!0}}),e},isAndroid:function(){var e=!1;return this.platform({android:function(){e=!0}}),e},isWeixin:function(){var e=!1;return this.platform({weixin:function(){e=!0}}),e},decrypt_username:function(e){try{var t=forge.util.hexToBytes(e.info),n=forge.md.sha256.create();n.update(e.id,"utf8");var i=n.digest().toHex().substring(0,32),r=forge.util.hexToBytes(e.random),o=forge.util.hexToBytes(e.tag),a=this.decryptAESGCM256(t,i,r,o);return e.username=a.split("#")[0],e.password=a.split("#")[1],e}catch(s){return console.log("Error Decrypt "+s),e}},decryptAESGCM256:function(e,t,n,i){if(!e)return"";try{var r=forge.cipher.createDecipher("AES-GCM",t);r.start({iv:n,additionalData:"UDESK_AES_GCM_AUTH_DATA",tagLength:128,tag:i}),r.update(forge.util.createBuffer(e));var o=r.finish();return o?r.output.getBytes():""}catch(a){return e}}};f.extend({notification:function(e,t,n){if(e=e||"ç³»ç»éç¥",n=n||{},window.Notification){if("granted"!=Notification.permission)return Notification.requestPermission();Notification.requestPermission(function(e){});var i=u.filter(function(e){return e.tag===n.messageId});if(!(i.length>0)){var r=new Notification(e,{body:t,icon:n.img||"/im_client/images/notification24.png",tag:n.messageId});if(n.url&&window.open(n.url),r.onclick=function(e){n.click&&n.click(e),r.close()},u.push(r),u.length>3){var o=u.shift();o.close()}}}},closeWindow:function(){var t=/qqbrowser/i,n="undefined"!=typeof WeixinJSBridge,r=function(e){try{e.opener=null,e.close()}catch(t){}};return n?WeixinJSBridge.call("closeWindow"):(r(e.top),void(t.test(i)||this.isMob()||(e.top.location.href="about:blank")))},decodeBase64:function(e){var t,n,i,r,o,a,s,c="",l=0,u="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";for(e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"");l<e.length;)r=u.indexOf(e.charAt(l++)),o=u.indexOf(e.charAt(l++)),a=u.indexOf(e.charAt(l++)),s=u.indexOf(e.charAt(l++)),t=r<<2|o>>4,n=(15&o)<<4|a>>2,i=(3&a)<<6|s,c+=String.fromCharCode(t),64!=a&&(c+=String.fromCharCode(n)),64!=s&&(c+=String.fromCharCode(i));return c=this._utf8_decode(c)},_utf8_decode:function(e){for(var t="",n=0,i=c1=c2=0;n<e.length;)i=e.charCodeAt(n),i<128?(t+=String.fromCharCode(i),n++):i>191&&i<224?(c2=e.charCodeAt(n+1),t+=String.fromCharCode((31&i)<<6|63&c2),n+=2):(c2=e.charCodeAt(n+1),c3=e.charCodeAt(n+2),t+=String.fromCharCode((15&i)<<12|(63&c2)<<6|63&c3),n+=3);return t},urlParams:function(t,n){var i="";if(n=n||{},t)if(n.isUrlStr){var o=document.createElement("a");o.href=t,i=o.search||t}else{var a=n.win?e[n.win]:e;i=a.location.search}else i=e.location.search;var s,c=location.host.indexOf("cpic01.s2.udesk.cn")>-1;if(0===i.indexOf("?ud$")&&c){var l=i.split("&"),u=l[0],d=decodeURIComponent(f.decodeBase64(u.split("?ud$")[1]));s=this.str2json("?"+d);var p=[];if(r.each(l,function(e,t){e>0&&p.push(t)}),p.length>0){var h=p.join("&"),g=this.str2json("?"+h);s=r.extend({},s,g)}}else s=this.str2json(i);return s},str2json:function(e){var t={},n=e.match(new RegExp("[?&][^?&]+=[^?&]+","g"));if(n)for(var i=0,r=n.length;i<r;i++){var o,a,s;try{o=n[i].substring(1).split("="),a=decodeURIComponent(o[0]),s=decodeURIComponent(o[1]),t[a]=s}catch(c){o&&o[0]&&(t[o[0]]=o[1]||"")}}return t},addNetworkListener:function(e){if(e){var t=[],n=2,i="images/emoji.png",r=0,o=function(){var o,a,s=new Date,c=document.createElement("img");c.src=i+"?"+s.getTime(),c.onload=function(){r=0,o=new Date,a=Math.round(1e3*n/(o-s)),t.push(a),e.success&&e.success(a,t)},c.onerror=function(){e.error&&e.error(++r)}};setInterval(o,e.interval||3e3)}},xss:function(e){if(e)for(var t in p)e=(e+"").replace(new RegExp(t,"g"),p[t]);return e||""},xssNotEnter:function(e){var t=r.extend({},p);if(delete t["\n"],e)for(var n in t)e=(e+"").replace(new RegExp(n,"g"),t[n]);return e||""},xssNotSymbol:function(e,t){var n=r.extend({},p);if(delete n[t],e)for(var i in n)e=(e+"").replace(new RegExp(i,"g"),n[i]);return e||""},unXssNotEnter:function(e){var t=r.extend({},h);if(delete t["<br/>"],e)for(var n in t)e=e.replace(new RegExp(n,"g"),t[n]);return e||""},unXss:function(e){if(e)for(var t in h)e=e.replace(new RegExp(t,"g"),h[t]);return e||""}}),f.extend({loader:{_cache:{},_toArr:function(e){return e?r.isArray(e)?e:[e]:[]},_js:function(e,t){var n=this;return t&&this._cache[e]?r.Deferred(function(e){r(e.resolve)}):r.getScript(e).then(function(t){return n._cache[e]=!0,t})},_css:function(e,t){if(!t||!this._cache[e]){var n=r("<link>");n.attr({rel:"stylesheet",type:"text/css",href:e}),r("head").append(n),this._cache[e]=!0}},js:function(e,t){var n,i=this;return t=r.extend({dir:c,cache:!0},t),n=r.map(this._toArr(e),function(e){return e.indexOf(t.dir)>-1?i._js(e,t.cache):i._js((t.dir||"")+e,t.cache)}),r.when.apply(r,n)},css:function(e,t){var n=this;t=r.extend({dir:l,cache:!0},t),r.each(this._toArr(e),function(e,i){return i.indexOf(t.dir)>-1?n._css(i,t.cache):n._css((t.dir||"")+i,t.cache)})},files:function(e,t){var n=[],i=[];if(r.each(this._toArr(e),function(e,t){/\.css$/.test(t)?i.push(t):n.push(t)}),i.length&&this.css(i,t),n.length)return this.js(n,t)}}}),f.extend({context:{els:{},config:{}},emptyFn:function(){},clone:function(e){return r.extend({},e)},map:function(e,t){var n=[];return r.isArray(e)&&r.each(e,function(e,i){t&&n.push(t(e,i))}),n},parseJSON:function(e){return e&&"string"===r.type(e)?JSON.parse(e):e},joinStr:function(){var e=[];return r.each(arguments,function(t,n){n&&(r.isArray(n)?e=e.concat(n):e.push(r.trim(n)))}),e.join("")},createHtml:function(e,t){var n=r("<"+(e||"div")+">"),i={},o=r.extend({},t),a=[];return r.each(["tagName","class","className","css","act","iconName","text","html","tip","capture"],function(e,t){o[t]&&(i[t]=o[t],delete o[t])}),i.act&&(o["data-act"]=i.act),i.tip&&(o["data-tip"]=i.tip),f.isAndroid()&&i.capture&&(o.capture="camera"),i["class"]&&a.push(i["class"]),i.className&&a.push(i.className),i.iconName&&a.push("icon icon-"+i.iconName),i["class"]=a.join(" "),i.css&&n.css(i.css),i.text&&n.html("<span>"+i.text+"</span>"),i.html&&n.html(i.html),n.addClass(i["class"]),n.attr(o),r("<div>").append(n).html()},setContext:function(e){return e=this.clone(e),e.els=r.extend({},this.context.els,e.els),e.config=r.extend({},this.context.config,e.config),r.extend(this.context,e)}}),f.extend({_eventMap:{},on:function(e,t,n){this._eventMap[e]||(this._eventMap[e]=[]),this._eventMap[e].push([t,n])},off:function(e,t){return t?void(this._eventMap[e]=this._eventMap[e].filter(function(e){return e[0]!==t})):void delete this._eventMap[e]},fire:function(e){var t=arguments,n=this._eventMap[e]||[];n.forEach(function(e){return e[0].apply(e[1],[].slice.apply(t,[1]))})}})}(this),function(e,t){function n(e){return e?w[e]:w}function i(e){return console.log("config",e),e=_.extend({},e),e.appBar&&e.appBar.onClick&&(x.appBarClickHandlers=x.appBarClickHandlers||[],x.appBarClickHandlers.push(e.appBar.onClick),delete e.appBar.onClick),e.appBar=_.extend({},w.appBar,e.appBar),e.editor=_.extend({},w.editor,e.editor),_.extend(w,e)}function r(t){t=t||{};var n=_(t.container||"body"),i=_(e.replaceTpl(k,t));return t.css&&i.css(t.css),n.find(".mask").remove(),n.append(i),i}function o(t){if(t){t=_.extend({},w,t),!t.closeContent&&(t.closeContent="");var n,i=t.needMask!==!1,o=t.needClose!==!1,a=t.container||_("body"),s=a.find(".im-pop");if(t.content instanceof Element||t.content instanceof jQuery){var c=t.content;n=_(e.replaceTpl(T,_.extend({},t,{content:""}))),n.find(">dd").prepend(c)}else n=_(e.replaceTpl(T,t));var l=i&&r(_.extend({container:a},t.mask)),u=function(){l&&l.show(),n.addClass("show"),t.show&&t.show(),w.show&&w.show(n,t)},d=function(){l&&l.hide(),n.removeClass("show"),t.hide&&t.hide(),w.hide&&w.hide(n,t)},p=function(){l&&l.remove(),n.remove(),t.hide&&t.hide(),t.remove&&t.remove(),w.hide&&w.hide(n,t)};s.remove(),t.title&&n.addClass("has-title"),x.isMob&&n.addClass("mob"),t.cssAttrs&&n.css(t.cssAttrs),a.append(n),u();var h=n.find(".btn-x");return o?h.click(d):h.remove(),t.headerExtraHtml||n.find(".header-extra-html").remove(),x.isMob||t.isInner?n.css({width:"100%",minWidth:"100%"}):!t._isPop&&n.css({width:"364px",margin:"-"+n.height()/2+"px 0 0 -182px"}),{el:n,show:u,hide:d,close:p,toggle:function(){"none"==n.css("display")?u():d()}}}}function a(e){var t=w.isInner,n=o(_.extend(e,{clz:"im-modal "+(e.clz||""),mask:_.extend({clz:e.clz||""},e.mask)}));return!x.isMob&&!t&&n.el.css({left:"50%",top:"50%"}),n}function s(e){return a(_.extend({needClose:!1},e,{clz:"tiny-modal "+(e.clz||"")}))}function c(e,t,n,i){i=_.extend({confirmText:"ç¡®å®",cancelText:"åæ¶",icon:"",title:""},i);var r=_(['<ul class="vcall-pop vcall-received-pop">',"    <li>",'        <span class="circle">'+(i.icon?'<i class="icon icon-'+i.icon+'"></i>':"")+"</span>",i.title?'<span class="nick ellipsis">'+i.title+"</span>":"",'        <p class="desc text-muted">'+e+"</p>","    </li>",'    <li class="text-right">','        <a data-act="cancel" class="btn btn-danger btn-sm">'+i.cancelText+"</a>",i.confirmText?'        <a data-act="confirm" class="btn btn-primary btn-sm">'+i.confirmText+"</a>":"","    </li>","</ul>"].join("")),o=function(){r.off(),r.remove(),i.onClosed&&i.onClosed()};r.on("click",'[data-act="cancel"]',function(){n&&n(),o()}),r.on("click",'[data-act="confirm"]',function(){t&&t(),o()});var a=_("body");return a.append(r),i.onShown&&i.onShown(),{destroy:o}}function l(e){e=e||{};var t=_(e.target),n=t.offset(),i=e.offset||{},r=e.cssAttrs||{};r=_.extend({top:n.top+(i.top||0)+"px",left:n.left+(i.left||0)+"px"},r);var a=o(_.extend({_isPop:!0,needMask:!1,needClose:!1,cssAttrs:r},e));return a}function u(t,n){if(t){n=_.extend({type:"success",autoClose:!0},w.tip,n);var i="tip",r=e.id(),o=["ui-"+i,"bg-"+n.type,"clearfix"],a=_(n.container||document.body),s=_(e.joinStr('<div id="'+r+'" class="'+o.join(" ")+'">',t,'   <a data-act="close" class="icon icon-guanbi"></a>',"</div>"));return n.css&&s.css(n.css),s.on("click","[data-act]",function(e){var t=_(this).data("act");"close"===t&&s.fadeOut(),n.onClick&&n.onClick(t,n)}),a.find("."+o[0]).remove(),a.append(s),s.fadeIn(),n.autoClose&&setTimeout(function(){s.fadeOut()},n.time||3e3),s}}function d(e,t){x.isMob||(e=_(e),t=_.extend({delay:{show:300,hide:100}},t),e.find("[data-toggle='tooltip']").tooltip(t))}function p(t){t=t||{},t.noDefault||(t=_.extend({},w.appBar,t));var n,i,r="appbar",o=["ui-"+r,"clearfix"],a=e.createHtml,s=_(t.container),c=t.getButtons?t.getButtons(t):t.buttons,l=[];return"undefined"!=typeof t.inputting&&s?void s.find(".inputting").text(t.inputting):(t.btnBack&&o.push("has-back"),!t.avatar&&!t.desc&&l.push("margin-top: 10px"),t.title&&(n=e.joinStr('<div class="title" title='+(t.title||"")+' style="'+l.join(";")+'">'+t.title,'  <span class="inputting">'+(t.inputting||"")+"</span>","</div>")),console.log("cfg====",t),i=_(e.joinStr('<div class="'+o.join(" ")+'" style="color:'+e.context.textColor+'">','  <div class="appbar-left">',t.btnBack&&a("a",{act:"back",iconName:"arrow-left"}),t.avatar&&'<img src="'+t.avatar+'" />','    <div class="title-box">',n,t.desc&&'<div class="desc" title="'+t.desc+'">'+t.desc+"</div>","    </div>","  </div>",'  <div class="appbar-right">',e.map(c,function(e,t){return a("a",t)}),"  </div>","</div>")),i.on("click","[data-act]",function(e){var n=_(this),i=n.data("act");t.onClick&&t.onClick(i,{el:n}),x.appBarClickHandlers&&_.each(x.appBarClickHandlers,function(e,t){t(i,{el:n})})}),s.empty(),s.append(i),t.onReady&&t.onReady(i,t),i)}function h(t){t=_.extend({},w.editor,t);var n="editor",i=["ui-"+n,"clearfix"],r=e.createHtml,o=_(t.container),a=t.textarea||{},s=t.getButtons?t.getButtons(t):t.buttons,c=null;e.isMob()?(c=_.extend({"class":"icon icon-ic-send-line"},t.btnSend,{"data-act":"send"}),delete c.text):c=_.extend({"class":"btn-send"},t.btnSend,{"data-act":"send"});var l="function"==typeof t.btnVoice?t.btnVoice():"";l&&(l=_.extend({"class":"btn-voice "},l,{"data-act":"switch"}),i.push("voice-enabled"));var u=_(e.joinStr('<div id="topBottomBtn">','   <div class="icon icon-ic-dou-up-shuangjiantoushang to-top"></div>','   <div class="icon icon-ic-dou-down-shuangjiantouxia1 to-bottom"></div>',"</div>",'<div id="guideList" class="scrollbar"></div>','<div class="'+i.join(" ")+'">','   <div class="tipbar"></div>',l?e.joinStr(r("a",l),'   <div class="voicebox">','   <a href="javascript:;" class="down-voice"><span class="voice-rolling"></span><span class="down-voice-txt">'+(l.otherText||"æä½ è¯´è¯")+"</span></a>","   </div>"):"",'   <div class="textbox">',r("textarea",a),r("div",c),"   </div>",'   <div class="more-box"></div>','   <div class="toolbar clearfix">',e.map(s,function(e,t){return r("a",t)}),"   </div>","</div>"));return!a.value&&u.find("textarea").val(""),u.on("click","[data-act]",function(e){var n=_(this).data("act");"send"===n?t.onSend&&t.onSend():t.onClick&&t.onClick(n),e.stopPropagation()}).on("keydown","textarea",function(e){if(13==e.keyCode){if(e.shiftKey)return;return t.onSend&&t.onSend(),e.preventDefault()}}).on("input propertychange","textarea",function(e){t.onInput&&t.onInput()}),o.empty(),o.append(u),t.onReady&&t.onReady(u,t),u}function f(t){t=t||{},t=_.extend({type:"bar",percentage:0,color:w.themeColor,size:"circle"===t.type?32:2},w.progress,t);var n,i="progress",r=["ui-"+i,i+"-"+t.type].concat(t.clz||[]),o=_(t.container);return n=o.find("."+r[0]),n.size()||(n=_(e.joinStr('<div class="'+r.join(" ")+'">',"   <div></div>","</div>")),n.height(t.height),o.append(n)),"bar"===t.type&&n.find(">div").css({width:t.percentage+"%",backgroundColor:t.color}),n}function g(t){t=_.extend({type:"page"},w.form,t);var n="form",i=["ui-"+n,"clearfix"],r=e.createHtml,o=_(t.container),a=t.getButtons?t.getButtons(t):t.buttons,s=_(e.joinStr('<div class="'+i.join(" ")+'">','    <div class="form-body">',t.desc&&'<div class="desc">'+t.desc+"</div>",S.isStr(t.body)&&t.body,"    </div>",'    <div class="toolbar clearfix">',e.map(a,function(e,t){return r(t.tagName,t)}),"    </div>","</div>")),c=s.find(">.form-body");s.find(">.toolbar");return S.isEl(t.body)&&c.append(t.body),s.on("click","[data-act]",function(e){var n=_(this),i=n.data("act");t.onClick&&t.onClick(i,{el:n})}),o.html(s),s}function m(t){t=_.extend({},t),w.board=w.board||{},t.header!==!1&&(t.header=_.extend({},w.board.header,t.header)),t=_.extend({type:"html",open:!0,container:document.body},w.board,t);var n,i,r,o,a="board",s=a+"-header",c=a+"-body",l=["ui-"+a,"box-shadow","clearfix"],u=_(t.container);if(o="iframe"===t.type,t.id&&(n=u.find("#"+t.id),w.board.id=t.id,w.board.ids=w.board.ids||[],w.board.ids.push(t.id)),n&&t.replace&&(n.remove(),n=null),e.platform({iphone:function(){u.width(document.documentElement.clientWidth||document.body.clientWidth)}}),!n||!n.size()){if(n=_(e.joinStr('<div class="'+l.join(" ")+'">','   <div class="'+s+'">',"   </div>",'   <div class="'+c+'">',o?'<iframe frameborder="0"></iframe>':S.isStr(t.body)?t.body:"","   </div>","</div>")),t.id&&n.attr("id",t.id),i=n.find(">."+s),r=n.find(">."+c),console.log("cfg===",t,i),t.header){if(i.addClass("header"),i.css({backgroundColor:t.themeColor}),0==t.isback)return;console.log("0000--------"),p(_.extend({noDefault:!0,title:t.title,container:i,titleWidth:u.width()},t.header))}else r.css("top",0);if(o){var d={src:t.body},h=r.find("iframe");h.attr(d)}else S.isEl(t.body)&&r.append(t.body);n.on("click","[data-act]",function(e){var i=_(this).data("act");t.onClick&&t.onClick(i,{el:n}),e.stopPropagation()}),u.append(n)}return t.open&&((x.isMob||w.isInner)&&(t.noAnimate||((!x.lastBoardOpenTime||new Date-x.lastBoardOpenTime>1e3)&&n.addClass("animate").css("left","110%"),x.lastBoardOpenTime=new Date)),S.delayFn(function(){x.boardZIndex=x.boardZIndex||99998,n.css("zIndex",++x.boardZIndex).addClass("open"),setTimeout(function(){n.css("left",0)},50),t.onDelayShow&&t.onDelayShow({el:n})})),t.containerWidth=document.documentElement.clientWidth||document.body.clientWidth,t.onReady&&t.onReady(n,t),n}function v(t){t=_.extend({},w.dialog,t);var n,i="dialog",o=["ui-"+i].concat(t.clz||[]),a=[t.title?i+"-header":""],s=[i+"-body"],c=[t.buttons?i+"-footer":""],l=e.createHtml,u=_(t.container||"body"),d=t.mask||{},p=r(_.extend({container:u,css:_.extend({top:0},d.css)},d)),h=p.css("z-index")+1;return u.find("."+o[0]).remove(),n=_(e.joinStr('<div class="'+o.join(" ")+'">','   <div class="'+a.join(" ")+'">'+(t.title||""),t.needClose&&'<a data-act="close" class="icon icon-guanbi"></a>',"   </div>",'   <div class="'+s.join(" ")+'">',S.isStr(t.body)&&t.body,"   </div>",'   <div class="'+c.join(" ")+'">',e.map(t.buttons,function(e,t){return l(t.tagName,t)}),"   </div>","</div>")),u.append(n),S.autoCenter(n,{zIndex:h}),n.on("click","[data-act]",function(e){var n=_(this),i=n.data("act");t.onClick&&t.onClick(i,{el:n}),e.stopPropagation()}),n}function y(e){e=_.extend({},w.imgPreview,e);var t="img-preview",n=w.themeColor,i=_(e.container||"body"),r=v(_.extend({needClose:!0,body:"<img />",buttons:e.sendText&&[{"class":"btn",act:"send",text:e.sendText||"",css:{color:"#fff",backgroundColor:n}}]},e,{onClick:function(t){"close"!==t&&"send"!==t||(o.remove(),r.remove()),e.onClick&&e.onClick(t,{el:r})}})),o=i.find(">.mask"),a=r.find("img");return r.addClass("ui-"+t),e.src&&a.attr("src",e.src),a[0].onload=function(){S.autoCenter(r)},r}function b(e){var t=_(e.container||"body"),n=e.src_idx,i=t.find(".voice-wave");return e.hide?void(i.size()&&i.hide().remove()):void(n&&(!i.size()&&n?(i='<div class="voice-wave"><img src="/im_client/images/voice_'+n+'.png" </img></div>',t.append(i)):(console.log(n),i.find("img").eq(0).attr("src","/im_client/images/voice_"+n+".png"))))}var _=e.$,x={isMob:e.isMob()},w={},k='<div class="mask {clz}"></div>',T=['<dl class="im-pop {clz}">','  <dt>{title}<a class="btn-x icon icon-guanbi"></a><div class="header-extra-html">{headerExtraHtml}</div></dt>','  <dd class="{contentClz}">{content}</dd>',"{closeContent}","</dl>"].join(""),S={isEl:function(e){return!!e&&(1===e.nodeType||e instanceof _)},isStr:function(e){return"string"===_.type(e)},isObj:function(e){return"object"===_.type(e)},delayFn:function(e,t){return setTimeout(function(){e&&e()},t||50)},autoCenter:function(e,t){e&&e.css(_.extend({position:"absolute",top:"50%",left:"50%",margin:"-"+e.height()/2+"px 0 0 -"+e.width()/2+"px"},t))},resolveLinearGradientColor:function(e){var t=/#[a-zA-Z0-9]+|(rgb|RGB)\([0-9 ,]+\)/g,n=e.match(t)||[];return[n[0]||"#fff",n[1]||"#fff"]}};p.setMute=function(e){e?_('.ui-appbar [data-act="muted"]').removeClass("icon-stereos-on").addClass("icon-stereos-off"):_('.ui-appbar [data-act="muted"]').removeClass("icon-stereos-off").addClass("icon-stereos-on")},p.removeBackBtn=function(){_('.ui-appbar [data-act="back"]').remove()},_(function(){var e=document.body;_(e).on("click.toolbar",function(){_(".im-pop").not(".im-modal").hide();var e=_("#footer"),t=e.find(".toolbar"),n=e.find(".more-box"),i=t.find("a").filter(function(){var e=_(this);return"none"!==e.css("display")});_.each(i,function(e,t){_(t).attr("clickshow")&&_(t).hide()}),n.hide()}).on("click",".im-pop,.mask",function(e){e.target.className.includes("udesk-km-chat-sdk")||e.stopPropagation()})}),e.ui={util:S,mask:r,modal:a,tinyModal:s,pop:l,tip:u,tooltip:d,form:g,appBar:p,editor:h,progress:f,board:m,dialog:v,imgPreview:y,voiceWaveImg:b,config:function(e){return e?i(e):n()},confirm:c}}(this.udesk,this),function(e,t){function n(){for(var e=[{text:"å¾®ç¬",enText:"smile",index:0,code:"/::)",regcode:"/::\\)",regtext:"\\[å¾®ç¬\\]",regEnText:"\\[smile\\]"},{text:"ä¼¤å¿",enText:"sad",index:1,code:"/::~",regcode:"/::~",regtext:"\\[ä¼¤å¿\\]",regEnText:"\\[sad\\]"},{text:"ç¾å¥³",enText:"beauty",index:2,code:"/::B",regcode:"/::B",regtext:"\\[ç¾å¥³\\]",regEnText:"\\[beauty\\]"},{text:"åå",enText:"daze",index:3,code:"/::|",regcode:"/::\\|",regtext:"\\[åå\\]",regEnText:"\\[daze\\]"},{text:"å¢¨é",enText:"sunglasses",index:4,code:"/:8-)",regcode:"/:8\\-\\)",regtext:"\\[å¢¨é\\]",regEnText:"\\[sunglasses\\]"},{text:"æµæ³ª",enText:"tears",index:5,code:"/::<",regcode:"/::<",regtext:"\\[æµæ³ª\\]",regEnText:"\\[tears\\]"},{text:"ç¾",enText:"shame",index:6,code:"/::$",regcode:"/::\\$",regtext:"\\[ç¾\\]",regEnText:"\\[shame\\]"},{text:"å",enText:"dumb",index:7,code:"/::X",regcode:"/::X",regtext:"\\[å\\]",regEnText:"\\[dumb\\]"},{text:"ç¡",enText:"sleep",index:8,code:"/::Z",regcode:"/::Z",regtext:"\\[ç¡\\]",regEnText:"\\[sleep\\]"},{text:"å­",enText:"cry",index:9,code:"/::'(",regcode:"/::'\\(",regtext:"\\[å­\\]",regEnText:"\\[cry\\]"},{text:"å°´å°¬",enText:"embarrassed",index:10,code:"/::-|",regcode:"/::\\-\\|",regtext:"\\[å°´å°¬\\]",regEnText:"\\[embarrassed\\]"},{text:"æ",enText:"anger",index:11,code:"/::@",regcode:"/::@",regtext:"\\[æ\\]",regEnText:"\\[anger\\]"},{text:"è°ç®",enText:"naughty",index:12,code:"/::P",
regcode:"/::P",regtext:"\\[è°ç®\\]",regEnText:"\\[naughty\\]"},{text:"ç¬",enText:"smile",index:13,code:"/::D",regcode:"/::D",regtext:"\\[ç¬\\]",regEnText:"\\[smile\\]"},{text:"æè®¶",enText:"surprised",index:14,code:"/::O",regcode:"/::O",regtext:"\\[æè®¶\\]",regEnText:"\\[surprised\\]"},{text:"é¾è¿",enText:"sorrow",index:15,code:"/::(",regcode:"/::\\(",regtext:"\\[é¾è¿\\]",regEnText:"\\[sorrow\\]"},{text:"é·",enText:"cool",index:16,code:"/:: ",regcode:"/:: ",regtext:"\\[é·\\]",regEnText:"\\[cool\\]"},{text:"å§",enText:"orz",index:17,code:"/:--b",regcode:"/:--b",regtext:"\\[å§\\]",regEnText:"\\[orz\\]"},{text:"æç",enText:"madness",index:18,code:"/::Q",regcode:"/::Q",regtext:"\\[æç\\]",regEnText:"\\[madness\\]"},{text:"å",enText:"spit",index:19,code:"/::T",regcode:"/::T",regtext:"\\[å\\]",regEnText:"\\[spit\\]"},{text:"å·ç¬",enText:"snicker",index:20,code:"/:,@P",regcode:"/:,@P",regtext:"\\[å·ç¬\\]",regEnText:"\\[snicker\\]"},{text:"å¿«ä¹",enText:"happy",index:21,code:"/:,@-D",regcode:"/:,@\\-D",regtext:"\\[å¿«ä¹\\]",regEnText:"\\[happy\\]"},{text:"ç½ç¼",enText:"Supercilious look",index:22,code:"/::d",regcode:"/::d",regtext:"\\[ç½ç¼\\]",regEnText:"\\[Supercilious look\\]"},{text:"æå´",enText:"curl one's lip",index:23,code:"/:,@o",regcode:"/:,@o",regtext:"\\[æå´\\]",regEnText:"\\[curl one's lip\\]"},{text:"é¥¿",enText:"hungry",index:24,code:"/::g",regcode:"/::g",regtext:"\\[é¥¿\\]",regEnText:"\\[hungry\\]"},{text:"å°",enText:"trapped",index:25,code:"/:|-)",regcode:"/:\\|\\-\\)",regtext:"\\[å°\\]",regEnText:"\\[trapped\\]"},{text:"æå",enText:"frightened",index:26,code:"/::!",regcode:"/::!",regtext:"\\[æå\\]",regEnText:"\\[frightened\\]"},{text:"æµæ±",enText:"sweat",index:27,code:"/::L",regcode:"/::L",regtext:"\\[æµæ±\\]",regEnText:"\\[sweat\\]"},{text:"å¤§ç¬",enText:"laugh",index:28,code:"/::>",regcode:"/::>",regtext:"\\[å¤§ç¬\\]",regEnText:"\\[laugh\\]"},{text:"æ½ç",enText:"smoking",index:29,code:"/::,@",regcode:"/::,@",regtext:"\\[æ½ç\\]",regEnText:"\\[smoking\\]"},{text:"å¥æ",enText:"struggle",index:30,code:"/:,@f",regcode:"/:,@f",regtext:"\\[å¥æ\\]",regEnText:"\\[struggle\\]"},{text:"åéª",enText:"curse",index:31,code:"/::-S",regcode:"/::\\-S",regtext:"\\[åéª\\]",regEnText:"\\[curse\\]"},{text:"çé®",enText:"doubt",index:32,code:"/:?",regcode:"/:\\?",regtext:"\\[çé®\\]",regEnText:"\\[doubt\\]"},{text:"ç§å¯",enText:"secret",index:33,code:"/:,@x",regcode:"/:,@x",regtext:"\\[ç§å¯\\]",regEnText:"\\[secret\\]"},{text:"æ",enText:"dizzy",index:34,code:"/:,@@",regcode:"/:,@@",regtext:"\\[æ\\]",regEnText:"\\[dizzy\\]"},{text:"åç¯",enText:"crazy",index:35,code:"/::8",regcode:"/::8",regtext:"\\[åç¯\\]",regEnText:"\\[crazy\\]"},{text:"è¡°",enText:"failure",index:36,code:"/:,@!",regcode:"/:,@!",regtext:"\\[è¡°\\]",regEnText:"\\[failure\\]"},{text:"éª·é«",enText:"skeleton",index:37,code:"/:!!!",regcode:"/:!!!",regtext:"\\[éª·é«\\]",regEnText:"\\[skeleton\\]"},{text:"æ²æ",enText:"knock",index:38,code:"/:xx",regcode:"/:xx",regtext:"\\[æ²æ\\]",regEnText:"\\[knock\\]"},{text:"åè§",enText:"goodbye",index:39,code:"/:bye",regcode:"/:bye",regtext:"\\[åè§\\]",regEnText:"\\[goodbye\\]"},{text:"æ¦æ±",enText:"Wipe the sweat",index:40,code:"/:wipe",regcode:"/:wipe",regtext:"\\[æ¦æ±\\]",regEnText:"\\[Wipe the sweat\\]"},{text:"æ é¼»",enText:"pick one's nose",index:41,code:"/:dig",regcode:"/:dig",regtext:"\\[æ é¼»\\]",regEnText:"\\[pick one's nose\\]"},{text:"é¼æ",enText:"applause",index:42,code:"/:handclap",regcode:"/:handclap",regtext:"\\[é¼æ\\]",regEnText:"\\[applause\\]"},{text:"ç³",enText:"embarrassing",index:43,code:"/:&-(",regcode:"/:&\\-\\(",regtext:"\\[ç³\\]",regEnText:"\\[embarrassing\\]"},{text:"åç¬",enText:"Bad smile",index:44,code:"/:B-)",regcode:"/:B\\-\\)",regtext:"\\[åç¬\\]",regEnText:"\\[Bad smile\\]"},{text:"å·¦å¼å¼",enText:"Left hem",index:45,code:"/:<@",regcode:"/:<@",regtext:"\\[å·¦å¼å¼\\]",regEnText:"\\[Left hem\\]"},{text:"å³å¼å¼",enText:"Right hem",index:46,code:"/:@>",regcode:"/:@>",regtext:"\\[å³å¼å¼\\]",regEnText:"\\[Right hem\\]"},{text:"åæ¬ ",enText:"yawn",index:47,code:"/::-O",regcode:"/::\\-O",regtext:"\\[åæ¬ \\]",regEnText:"\\[yawn\\]"},{text:"éè§",enText:"despise",index:48,code:"/:>-|",regcode:"/:>\\-\\|",regtext:"\\[éè§\\]",regEnText:"\\[despise\\]"},{text:"å§å±",enText:"injustice",index:49,code:"/:P-(",regcode:"/:P\\-\\(",regtext:"\\[å§å±\\]",regEnText:"\\[injustice\\]"},{text:"å¿«å­äº",enText:"I'm going to cry",index:50,code:"/::'|",regcode:"/::'\\|",regtext:"\\[å¿«å­äº\\]",regEnText:"\\[I'm going to cry\\]"},{text:"å¥¸ç¬",enText:"Smirking",index:51,code:"/:X-)",regcode:"/:X\\-\\)",regtext:"\\[å¥¸ç¬\\]",regEnText:"\\[Smirking\\]"},{text:"äº²äº²",enText:"Kiss",index:52,code:"/::*",regcode:"/::\\*",regtext:"\\[äº²äº²\\]",regEnText:"\\[Kiss\\]"},{text:"å",enText:"Scared",index:53,code:"/:@x",regcode:"/:@x",regtext:"\\[å\\]",regEnText:"\\[Scared\\]"},{text:"å¯æ",enText:"Poor",index:54,code:"/:8*",regcode:"/:8\\*",regtext:"\\[å¯æ\\]",regEnText:"\\[Poor\\]"},{text:"èå",enText:"Chopper",index:55,code:"/:pd",regcode:"/:pd",regtext:"\\[èå\\]",regEnText:"\\[Chopper\\]"},{text:"è¥¿ç",enText:"Watermelon",index:56,code:"/:<W>",regcode:"/:<W>",regtext:"\\[è¥¿ç\\]",regEnText:"\\[Watermelon\\]"},{text:"å¤é",enText:"Beer",index:57,code:"/:beer",regcode:"/:beer",regtext:"\\[å¤é\\]",regEnText:"\\[Beer\\]"},{text:"ç¯®ç",enText:"Basketball",index:58,code:"/:basketb",regcode:"/:basketb",regtext:"\\[ç¯®ç\\]",regEnText:"\\[Basketball\\]"},{text:"ä¹ä¹",enText:"Table tennis",index:59,code:"/:oo",regcode:"/:oo",regtext:"\\[ä¹ä¹\\]",regEnText:"\\[Table tennis\\]"},{text:"åå¡",enText:"Coffee",index:60,code:"/:coffee",regcode:"/:coffee",regtext:"\\[åå¡\\]",regEnText:"\\[Coffee\\]"},{text:"é¥­",enText:"Rice",index:61,code:"/:eat",regcode:"/:eat",regtext:"\\[é¥­\\]",regEnText:"\\[Rice\\]"},{text:"çªå¤´",enText:"Pig",index:62,code:"/:pig",regcode:"/:pig",regtext:"\\[çªå¤´\\]",regEnText:"\\[Pig\\]"},{text:"é²è±",enText:"Flowers",index:63,code:"/:rose",regcode:"/:rose",regtext:"\\[é²è±\\]",regEnText:"\\[Flowers\\]"},{text:"æ¯è",enText:"Withered",index:64,code:"/:fade",regcode:"/:fade",regtext:"\\[æ¯è\\]",regEnText:"\\[Withered\\]"},{text:"çº¢å",enText:"Red lips",index:65,code:"/:showlove",regcode:"/:showlove",regtext:"\\[çº¢å\\]",regEnText:"\\[Red lips\\]"},{text:"ç±å¿",enText:"Love",index:66,code:"/:heart",regcode:"/:heart",regtext:"\\[ç±å¿\\]",regEnText:"\\[Love\\]"},{text:"å¿ç¢",enText:"Heart",index:67,code:"/:break",regcode:"/:break",regtext:"\\[å¿ç¢\\]",regEnText:"\\[Heart\\]"},{text:"èç³",enText:"Cake",index:68,code:"/:cake",regcode:"/:cake",regtext:"\\[èç³\\]",regEnText:"\\[Cake\\]"},{text:"éªçµ",enText:"Lightning",index:69,code:"/:li",regcode:"/:li",regtext:"\\[éªçµ\\]",regEnText:"\\[Lightning\\]"},{text:"ç¸å¼¹",enText:"Bomb",index:70,code:"/:bome",regcode:"/:bome",regtext:"\\[ç¸å¼¹\\]",regEnText:"\\[Bomb\\]"},{text:"å",enText:"Knife",index:71,code:"/:kn",regcode:"/:kn",regtext:"\\[å\\]",regEnText:"\\[Knife\\]"},{text:"è¶³ç",enText:"Football",index:72,code:"/:footb",regcode:"/:footb",regtext:"\\[è¶³ç\\]",regEnText:"\\[Football\\]"},{text:"ç¢è«",enText:"Ladybug",index:73,code:"/:ladybug",regcode:"/:ladybug",regtext:"\\[ç¢è«\\]",regEnText:"\\[Ladybug\\]"},{text:"ä¾¿ä¾¿",enText:"Shit",index:74,code:"/:shit",regcode:"/:shit",regtext:"\\[ä¾¿ä¾¿\\]",regEnText:"\\[Shit\\]"},{text:"æå®",enText:"Good night",index:75,code:"/:moon",regcode:"/:moon",regtext:"\\[æå®\\]",regEnText:"\\[Good night\\]"},{text:"å¤ªé³",enText:"Sun",index:76,code:"/:sun",regcode:"/:sun",regtext:"\\[å¤ªé³\\]",regEnText:"\\[Sun\\]"},{text:"ç¤¼ç©",enText:"Gift",index:77,code:"/:gift",regcode:"/:gift",regtext:"\\[ç¤¼ç©\\]",regEnText:"\\[Gift\\]"},{text:"æ±æ±",enText:"Hug",index:78,code:"/:hug",regcode:"/:hug",regtext:"\\[æ±æ±\\]",regEnText:"\\[Hug\\]"},{text:"èµ",enText:"Praise",index:79,code:"/:strong",regcode:"/:strong",regtext:"\\[èµ\\]",regEnText:"\\[Praise\\]"},{text:"å·®å²",enText:"Bad",index:80,code:"/:weak",regcode:"/:weak",regtext:"\\[å·®å²\\]",regEnText:"\\[Bad\\]"},{text:"æ¡æ",enText:"Shake hands",index:81,code:"/:share",regcode:"/:share",regtext:"\\[æ¡æ\\]",regEnText:"\\[Shake hands\\]"},{text:"yeah",enText:"Yeah",index:82,code:"/:v",regcode:"/:v",regtext:"\\[yeah\\]",regEnText:"\\[Yeah\\]"},{text:"æ±æ³",enText:"Hold your fist",index:83,code:"/:@)",regcode:"/:@\\)",regtext:"\\[æ±æ³\\]",regEnText:"\\[Hold your fist\\]"},{text:"å¾å¼",enText:"Seduce",index:84,code:"/:jj",regcode:"/:jj",regtext:"\\[å¾å¼\\]",regEnText:"\\[Seduce\\]"},{text:"åé",enText:"Power",index:85,code:"/:@@",regcode:"/:@@",regtext:"\\[åé\\]",regEnText:"\\[Power\\]"},{text:"å",enText:"Bad",index:86,code:"/:bad",regcode:"/:bad",regtext:"\\[å\\]",regEnText:"\\[Bad\\]"},{text:"ç±ä½ ",enText:"Love you",index:87,code:"/:lvu",regcode:"/:lvu",regtext:"\\[ç±ä½ \\]",regEnText:"\\[Love you\\]"},{text:"NO",enText:"NO",index:88,code:"/:no",regcode:"/:no",regtext:"\\[NO\\]",regEnText:"\\[NO\\]"},{text:"OK",enText:"OK",index:89,code:"/:ok",regcode:"/:ok",regtext:"\\[OK\\]",regEnText:"\\[OK\\]"},{text:"ç±",enText:"Love",index:90,code:"/:love",regcode:"/:love",regtext:"\\[ç±\\]",regEnText:"\\[Love\\]"},{text:"é£å»",enText:"Kiss",index:91,code:"/:<L>",regcode:"/:<L>",regtext:"\\[é£å»\\]",regEnText:"\\[Kiss\\]"},{text:"è·³è",enText:"Dance",index:92,code:"/:jump",regcode:"/:jump",regtext:"\\[è·³è\\]",regEnText:"\\[Dance\\]"},{text:"åæ",enText:"Shivering",index:93,code:"/:shake",regcode:"/:shake",regtext:"\\[åæ\\]",regEnText:"\\[Shivering\\]"},{text:"å°å«",enText:"Scream",index:94,code:"/:<O>",regcode:"/:<O>",regtext:"\\[å°å«\\]",regEnText:"\\[Scream\\]"},{text:"å",enText:"Circle",index:95,code:"/:circle",regcode:"/:circle",regtext:"\\[å\\]",regEnText:"\\[Circle\\]"},{text:"æ",enText:"Worship",index:96,code:"/:kotow",regcode:"/:kotow",regtext:"\\[æ\\]",regEnText:"\\[Worship\\]"},{text:"åå¤´",enText:"Back",index:97,code:"/:turn",regcode:"/:turn",regtext:"\\[åå¤´\\]",regEnText:"\\[Back\\]"},{text:"è·³",enText:"Jump",index:98,code:"/:skip",regcode:"/:skip",regtext:"\\[è·³\\]",regEnText:"\\[Jump\\]"},{text:"æ¥æ",enText:"Waved",index:99,code:"/:oY",regcode:"/:o\\Y",regtext:"\\[æ¥æ\\]",regEnText:"\\[Waved\\]"},{text:"æ¿å¨",enText:"Excited",index:100,code:"/:#-0",regcode:"/:#\\-0",regtext:"\\[æ¿å¨\\]",regEnText:"\\[Excited\\]"},{text:"å»",enText:"Kiss",index:102,code:"/:kiss",regcode:"/:kiss",regtext:"\\[å»\\]",regEnText:"\\[Kiss\\]"},{text:"å¤ªæ",enText:"Tai chi",index:104,code:"/:&>",regcode:"/:&>",regtext:"\\[å¤ªæ\\]",regEnText:"\\[Tai chi\\]"}],t=0;t<e.length;t++){var n=e[t],i=n.index;n.clz="udesk_im_client_wechat-emoji"+i,n.position="-"+i%15*29+"px -"+29*parseInt(i/15)+"px"}return e}function i(){for(var e=[{text:"çç«¹",enText:"",index:0,regtext:"\\[çç«¹\\]",regEnText:"\\[Firecracker\\]"},{text:"åå",enText:"",index:1,regtext:"\\[åå\\]",regEnText:"\\[Worship\\]"}],t=0;t<e.length;t++){var n=e[t];n.clz="udesk_im_client_new-wechat-emoji"+n.index}return e}var r,o,a=e.isMob(),s='<a data-value="{value}"><i class="udesk_im_client_wechat-emoji {num}"></i></a>',c=n(),l=i(),u=function(t){var n="";console.log("lang===",e.context.lang);for(var i=e.context.lang,r=0;r<c.length;r++){var o=c[r];new RegExp(o.regcode,"g");n+=e.replaceTpl(s,{num:o.clz,value:"["+("zh-cn"===i?o.text:o.enText)+"]"})}return n='<div class="emoji-panel scrollbar">'+n+"</div>"},d=function(t){if(t){o=t;var n=$(t.target);return n.off("click").click(function(n){if(r&&r.el.is(":visible"))return void r.hide();var i=t.isCopyRight?30:0,o=$("#footer"),s={bottom:a?i:o.outerHeight()+i+"px"};(a||t.isInner)&&(s.left=0,s.width="100%"),r=e.ui.pop($.extend({needClose:!1,content:u(t),cssAttrs:s,clz:"im-emotion"},t)),(a||t.isInner)&&r.el.find(".emoji-panel").css({paddingLeft:"15px"}),r.el.on("click","dd a",t.click),n.stopPropagation()}),{show:function(){r&&r.show()},hide:function(){r&&r.hide()}}}},p=function(e){return e?"string"!=typeof e?e:e.replace(/\[emoji([^\].]+)\]/g,'<span class="udesk_im_client_emoji udesk_im_client_emoji$1"></span>'):""},h=function(e){if(!e)return"";if("string"!=typeof e)return e;e=e.replace(/&#39;/g,"'").replace(/\/::$/,"/:: ");for(var t=c,n=0;n<t.length;n++){var i=t[n],r=i.regcode.replace(/>/g,"&gt;").replace(/</g,"&lt;"),o=new RegExp(r,"g");e=e.replace(o,'<span class="udesk_im_client_wechat-emoji '+i.clz+'"></span>')}return e},f=function(e){if(!e)return e;if("string"!=typeof e)return e;for(var t=c,n=0;n<t.length;n++){var i=t[n],r=new RegExp(i.regcode,"g");e=e.replace(r,'<span class="udesk_im_client_wechat-emoji '+i.clz+'"></span>')}return e},g=function(e){if(!e)return"";if("string"!=typeof e)return e;for(var t=c,n=0;n<t.length;n++){var i=t[n],r=new RegExp(i.regtext,"g"),o=i.regEnText?new RegExp(i.regEnText,"g"):null;e=r.test(e)?e.replace(r,i.code):e.replace(o,i.code)}return e},m=function(e){if(!e)return"";if("string"!=typeof e)return e;for(var t=0;t<l.length;t++){var n=l[t],i=new RegExp(n.regtext,"g"),r=new RegExp(n.regEnText,"g");e=i.test(e)?e.replace(i,'<span class="udesk_im_client_new-wechat-emoji '+n.clz+'"></span>'):e.replace(r,'<span class="udesk_im_client_new-wechat-emoji '+n.clz+'"></span>')}for(var o=c,a=0;a<o.length;a++){var s=o[a],u=new RegExp(s.regtext,"g"),d=new RegExp(s.regEnText,"g");e=u.test(e)?e.replace(u,'<span class="udesk_im_client_wechat-emoji '+s.clz+'"></span>'):e.replace(d,'<span class="udesk_im_client_wechat-emoji '+s.clz+'"></span>')}return e};$(document).on("click",function(){r&&r.hide()}),e.ui=e.ui||{},e.ui.emotion=d,e.ui.emotionToHtml=p,e.ui.wechatData=c,e.ui.wechatEmotionToHtml=h,e.ui.emotionRegcodeToHtml=f,e.ui.wordToCode=g,e.ui.wechatEmotionWordToHtml=m}(this.udesk,this);var Base64=function(){var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",t={encode:function(t){var n,i,r,o,a,s,c,l="",u=0;do n=t.charCodeAt(u++),i=t.charCodeAt(u++),r=t.charCodeAt(u++),o=n>>2,a=(3&n)<<4|i>>4,s=(15&i)<<2|r>>6,c=63&r,isNaN(i)?s=c=64:isNaN(r)&&(c=64),l=l+e.charAt(o)+e.charAt(a)+e.charAt(s)+e.charAt(c);while(u<t.length);return l},decode:function(t){var n,i,r,o,a,s,c,l="",u=0;t=t.replace(/[^A-Za-z0-9\+\/\=]/g,"");do o=e.indexOf(t.charAt(u++)),a=e.indexOf(t.charAt(u++)),s=e.indexOf(t.charAt(u++)),c=e.indexOf(t.charAt(u++)),n=o<<2|a>>4,i=(15&a)<<4|s>>2,r=(3&s)<<6|c,l+=String.fromCharCode(n),64!=s&&(l+=String.fromCharCode(i)),64!=c&&(l+=String.fromCharCode(r));while(u<t.length);return l}};return t}(),MD5=function(){var e=function(e,t){var n=(65535&e)+(65535&t),i=(e>>16)+(t>>16)+(n>>16);return i<<16|65535&n},t=function(e,t){return e<<t|e>>>32-t},n=function(e){for(var t=[],n=0;n<8*e.length;n+=8)t[n>>5]|=(255&e.charCodeAt(n/8))<<n%32;return t},i=function(e){for(var t="",n=0;n<32*e.length;n+=8)t+=String.fromCharCode(e[n>>5]>>>n%32&255);return t},r=function(e){for(var t="0123456789abcdef",n="",i=0;i<4*e.length;i++)n+=t.charAt(e[i>>2]>>i%4*8+4&15)+t.charAt(e[i>>2]>>i%4*8&15);return n},o=function(n,i,r,o,a,s){return e(t(e(e(i,n),e(o,s)),a),r)},a=function(e,t,n,i,r,a,s){return o(t&n|~t&i,e,t,r,a,s)},s=function(e,t,n,i,r,a,s){return o(t&i|n&~i,e,t,r,a,s)},c=function(e,t,n,i,r,a,s){return o(t^n^i,e,t,r,a,s)},l=function(e,t,n,i,r,a,s){return o(n^(t|~i),e,t,r,a,s)},u=function(t,n){t[n>>5]|=128<<n%32,t[(n+64>>>9<<4)+14]=n;for(var i,r,o,u,d=1732584193,p=-271733879,h=-1732584194,f=271733878,g=0;g<t.length;g+=16)i=d,r=p,o=h,u=f,d=a(d,p,h,f,t[g+0],7,-680876936),f=a(f,d,p,h,t[g+1],12,-389564586),h=a(h,f,d,p,t[g+2],17,606105819),p=a(p,h,f,d,t[g+3],22,-1044525330),d=a(d,p,h,f,t[g+4],7,-176418897),f=a(f,d,p,h,t[g+5],12,1200080426),h=a(h,f,d,p,t[g+6],17,-1473231341),p=a(p,h,f,d,t[g+7],22,-45705983),d=a(d,p,h,f,t[g+8],7,1770035416),f=a(f,d,p,h,t[g+9],12,-1958414417),h=a(h,f,d,p,t[g+10],17,-42063),p=a(p,h,f,d,t[g+11],22,-1990404162),d=a(d,p,h,f,t[g+12],7,1804603682),f=a(f,d,p,h,t[g+13],12,-40341101),h=a(h,f,d,p,t[g+14],17,-1502002290),p=a(p,h,f,d,t[g+15],22,1236535329),d=s(d,p,h,f,t[g+1],5,-165796510),f=s(f,d,p,h,t[g+6],9,-1069501632),h=s(h,f,d,p,t[g+11],14,643717713),p=s(p,h,f,d,t[g+0],20,-373897302),d=s(d,p,h,f,t[g+5],5,-701558691),f=s(f,d,p,h,t[g+10],9,38016083),h=s(h,f,d,p,t[g+15],14,-660478335),p=s(p,h,f,d,t[g+4],20,-405537848),d=s(d,p,h,f,t[g+9],5,568446438),f=s(f,d,p,h,t[g+14],9,-1019803690),h=s(h,f,d,p,t[g+3],14,-187363961),p=s(p,h,f,d,t[g+8],20,1163531501),d=s(d,p,h,f,t[g+13],5,-1444681467),f=s(f,d,p,h,t[g+2],9,-51403784),h=s(h,f,d,p,t[g+7],14,1735328473),p=s(p,h,f,d,t[g+12],20,-1926607734),d=c(d,p,h,f,t[g+5],4,-378558),f=c(f,d,p,h,t[g+8],11,-2022574463),h=c(h,f,d,p,t[g+11],16,1839030562),p=c(p,h,f,d,t[g+14],23,-35309556),d=c(d,p,h,f,t[g+1],4,-1530992060),f=c(f,d,p,h,t[g+4],11,1272893353),h=c(h,f,d,p,t[g+7],16,-155497632),p=c(p,h,f,d,t[g+10],23,-1094730640),d=c(d,p,h,f,t[g+13],4,681279174),f=c(f,d,p,h,t[g+0],11,-358537222),h=c(h,f,d,p,t[g+3],16,-722521979),p=c(p,h,f,d,t[g+6],23,76029189),d=c(d,p,h,f,t[g+9],4,-640364487),f=c(f,d,p,h,t[g+12],11,-421815835),h=c(h,f,d,p,t[g+15],16,530742520),p=c(p,h,f,d,t[g+2],23,-995338651),d=l(d,p,h,f,t[g+0],6,-198630844),f=l(f,d,p,h,t[g+7],10,1126891415),h=l(h,f,d,p,t[g+14],15,-1416354905),p=l(p,h,f,d,t[g+5],21,-57434055),d=l(d,p,h,f,t[g+12],6,1700485571),f=l(f,d,p,h,t[g+3],10,-1894986606),h=l(h,f,d,p,t[g+10],15,-1051523),p=l(p,h,f,d,t[g+1],21,-2054922799),d=l(d,p,h,f,t[g+8],6,1873313359),f=l(f,d,p,h,t[g+15],10,-30611744),h=l(h,f,d,p,t[g+6],15,-1560198380),p=l(p,h,f,d,t[g+13],21,1309151649),d=l(d,p,h,f,t[g+4],6,-145523070),f=l(f,d,p,h,t[g+11],10,-1120210379),h=l(h,f,d,p,t[g+2],15,718787259),p=l(p,h,f,d,t[g+9],21,-343485551),d=e(d,i),p=e(p,r),h=e(h,o),f=e(f,u);return[d,p,h,f]},d={hexdigest:function(e){return r(u(n(e),8*e.length))},hash:function(e){return i(u(n(e),8*e.length))}};return d}();Function.prototype.bind||(Function.prototype.bind=function(e){var t=this,n=Array.prototype.slice,i=Array.prototype.concat,r=n.call(arguments,1);return function(){return t.apply(e?e:this,i.call(r,n.call(arguments,0)))}}),Array.prototype.indexOf||(Array.prototype.indexOf=function(e){var t=this.length,n=Number(arguments[1])||0;for(n=n<0?Math.ceil(n):Math.floor(n),n<0&&(n+=t);n<t;n++)if(n in this&&this[n]===e)return n;return-1}),function(e){function t(e,t){return new o.Builder(e,t)}function n(e){return new o.Builder("message",e)}function i(e){return new o.Builder("iq",e)}function r(e){return new o.Builder("presence",e)}var o;o={VERSION:"1.1.3",NS:{HTTPBIND:"http://jabber.org/protocol/httpbind",BOSH:"urn:xmpp:xbosh",CLIENT:"jabber:client",AUTH:"jabber:iq:auth",ROSTER:"jabber:iq:roster",PROFILE:"jabber:iq:profile",DISCO_INFO:"http://jabber.org/protocol/disco#info",DISCO_ITEMS:"http://jabber.org/protocol/disco#items",MUC:"http://jabber.org/protocol/muc",SASL:"urn:ietf:params:xml:ns:xmpp-sasl",STREAM:"http://etherx.jabber.org/streams",BIND:"urn:ietf:params:xml:ns:xmpp-bind",SESSION:"urn:ietf:params:xml:ns:xmpp-session",VERSION:"jabber:iq:version",STANZAS:"urn:ietf:params:xml:ns:xmpp-stanzas",XHTML_IM:"http://jabber.org/protocol/xhtml-im",XHTML:"http://www.w3.org/1999/xhtml"},XHTML:{tags:["a","blockquote","br","cite","em","img","li","ol","p","span","strong","ul","body"],attributes:{a:["href"],blockquote:["style"],br:[],cite:["style"],em:[],img:["src","alt","style","height","width"],li:["style"],ol:["style"],p:["style"],span:["style"],strong:[],ul:["style"],body:[]},css:["background-color","color","font-family","font-size","font-style","font-weight","margin-left","margin-right","text-align","text-decoration"],validTag:function(e){for(var t=0;t<o.XHTML.tags.length;t++)if(e==o.XHTML.tags[t])return!0;return!1},validAttribute:function(e,t){if("undefined"!=typeof o.XHTML.attributes[e]&&o.XHTML.attributes[e].length>0)for(var n=0;n<o.XHTML.attributes[e].length;n++)if(t==o.XHTML.attributes[e][n])return!0;return!1},validCSS:function(e){for(var t=0;t<o.XHTML.css.length;t++)if(e==o.XHTML.css[t])return!0;return!1}},Status:{ERROR:0,CONNECTING:1,CONNFAIL:2,AUTHENTICATING:3,AUTHFAIL:4,CONNECTED:5,DISCONNECTED:6,DISCONNECTING:7,ATTACHED:8},LogLevel:{DEBUG:0,INFO:1,WARN:2,ERROR:3,FATAL:4},ElementType:{NORMAL:1,TEXT:3,CDATA:4,FRAGMENT:11},TIMEOUT:1.1,SECONDARY_TIMEOUT:.1,addNamespace:function(e,t){o.NS[e]=t},forEachChild:function(e,t,n){var i,r;for(i=0;i<e.childNodes.length;i++)r=e.childNodes[i],r.nodeType!=o.ElementType.NORMAL||t&&!this.isTagEqual(r,t)||n(r)},isTagEqual:function(e,t){return e.tagName.toLowerCase()==t.toLowerCase()},_xmlGenerator:null,_makeGenerator:function(){var e;return void 0===document.implementation.createDocument||document.implementation.createDocument&&document.documentMode&&document.documentMode<10?(e=this._getIEXmlDom(),e.appendChild(e.createElement("strophe"))):e=document.implementation.createDocument("jabber:client","strophe",null),e},xmlGenerator:function(){return o._xmlGenerator||(o._xmlGenerator=o._makeGenerator()),o._xmlGenerator},_getIEXmlDom:function(){for(var e=null,t=["Msxml2.DOMDocument.6.0","Msxml2.DOMDocument.5.0","Msxml2.DOMDocument.4.0","MSXML2.DOMDocument.3.0","MSXML2.DOMDocument","MSXML.DOMDocument","Microsoft.XMLDOM"],n=0;n<t.length&&null===e;n++)try{e=new ActiveXObject(t[n])}catch(i){e=null}return e},xmlElement:function(e){if(!e)return null;var t,n,i,r=o.xmlGenerator().createElement(e);for(t=1;t<arguments.length;t++)if(arguments[t])if("string"==typeof arguments[t]||"number"==typeof arguments[t])r.appendChild(o.xmlTextNode(arguments[t]));else if("object"==typeof arguments[t]&&"function"==typeof arguments[t].sort)for(n=0;n<arguments[t].length;n++)"object"==typeof arguments[t][n]&&"function"==typeof arguments[t][n].sort&&r.setAttribute(arguments[t][n][0],arguments[t][n][1]);else if("object"==typeof arguments[t])for(i in arguments[t])arguments[t].hasOwnProperty(i)&&r.setAttribute(i,arguments[t][i]);return r},xmlescape:function(e){return e=e.replace(/\&/g,"&amp;"),e=e.replace(/</g,"&lt;"),e=e.replace(/>/g,"&gt;"),e=e.replace(/'/g,"&apos;"),e=e.replace(/"/g,"&quot;")},xmlTextNode:function(e){return o.xmlGenerator().createTextNode(e)},xmlHtmlNode:function(e){var t;if(window.DOMParser){var n=new DOMParser;t=n.parseFromString(e,"text/xml")}else t=new ActiveXObject("Microsoft.XMLDOM"),t.async="false",t.loadXML(e);return t},getText:function(e){if(!e)return null;var t="";0===e.childNodes.length&&e.nodeType==o.ElementType.TEXT&&(t+=e.nodeValue);for(var n=0;n<e.childNodes.length;n++)e.childNodes[n].nodeType==o.ElementType.TEXT&&(t+=e.childNodes[n].nodeValue);return o.xmlescape(t)},copyElement:function(e){var t,n;if(e.nodeType==o.ElementType.NORMAL){for(n=o.xmlElement(e.tagName),t=0;t<e.attributes.length;t++)n.setAttribute(e.attributes[t].nodeName.toLowerCase(),e.attributes[t].value);for(t=0;t<e.childNodes.length;t++)n.appendChild(o.copyElement(e.childNodes[t]))}else e.nodeType==o.ElementType.TEXT&&(n=o.xmlGenerator().createTextNode(e.nodeValue));return n},createHtml:function(e){var t,n,i,r,a,s,c,l,u,d,p;if(e.nodeType==o.ElementType.NORMAL)if(r=e.nodeName.toLowerCase(),o.XHTML.validTag(r))try{for(n=o.xmlElement(r),t=0;t<o.XHTML.attributes[r].length;t++)if(a=o.XHTML.attributes[r][t],s=e.getAttribute(a),"undefined"!=typeof s&&null!==s&&""!==s&&s!==!1&&0!==s)if("style"==a&&"object"==typeof s&&"undefined"!=typeof s.cssText&&(s=s.cssText),"style"==a){for(c=[],l=s.split(";"),i=0;i<l.length;i++)u=l[i].split(":"),d=u[0].replace(/^\s*/,"").replace(/\s*$/,"").toLowerCase(),o.XHTML.validCSS(d)&&(p=u[1].replace(/^\s*/,"").replace(/\s*$/,""),c.push(d+": "+p));c.length>0&&(s=c.join("; "),n.setAttribute(a,s))}else n.setAttribute(a,s);for(t=0;t<e.childNodes.length;t++)n.appendChild(o.createHtml(e.childNodes[t]))}catch(h){n=o.xmlTextNode("")}else for(n=o.xmlGenerator().createDocumentFragment(),t=0;t<e.childNodes.length;t++)n.appendChild(o.createHtml(e.childNodes[t]));else if(e.nodeType==o.ElementType.FRAGMENT)for(n=o.xmlGenerator().createDocumentFragment(),t=0;t<e.childNodes.length;t++)n.appendChild(o.createHtml(e.childNodes[t]));else e.nodeType==o.ElementType.TEXT&&(n=o.xmlTextNode(e.nodeValue));return n},escapeNode:function(e){return e.replace(/^\s+|\s+$/g,"").replace(/\\/g,"\\5c").replace(/ /g,"\\20").replace(/\"/g,"\\22").replace(/\&/g,"\\26").replace(/\'/g,"\\27").replace(/\//g,"\\2f").replace(/:/g,"\\3a").replace(/</g,"\\3c").replace(/>/g,"\\3e").replace(/@/g,"\\40")},unescapeNode:function(e){return e.replace(/\\20/g," ").replace(/\\22/g,'"').replace(/\\26/g,"&").replace(/\\27/g,"'").replace(/\\2f/g,"/").replace(/\\3a/g,":").replace(/\\3c/g,"<").replace(/\\3e/g,">").replace(/\\40/g,"@").replace(/\\5c/g,"\\")},getNodeFromJid:function(e){return e.indexOf("@")<0?null:e.split("@")[0]},getDomainFromJid:function(e){var t=o.getBareJidFromJid(e);if(t.indexOf("@")<0)return t;var n=t.split("@");return n.splice(0,1),n.join("@")},getResourceFromJid:function(e){var t=e.split("/");return t.length<2?null:(t.splice(0,1),t.join("/"))},getBareJidFromJid:function(e){return e?e.split("/")[0]:null},log:function(e,t){},debug:function(e){this.log(this.LogLevel.DEBUG,e)},info:function(e){this.log(this.LogLevel.INFO,e)},warn:function(e){this.log(this.LogLevel.WARN,e)},error:function(e){this.log(this.LogLevel.ERROR,e)},fatal:function(e){this.log(this.LogLevel.FATAL,e)},serialize:function(e){var t;if(!e)return null;"function"==typeof e.tree&&(e=e.tree());var n,i,r=e.nodeName;for(e.getAttribute("_realname")&&(r=e.getAttribute("_realname")),t="<"+r,n=0;n<e.attributes.length;n++)"_realname"!=e.attributes[n].nodeName&&(t+=" "+e.attributes[n].nodeName.toLowerCase()+"='"+e.attributes[n].value.replace(/&/g,"&amp;").replace(/\'/g,"&apos;").replace(/>/g,"&gt;").replace(/</g,"&lt;")+"'");if(e.childNodes.length>0){for(t+=">",n=0;n<e.childNodes.length;n++)switch(i=e.childNodes[n],i.nodeType){case o.ElementType.NORMAL:t+=o.serialize(i);break;case o.ElementType.TEXT:t+=o.xmlescape(i.nodeValue);break;case o.ElementType.CDATA:t+="<![CDATA["+i.nodeValue+"]]>"}t+="</"+r+">"}else t+="/>";return t},_requestId:0,_connectionPlugins:{},addConnectionPlugin:function(e,t){o._connectionPlugins[e]=t}},o.Builder=function(e,t){"presence"!=e&&"message"!=e&&"iq"!=e||(t&&!t.xmlns?t.xmlns=o.NS.CLIENT:t||(t={xmlns:o.NS.CLIENT})),this.nodeTree=o.xmlElement(e,t),this.node=this.nodeTree},o.Builder.prototype={tree:function(){return this.nodeTree},toString:function(){return o.serialize(this.nodeTree)},up:function(){return this.node=this.node.parentNode,this},attrs:function(e){for(var t in e)e.hasOwnProperty(t)&&this.node.setAttribute(t,e[t]);return this},c:function(e,t,n){var i=o.xmlElement(e,t,n);return this.node.appendChild(i),n||(this.node=i),this},cnode:function(e){var t,n=o.xmlGenerator();try{t=void 0!==n.importNode}catch(i){t=!1}var r=t?n.importNode(e,!0):o.copyElement(e);return this.node.appendChild(r),this.node=r,this},t:function(e){var t=o.xmlTextNode(e);return this.node.appendChild(t),this},h:function(e){var t=document.createElement("body");t.innerHTML=e;for(var n=o.createHtml(t);n.childNodes.length>0;)this.node.appendChild(n.childNodes[0]);return this}},o.Handler=function(e,t,n,i,r,a,s){this.handler=e,this.ns=t,this.name=n,this.type=i,this.id=r,this.options=s||{matchBare:!1},this.options.matchBare||(this.options.matchBare=!1),this.options.matchBare?this.from=a?o.getBareJidFromJid(a):null:this.from=a,this.user=!0},o.Handler.prototype={isMatch:function(e){var t,n=null;if(n=this.options.matchBare?o.getBareJidFromJid(e.getAttribute("from")):e.getAttribute("from"),t=!1,this.ns){var i=this;o.forEachChild(e,null,function(e){e.getAttribute("xmlns")==i.ns&&(t=!0)}),t=t||e.getAttribute("xmlns")==this.ns}else t=!0;return!(!t||this.name&&!o.isTagEqual(e,this.name)||this.type&&e.getAttribute("type")!=this.type||this.id&&e.getAttribute("id")!=this.id||this.from&&n!=this.from)},run:function(e){var t=null;try{t=this.handler(e)}catch(n){throw n.sourceURL?o.fatal("error: "+this.handler+" "+n.sourceURL+":"+n.line+" - "+n.name+": "+n.message):n.fileName?("undefined"!=typeof console&&(console.trace(),console.error(this.handler," - error - ",n,n.message)),o.fatal("error: "+this.handler+" "+n.fileName+":"+n.lineNumber+" - "+n.name+": "+n.message)):o.fatal("error: "+n.message+"\n"+n.stack),n}return t},toString:function(){return"{Handler: "+this.handler+"("+this.name+","+this.id+","+this.ns+")}"}},o.TimedHandler=function(e,t){this.period=e,this.handler=t,this.lastCalled=(new Date).getTime(),this.user=!0},o.TimedHandler.prototype={run:function(){return this.lastCalled=(new Date).getTime(),this.handler()},reset:function(){this.lastCalled=(new Date).getTime()},toString:function(){return"{TimedHandler: "+this.handler+"("+this.period+")}"}},o.Connection=function(e,t){this.service=e,this.options=t||{};var n=this.options.protocol||"";0===e.indexOf("ws:")||0===e.indexOf("wss:")||0===n.indexOf("ws")?this._proto=new o.Websocket(this):this._proto=new o.Bosh(this),this.jid="",this.domain=null,this.features=null,this._sasl_data={},this.do_session=!1,this.do_bind=!1,this.timedHandlers=[],this.handlers=[],this.removeTimeds=[],this.removeHandlers=[],this.addTimeds=[],this.addHandlers=[],this._authentication={},this._idleTimeout=null,this._disconnectTimeout=null,this.do_authentication=!0,this.authenticated=!1,this.disconnecting=!1,this.connected=!1,this.errors=0,this.paused=!1,this._data=[],this._uniqueId=0,this._sasl_success_handler=null,this._sasl_failure_handler=null,this._sasl_challenge_handler=null,this.maxRetries=5,this._idleTimeout=setTimeout(this._onIdle.bind(this),100);for(var i in o._connectionPlugins)if(o._connectionPlugins.hasOwnProperty(i)){var r=o._connectionPlugins[i],a=function(){};a.prototype=r,this[i]=new a,this[i].init(this)}},o.Connection.prototype={reset:function(){this._proto._reset(),this.do_session=!1,this.do_bind=!1,this.timedHandlers=[],this.handlers=[],this.removeTimeds=[],this.removeHandlers=[],this.addTimeds=[],this.addHandlers=[],this._authentication={},this.authenticated=!1,this.disconnecting=!1,this.connected=!1,this.errors=0,this._requests=[],this._uniqueId=0},pause:function(){this.paused=!0},resume:function(){this.paused=!1},getUniqueId:function(e){return"string"==typeof e||"number"==typeof e?++this._uniqueId+":"+e:++this._uniqueId+""},connect:function(e,t,n,i,r,a){this.jid=e,this.authzid=o.getBareJidFromJid(this.jid),this.authcid=o.getNodeFromJid(this.jid),this.pass=t,this.servtype="xmpp",this.connect_callback=n,this.disconnecting=!1,this.connected=!1,this.authenticated=!1,this.errors=0,this.domain=o.getDomainFromJid(this.jid),this._changeConnectStatus(o.Status.CONNECTING,null),this._proto._connect(i,r,a)},attach:function(e,t,n,i,r,o,a){this._proto._attach(e,t,n,i,r,o,a)},xmlInput:function(e){},xmlOutput:function(e){},rawInput:function(e){},rawOutput:function(e){},send:function(e){if(null!==e){if("function"==typeof e.sort)for(var t=0;t<e.length;t++)this._queueData(e[t]);else"function"==typeof e.tree?this._queueData(e.tree()):this._queueData(e);this._proto._send()}},flush:function(){clearTimeout(this._idleTimeout),this._onIdle()},sendIQ:function(e,t,n,i){var r=null,o=this;"function"==typeof e.tree&&(e=e.tree());var a=e.getAttribute("id");a||(a=this.getUniqueId("sendIQ"),e.setAttribute("id",a));var s=this.addHandler(function(e){r&&o.deleteTimedHandler(r);var i=e.getAttribute("type");if("result"==i)t&&t(e);else{if("error"!=i)throw{name:"StropheError",message:"Got bad IQ type of "+i};n&&n(e)}},null,"iq",null,a);return i&&(r=this.addTimedHandler(i,function(){return o.deleteHandler(s),n&&n(null),!1})),this.send(e),a},_queueData:function(e){if(null===e||!e.tagName||!e.childNodes)throw{name:"StropheError",message:"Cannot queue non-DOMElement."};this._data.push(e)},_sendRestart:function(){this._data.push("restart"),this._proto._sendRestart(),this._idleTimeout=setTimeout(this._onIdle.bind(this),100)},addTimedHandler:function(e,t){var n=new o.TimedHandler(e,t);return this.addTimeds.push(n),n},deleteTimedHandler:function(e){this.removeTimeds.push(e)},addHandler:function(e,t,n,i,r,a,s){var c=new o.Handler(e,t,n,i,r,a,s);return this.addHandlers.push(c),c},deleteHandler:function(e){this.removeHandlers.push(e)},disconnect:function(e){if(this._changeConnectStatus(o.Status.DISCONNECTING,e),o.info("Disconnect was called because: "+e),this.connected){var t=!1;this.disconnecting=!0,this.authenticated&&(t=r({xmlns:o.NS.CLIENT,type:"unavailable"})),this._disconnectTimeout=this._addSysTimedHandler(3e3,this._onDisconnectTimeout.bind(this)),this._proto._disconnect(t)}},_changeConnectStatus:function(e,t){for(var n in o._connectionPlugins)if(o._connectionPlugins.hasOwnProperty(n)){var i=this[n];if(i.statusChanged)try{i.statusChanged(e,t)}catch(r){o.error(""+n+" plugin caused an exception changing status: "+r);
}}if(this.connect_callback)try{this.connect_callback(e,t)}catch(a){o.error("User connection callback caused an exception: "+a)}},_doDisconnect:function(){null!==this._disconnectTimeout&&(this.deleteTimedHandler(this._disconnectTimeout),this._disconnectTimeout=null),o.info("_doDisconnect was called"),this._proto._doDisconnect(),this.authenticated=!1,this.disconnecting=!1,this.handlers=[],this.timedHandlers=[],this.removeTimeds=[],this.removeHandlers=[],this.addTimeds=[],this.addHandlers=[],this._changeConnectStatus(o.Status.DISCONNECTED,null),this.connected=!1},_dataRecv:function(e,t){o.info("_dataRecv called");var n=this._proto._reqToData(e);if(null!==n){this.xmlInput!==o.Connection.prototype.xmlInput&&(n.nodeName===this._proto.strip&&n.childNodes.length?this.xmlInput(n.childNodes[0]):this.xmlInput(n)),this.rawInput!==o.Connection.prototype.rawInput&&(t?this.rawInput(t):this.rawInput(o.serialize(n)));for(var i,r;this.removeHandlers.length>0;)r=this.removeHandlers.pop(),i=this.handlers.indexOf(r),i>=0&&this.handlers.splice(i,1);for(;this.addHandlers.length>0;)this.handlers.push(this.addHandlers.pop());if(this.disconnecting&&this._proto._emptyQueue())return void this._doDisconnect();var a,s,c=n.getAttribute("type");if(null!==c&&"terminate"==c){if(this.disconnecting)return;return a=n.getAttribute("condition"),s=n.getElementsByTagName("conflict"),null!==a?("remote-stream-error"==a&&s.length>0&&(a="conflict"),this._changeConnectStatus(o.Status.CONNFAIL,a)):this._changeConnectStatus(o.Status.CONNFAIL,"unknown"),void this.disconnect("unknown stream-error")}var l=this;o.forEachChild(n,null,function(e){var t,n;for(n=l.handlers,l.handlers=[],t=0;t<n.length;t++){var i=n[t];try{!i.isMatch(e)||!l.authenticated&&i.user?l.handlers.push(i):i.run(e)&&l.handlers.push(i)}catch(r){o.warn("Removing Strophe handlers due to uncaught exception: "+r.message)}}})}},mechanisms:{},_connect_cb:function(e,t,n){o.info("_connect_cb was called"),this.connected=!0;var i=this._proto._reqToData(e);if(i){this.xmlInput!==o.Connection.prototype.xmlInput&&(i.nodeName===this._proto.strip&&i.childNodes.length?this.xmlInput(i.childNodes[0]):this.xmlInput(i)),this.rawInput!==o.Connection.prototype.rawInput&&(n?this.rawInput(n):this.rawInput(o.serialize(i)));var r=this._proto._connect_cb(i);if(r!==o.Status.CONNFAIL){this._authentication.sasl_scram_sha1=!1,this._authentication.sasl_plain=!1,this._authentication.sasl_digest_md5=!1,this._authentication.sasl_anonymous=!1,this._authentication.legacy_auth=!1;var a=i.getElementsByTagName("stream:features").length>0;a||(a=i.getElementsByTagName("features").length>0);var s,c,l=i.getElementsByTagName("mechanism"),u=[],d=!1;if(!a)return void this._proto._no_auth_received(t);if(l.length>0)for(s=0;s<l.length;s++)c=o.getText(l[s]),this.mechanisms[c]&&u.push(this.mechanisms[c]);return this._authentication.legacy_auth=i.getElementsByTagName("auth").length>0,(d=this._authentication.legacy_auth||u.length>0)?void(this.do_authentication!==!1&&this.authenticate(u)):void this._proto._no_auth_received(t)}}},authenticate:function(e){var n;for(n=0;n<e.length-1;++n){for(var r=n,a=n+1;a<e.length;++a)e[a].prototype.priority>e[r].prototype.priority&&(r=a);if(r!=n){var s=e[n];e[n]=e[r],e[r]=s}}var c=!1;for(n=0;n<e.length;++n)if(e[n].test(this)){this._sasl_success_handler=this._addSysHandler(this._sasl_success_cb.bind(this),null,"success",null,null),this._sasl_failure_handler=this._addSysHandler(this._sasl_failure_cb.bind(this),null,"failure",null,null),this._sasl_challenge_handler=this._addSysHandler(this._sasl_challenge_cb.bind(this),null,"challenge",null,null),this._sasl_mechanism=new e[n],this._sasl_mechanism.onStart(this);var l=t("auth",{xmlns:o.NS.SASL,mechanism:this._sasl_mechanism.name});if(this._sasl_mechanism.isClientFirst){var u=this._sasl_mechanism.onChallenge(this,null);l.t(Base64.encode(u))}this.send(l.tree()),c=!0;break}c||(null===o.getNodeFromJid(this.jid)?(this._changeConnectStatus(o.Status.CONNFAIL,"x-strophe-bad-non-anon-jid"),this.disconnect("x-strophe-bad-non-anon-jid")):(this._changeConnectStatus(o.Status.AUTHENTICATING,null),this._addSysHandler(this._auth1_cb.bind(this),null,null,null,"_auth_1"),this.send(i({type:"get",to:this.domain,id:"_auth_1"}).c("query",{xmlns:o.NS.AUTH}).c("username",{}).t(o.getNodeFromJid(this.jid)).tree())))},_sasl_challenge_cb:function(e){var n=Base64.decode(o.getText(e)),i=this._sasl_mechanism.onChallenge(this,n),r=t("response",{xmlns:o.NS.SASL});return""!==i&&r.t(Base64.encode(i)),this.send(r.tree()),!0},_auth1_cb:function(e){var t=i({type:"set",id:"_auth_2"}).c("query",{xmlns:o.NS.AUTH}).c("username",{}).t(o.getNodeFromJid(this.jid)).up().c("password").t(this.pass);return o.getResourceFromJid(this.jid)||(this.jid=o.getBareJidFromJid(this.jid)+"/strophe"),t.up().c("resource",{}).t(o.getResourceFromJid(this.jid)),this._addSysHandler(this._auth2_cb.bind(this),null,null,null,"_auth_2"),this.send(t.tree()),!1},_sasl_success_cb:function(e){if(this._sasl_data["server-signature"]){var t,n=Base64.decode(o.getText(e)),i=/([a-z]+)=([^,]+)(,|$)/,r=n.match(i);if("v"==r[1]&&(t=r[2]),t!=this._sasl_data["server-signature"])return this.deleteHandler(this._sasl_failure_handler),this._sasl_failure_handler=null,this._sasl_challenge_handler&&(this.deleteHandler(this._sasl_challenge_handler),this._sasl_challenge_handler=null),this._sasl_data={},this._sasl_failure_cb(null)}return o.info("SASL authentication succeeded."),this._sasl_mechanism&&this._sasl_mechanism.onSuccess(),this.deleteHandler(this._sasl_failure_handler),this._sasl_failure_handler=null,this._sasl_challenge_handler&&(this.deleteHandler(this._sasl_challenge_handler),this._sasl_challenge_handler=null),this._addSysHandler(this._sasl_auth1_cb.bind(this),null,"stream:features",null,null),this._sendRestart(),!1},_sasl_auth1_cb:function(e){this.features=e;var t,n;for(t=0;t<e.childNodes.length;t++)n=e.childNodes[t],"bind"==n.nodeName&&(this.do_bind=!0),"session"==n.nodeName&&(this.do_session=!0);if(!this.do_bind)return this._changeConnectStatus(o.Status.AUTHFAIL,null),!1;this._addSysHandler(this._sasl_bind_cb.bind(this),null,null,null,"_bind_auth_2");var r=o.getResourceFromJid(this.jid);return r?this.send(i({type:"set",id:"_bind_auth_2"}).c("bind",{xmlns:o.NS.BIND}).c("resource",{}).t(r).tree()):this.send(i({type:"set",id:"_bind_auth_2"}).c("bind",{xmlns:o.NS.BIND}).tree()),!1},_sasl_bind_cb:function(e){if("error"==e.getAttribute("type")){o.info("SASL binding failed.");var t,n=e.getElementsByTagName("conflict");return n.length>0&&(t="conflict"),this._changeConnectStatus(o.Status.AUTHFAIL,t),!1}var r,a=e.getElementsByTagName("bind");return a.length>0?(r=a[0].getElementsByTagName("jid"),void(r.length>0&&(this.jid=o.getText(r[0]),this.do_session?(this._addSysHandler(this._sasl_session_cb.bind(this),null,null,null,"_session_auth_2"),this.send(i({type:"set",id:"_session_auth_2"}).c("session",{xmlns:o.NS.SESSION}).tree())):(this.authenticated=!0,this._changeConnectStatus(o.Status.CONNECTED,null))))):(o.info("SASL binding failed."),this._changeConnectStatus(o.Status.AUTHFAIL,null),!1)},_sasl_session_cb:function(e){if("result"==e.getAttribute("type"))this.authenticated=!0,this._changeConnectStatus(o.Status.CONNECTED,null);else if("error"==e.getAttribute("type"))return o.info("Session creation failed."),this._changeConnectStatus(o.Status.AUTHFAIL,null),!1;return!1},_sasl_failure_cb:function(e){return this._sasl_success_handler&&(this.deleteHandler(this._sasl_success_handler),this._sasl_success_handler=null),this._sasl_challenge_handler&&(this.deleteHandler(this._sasl_challenge_handler),this._sasl_challenge_handler=null),this._sasl_mechanism&&this._sasl_mechanism.onFailure(),this._changeConnectStatus(o.Status.AUTHFAIL,null),!1},_auth2_cb:function(e){return"result"==e.getAttribute("type")?(this.authenticated=!0,this._changeConnectStatus(o.Status.CONNECTED,null)):"error"==e.getAttribute("type")&&(this._changeConnectStatus(o.Status.AUTHFAIL,null),this.disconnect("authentication failed")),!1},_addSysTimedHandler:function(e,t){var n=new o.TimedHandler(e,t);return n.user=!1,this.addTimeds.push(n),n},_addSysHandler:function(e,t,n,i,r){var a=new o.Handler(e,t,n,i,r);return a.user=!1,this.addHandlers.push(a),a},_onDisconnectTimeout:function(){return o.info("_onDisconnectTimeout was called"),this._proto._onDisconnectTimeout(),this._doDisconnect(),!1},_onIdle:function(){for(var e,t,n,i;this.addTimeds.length>0;)this.timedHandlers.push(this.addTimeds.pop());for(;this.removeTimeds.length>0;)t=this.removeTimeds.pop(),e=this.timedHandlers.indexOf(t),e>=0&&this.timedHandlers.splice(e,1);var r=(new Date).getTime();for(i=[],e=0;e<this.timedHandlers.length;e++)t=this.timedHandlers[e],!this.authenticated&&t.user||(n=t.lastCalled+t.period,n-r<=0?t.run()&&i.push(t):i.push(t));this.timedHandlers=i,clearTimeout(this._idleTimeout),this._proto._onIdle(),this.connected&&(this._idleTimeout=setTimeout(this._onIdle.bind(this),100))}},e&&e(o,t,n,i,r),o.SASLMechanism=function(e,t,n){this.name=e,this.isClientFirst=t,this.priority=n},o.SASLMechanism.prototype={test:function(e){return!0},onStart:function(e){this._connection=e},onChallenge:function(e,t){throw new Error("You should implement challenge handling!")},onFailure:function(){this._connection=null},onSuccess:function(){this._connection=null}},o.SASLAnonymous=function(){},o.SASLAnonymous.prototype=new o.SASLMechanism("ANONYMOUS",(!1),10),o.SASLAnonymous.test=function(e){return null===e.authcid},o.Connection.prototype.mechanisms[o.SASLAnonymous.prototype.name]=o.SASLAnonymous,o.SASLPlain=function(){},o.SASLPlain.prototype=new o.SASLMechanism("PLAIN",(!0),20),o.SASLPlain.test=function(e){return null!==e.authcid},o.SASLPlain.prototype.onChallenge=function(e){var t=e.authzid;return t+="\0",t+=e.authcid,t+="\0",t+=e.pass},o.Connection.prototype.mechanisms[o.SASLPlain.prototype.name]=o.SASLPlain,o.SASLSHA1=function(){},o.SASLSHA1.prototype=new o.SASLMechanism("SCRAM-SHA-1",(!0),40),o.SASLSHA1.test=function(e){return null!==e.authcid},o.SASLSHA1.prototype.onChallenge=function(e,t,n){var i=n||MD5.hexdigest(1234567890*Math.random()),r="n="+e.authcid;return r+=",r=",r+=i,e._sasl_data.cnonce=i,e._sasl_data["client-first-message-bare"]=r,r="n,,"+r,this.onChallenge=function(e,t){for(var n,i,r,o,a,s,c,l,u,d,p,h="c=biws,",f=e._sasl_data["client-first-message-bare"]+","+t+",",g=e._sasl_data.cnonce,m=/([a-z]+)=([^,]+)(,|$)/;t.match(m);){var v=t.match(m);switch(t=t.replace(v[0],""),v[1]){case"r":n=v[2];break;case"s":i=v[2];break;case"i":r=v[2]}}if(n.substr(0,g.length)!==g)return e._sasl_data={},e._sasl_failure_cb();for(h+="r="+n,f+=h,i=Base64.decode(i),i+="\0\0\0",o=s=core_hmac_sha1(e.pass,i),c=1;c<r;c++){for(a=core_hmac_sha1(e.pass,binb2str(s)),l=0;l<5;l++)o[l]^=a[l];s=a}for(o=binb2str(o),u=core_hmac_sha1(o,"Client Key"),d=str_hmac_sha1(o,"Server Key"),p=core_hmac_sha1(str_sha1(binb2str(u)),f),e._sasl_data["server-signature"]=b64_hmac_sha1(d,f),l=0;l<5;l++)u[l]^=p[l];return h+=",p="+Base64.encode(binb2str(u))}.bind(this),r},o.Connection.prototype.mechanisms[o.SASLSHA1.prototype.name]=o.SASLSHA1,o.SASLMD5=function(){},o.SASLMD5.prototype=new o.SASLMechanism("DIGEST-MD5",(!1),30),o.SASLMD5.test=function(e){return null!==e.authcid},o.SASLMD5.prototype._quote=function(e){return'"'+e.replace(/\\/g,"\\\\").replace(/"/g,'\\"')+'"'},o.SASLMD5.prototype.onChallenge=function(e,t,n){for(var i,r=/([a-z]+)=("[^"]+"|[^,"]+)(?:,|$)/,o=n||MD5.hexdigest(""+1234567890*Math.random()),a="",s=null,c="",l="";t.match(r);)switch(i=t.match(r),t=t.replace(i[0],""),i[2]=i[2].replace(/^"(.+)"$/,"$1"),i[1]){case"realm":a=i[2];break;case"nonce":c=i[2];break;case"qop":l=i[2];break;case"host":s=i[2]}var u=e.servtype+"/"+e.domain;null!==s&&(u=u+"/"+s);var d=MD5.hash(e.authcid+":"+a+":"+this._connection.pass)+":"+c+":"+o,p="AUTHENTICATE:"+u,h="";return h+="charset=utf-8,",h+="username="+this._quote(e.authcid)+",",h+="realm="+this._quote(a)+",",h+="nonce="+this._quote(c)+",",h+="nc=00000001,",h+="cnonce="+this._quote(o)+",",h+="digest-uri="+this._quote(u)+",",h+="response="+MD5.hexdigest(MD5.hexdigest(d)+":"+c+":00000001:"+o+":auth:"+MD5.hexdigest(p))+",",h+="qop=auth",this.onChallenge=function(){return""}.bind(this),h},o.Connection.prototype.mechanisms[o.SASLMD5.prototype.name]=o.SASLMD5}(function(){window.Strophe=arguments[0],window.$build=arguments[1],window.$msg=arguments[2],window.$iq=arguments[3],window.$pres=arguments[4]}),Strophe.Request=function(e,t,n,i){this.id=++Strophe._requestId,this.xmlData=e,this.data=Strophe.serialize(e),this.origFunc=t,this.func=t,this.rid=n,this.date=NaN,this.sends=i||0,this.abort=!1,this.dead=null,this.age=function(){if(!this.date)return 0;var e=new Date;return(e-this.date)/1e3},this.timeDead=function(){if(!this.dead)return 0;var e=new Date;return(e-this.dead)/1e3},this.xhr=this._newXHR()},Strophe.Request.prototype={getResponse:function(){var e=null;if(this.xhr.responseXML&&this.xhr.responseXML.documentElement){if(e=this.xhr.responseXML.documentElement,"parsererror"==e.tagName)throw Strophe.error("invalid response received"),Strophe.error("responseText: "+this.xhr.responseText),Strophe.error("responseXML: "+Strophe.serialize(this.xhr.responseXML)),"parsererror"}else this.xhr.responseText&&(Strophe.error("invalid response received"),Strophe.error("responseText: "+this.xhr.responseText),Strophe.error("responseXML: "+Strophe.serialize(this.xhr.responseXML)));return e},_newXHR:function(){var e=null;return window.XMLHttpRequest?(e=new XMLHttpRequest,e.overrideMimeType&&e.overrideMimeType("text/xml")):window.ActiveXObject&&(e=new ActiveXObject("Microsoft.XMLHTTP")),e.onreadystatechange=this.func.bind(null,this),e}},Strophe.Bosh=function(e){this._conn=e,this.rid=Math.floor(4294967295*Math.random()),this.sid=null,this.hold=1,this.wait=60,this.window=5,this._requests=[]},Strophe.Bosh.prototype={strip:null,_buildBody:function(){var e=$build("body",{rid:this.rid++,xmlns:Strophe.NS.HTTPBIND});return null!==this.sid&&e.attrs({sid:this.sid}),e},_reset:function(){this.rid=Math.floor(4294967295*Math.random()),this.sid=null},_connect:function(e,t,n){this.wait=e||this.wait,this.hold=t||this.hold;var i=this._buildBody().attrs({to:this._conn.domain,"xml:lang":"en",wait:this.wait,hold:this.hold,content:"text/xml; charset=utf-8",ver:"1.6","xmpp:version":"1.0","xmlns:xmpp":Strophe.NS.BOSH});n&&i.attrs({route:n});var r=this._conn._connect_cb;this._requests.push(new Strophe.Request(i.tree(),this._onRequestStateChange.bind(this,r.bind(this._conn)),i.tree().getAttribute("rid"))),this._throttledRequestHandler()},_attach:function(e,t,n,i,r,o,a){this._conn.jid=e,this.sid=t,this.rid=n,this._conn.connect_callback=i,this._conn.domain=Strophe.getDomainFromJid(this._conn.jid),this._conn.authenticated=!0,this._conn.connected=!0,this.wait=r||this.wait,this.hold=o||this.hold,this.window=a||this.window,this._conn._changeConnectStatus(Strophe.Status.ATTACHED,null)},_connect_cb:function(e){var t,n,i=e.getAttribute("type");if(null!==i&&"terminate"==i)return Strophe.error("BOSH-Connection failed: "+t),t=e.getAttribute("condition"),n=e.getElementsByTagName("conflict"),null!==t?("remote-stream-error"==t&&n.length>0&&(t="conflict"),this._conn._changeConnectStatus(Strophe.Status.CONNFAIL,t)):this._conn._changeConnectStatus(Strophe.Status.CONNFAIL,"unknown"),this._conn._doDisconnect(),Strophe.Status.CONNFAIL;this.sid||(this.sid=e.getAttribute("sid"));var r=e.getAttribute("requests");r&&(this.window=parseInt(r,10));var o=e.getAttribute("hold");o&&(this.hold=parseInt(o,10));var a=e.getAttribute("wait");a&&(this.wait=parseInt(a,10))},_disconnect:function(e){this._sendTerminate(e)},_doDisconnect:function(){this.sid=null,this.rid=Math.floor(4294967295*Math.random())},_emptyQueue:function(){return 0===this._requests.length},_hitError:function(e){this.errors++,Strophe.warn("request errored, status: "+e+", number of errors: "+this.errors),this.errors>4&&this._onDisconnectTimeout()},_no_auth_received:function(e){e=e?e.bind(this._conn):this._conn._connect_cb.bind(this._conn);var t=this._buildBody();this._requests.push(new Strophe.Request(t.tree(),this._onRequestStateChange.bind(this,e.bind(this._conn)),t.tree().getAttribute("rid"))),this._throttledRequestHandler()},_onDisconnectTimeout:function(){for(var e;this._requests.length>0;)e=this._requests.pop(),e.abort=!0,e.xhr.abort(),e.xhr.onreadystatechange=function(){}},_onIdle:function(){var e=this._conn._data;if(this._conn.authenticated&&0===this._requests.length&&0===e.length&&!this._conn.disconnecting&&(Strophe.info("no requests during idle cycle, sending blank request"),e.push(null)),this._requests.length<2&&e.length>0&&!this._conn.paused){for(var t=this._buildBody(),n=0;n<e.length;n++)null!==e[n]&&("restart"===e[n]?t.attrs({to:this._conn.domain,"xml:lang":"en","xmpp:restart":"true","xmlns:xmpp":Strophe.NS.BOSH}):t.cnode(e[n]).up());delete this._conn._data,this._conn._data=[],this._requests.push(new Strophe.Request(t.tree(),this._onRequestStateChange.bind(this,this._conn._dataRecv.bind(this._conn)),t.tree().getAttribute("rid"))),this._processRequest(this._requests.length-1)}if(this._requests.length>0){var i=this._requests[0].age();null!==this._requests[0].dead&&this._requests[0].timeDead()>Math.floor(Strophe.SECONDARY_TIMEOUT*this.wait)&&this._throttledRequestHandler(),i>Math.floor(Strophe.TIMEOUT*this.wait)&&(Strophe.warn("Request "+this._requests[0].id+" timed out, over "+Math.floor(Strophe.TIMEOUT*this.wait)+" seconds since last activity"),this._throttledRequestHandler())}},_onRequestStateChange:function(e,t){if(Strophe.debug("request id "+t.id+"."+t.sends+" state changed to "+t.xhr.readyState),t.abort)return void(t.abort=!1);var n;if(4==t.xhr.readyState){n=0;try{n=t.xhr.status}catch(i){}if("undefined"==typeof n&&(n=0),this.disconnecting&&n>=400)return void this._hitError(n);var r=this._requests[0]==t,o=this._requests[1]==t;(n>0&&n<500||t.sends>5)&&(this._removeRequest(t),Strophe.debug("request id "+t.id+" should now be removed")),200==n?((o||r&&this._requests.length>0&&this._requests[0].age()>Math.floor(Strophe.SECONDARY_TIMEOUT*this.wait))&&this._restartRequest(0),Strophe.debug("request id "+t.id+"."+t.sends+" got 200"),e(t),this.errors=0):(Strophe.error("request id "+t.id+"."+t.sends+" error "+n+" happened"),(0===n||n>=400&&n<600||n>=12e3)&&(this._hitError(n),n>=400&&n<500&&(this._conn._changeConnectStatus(Strophe.Status.DISCONNECTING,null),this._conn._doDisconnect()))),n>0&&n<500||t.sends>5||this._throttledRequestHandler()}},_processRequest:function(e){var t=this,n=this._requests[e],i=-1;try{4==n.xhr.readyState&&(i=n.xhr.status)}catch(r){Strophe.error("caught an error in _requests["+e+"], reqStatus: "+i)}if("undefined"==typeof i&&(i=-1),n.sends>this.maxRetries)return void this._onDisconnectTimeout();var o=n.age(),a=!isNaN(o)&&o>Math.floor(Strophe.TIMEOUT*this.wait),s=null!==n.dead&&n.timeDead()>Math.floor(Strophe.SECONDARY_TIMEOUT*this.wait),c=4==n.xhr.readyState&&(i<1||i>=500);if((a||s||c)&&(s&&Strophe.error("Request "+this._requests[e].id+" timed out (secondary), restarting"),n.abort=!0,n.xhr.abort(),n.xhr.onreadystatechange=function(){},this._requests[e]=new Strophe.Request(n.xmlData,n.origFunc,n.rid,n.sends),n=this._requests[e]),0===n.xhr.readyState){Strophe.debug("request id "+n.id+"."+n.sends+" posting");try{n.xhr.open("POST",this._conn.service,!this._conn.options.sync)}catch(l){return Strophe.error("XHR open failed."),this._conn.connected||this._conn._changeConnectStatus(Strophe.Status.CONNFAIL,"bad-service"),void this._conn.disconnect()}var u=function(){if(n.date=new Date,t._conn.options.customHeaders){var e=t._conn.options.customHeaders;for(var i in e)e.hasOwnProperty(i)&&n.xhr.setRequestHeader(i,e[i])}n.xhr.send(n.data)};if(n.sends>1){var d=1e3*Math.min(Math.floor(Strophe.TIMEOUT*this.wait),Math.pow(n.sends,3));setTimeout(u,d)}else u();n.sends++,this._conn.xmlOutput!==Strophe.Connection.prototype.xmlOutput&&(n.xmlData.nodeName===this.strip&&n.xmlData.childNodes.length?this._conn.xmlOutput(n.xmlData.childNodes[0]):this._conn.xmlOutput(n.xmlData)),this._conn.rawOutput!==Strophe.Connection.prototype.rawOutput&&this._conn.rawOutput(n.data)}else Strophe.debug("_processRequest: "+(0===e?"first":"second")+" request has readyState of "+n.xhr.readyState)},_removeRequest:function(e){Strophe.debug("removing request");var t;for(t=this._requests.length-1;t>=0;t--)e==this._requests[t]&&this._requests.splice(t,1);e.xhr.onreadystatechange=function(){},this._throttledRequestHandler()},_restartRequest:function(e){var t=this._requests[e];null===t.dead&&(t.dead=new Date),this._processRequest(e)},_reqToData:function(e){try{return e.getResponse()}catch(t){if("parsererror"!=t)throw t;this._conn.disconnect("strophe-parsererror")}},_sendTerminate:function(e){Strophe.info("_sendTerminate was called");var t=this._buildBody().attrs({type:"terminate"});e&&t.cnode(e.tree());var n=new Strophe.Request(t.tree(),this._onRequestStateChange.bind(this,this._conn._dataRecv.bind(this._conn)),t.tree().getAttribute("rid"));this._requests.push(n),this._throttledRequestHandler()},_send:function(){clearTimeout(this._conn._idleTimeout),this._throttledRequestHandler(),this._conn._idleTimeout=setTimeout(this._conn._onIdle.bind(this._conn),100)},_sendRestart:function(){this._throttledRequestHandler(),clearTimeout(this._conn._idleTimeout)},_throttledRequestHandler:function(){this._requests?Strophe.debug("_throttledRequestHandler called with "+this._requests.length+" requests"):Strophe.debug("_throttledRequestHandler called with undefined requests"),this._requests&&0!==this._requests.length&&(this._requests.length>0&&this._processRequest(0),this._requests.length>1&&Math.abs(this._requests[0].rid-this._requests[1].rid)<this.window&&this._processRequest(1))}},Strophe.Websocket=function(e){this._conn=e,this.strip="stream:stream";var t=e.service;if(0!==t.indexOf("ws:")&&0!==t.indexOf("wss:")){var n="";n+="ws"===e.options.protocol&&"https:"!==window.location.protocol?"ws":"wss",n+="://"+window.location.host,n+=0!==t.indexOf("/")?window.location.pathname+t:t,e.service=n}},Strophe.Websocket.prototype={_buildStream:function(){return $build("stream:stream",{to:this._conn.domain,xmlns:Strophe.NS.CLIENT,"xmlns:stream":Strophe.NS.STREAM,version:"1.0"})},_check_streamerror:function(e,t){var n=e.getElementsByTagName("stream:error");if(0===n.length)return!1;for(var i=n[0],r="",o="",a="urn:ietf:params:xml:ns:xmpp-streams",s=0;s<i.childNodes.length;s++){var c=i.childNodes[s];if(c.getAttribute("xmlns")!==a)break;"text"===c.nodeName?o=c.textContent:r=c.nodeName}var l="WebSocket stream error: ";return l+=r?r:"unknown",o&&(l+=" - "+r),Strophe.error(l),this._conn._changeConnectStatus(t,r),this._conn._doDisconnect(),!0},_reset:function(){},_connect:function(){this._closeSocket(),this.socket=new WebSocket(this._conn.service,"xmpp"),this.socket.onopen=this._onOpen.bind(this),this.socket.onerror=this._onError.bind(this),this.socket.onclose=this._onClose.bind(this),this.socket.onmessage=this._connect_cb_wrapper.bind(this)},_connect_cb:function(e){var t=this._check_streamerror(e,Strophe.Status.CONNFAIL);if(t)return Strophe.Status.CONNFAIL},_handleStreamStart:function(e){var t=!1,n=e.getAttribute("xmlns");"string"!=typeof n?t="Missing xmlns in stream:stream":n!==Strophe.NS.CLIENT&&(t="Wrong xmlns in stream:stream: "+n);var i=e.namespaceURI;"string"!=typeof i?t="Missing xmlns:stream in stream:stream":i!==Strophe.NS.STREAM&&(t="Wrong xmlns:stream in stream:stream: "+i);var r=e.getAttribute("version");return"string"!=typeof r?t="Missing version in stream:stream":"1.0"!==r&&(t="Wrong version in stream:stream: "+r),!t||(this._conn._changeConnectStatus(Strophe.Status.CONNFAIL,t),this._conn._doDisconnect(),!1)},_connect_cb_wrapper:function(e){if(0===e.data.indexOf("<stream:stream ")||0===e.data.indexOf("<?xml")){var t=e.data.replace(/^(<\?.*?\?>\s*)*/,"");if(""===t)return;t=e.data.replace(/<stream:stream (.*[^\/])>/,"<stream:stream $1/>");var n=(new DOMParser).parseFromString(t,"text/xml").documentElement;this._conn.xmlInput(n),this._conn.rawInput(e.data),this._handleStreamStart(n)&&(this._connect_cb(n),this.streamStart=e.data.replace(/^<stream:(.*)\/>$/,"<stream:$1>"))}else{if("</stream:stream>"===e.data)return this._conn.rawInput(e.data),this._conn.xmlInput(document.createElement("stream:stream")),this._conn._changeConnectStatus(Strophe.Status.CONNFAIL,"Received closing stream"),void this._conn._doDisconnect();var i=this._streamWrap(e.data),r=(new DOMParser).parseFromString(i,"text/xml").documentElement;this.socket.onmessage=this._onMessage.bind(this),this._conn._connect_cb(r,null,e.data)}},_disconnect:function(e){if(this.socket.readyState!==WebSocket.CLOSED){e&&this._conn.send(e);var t="</stream:stream>";this._conn.xmlOutput(document.createElement("stream:stream")),this._conn.rawOutput(t);try{}catch(n){Strophe.info("Couldn't send closing stream tag.")}}this._conn._doDisconnect()},_doDisconnect:function(){Strophe.info("WebSockets _doDisconnect was called"),this._closeSocket()},_streamWrap:function(e){return this.streamStart+e+"</stream:stream>"},_closeSocket:function(){if(this.socket)try{this.socket.close()}catch(e){}this.socket=null},_emptyQueue:function(){return!0},_onClose:function(){this._conn.connected&&!this._conn.disconnecting?(Strophe.error("Websocket closed unexcectedly"),this._conn._doDisconnect()):Strophe.info("Websocket closed")},_no_auth_received:function(e){Strophe.error("Server did not send any auth methods"),this._conn._changeConnectStatus(Strophe.Status.CONNFAIL,"Server did not send any auth methods"),e&&(e=e.bind(this._conn))(),this._conn._doDisconnect()},_onDisconnectTimeout:function(){},_onError:function(e){Strophe.error("Websocket error "+e),this._conn._changeConnectStatus(Strophe.Status.CONNFAIL,"The WebSocket connection could not be established was disconnected."),this._disconnect()},_onIdle:function(){var e=this._conn._data;if(e.length>0&&!this._conn.paused){for(var t=0;t<e.length;t++)if(null!==e[t]){var n,i;"restart"===e[t]?(n=this._buildStream(),i=this._removeClosingTag(n),n=n.tree()):(n=e[t],i=Strophe.serialize(n)),this._conn.xmlOutput(n),this._conn.rawOutput(i),this.socket.send(i)}this._conn._data=[]}},_onMessage:function(e){var t,n;if("</stream:stream>"===e.data){var i="</stream:stream>";return this._conn.rawInput(i),this._conn.xmlInput(document.createElement("stream:stream")),void(this._conn.disconnecting||this._conn._doDisconnect())}if(0===e.data.search("<stream:stream ")){if(n=e.data.replace(/<stream:stream (.*[^\/])>/,"<stream:stream $1/>"),t=(new DOMParser).parseFromString(n,"text/xml").documentElement,!this._handleStreamStart(t))return}else n=this._streamWrap(e.data),t=(new DOMParser).parseFromString(n,"text/xml").documentElement;if(!this._check_streamerror(t,Strophe.Status.ERROR))return this._conn.disconnecting&&"presence"===t.firstChild.nodeName&&"unavailable"===t.firstChild.getAttribute("type")?(this._conn.xmlInput(t),void this._conn.rawInput(Strophe.serialize(t))):void this._conn._dataRecv(t,e.data)},_onOpen:function(){Strophe.info("Websocket open");var e=this._buildStream();this._conn.xmlOutput(e.tree());var t=this._removeClosingTag(e);this._conn.rawOutput(t),this.socket.send(t)},_removeClosingTag:function(e){var t=Strophe.serialize(e);return t=t.replace(/<(stream:stream .*[^\/])\/>$/,"<$1>")},_reqToData:function(e){return e},_send:function(){this._conn.flush()},_sendRestart:function(){clearTimeout(this._conn._idleTimeout),this._conn._onIdle.bind(this._conn)()}},function(e,t,n){e.log=n(e,t)}(this.udesk,this,function(e,t){function n(e,t){if(e&&t)for(var n=0,i=e.length;n<i;n++)if(t.indexOf(e[n])>-1)return!0;return!1}function i(e,t){for(var n=0,i=e.length;n<i;n++)if(t(e[n]))return e[n]}function r(e,t,r){if(t){e=e||"info",r=r||{};var o=r.path||"",a=r.statusText||"";if(delete r.path,delete r.statusText,(o||l.allow_path_empty)&&(!l.allow_paths.length||n(l.allow_paths,o))){var s=i(u,function(e){return e&&e.path===o}),c=s&&s.params&&s.params.date,d=new Date;!c&&(c=d),r.date=d,r.type=e,u.push({duration:d-c,path:o,content:t,status:a,params:r})}}}function o(){u.length=0}function a(){if(u.length){var e,t=l.user,n={log_type:l.log_type,logs:[]};c.each(u,function(t,i){"ajaxSend"!==i.content&&"ajaxComplete"!==i.content&&n.logs.push(i),!e&&(e="error"===i.params.type)}),e&&(t&&(n.role=t.role,n.logs.unshift({content:"userData",params:t})),n.logs=JSON.stringify(n.logs),c.post(l.api,n),o())}}var s,c=e.$,l={api:"/spa1/im/im_logs/im_client_logs",log_type:"im-client-logs",allow_path_empty:!0,allow_paths:[]},u=[],d=6e4,p=1e4;return setTimeout(a,p),s=setInterval(a,d),{config:function(e){if(e){var t=l.user;c.extend(l,e),t&&e.user&&c.extend(l.user,t),105343220!=l.user.user_id&&81073504!=l.user.user_id||(Strophe.log=function(e,t){e===Strophe.LogLevel.ERROR&&r("error","stropheError",{errorMsg:t})})}},stop:function(){clearInterval(s)},info:function(e,t){r("info",e,t)},warn:function(e,t){r("warn",e,t)},error:function(e,t){r("error",e,t)}}}),Strophe.addConnectionPlugin("ping",{_c:null,init:function(e){this._c=e,Strophe.addNamespace("PING","urn:xmpp:ping")},ping:function(e,t,n,i){var r=this._c.getUniqueId("ping"),o=$iq({type:"get",to:e,id:r}).c("ping",{xmlns:Strophe.NS.PING});this._c.sendIQ(o,t,n,i)},pong:function(e){var t=e.getAttribute("from"),n=e.getAttribute("id"),i=$iq({type:"result",to:t,id:n});this._c.sendIQ(i)},addPingHandler:function(e){return this._c.addHandler(e,Strophe.NS.PING,"iq","get")}}),function(e,t){Strophe.addConnectionPlugin("udeskIM",{_connection:null,_fromUser:null,_toUser:null,init:function(e){this._connection=e},connect:function(t,n){var i=t.username;this._fromUser=t,n=n||{},this.options=n,this._connection.connect(i,t.password,function(t,i){var r="";for(var o in Strophe.Status)if(t==Strophe.Status[o]){r=o.toLowerCase();break}console.log("Strophe "+r),n[r]&&n[r](i),n.always&&n.always(r),"disconnect"===r&&e.log("info",{StropheStatus:"disconnect",status:"disconnect"})})},disconnect:function(){this._connection.disconnect()},flush:function(){this._connection.flush()},setToUser:function(e){e.username=e.username||e.jid,this._toUser=e},info:function(){var e=this.options.log||{};e.info&&e.info.apply(null,arguments)},error:function(){var e=this.options.log||{};e.error&&e.error.apply(null,arguments)},appendChildren:function(e,t){if(e&&t){for(var n=$.isArray(t.children)?t.children:[t.children],i=0,r=n.length;i<r;i++){var o=n[i];o&&o.name&&(i&&e.up(),e=e.c(o.name,o.attributes||{}).t("object"==typeof o.value&&o.value?JSON.stringify(o.value):o.value||""))}return e}},sendMessage:function(t){if(this._fromUser&&this._toUser){var n=$msg(e.$.extend({to:this._toUser.username,from:this._fromUser.username,type:"chat"},t.attributes));this.appendChildren(n,t);var i=n.tree();t.attributes.id&&this.info("sendMessage",i.outerHTML);try{return this._connection.send(i)}catch(r){}return!1}},sendPresence:function(t){if(this._fromUser){var n=$pres(e.$.extend({},t.attributes)),i=t.children;return i&&(n=n.c(i.name,i.attributes).t(i.value)),this._connection.send(n.tree())}},sendIQ:function(e){var t=$iq({type:"get"}).c("query",{xmlns:"jabber:iq:roster"});return this._connection.sendIQ(t,function(t){return e(t)}),!0},receiveMessageListener:function(e){var t=this;return this._connection.addHandler(function(n){t.info("onMessage",n.outerHTML);try{e(t.parseXml(n))}catch(i){t.error(i,{type:"onMessageException"})}return!0},null,"message",null,null,null),!0},receivePresenceListener:function(e){var t=this;return this._connection.addHandler(function(n){t.info("onPresence",n.outerHTML);try{e(t.parseXml(n))}catch(i){t.error(i,{type:"onPresenceException"})}return!0},null,"presence"),!0},xmlescape:function(e){return e?Strophe.xmlescape(e):""},getNodeValue:function(e){return e.nodeValue||e.textContent||e.text||""},parseAttrs:function(t){var n=this,i={};return t?(e.$.each(t.attributes,function(){i[this.nodeName]=n.getNodeValue(this)}),i):i},parseElement:function(e){if(!e)return null;var t={name:e.nodeName,value:this.getNodeValue(e),html:e.innerHTML||"",attributes:this.parseAttrs(e)},n=t.attributes.from;return n&&(t.attributes.jid=Strophe.getBareJidFromJid(n)),
t},parseXml:function(e){if(!e)return null;var t=this,n=this.parseElement(e)||{};return n.children={},$(e).children().each(function(){var e=t.parseElement(this);n.children[e.name]=e}),n}}),e.ifIE()&&Strophe.addConnectionPlugin("flxhr",{init:function(e){"withCredentials"in new XMLHttpRequest?Strophe.Request.prototype._newXHR=function(){var e=new XMLHttpRequest;return e.overrideMimeType&&e.overrideMimeType("text/xml"),e.onreadystatechange=this.func.bind(null,this),e}:t.flensed&&flensed.flXHR?Strophe.Request.prototype._newXHR=function(){var t=new flensed.flXHR({autoUpdatePlayer:!0,instancePooling:!0,noCacheHeader:!1,onerror:function(t){console.log(t),e._changeConnectStatus(Strophe.Status.CONNFAIL,"flXHR connection error"),e._onDisconnectTimeout()}});return t.onreadystatechange=this.func.bind(null,this),t}:Strophe.error("flXHR plugin loaded, but flXHR not found.  Falling back to native XHR implementation.")}}),t.console=t.console||{log:function(){}}}(this.udesk,this),function(e,t,n){e.ns("WS"),e.WS.Timer=n(e,t)}(this.udesk,this,function(e,t){function n(e){e=$.extend({},e),this.props=e}return n.create=function(e){return new n(e)},$.extend(n.prototype,{start:function(e){var t=this.props;e=$.extend({interval:5e4},e),this.stop(!0),this.status="start",this.timer=setInterval(function(){e.cb&&e.cb(),t.onStart&&t.onStart()},e.interval)},stop:function(e){var t=this.props;clearInterval(this.timer),e||(t.onStop&&t.onStop(),this.status="stoped")}}),n}),function(e,t,n){e.WS=n(e,t)}(this.udesk,this,function(e,t){function n(e){e=$.extend({},e),this.props=e,this.handlers=[],this.client=new r(e.server_url),this.ping=i.create(),this.reconnect=i.create()}var i=e.WS.Timer,r=t.WebSocket||t.MozWebSocket,o=["connecting","open","closing","closed"];return $.extend(n,{isSupperted:function(){return!!r},create:function(e){return new n(e)},extend:function(e){return $.extend(n.prototype,e)}}),n.extend({getReadyState:function(){return o[this.client.readyState]},isReadyState:function(e){var t=this.getReadyState();if("array"!==$.type(e))return e===t;for(var n=0,i=e.length;n<i;n++)if(e[n]===t)return!0},transformSend:function a(e){var a=this.props.transformSend;return $.isFunction(a)&&(e=a(e)),e},transformOn:function s(e,t){var s=this.props.transformOn,n=t?t.data:{};if("string"==typeof n)try{n=JSON.parse(n)}catch(i){}return $.isFunction(s)&&(n=s(e,n)),n},send:function(e){var t,n=this.props;try{return e=t=this.transformSend(e),(!n.sendStart||n.sendStart(e)!==!1)&&($.isPlainObject(t)&&(t=JSON.stringify(t)),this.isReadyState("open")&&this.client.send(t),n.sendStop&&n.sendStop(e),e)}catch(i){}},sendSync:function(e,t){t=$.extend({timeout:3e3},t);var n,i,r=this,o=$.Deferred(),a=this.props,s=t.success||a.sendSuccess,c=t.erro||a.sendError,l=t.complete||a.sendComplete,u=t.receiptCondition||a.sendSyncReceiptCondition,d=this.send(e),p="message";return d&&$.isFunction(u)?(this.on(p,n=function(e,t){u(d,e,t)&&(r.off(p,n),o.resolve(e,t),s&&s(d,e,t),l&&l(d,e,t),clearTimeout(i))}),i=setTimeout(function(e){e="åæ§è¶æ¶",r.off(p,n),o.reject(e),c&&c(d,e),l&&l(d,e)},t.timeout)):o.reject("",d),o.promise()},close:function(e,t){this.off(),this.ping.stop(),this.reconnect.stop(),this.client.close(e,t)},ensure:function(e,t){t=$.extend({timeout:5e3},t);var n=$.Deferred();return this.isReadyState(e)?n.resolve():(this.on(e,function(){n.resolve()}),setTimeout(function(e){n.reject("è¶æ¶")},t.timeout)),n.promise()},on:function(e,t){var n=this,i=function(i){t&&t(n.transformOn(e,i),i)};return this.handlers.push({name:e,fn:t,_fn:i}),this.client.addEventListener(e,i),this},one:function(e,t){var n=this;return this.on(e,function(i){t&&t(n.transformOn(e,i),i),n.off(e,t)})},off:function(e,t){for(var n,i=this.client,r=this.handlers,o=r.length-1;o>=0;o--)n=r[o],e&&n.name!==e||t&&t!==n.fn||(r.splice(o,1),i.removeEventListener(n.name,n._fn));return this}}),n}),function(e,t,n){e.fullscreen=n(e,t)}(this.udesk,this,function(e,t){function n(){if(l){var e=$.Deferred();return e.resolve(),e.promise()}return l=!0,$.getScript("/static_cmps/screenfull/min.js")}function i(){return n().then(function(){return screenfull.enabled})}function r(e){return n().then(function(){screenfull.request()})}function o(){return n().then(function(){screenfull.exit()})}function a(e){return n().then(function(){return screenfull.toggle(e)})}function s(){return n().then(function(){return screenfull.isFullscreen})}function c(e){return n().then(function(){screenfull.off("change"),screenfull.on("change",function(){e&&e(screenfull.isFullscreen)})})}var l;return{load:n,enabled:i,isFull:s,request:r,exit:o,toggle:a,onChange:c}}),function(e,t,n){e.ns("Sign"),e.Sign.Base=n(e,t)}(this.udesk,this,function(e,t){function n(e){e=$.extend({actionKey:"method"},e),this.props=e,this.ws=i.create(e)}var i=e.WS;return n.create=function(e){return new n(e)},$.extend(n.prototype,{getToken:function(e){return $.post(this.props.token_url,e)},mapSendData:function(e,t,n){if(e)return n=n||{},n.mapSendData?n.mapSendData(e,t):(t=t||{},t[this.props.actionKey]=e,t)},send:function(e,t,n){if(t=this.mapSendData(e,t,n))return this.ws.send(t)},sendSync:function(e,t,n){if(t=this.mapSendData(e,t,n))return this.ws.sendSync(t,n)},login:function(e){var t=this,n=(this.props,this.ws),i=$.Deferred();return e=$.extend({app_id:e.subdomain,ua:navigator.userAgent,state:"idle",expire:300},e),t.loginRes?(i.resolve(t.loginRes),i.promise()):(this.getToken({app_id:e.app_id,token:e.token,expire:e.expire,timestamp:e.timestamp,subdomain:e.subdomain,type:e.type}).always(function(r){console.log("login"),r.sig_token?n.ensure("open").then(function(){t.sendSync("login",{app_id:e.app_id,user_id:e.user_id,ua:e.ua,state:e.state,res_id:e.res_id,token:r.sig_token},{timeout:5e3}).always(function(e){e.uid?(t.loginRes=e,i.resolve(e)):i.reject({message:"ç»å½å¤±è´¥",trace:e})})},function(e){i.reject({message:"ws "+n.getReadyState(),trace:e})}):i.reject({message:"è·åtokenå¤±è´¥",trace:r})}),i.promise())},logout:function(){var e=this.sendSync("logout");return this.loginRes=null,this.ws.close(),e},on:function(e){this.ws.on("message",e)},one:function(e){this.ws.one("message",e)},off:function(e){this.ws.off("message",e)}}),n}),function(e,t,n){e.ns("Sign"),e.Sign.App=n(e,t)}(this.udesk,this,function(e,t){function n(e){return f[e]}function i(e,t){f[e]=t}function r(e,t){$.isPlainObject(e)?$.each(e,function(e,t){g[e]=t}):g[e]=t}function o(){var e="/spa1/remote_control_access_token";return $.get(e).then(function(e){return e=e||{},r(e.data),e.data},function(e){console.log("GET remote_access_token error")})}function a(){var e=d.ws,t=0;e.ping.start({interval:5e4,cb:function(){d.sendSync("ping",null,{timeout:3e3,mapSendData:function(e){return e},receiptCondition:function(e,t,n){return"pong"===t}}).then(function(){t=0},function(){"stoped"!==e.ping.status&&(t++,console.log("Pong error",t))})}})}function s(){var e=d.ws,t=0;f.loginFailedCounter>5||f.isReconnect||(f.isReconnect=!0,e.reconnect.start({interval:1e3,cb:function(){switch(t++,t){case 1:case 6:case 11:case 21:case 31:break;default:t>31&&e.reconnect.stop()}}}))}function c(e,t){if(!e)return t;if("login"===t.method||"logout"===t.method)return"login"===t.method&&m.trigger("login",g),"transformSend"===e?(f.is_vcall&&(t=g.vcall[e](t)),f.is_remote&&(t=g.remote[e](t)),t):("sendStart"===e&&f.is_vcall&&g.vcall[e](t),t);var n=parseInt(t.method_id||0);return n>=1e3&&n<2e3?g.remote[e]?g.remote[e](t):t:g.vcall[e]?g.vcall[e](t):t}function l(e){return d?d:(d=p.create($.extend({token_url:g.remote_control_token_url||g.vcall_token_url,transformSend:function(e){return $.isPlainObject(e)?c("transformSend",e):e},transformOn:function(e,t){return t},sendSyncReceiptCondition:function(e,t){return e.msg_id===t.msg_id},sendStart:function(e){c("sendStart",e)},sendStop:function(e){},sendSuccess:function(e,t){},sendError:function(e,t){}},e)),h.sign=d,d.on(function(e){return $.isPlainObject(e)?void c("onMessage",e):e}),d.ws.on("open",function(e){i("isReconnect",!1)}),d.ws.on("close",function(e){i("isLogin",!1),d.ws.ping.stop(),s()}),d.ws.on("error",function(e){console.log("[sign][error]",e)}),d)}function u(e,t){if(i("is_"+e,!0),t&&r(e,t),t&&r("user_id",t.user_id),n("isLogin")||n("isInit")){var s=$.Deferred();return s.resolve(),s.promise()}return i("isInit",!0),o(e).then(function(){return l({server_url:g.server_url}).login({user_id:g.user_id,app_id:g.app_id,token:g.token,timestamp:g.timestamp,subdomain:g.subdomain,type:e}).then(function(e){return a(),i("isInit",!1),i("isLogin",!0),f.loginFailedCounter=0,e},function(e){return i("isInit",!1),f.loginFailedCounter=(f.loginFailedCounter||0)+1,e})})}var d,p=e.Sign.Base,h={},f={},g={},m={clientList:{},listen:function(e,t){this.clientList[e]||(this.clientList[e]=[]),this.clientList[e].push(t)},trigger:function(){var e=Array.prototype.shift.call(arguments),t=this.clientList[e];if(!t||0===t.length)return!1;for(var n,i=0;n=t[i++];)n.apply(this,arguments)}};return h={init:u,event:m}}),function(e,t,n){e.ns("remoteControl"),e.remoteControl.receivedPop=n(e,t)}(this.udesk,this,function(e,t){function n(){c.on("click","[data-act]",function(e,t){t=$(this).data("act"),h[t]&&h[t](e)})}function i(){var t=e.common,n=t.UDL;c=$(u),n.parseElements(c),p.append(c),c.find(".nick").text(d.from_nickname)}function r(){$(".remote-received-pop").remove()}function o(e){$.extend(!0,d,e)}function a(t){o(t),s=e.remoteControl.app,r(),i(),n()}var s,c,l=e.Sign.App,u=['<div class="remote-received-pop">','<img class="remote-icon" src="images/remote-control.png" />','<span class="nick ellipsis"></span>','<a data-act="close" class="close-receive-box"><i class="icon icon-guanbi"></i></a>','<a data-act="lanuchRemote" href="" class="lanuch-remote-btn link">å¦å·²å®è£è¿ç¨æ§å¶ç«¯ï¼ç¹å»ç«å³ä½¿ç¨ </a>','<span class="remote-tip">è¯·æ±è¿ç¨åå©è¿æ¥æ¨ççµè</span>','<a data-act="reject" class="reject-btn btn btn-default">æç»</a>','<a data-act="accept" class="accept-btn btn btn-primary">æ¥å</a>',"</div>"].join(""),d={},p=$("#main"),h={accept:function(e){l.sign.send("accept",{method_id:1003,body:{invitation_id:d.invitation_id}}),$(".reject-btn, .accept-btn").hide(),$(".close-receive-box,.download-remote-btn,.lanuch-remote-btn").show()},reject:function(e){l.sign.send("reject",{method_id:1004,body:{invitation_id:d.invitation_id}}),r()},close:function(e){l.sign.send("cancel",{method_id:1002,body:{invitation_id:d.invitation_id}}),r()},lanuchRemote:function(e){var t="UdeskRemote://?role=controlled&token="+d.token+"&invitation_id="+d.invitation_id+"&chan_id=no&address=no&session_name=no";$(".lanuch-remote-btn").attr("href",t),s.lanuchRemote=!0,r()}};return{init:a,setConfig:o,destroy:r}}),function(e,t,n){e.ns("remoteControl"),e.remoteControl.app=n(e,t)}(this.udesk,this,function(e,t){function n(e){return $.extend(h,e)}function i(e,t){$.isPlainObject(e)?$.each(e,function(e,t){p[e]=t}):p[e]=t}function r(){return navigator.platform.indexOf("Mac")>-1}function o(){var e=r();return!e}function a(){function e(){return(65536*(1+Math.random())|0).toString(16).substring(1)}return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()}function s(e){e.seq_id||(p.seq_id=(p.seq_id||1)+1);var t={},n="REQ";t[e.method]=!0;var i=$.extend({ver:u,seq_id:p.seq_id,msg_id:a(),msg_type:n,res_id:"web",timestamp:+new Date,ua:navigator.userAgent,body:{}},e);return(t.login||t.logout)&&delete i.body,i}function c(e){var t=e.method,n={},r={},o=e.rcode;if("000003"===o)return console.log(e.rdesc);if(r[t]=!0,n[e.msg_type]=!0,n.REP)r.invite?"000000"===o||("000300"===o?i("remote_status","remoteing"):"000002"===o&&i("remote_status","paramError")):r.accept&&(i("remote_status","acceptRepSuccess"),g.setConfig(e.body));else if(n.EVT);else if(n.NTF)switch(t){case"invite":i("remote_status","receiving"),i("receiving",e),g.init({from_user_id:e.body.from_user_id,from_nickname:e.body.from_nickname,invitation_id:e.body.invitation_id});break;case"accept":i("remote_status","accepted"),i("accepted",e);break;case"rejected":i("remote_status","rejected"),i("rejected",e);break;case"chan_create":i("controll_status","chan_create");break;case"chan_del":i("controll_status","chan_del"),i("chan_del",e)}}function l(e,t){if(e=n(e),!t){if(!o())return;if(p.isInit)return;p.isInit=!0}return f.init("remote",{user_id:h.user_id,seq_id:p.seq_id,transformSend:s,onMessage:c}).then(function(e){d.isRcInitOk=!0,i("remote_status","rcInitSucess"),console.log("isRcInitOk")},function(e){console.log("åå§åå¤±è´¥")})}var u="1.0",d={},p={},h={},f=e.Sign.App,g=e.remoteControl.receivedPop;return d={init:l,state:p}}),function(e,t,n){e.ns("vcall"),e.vcall.Channel=n(e,t)}(this.udesk,this,function(e,t){function n(){function e(){return(65536*(1+Math.random())|0).toString(16).substring(1)}return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()}function i(){var e=$.Deferred();return AgoraRTC.getDevices(function(t){for(var n=[],i=[],r=0;r!==t.length;++r){var o=t[r];"audioinput"===o.kind?n.push(o):"videoinput"===o.kind?i.push(o):console.log("Some other kind of source/device: ",o)}e.resolve({microphoneId:n.length?n[0].deviceId:"",cameraId:i.length?i[i.length-1].deviceId:"",microphones:n,cameras:i})}),e.promise()}function r(t,n){var i=(""+t).toUpperCase();switch(t){case"360p":15===n&&(i+="_4");break;case"480p":i=15===n?"8":"9";break;case"720p":case"1080p":15===n&&(i+="_3");break;default:i="240p",e.isMob()&&(i=" "+i)}return console.log(i),i}function o(e){e=$.extend({mode:"interop"},e),$.extend(this,{props:e,state:{seq_id:0,channel_id:e.channel_id||n()},device:{},channel:{},handlers:{},localStreams:[],remoteStreams:[]})}return $.extend(o,{guid:n,genVideoProfile:r,create:function(e){return new o(e)},extend:function(e){return $.extend(o.prototype,e)}}),o.extend({init:function(){var e=this,t=this.props,n=$.Deferred(),r=this.client=AgoraRTC.createClient({mode:t.mode});return r.init(t.appId,function(){console.log("AgoraRTC client initialized"),i().then(function(t){e.device=t||{}}),n.resolve()},function(e){console.log("AgoraRTC client init failed",e),n.reject(e)}),n.promise()},join:function(e){if(e){e=$.extend({uid:null},e);var t=this,n=this.state,i=$.Deferred();return $.extend(n,e),this.client.join(e.channel_key,e.channel_name||n.channel_id,e.uid,function(e){console.log("User "+e+" join channel successfully"),t.uid=e,i.resolve(e)},function(e){console.log("Join channel failed",e),i.reject(e)}),i.promise()}},createStream:function(e){var t=this.localStream,n=this.device||{};return e=$.extend({streamID:this.uid,cameraId:n.cameraId,microphoneId:n.microphoneId,audio:!0,video:!0,screen:!1},e),t=this.localStream=AgoraRTC.createStream(e),e.video&&t.setVideoProfile(r(e.resolution,e.frameRate)),this.localStreams.push(t),t},leave:function(){var e=this,t=$.Deferred(),n=this.client;return n&&n.leave(function(){console.log("Leavel channel successfully"),$.each(e.localStreams,function(){this.close()}),e.localStream=null,e.localStreams.length=0,t.resolve()},function(e){console.log("Leave channel failed",e),t.reject()}),t.promise()},transformOn:function a(e,t){var a=this.props.transformOn,n=t;return $.isFunction(a)&&(n=a(e,t)),n},on:function(e,t){var n=this,i=this.handlers;i[e]=i[e]||[],i[e].length||this.client.on(e,function(e){return function(t){$.each(n.handlers[e],function(){this(n.transformOn(e,t),t)})}}(e)),i[e].push(t)},off:function(e,t){var n=this.handlers,i=n[e];if(e){if(i)for(var r=i.length-1;r<-1;r--)if(!t||t===i[r])return void i.splice(r,1)}else n.length=0},destroy:function(){this.off(),this.leave()}}),o}),function(e,t,n){e.ns("vcall"),e.vcall.dropdown=n(e,t)}(this.udesk,this,function(e,t){function n(){s.off().on("click",function(e){var t=$(this),n=t.data("act");c.onClick&&c.onClick(n,e),s.removeClass("open")})}function i(){var t=e.common,n=t.UDL,i='<a class="icon icon-video" data-toggle="dropdown" data-act="video" data-tip="'+n.gl("video")+'"></a>';s=$(i),n.parseElements(s),l.append(s),console.log("editorAutoShow"),e.common.editorAutoShow()}function r(){$(".vcall-dropdown").remove()}function o(t){c=t=t||{},a=e.vcall.app,l=$(t.container||l),r(),i(),n()}var a,s,c,l=$("body");return{init:o}}),function(e,t,n){e.ns("vcall"),e.vcall.sentPop=n(e,t)}(this.udesk,this,function(e,t){function n(){s.on("click","[data-act]",function(e,t){t=$(this).data("act"),p[t]&&p[t](e)})}function i(){var t=e.common,n=t.UDL;s=$(u),n.parseElements(s),d.append(s),s.find(".nick").text(c.sendee_name),s.find(".desc").text(e.replaceTpl(n.g("vcall.ringing_desc"),{type:n.gl(a.getState("call_type"))}))}function r(){$(".vcall-pop").remove()}function o(t){c=t=t||{},a=e.vcall.app,r(),i(),n()}var a,s,c,l=e.Sign.App,u=['<ul class="vcall-pop vcall-sent-pop">',"    <li>",'        <span class="circle"><i class="icon icon-video-solid"></i></span>','        <span udl-g="vcall.to"></span> <span class="nick ellipsis"></span>','        <p class="desc text-muted"></p>',"    </li>",'    <li class="text-right">','        <a data-act="cancel" class="btn btn-danger btn-sm" udl-gl="cancel"></a>',"    </li>","</ul>"].join(""),d=$("body"),p={cancel:function(e){r(),l.sign.send("cancel")}};return{init:o,destroy:r}}),function(e,t,n){e.ns("vcall"),e.vcall.receivedPop=n(e,t)}(this.udesk,this,function(e,t){function n(){s.on("click","[data-act]",function(e,t){t=$(this).data("act"),p[t]&&p[t](e)})}function i(){var t=e.common,n=t.UDL;s=$(u),n.parseElements(s),d.append(s),s.find(".nick").text(c.sendee_name),s.find(".desc").text(e.replaceTpl(n.g("vcall.ringing_desc"),{type:n.gl(a.getState("call_type"))}))}function r(){$(".vcall-pop").remove()}function o(t){c=t=t||{},a=e.vcall.app,r(),i(),n()}var a,s,c,l=e.Sign.App,u=['<ul class="vcall-pop vcall-received-pop">',"    <li>",'        <span class="circle"><i class="icon icon-video-solid"></i></span>','        <span class="nick ellipsis"></span>','        <p class="desc text-muted"></p>',"    </li>",'    <li class="text-right">','        <a data-act="deny" class="btn btn-danger btn-sm" udl-g="vcall.danger"></a>','        <a data-act="accept" class="btn btn-primary btn-sm" udl-g="vcall.accept"></a>',"    </li>","</ul>"].join(""),d=$("body"),p={accept:function(e){r(),l.sign.send("answer")},deny:function(e){r(),l.sign.send("cancel",{reason:"001"})}};return{init:o,destroy:r}}),function(e,t,n){e.ns("vcall"),e.vcall.chatBox=n(e,t)}(this.udesk,this,function(e,t){function n(e){e=e||l.channel.remoteStream,e&&h&&(h.empty(),h.show(),e.play("remoteStream"),d&&d.addClass("pip2"),m=!0)}function i(){h&&(h.empty(),d.removeClass("pip2"))}function r(){var e=l.channel.localStream;e&&($("#localStream").empty(),e.play("localStream"))}function o(){d.on("click","[data-act]",function(e,t){t=$(this).data("act"),_[t]&&_[t](e)}),g||(g=!0,u.onChange(function(e){d[(e?"add":"remove")+"Class"]("fullscreen")}))}function a(){var t=e.common,i=t.UDL;d=$(y),i.parseElements(d),p=d.find(".title"),h=d.find("#remoteStream"),"audio"===f.type&&d.addClass("audioEnabled"),b.append(d),p.text(e.replaceTpl(i.g("vcall.chat_title"),{name:f.sendee_name,type:i.gl(f.type)})),r(),n()}function s(){i(),$(".vcall-chat-box").remove()}function c(t){f=t=t||{},l=e.vcall.app,u=e.fullscreen,s(),a(),o()}var l,u,d,p,h,f,g,m,v=e.Sign.App,y=['<div class="vcall-chat-box">','  <div class="statusbar clearfix">','      <span class="title"></span>','      <div class="pull-right">','          <a data-act="fullscreen" class="icon icon-square"></a>',"      </div>","  </div>",'  <div class="media-box">','      <div id="localStream" data-act="switchPip" class="local-stream"></div>','      <div id="remoteStream" data-act="switchPip" class="remote-stream"></div>',"  </div>",'  <div class="toolbar text-center clearfix">','      <div class="pull-left"></div>','      <a data-act="switchMute" class="icon icon-microphone1" title="éé³"></a>','      <a data-act="switchMicrophone" class="icon icon-horn" title="æ¬å£°å¨"></a>','      <a data-act="switchAudio" class="icon icon-video" title="è§é¢"></a>','      <div class="pull-right">','        <a data-act="hangup" class="btn btn-danger btn-sm" udl-g="vcall.hangup"></a>',"      </div>","  </div>","</div>"].join(""),b=$("body"),_={fullscreen:function(e){u.enabled().then(function(e){e?u.toggle(d[0]):console.log("Do not support full screenï¼")})},switchMute:function(e){var t=l.channel,n=d.is(".muteEnabled");t.localStream[n?"enableAudio":"disableAudio"](),d[(n?"remove":"add")+"Class"]("muteEnabled")},switchMicrophone:function(e){var t=d.is(".microphoneEnabled");l.switchMicrophone(t).then(function(){r()}),d[(t?"remove":"add")+"Class"]("microphoneEnabled")},switchAudio:function(e){var t=l.channel,n=d.is(".audioEnabled");t.localStream[n?"enableVideo":"disableVideo"](),d[(n?"remove":"add")+"Class"]("audioEnabled")},hangup:function(e){s(),l.channel.leave(),v.sign.send("bye")},switchPip:function(e){var t=$(e.currentTarget),n=l.channel;0!==parseInt(t.css("top"))&&n.localStream&&n.remoteStream&&d.toggleClass("pip2")}};return{init:c,destroy:s,showRemoteStream:n,removeRemoteStream:i}}),function(e,t,n){e.ns("vcall"),e.vcall.app=n(e,t)}(this.udesk,this,function(e,t){function n(e,t,n){t=t||{},n=n||t.type||"debug","undefined"!=typeof AgoraRTC&&AgoraRTC.Logger.log({debug:0,info:1,error:2,none:3,warning:4}[n],e,t)}function i(){var t="https:"===location.protocol,n=0===location.host.indexOf("localhost");return(n||t)&&e.WS.isSupperted()}function r(){var e=$.Deferred();return I.isLoadedSDK?(e.resolve(),e.promise()):(I.isLoadedSDK=!0,$.getScript("/static_cmps/AgoraRTCSDK/2.2.0.js"))}function o(e){return I[e]}function a(e,t){$.isPlainObject(e)?$.each(e,function(e,t){I[e]=t}):I[e]=t}function s(e){return $.extend(L,e)}function c(e,t){var n="",i="audio"===I.call_type?"è¯­é³":"è§é¢",r={};if(r[t.method]=!0,r.invite)n="åèµ·"+i;else if(r.cancel){switch(t.reason){case"001":n="ææ¥";break;case"003":n="æªæ¥";break;default:n="åæ¶"}n+=i}else if(r.busy)n="æ­£å¿";else{if(!r.bye)return;n="ç»æ"+i}"send"===e?n=L.sender_name+n:"recv"===e&&(n=L.sendee_name+n),L.onCallStatus&&L.onCallStatus($.extend({},t,{isRecv:"recv"===e,call_desc:n}))}function l(e){b&&b.destroy();var t=$.Deferred();return e=$.extend({appId:L.agora_app_id,channel_id:I.channel_id},e),b=x.create(e),A.channel=b,b.init().then(function(){b.on("stream-added",function(e){var t=e.stream;b.client.subscribe(t),clearTimeout(I.peerLeaveTimer)}),b.on("stream-subscribed",function(e){var t=b.remoteStream;t=e.stream,b.remoteStream=t,C.showRemoteStream(t)}),b.on("stream-removed",function(e){var t=e.stream;t&&(t.stop(),b.remoteStream=null,C.removeRemoteStream())}),b.on("peer-leave",function(e){var t=e.stream;t&&(t.stop(),b.remoteStream=null,C.removeRemoteStream(),I.peerLeaveTimer=setTimeout(function(){w.sign.send("stop_media"),w.sign.send("bye")},3e4))}),b.on("error",function(e){n("Got error msg:",e.reason),"DYNAMIC_KEY_TIMEOUT"===e.reason&&b.client.renewChannelKey(b.channel_key)}),w.sign.sendSync("get_channel_token",{channel_id:e.channel_id}).always(function(e){e.channel_token?(a({uid:e.agora_uid,channel_token:e.channel_token}),t.resolve(e)):t.reject("è·åchannel_tokenå¤±è´¥",e)})},t.reject),t.promise()}function u(e){var t,n=$.Deferred();return e=$.extend({video:"audio"!==I.call_type},e),t=b.createStream(e),t.init(function(){b.client.publish(t),w.sign.send("start_media"),a("call_status","chating"),n.resolve(t)},n.reject),n.promise()}function d(e){var t=$.Deferred();return e=$.extend({uid:I.uid,channel_id:I.channel_id,channel_key:I.channel_token},e),e.force||"chating"!==o("call_status")?(a("call_status","chating"),b.join({uid:e.uid,channel_key:e.channel_key}).then(function(){u(e.stream).then(function(){T.destroy(),S.destroy(),C.init({sendee_name:L.sendee_name,type:I.call_type}),t.resolve()},t.reject)},function(e){t.reject("å å¥channelå¤±è´¥",e)}),t.promise()):(t.reject("In chating"),n("In chating"),t.promise())}function p(e){I.isInit&&(e=e||{},b&&(!e.noNeedStopMedia&&w.sign.send("stop_media"),e.needBye&&w.sign.send("bye"),b.leave(),b=null),C.destroy(),T.destroy(),S.destroy(),a("call_status"))}function h(e){var t=$.Deferred();if(e)l().then(function(){d({force:!0}).then(t.resolve,t.reject)},t.reject);else{var n=b.device.microphones;n&&n[1]?u({microphoneId:n[1].deviceId}).then(t.resolve,t.reject):t.reject("No microphone")}return t.promise()}function f(e){if(!$.isPlainObject(e))return e;e.seq_id||(I.seq_id=(I.seq_id||1)+1);var t={},n="REQ";return t[e.method]=!0,(t.start_media||t.stop_media)&&(n="NTF"),t.login||t.logout||(e.channel_id=e.channel_id||I.channel_id),$.extend({ver:E,msg_id:x.guid(),msg_type:n,seq_id:I.seq_id,res_id:"web",ua:navigator.userAgent,from_user_id:L.user_id||"",to_user_id:L.to_user_id||"",biz_session_id:L.biz_session_id||"",timestamp:+new Date},e)}function g(e){var t=e.method,n={},i={};n[t]=!0,i[e.msg_type]=!0,i.REQ&&((n.cancel||n.bye)&&(a("call_status"),_.exit()),n.invite?a($.extend({call_status:"sending"},e)):n.answer?l().then(d):n.bye&&p(),c("send",e))}function m(e){if(!$.isPlainObject(e))return e;var t=e.method,i={},r={},o=e.rcode;if(i[t]=!0,r[e.msg_type]=!0,o&&"000000"!==o&&n("[sign][rcode="+o+"]",e.reason||e.rdesc||e.msg),r.EVT)i.invite?e.user_id!==L.user_id&&(a($.extend({call_status:"receiving"},e)),S.init({sendee_name:L.sendee_name})):i.answer?l().then(d):i.bye&&p(),(i.cancel||i.bye)&&(a("call_status"),S.destroy()),c("recv",e),w.sign.send(t,{seq_id:e.seq_id,msg_id:e.msg_id,msg_type:"ACK",channel_id:e.channel_id});else if(r.REP)switch(o){case"004":a("call_status"),S.destroy();break;case"000101":L.showTip("å®¢æ·æªç»å½è§é¢"),a("call_status"),T.destroy();break;case"000103":L.showTip("å¯¹æ¹æ­£å¿"),a("call_status"),c("recv",{method:"busy"}),T.destroy()}}function v(e){s({agora_app_id:e.agora_app_id})}function y(o,c){if(o=s(o),!c){if(!i())return;if(I.isInit)return;I.isInit=!0}r().then(function(){var i=AgoraRTC.checkSystemRequirements();return i?(a({call_type:"video"}),w.event.listen("login",v),w.event.listen("reconnectFail",p),w.init("vcall",{user_id:L.user_id,seq_id:I.seq_id,transformSend:f,sendStart:g,onMessage:m}).then(function(n){var i=e.context||{},r=i.config||{},o=r.buttons_enable||{};o.vcall&&k.init({container:L.container,theme_color:L.theme_color,onClick:function(e,t){if(I.call_status){if("chating"===I.call_status)return L.showTip("è¯·ç»æå½åè§é¢éè¯")}else a({call_type:e}),T.destroy(),S.destroy(),T.init({type:e,sendee_name:L.sendee_name}),w.sign.send("invite",{call_type:e,channel_id:x.guid()})}}),$(t).bind("unload",function(e){w.sign.send("bye")})},function(e){n("åå§åå¤±è´¥",e)})):void n("ä¸æ¯æé³è§é¢èå¤©ï¼",i)})}var b,_=e.fullscreen,x=e.vcall.Channel,w=e.Sign.App,k=e.vcall.dropdown,T=e.vcall.sentPop,S=e.vcall.receivedPop,C=e.vcall.chatBox,E="1.0",A=(!e.isTestENV(),{}),I={},L={},B=e.common||{};B.frameConfig||{};return A={log:n,state:I,getState:o,setState:a,setConfig:s,init:y,genChannelId:x.guid,switchMicrophone:h,leaveChannel:p}}),udesk.isMob()&&initVirtualConsoleEvent();var requirejs,require,define;!function(global,setTimeout){function commentReplace(e,t){return t||""}function isFunction(e){return"[object Function]"===ostring.call(e)}function isArray(e){return"[object Array]"===ostring.call(e)}function each(e,t){if(e){var n;for(n=0;n<e.length&&(!e[n]||!t(e[n],n,e));n+=1);}}function eachReverse(e,t){if(e){var n;for(n=e.length-1;n>-1&&(!e[n]||!t(e[n],n,e));n-=1);}}function hasProp(e,t){return hasOwn.call(e,t)}function getOwn(e,t){return hasProp(e,t)&&e[t]}function eachProp(e,t){var n;for(n in e)if(hasProp(e,n)&&t(e[n],n))break}function mixin(e,t,n,i){return t&&eachProp(t,function(t,r){!n&&hasProp(e,r)||(!i||"object"!=typeof t||!t||isArray(t)||isFunction(t)||t instanceof RegExp?e[r]=t:(e[r]||(e[r]={}),mixin(e[r],t,n,i)))}),e}function bind(e,t){return function(){return t.apply(e,arguments)}}function scripts(){return document.getElementsByTagName("script")}function defaultOnError(e){throw e}function getGlobal(e){if(!e)return e;var t=global;return each(e.split("."),function(e){t=t[e]}),t}function makeError(e,t,n,i){var r=new Error(t+"\nhttps://requirejs.org/docs/errors.html#"+e);return r.requireType=e,r.requireModules=i,n&&(r.originalError=n),r}function newContext(e){function t(e){var t,n;for(t=0;t<e.length;t++)if(n=e[t],"."===n)e.splice(t,1),t-=1;else if(".."===n){if(0===t||1===t&&".."===e[2]||".."===e[t-1])continue;t>0&&(e.splice(t-1,2),t-=2)}}function n(e,n,i){var r,o,a,s,c,l,u,d,p,h,f,g,m=n&&n.split("/"),v=k.map,y=v&&v["*"];if(e&&(e=e.split("/"),u=e.length-1,k.nodeIdCompat&&jsSuffixRegExp.test(e[u])&&(e[u]=e[u].replace(jsSuffixRegExp,"")),"."===e[0].charAt(0)&&m&&(g=m.slice(0,m.length-1),e=g.concat(e)),t(e),e=e.join("/")),i&&v&&(m||y)){a=e.split("/");e:for(s=a.length;s>0;s-=1){if(l=a.slice(0,s).join("/"),m)for(c=m.length;c>0;c-=1)if(o=getOwn(v,m.slice(0,c).join("/")),o&&(o=getOwn(o,l))){d=o,p=s;break e}!h&&y&&getOwn(y,l)&&(h=getOwn(y,l),f=s)}!d&&h&&(d=h,p=f),d&&(a.splice(0,p,d),e=a.join("/"))}return r=getOwn(k.pkgs,e),r?r:e}function i(e){isBrowser&&each(scripts(),function(t){if(t.getAttribute("data-requiremodule")===e&&t.getAttribute("data-requirecontext")===_.contextName)return t.parentNode.removeChild(t),!0})}function r(e){var t=getOwn(k.paths,e);if(t&&isArray(t)&&t.length>1)return t.shift(),_.require.undef(e),_.makeRequire(null,{skipMap:!0})([e]),!0}function o(e){var t,n=e?e.indexOf("!"):-1;return n>-1&&(t=e.substring(0,n),e=e.substring(n+1,e.length)),[t,e]}function a(e,t,i,r){var a,s,c,l,u=null,d=t?t.name:null,p=e,h=!0,f="";return e||(h=!1,e="_@r"+(B+=1)),l=o(e),u=l[0],e=l[1],u&&(u=n(u,d,r),s=getOwn(A,u)),e&&(u?f=i?e:s&&s.normalize?s.normalize(e,function(e){return n(e,d,r)}):e.indexOf("!")===-1?n(e,d,r):e:(f=n(e,d,r),l=o(f),u=l[0],f=l[1],i=!0,a=_.nameToUrl(f))),c=!u||s||i?"":"_unnormalized"+(D+=1),{prefix:u,name:f,parentMap:t,unnormalized:!!c,url:a,originalName:p,isDefine:h,id:(u?u+"!"+f:f)+c}}function s(e){var t=e.id,n=getOwn(T,t);return n||(n=T[t]=new _.Module(e)),n}function c(e,t,n){var i=e.id,r=getOwn(T,i);!hasProp(A,i)||r&&!r.defineEmitComplete?(r=s(e),r.error&&"error"===t?n(r.error):r.on(t,n)):"defined"===t&&n(A[i])}function l(e,t){var n=e.requireModules,i=!1;t?t(e):(each(n,function(t){var n=getOwn(T,t);n&&(n.error=e,n.events.error&&(i=!0,n.emit("error",e)))}),i||req.onError(e))}function u(){globalDefQueue.length&&(each(globalDefQueue,function(e){var t=e[0];"string"==typeof t&&(_.defQueueMap[t]=!0),E.push(e)}),globalDefQueue=[])}function d(e){delete T[e],delete S[e]}function p(e,t,n){var i=e.map.id;e.error?e.emit("error",e.error):(t[i]=!0,each(e.depMaps,function(i,r){var o=i.id,a=getOwn(T,o);!a||e.depMatched[r]||n[o]||(getOwn(t,o)?(e.defineDep(r,A[o]),e.check()):p(a,t,n))}),n[i]=!0)}function h(){var e,t,n=1e3*k.waitSeconds,o=n&&_.startTime+n<(new Date).getTime(),a=[],s=[],c=!1,u=!0;if(!y){if(y=!0,eachProp(S,function(e){var n=e.map,l=n.id;if(e.enabled&&(n.isDefine||s.push(e),!e.error))if(!e.inited&&o)r(l)?(t=!0,c=!0):(a.push(l),i(l));else if(!e.inited&&e.fetched&&n.isDefine&&(c=!0,!n.prefix))return u=!1}),o&&a.length)return e=makeError("timeout","Load timeout for modules: "+a,null,a),e.contextName=_.contextName,l(e);u&&each(s,function(e){p(e,{},{})}),o&&!t||!c||!isBrowser&&!isWebWorker||w||(w=setTimeout(function(){w=0,h()},50)),y=!1}}function f(e){hasProp(A,e[0])||s(a(e[0],null,!0)).init(e[1],e[2])}function g(e,t,n,i){e.detachEvent&&!isOpera?i&&e.detachEvent(i,t):e.removeEventListener(n,t,!1)}function m(e){var t=e.currentTarget||e.srcElement;return g(t,_.onScriptLoad,"load","onreadystatechange"),g(t,_.onScriptError,"error"),{node:t,id:t&&t.getAttribute("data-requiremodule")}}function v(){var e;for(u();E.length;){if(e=E.shift(),null===e[0])return l(makeError("mismatch","Mismatched anonymous define() module: "+e[e.length-1]));f(e)}_.defQueueMap={}}var y,b,_,x,w,k={waitSeconds:7,baseUrl:"./",paths:{},bundles:{},pkgs:{},shim:{},config:{}},T={},S={},C={},E=[],A={},I={},L={},B=1,D=1;return x={require:function(e){return e.require?e.require:e.require=_.makeRequire(e.map)},exports:function(e){if(e.usingExports=!0,e.map.isDefine)return e.exports?A[e.map.id]=e.exports:e.exports=A[e.map.id]={}},module:function(e){return e.module?e.module:e.module={id:e.map.id,uri:e.map.url,config:function(){return getOwn(k.config,e.map.id)||{}},exports:e.exports||(e.exports={})}}},b=function(e){this.events=getOwn(C,e.id)||{},this.map=e,this.shim=getOwn(k.shim,e.id),this.depExports=[],this.depMaps=[],this.depMatched=[],this.pluginMaps={},this.depCount=0},b.prototype={init:function(e,t,n,i){
i=i||{},this.inited||(this.factory=t,n?this.on("error",n):this.events.error&&(n=bind(this,function(e){this.emit("error",e)})),this.depMaps=e&&e.slice(0),this.errback=n,this.inited=!0,this.ignore=i.ignore,i.enabled||this.enabled?this.enable():this.check())},defineDep:function(e,t){this.depMatched[e]||(this.depMatched[e]=!0,this.depCount-=1,this.depExports[e]=t)},fetch:function(){if(!this.fetched){this.fetched=!0,_.startTime=(new Date).getTime();var e=this.map;return this.shim?void _.makeRequire(this.map,{enableBuildCallback:!0})(this.shim.deps||[],bind(this,function(){return e.prefix?this.callPlugin():this.load()})):e.prefix?this.callPlugin():this.load()}},load:function(){var e=this.map.url;I[e]||(I[e]=!0,_.load(this.map.id,e))},check:function(){if(this.enabled&&!this.enabling){var e,t,n=this.map.id,i=this.depExports,r=this.exports,o=this.factory;if(this.inited){if(this.error)this.emit("error",this.error);else if(!this.defining){if(this.defining=!0,this.depCount<1&&!this.defined){if(isFunction(o)){if(this.events.error&&this.map.isDefine||req.onError!==defaultOnError)try{r=_.execCb(n,o,i,r)}catch(a){e=a}else r=_.execCb(n,o,i,r);if(this.map.isDefine&&void 0===r&&(t=this.module,t?r=t.exports:this.usingExports&&(r=this.exports)),e)return e.requireMap=this.map,e.requireModules=this.map.isDefine?[this.map.id]:null,e.requireType=this.map.isDefine?"define":"require",l(this.error=e)}else r=o;if(this.exports=r,this.map.isDefine&&!this.ignore&&(A[n]=r,req.onResourceLoad)){var s=[];each(this.depMaps,function(e){s.push(e.normalizedMap||e)}),req.onResourceLoad(_,this.map,s)}d(n),this.defined=!0}this.defining=!1,this.defined&&!this.defineEmitted&&(this.defineEmitted=!0,this.emit("defined",this.exports),this.defineEmitComplete=!0)}}else hasProp(_.defQueueMap,n)||this.fetch()}},callPlugin:function(){var e=this.map,t=e.id,i=a(e.prefix);this.depMaps.push(i),c(i,"defined",bind(this,function(i){var r,o,u,p=getOwn(L,this.map.id),h=this.map.name,f=this.map.parentMap?this.map.parentMap.name:null,g=_.makeRequire(e.parentMap,{enableBuildCallback:!0});return this.map.unnormalized?(i.normalize&&(h=i.normalize(h,function(e){return n(e,f,!0)})||""),o=a(e.prefix+"!"+h,this.map.parentMap,!0),c(o,"defined",bind(this,function(e){this.map.normalizedMap=o,this.init([],function(){return e},null,{enabled:!0,ignore:!0})})),u=getOwn(T,o.id),void(u&&(this.depMaps.push(o),this.events.error&&u.on("error",bind(this,function(e){this.emit("error",e)})),u.enable()))):p?(this.map.url=_.nameToUrl(p),void this.load()):(r=bind(this,function(e){this.init([],function(){return e},null,{enabled:!0})}),r.error=bind(this,function(e){this.inited=!0,this.error=e,e.requireModules=[t],eachProp(T,function(e){0===e.map.id.indexOf(t+"_unnormalized")&&d(e.map.id)}),l(e)}),r.fromText=bind(this,function(n,i){var o=e.name,c=a(o),u=useInteractive;i&&(n=i),u&&(useInteractive=!1),s(c),hasProp(k.config,t)&&(k.config[o]=k.config[t]);try{req.exec(n)}catch(d){return l(makeError("fromtexteval","fromText eval for "+t+" failed: "+d,d,[t]))}u&&(useInteractive=!0),this.depMaps.push(c),_.completeLoad(o),g([o],r)}),void i.load(e.name,g,r,k))})),_.enable(i,this),this.pluginMaps[i.id]=i},enable:function(){S[this.map.id]=this,this.enabled=!0,this.enabling=!0,each(this.depMaps,bind(this,function(e,t){var n,i,r;if("string"==typeof e){if(e=a(e,this.map.isDefine?this.map:this.map.parentMap,!1,!this.skipMap),this.depMaps[t]=e,r=getOwn(x,e.id))return void(this.depExports[t]=r(this));this.depCount+=1,c(e,"defined",bind(this,function(e){this.undefed||(this.defineDep(t,e),this.check())})),this.errback?c(e,"error",bind(this,this.errback)):this.events.error&&c(e,"error",bind(this,function(e){this.emit("error",e)}))}n=e.id,i=T[n],hasProp(x,n)||!i||i.enabled||_.enable(e,this)})),eachProp(this.pluginMaps,bind(this,function(e){var t=getOwn(T,e.id);t&&!t.enabled&&_.enable(e,this)})),this.enabling=!1,this.check()},on:function(e,t){var n=this.events[e];n||(n=this.events[e]=[]),n.push(t)},emit:function(e,t){each(this.events[e],function(e){e(t)}),"error"===e&&delete this.events[e]}},_={config:k,contextName:e,registry:T,defined:A,urlFetched:I,defQueue:E,defQueueMap:{},Module:b,makeModuleMap:a,nextTick:req.nextTick,onError:l,configure:function(e){if(e.baseUrl&&"/"!==e.baseUrl.charAt(e.baseUrl.length-1)&&(e.baseUrl+="/"),"string"==typeof e.urlArgs){var t=e.urlArgs;e.urlArgs=function(e,n){return(n.indexOf("?")===-1?"?":"&")+t}}var n=k.shim,i={paths:!0,bundles:!0,config:!0,map:!0};eachProp(e,function(e,t){i[t]?(k[t]||(k[t]={}),mixin(k[t],e,!0,!0)):k[t]=e}),e.bundles&&eachProp(e.bundles,function(e,t){each(e,function(e){e!==t&&(L[e]=t)})}),e.shim&&(eachProp(e.shim,function(e,t){isArray(e)&&(e={deps:e}),!e.exports&&!e.init||e.exportsFn||(e.exportsFn=_.makeShimExports(e)),n[t]=e}),k.shim=n),e.packages&&each(e.packages,function(e){var t,n;e="string"==typeof e?{name:e}:e,n=e.name,t=e.location,t&&(k.paths[n]=e.location),k.pkgs[n]=e.name+"/"+(e.main||"main").replace(currDirRegExp,"").replace(jsSuffixRegExp,"")}),eachProp(T,function(e,t){e.inited||e.map.unnormalized||(e.map=a(t,null,!0))}),(e.deps||e.callback)&&_.require(e.deps||[],e.callback)},makeShimExports:function(e){function t(){var t;return e.init&&(t=e.init.apply(global,arguments)),t||e.exports&&getGlobal(e.exports)}return t},makeRequire:function(t,r){function o(n,i,c){var u,d,p;return r.enableBuildCallback&&i&&isFunction(i)&&(i.__requireJsBuild=!0),"string"==typeof n?isFunction(i)?l(makeError("requireargs","Invalid require call"),c):t&&hasProp(x,n)?x[n](T[t.id]):req.get?req.get(_,n,t,o):(d=a(n,t,!1,!0),u=d.id,hasProp(A,u)?A[u]:l(makeError("notloaded",'Module name "'+u+'" has not been loaded yet for context: '+e+(t?"":". Use require([])")))):(v(),_.nextTick(function(){v(),p=s(a(null,t)),p.skipMap=r.skipMap,p.init(n,i,c,{enabled:!0}),h()}),o)}return r=r||{},mixin(o,{isBrowser:isBrowser,toUrl:function(e){var i,r=e.lastIndexOf("."),o=e.split("/")[0],a="."===o||".."===o;return r!==-1&&(!a||r>1)&&(i=e.substring(r,e.length),e=e.substring(0,r)),_.nameToUrl(n(e,t&&t.id,!0),i,!0)},defined:function(e){return hasProp(A,a(e,t,!1,!0).id)},specified:function(e){return e=a(e,t,!1,!0).id,hasProp(A,e)||hasProp(T,e)}}),t||(o.undef=function(e){u();var n=a(e,t,!0),r=getOwn(T,e);r.undefed=!0,i(e),delete A[e],delete I[n.url],delete C[e],eachReverse(E,function(t,n){t[0]===e&&E.splice(n,1)}),delete _.defQueueMap[e],r&&(r.events.defined&&(C[e]=r.events),d(e))}),o},enable:function(e){var t=getOwn(T,e.id);t&&s(e).enable()},completeLoad:function(e){var t,n,i,o=getOwn(k.shim,e)||{},a=o.exports;for(u();E.length;){if(n=E.shift(),null===n[0]){if(n[0]=e,t)break;t=!0}else n[0]===e&&(t=!0);f(n)}if(_.defQueueMap={},i=getOwn(T,e),!t&&!hasProp(A,e)&&i&&!i.inited){if(!(!k.enforceDefine||a&&getGlobal(a)))return r(e)?void 0:l(makeError("nodefine","No define call for "+e,null,[e]));f([e,o.deps||[],o.exportsFn])}h()},nameToUrl:function(e,t,n){var i,r,o,a,s,c,l,u=getOwn(k.pkgs,e);if(u&&(e=u),l=getOwn(L,e))return _.nameToUrl(l,t,n);if(req.jsExtRegExp.test(e))s=e+(t||"");else{for(i=k.paths,r=e.split("/"),o=r.length;o>0;o-=1)if(a=r.slice(0,o).join("/"),c=getOwn(i,a)){isArray(c)&&(c=c[0]),r.splice(0,o,c);break}s=r.join("/"),s+=t||(/^data\:|^blob\:|\?/.test(s)||n?"":".js"),s=("/"===s.charAt(0)||s.match(/^[\w\+\.\-]+:/)?"":k.baseUrl)+s}return k.urlArgs&&!/^blob\:/.test(s)?s+k.urlArgs(e,s):s},load:function(e,t){req.load(_,e,t)},execCb:function(e,t,n,i){return t.apply(i,n)},onScriptLoad:function(e){if("load"===e.type||readyRegExp.test((e.currentTarget||e.srcElement).readyState)){interactiveScript=null;var t=m(e);_.completeLoad(t.id)}},onScriptError:function(e){var t=m(e);if(!r(t.id)){var n=[];return eachProp(T,function(e,i){0!==i.indexOf("_@r")&&each(e.depMaps,function(e){if(e.id===t.id)return n.push(i),!0})}),l(makeError("scripterror",'Script error for "'+t.id+(n.length?'", needed by: '+n.join(", "):'"'),e,[t.id]))}}},_.require=_.makeRequire(),_}function getInteractiveScript(){return interactiveScript&&"interactive"===interactiveScript.readyState?interactiveScript:(eachReverse(scripts(),function(e){if("interactive"===e.readyState)return interactiveScript=e}),interactiveScript)}var req,s,head,baseElement,dataMain,src,interactiveScript,currentlyAddingScript,mainScript,subPath,version="2.3.6",commentRegExp=/\/\*[\s\S]*?\*\/|([^:"'=]|^)\/\/.*$/gm,cjsRequireRegExp=/[^.]\s*require\s*\(\s*["']([^'"\s]+)["']\s*\)/g,jsSuffixRegExp=/\.js$/,currDirRegExp=/^\.\//,op=Object.prototype,ostring=op.toString,hasOwn=op.hasOwnProperty,isBrowser=!("undefined"==typeof window||"undefined"==typeof navigator||!window.document),isWebWorker=!isBrowser&&"undefined"!=typeof importScripts,readyRegExp=isBrowser&&"PLAYSTATION 3"===navigator.platform?/^complete$/:/^(complete|loaded)$/,defContextName="_",isOpera="undefined"!=typeof opera&&"[object Opera]"===opera.toString(),contexts={},cfg={},globalDefQueue=[],useInteractive=!1;if("undefined"==typeof define){if("undefined"!=typeof requirejs){if(isFunction(requirejs))return;cfg=requirejs,requirejs=void 0}"undefined"==typeof require||isFunction(require)||(cfg=require,require=void 0),req=requirejs=function(e,t,n,i){var r,o,a=defContextName;return isArray(e)||"string"==typeof e||(o=e,isArray(t)?(e=t,t=n,n=i):e=[]),o&&o.context&&(a=o.context),r=getOwn(contexts,a),r||(r=contexts[a]=req.s.newContext(a)),o&&r.configure(o),r.require(e,t,n)},req.config=function(e){return req(e)},req.nextTick="undefined"!=typeof setTimeout?function(e){setTimeout(e,4)}:function(e){e()},require||(require=req),req.version=version,req.jsExtRegExp=/^\/|:|\?|\.js$/,req.isBrowser=isBrowser,s=req.s={contexts:contexts,newContext:newContext},req({}),each(["toUrl","undef","defined","specified"],function(e){req[e]=function(){var t=contexts[defContextName];return t.require[e].apply(t,arguments)}}),isBrowser&&(head=s.head=document.getElementsByTagName("head")[0],baseElement=document.getElementsByTagName("base")[0],baseElement&&(head=s.head=baseElement.parentNode)),req.onError=defaultOnError,req.createNode=function(e,t,n){var i=e.xhtml?document.createElementNS("http://www.w3.org/1999/xhtml","html:script"):document.createElement("script");return i.type=e.scriptType||"text/javascript",i.charset="utf-8",i.async=!0,i},req.load=function(e,t,n){var i,r=e&&e.config||{};if(isBrowser)return i=req.createNode(r,t,n),i.setAttribute("data-requirecontext",e.contextName),i.setAttribute("data-requiremodule",t),!i.attachEvent||i.attachEvent.toString&&i.attachEvent.toString().indexOf("[native code")<0||isOpera?(i.addEventListener("load",e.onScriptLoad,!1),i.addEventListener("error",e.onScriptError,!1)):(useInteractive=!0,i.attachEvent("onreadystatechange",e.onScriptLoad)),i.src=n,r.onNodeCreated&&r.onNodeCreated(i,r,t,n),currentlyAddingScript=i,baseElement?head.insertBefore(i,baseElement):head.appendChild(i),currentlyAddingScript=null,i;if(isWebWorker)try{setTimeout(function(){},0),importScripts(n),e.completeLoad(t)}catch(o){e.onError(makeError("importscripts","importScripts failed for "+t+" at "+n,o,[t]))}},isBrowser&&!cfg.skipDataMain&&eachReverse(scripts(),function(e){if(head||(head=e.parentNode),dataMain=e.getAttribute("data-main"))return mainScript=dataMain,cfg.baseUrl||mainScript.indexOf("!")!==-1||(src=mainScript.split("/"),mainScript=src.pop(),subPath=src.length?src.join("/")+"/":"./",cfg.baseUrl=subPath),mainScript=mainScript.replace(jsSuffixRegExp,""),req.jsExtRegExp.test(mainScript)&&(mainScript=dataMain),cfg.deps=cfg.deps?cfg.deps.concat(mainScript):[mainScript],!0}),define=function(e,t,n){var i,r;"string"!=typeof e&&(n=t,t=e,e=null),isArray(t)||(n=t,t=null),!t&&isFunction(n)&&(t=[],n.length&&(n.toString().replace(commentRegExp,commentReplace).replace(cjsRequireRegExp,function(e,n){t.push(n)}),t=(1===n.length?["require"]:["require","exports","module"]).concat(t))),useInteractive&&(i=currentlyAddingScript||getInteractiveScript(),i&&(e||(e=i.getAttribute("data-requiremodule")),r=contexts[i.getAttribute("data-requirecontext")])),r?(r.defQueue.push([e,t,n]),r.defQueueMap[e]=!0):globalDefQueue.push([e,t,n])},define.amd={jQuery:!0},req.exec=function(text){return eval(text)},req(cfg)}}(this,"undefined"==typeof setTimeout?void 0:setTimeout),function(){window.ud_define=window.define,window.define=void 0}(),ud_define("lib/udesk.core",[],function(){return window.udesk}),ud_define("lib/wechat-record",[],function(){return function(e){var t=e.appid,n=e.cb,i=e.bindEvent,r=e.platform,o=e.jweixinUrl,a=void 0===o?"https://res.wx.qq.com/open/js/jweixin-1.6.0.js":o;$.when($.getScript(a),$.getJSON("/spa1/im/js_sdk/get_signature",{url:window.location.href,platform:r,appid:t})).done(function(e,t){var o=t[0];wx.config({debug:!1,appId:o.appId,timestamp:o.timestamp,nonceStr:o.nonceStr,signature:o.signature,jsApiList:["startRecord","stopRecord","onVoiceRecordEnd","downloadVoice","playVoice","uploadVoice","translateVoice"]}),wx.ready(function(){function e(e){var t=e.localId;Promise.all([new Promise(function(e){wx.uploadVoice({localId:t,isShowProgressTips:1,success:function(t){return e(t)}})}),new Promise(function(e){wx.translateVoice({localId:t,isShowProgressTips:1,success:function(t){return e(t)}})})]).then(function(e){var t=e[0],i=e[1];console.log(t),console.log(i),n("end",{serverId:t.serverId,translateResult:i.translateResult,appid:o.appId,platform:r})})}i({onStart:function(){wx.startRecord(),wx.onVoiceRecordEnd({complete:e})},onEnd:function(){wx.stopRecord({success:e})},onCancel:function(){wx.stopRecord()}})}),wx.error(function(e){console.log("[wx error]",e)})})}}),function(e,t){function i(e,t){var n=[];t&&(e=encodeURIComponent(decodeURIComponent(e)),e=e.replace(/%2F/g,"/"));for(var i=0;i<e.length;i++){var r=e.charCodeAt(i).toString(16);n.push(r)}return n.join("")}var r,o,a,s=t.location.pathname||"",c=0===s.indexOf("/im_client")?s:"/im_client/",l=e.context,u={unreadCount:0,unreadMsgsHeight:0,isVoice2texting:!1,isLongEnter:!1,canOpenVoice:!1,voiceAllow:!1},d=function(e){var t=$(e.target).data("miniprogram-path");t&&wx.miniProgram.navigateTo({url:t,complete:function(){wx.miniProgram.switchTab({url:t})}})},p={modal:null,dialog:null,apiPath:"/spa1/",isMob:!1,currentMode:"fullscreen",stopQueuing:!1,agent_id:"",chat_creator:"customer",invited:!1,last_im_session_id:null,last_more_marking:null,getUserTimes:0,loadFiles:[],isVisibility:!0,merchantEl:null,noticeTime:null,shouqianbaCustomers:[105343220,81073504,205288134,271683748,161965284,200749209,272278743,272208833,272031681,271996306,271986120,271966763,271850930,271422440,247344435,108400076,87240564,262135541,244493529,211811372,211565244,180787069,128625611,108071665,86998005,66471855,64942934,63415152,57467743],safari:function(){return e.isIos()&&/[Vv]ersion\/\d+\.\d+(\.\d+)* .*[Ss]afari/.test(navigator.userAgent)},init:function(t){this.supportStore("sessionStorage")&&window.sessionStorage.setItem("window_init_time",(new Date).valueOf()+"_"+this.randCode());var n=this,i=p.innerController.isInnerMode;t=t||{},n.initData(),n.currentMode=n.urlParamObj.currentMode||n.currentMode,n.bodyEl.addClass(n.currentMode),!t.notUser&&n.initAjax(),n.setFavicon(),n.bindAudio(),n.getFrameConfig({themeColorSelector:".theme-c",themeBGSelector:".theme-bg",themeBDSelector:".theme-bd",isTicket:t.isTicket,cb:function(r){console.log("frameConfig",r),"show"===r.goto_top_bottom_btn&&n.initScrollBtn(),n.initHeadStyle(r);var o=r.theme_color,a=i?r.banner_url:"";a&&i&&!p.banner[0].children.length&&p.banner.append('<img src="'+a+'" />'),e.setContext({config:r,themeColor:o,textColor:n.darkOrLight(o),customerTextColor:n.darkOrLight(r.customer_bg_color||o),customerBgColor:r.customer_bg_color||o,previewTextWidth:n.autoCalcWidth(p.UDL.g("label.preview")),downloadTextWidth:n.autoCalcWidth(p.UDL.g("label.download")),agentTransferTextWidth:n.autoCalcWidth(p.UDL.g("agent.transfer"),{tagName:"a",css:{fontSize:"16px"}})}),n.frameConfig=r,t.onBefore&&t.onBefore(n.frameConfig),!i&&n.abjuctCenterBox(r.pc_no_max_window),r.h5Mode?n.applyH5Mode():n.bodyEl.addClass("noH5"),n.setBodyClassnames(r),n.editorAutoShow(),t.notUser?t.onAfter&&t.onAfter({frameConfig:r,urlParamObj:n.urlParamObj||{}}):n.imClientValid(r,function(){n.loadUser(function(i,o,a,s,c,l){if(n.customer=i,n.company=o,n.agentResp=l||"",n.csrf_token=i.csrf_token||"",n.last_im_session_id=i.last_im_session_id||0,n.bindContentScroll(),n.log.init(i),e.log.config({user:{role:a,user_id:i.user_id,agent_id:i.agent_id,jid:i.username,agent_jid:i.agent_jid,chatting:i.chatting,company_id:o.id,company_name:o.name}}),p.shouqianbaCustomers.indexOf(i.user_id)>-1)try{var u=[];document.querySelectorAll("script[src]").forEach(function(e){u.push(e.src)}),e.log.error("getVersion",{versionList:JSON.stringify(u)})}catch(d){e.log.error("getVersionError",{errorMsg:d})}return e.setContext({role:a,customer:i,company:o,offline:i.offline||{},robotConfig:o.robot}),"customer"!==a?n.showModal("noAuthority"):s?(n.hideModal(),c&&$(".black-list-tip").text(c),$(".black-img").show(),n.blackListEl.show(),void n.headerEl.show()):(t.onAfter&&t.onAfter({frameConfig:r,customer:n.customer,urlParamObj:n.urlParamObj||{},company:o}),void n.initSidebox())})})}}),top.document.addEventListener("visibilitychange",function(){top.document.hidden?n.isVisibility=!1:(n.isVisibility=!0,n.sendMsgOfRead())})},initHeaderTextBoxStyle:function(t){return".header .title-box {color:"+this.darkOrLight(t.header_bg?e.ui.util.resolveLinearGradientColor(t.header_bg)[0]:t.theme_color)+"}"+(".header .appbar-right {color:"+this.darkOrLight(t.header_bg?e.ui.util.resolveLinearGradientColor(t.header_bg)[1]:t.theme_color)+"}")},initHeadStyle:function(e){var t=e.theme_color,n=e.customer_bg_color||t,i=this.darkOrLight(n),r=e.agent_bg_color||"#fff",o=this.darkOrLight(r),a=this.darkOrLight(r,!0),s=this.darkOrLight(n,!0),c="body,#content,.customButton {background-color:"+e.im_client_bg_color+" !important;}.btn-hollow{color:"+t+" !important;}.msg.msg-send .msg-content,.msg.robot-msg-send .msg-content {background-color: "+n+";border:"+(e.show_customer_border?"1px solid "+e.customer_border_color:"unset")+"}.nav-ul>li.active>a{border-bottom-color:"+t+"}.message-with-voice .voice-wrapper{background-color:"+n+";color:"+i+"}.msg.msg-recv .msg-content {background-color: "+r+";border:"+(e.show_agent_border?"1px solid "+e.agent_border_color:"unset")+";color:"+o+"}.event-box .event-text,.event-bar {color:"+e.event_text_color+";background-color:"+e.event_bg_color+"}#show-history,.msg .sender, .im-log-wrapper > .sender,.msg .sender, .im-log-wrapper > .sender{color:"+e.sys_text_color+"}#content .messages .msg-content-and-after .more-btn {background-image:linear-gradient(to bottom, rgba(255,255,255,0.1) 0%, "+r+" 30%)}.messages .event-redirect h4 {color:"+e.event_text_color+"}"+(".header {background:"+(e.header_bg||e.theme_color)+"}")+".msg.msg-send a {color:"+s+"}.msg.msg-recv a {color:"+a+"}";e.font_family&&e.font_family.trim()&&(c+="body {font-family: "+e.font_family+', Arial, "Helvetica Neue", Helvetica, "Hiragino Sans GB", "Microsoft YaHei", sans-serif}'),"adaptive"===e.logo_shape&&(c+=".ui-appbar img {width:auto;border-radius:0;-webkit-border-radius:0}"),c+=this.initHeaderTextBoxStyle(e),"#fff"===o&&(c+=".common-qustion-title {color:"+o+"}.horizontal-type-wrapper {color:"+o+"}.horizontal-list .list-item-disc {color:"+o+"}.horizontal-list .list-item-disc .icon-ic-arrow-right-s-youjiantou {color:"+o+"}.text-muted {color:"+o+"}.msg.vertical-common .list-box .list-item .link {color:"+o+"}.msg.vertical-common .list-box .list-item-disc > a {color:"+o+"}.msg .list-box .list-item .icon-ic-arrow-right-s-youjiantou {color:"+o+"}.msg .list-box .list-item-disc > a {text-decoration:underline;color:"+o+"}.msg .list-box .list-header {color:unset}.msg .list-box .list-item-disc {color:"+o+"}.msg-recv a {text-decoration:underline;color:"+o+"}.list-box .change, .change-horizontal-question {color:"+o+"}#content .messages .msg-content-and-after .more-btn{color:"+o+"}");var l=document.head||document.getElementsByTagName("head")[0],u=document.createElement("style");u.setAttribute("type","text/css"),u.styleSheet?u.styleSheet.cssText=c:u.appendChild(document.createTextNode(c)),l.appendChild(u)},colorRgb:function(e){var t=e.toLocaleLowerCase();if(t.indexOf("rgb")>-1)return t;if(t){if(4===t.length){for(var n="#",i=1;i<4;i+=1)n+=t.slice(i,i+1).concat(t.slice(i,i+1));t=n}for(var r=[],i=1;i<7;i+=2)r.push(Number("0X"+t.slice(i,i+2)));return"rgb("+r.join(",")+")"}return t},darkOrLight:function(e,t){var n=this.colorRgb(e).match(/\d+/g),i=.299*n[0]+.587*n[1]+.114*n[2];return t?i>=90&&i<=150?"rgb("+.299*(255-1*n[0])+", "+.587*(255-1*n[1])+", "+.114*(255-1*n[2])+")":"rgb("+(.299*n[0]+149.685)+", "+(.587*n[1]+29.07)+", "+(.114*n[2]+255*.299)+")":i>=192?"#000":"#fff"},initData:function(){var n=e.ifIE()||e.isIE11(),i=this.urlParamObj=e.urlParams(t.location.href),r=!!i.sdk_token,o={doc:$(document)};i.invite_user_key=i._INVITE_USER_KEY,delete i._INVITE_USER_KEY,this.isMob="none"!=$(".hidden-place .visible-mob").css("display"),this.agent_id&&(i.agent_id=this.agent_id),this.isHeadless=r,this.bodyEl=o.body=$(document.body),this.headerEl=o.header=$("#header"),this.footerEl=o.footer=$("#footer"),this.mainEl=o.main=$("#main"),this.contentEl=o.content=$("#content"),this.messagesEl=o.messages=this.contentEl.find(".messages"),this.banner=o.banner=this.contentEl.find(".banner-log"),this.sideBoxEl=o.sideBox=$("#side-box"),this.btnFullScreenEl=o.btnFullScreen=$("#btnFullScreen"),this.bottomPanelEl=o.bottomPanel=$("#bottomPanel"),this.btpTextEl=o.btpText=$("#btp-text"),this.btpBtnsEl=o.btpBtns=$("#btp-btns"),this.blackListEl=o.blackList=$("#black-list"),this.guideListEl=o.guideList=$("#guideList"),this.h5TransferEl=o.h5Transfer=$("#btnTransfer2"),this.pagesEl=o.pages=$("#pages"),this.copyRightEl=o.copyRight=$("#copy-right"),e.setContext({isIE:n,isIE8:n&&e.ifIE(8),isIE9:n&&e.ifIE(9),isLowIE:n&&e.ifIE(9,"lte"),isPC:e.isPC(),isMob:e.isMob(),isIos:e.isIos(),isMobCSS:this.isMob,isSDK:r,isHttps:"https:"===location.protocol,isInner:"inner"===i.currentMode,isHeadless:this.isHeadless,urlParams:i,sessionKey:i.session_key||"",els:o}),console.log("Init context",e.context)},randCode:function(){for(var e="",t=0;t<6;t++)e+=String.fromCharCode(Math.floor(26*Math.random()+"a".charCodeAt(0)));return e},initAjax:function(){var t=this,n=this.urlParamObj;$(document).ajaxSend(function(i,r,o){var a=o.noParams||"",s=o.url||"";t.csrf_token&&t.needAddTokenByUrl(s)&&r.setRequestHeader("X-CSRF-Token",t.csrf_token),Cookies.get("ifc")&&r.setRequestHeader("X-UDESK-IFC",Cookies.get("ifc")),Cookies.get("tid")&&r.setRequestHeader("X-UDESK-TID",Cookies.get("tid")),function(e){$.each(e,function(e,i){var r=t.customer||{},s=o[i],c={access_token:r.access_token,user_id:r.user_id};if(n.merchant_id&&(c.merchant_id=n.merchant_id),s&&"string"==typeof s&&s.indexOf(".js")===-1&&!a){if(s.indexOf("no_additional_params")>-1||o.no_additional_params)return;n.web_token&&!/[\?\&]web_token=/.test(s)&&(c.web_token=n.web_token),o[i]+=("data"===i||/[\?\&]/.test(s)?"&":"?")+t.jsonParam(c)}})}(["url","data"]),e.log.info(i.type,{path:o.url||o.data,method:o.type})}).ajaxComplete(function(t,n,i){e.log[200===n.status?"info":"error"](t.type,{path:i.url||i.data,status:n.status,statusText:n.statusText,method:i.type})})},initRecorder:function(t){var n=this,i=p.footerEl.find(".btn-voice"),r=this,o=+new Date;i.size()&&"none"!==i.css("display")&&(e.isMob()&&e.isWxWork()&&this.urlParamObj.qywx_corp_id?require(["lib/wechat-record"],function(e){e({appid:n.urlParamObj.qywx_corp_id,cb:t,bindEvent:function(e){return n.bindWeixinVoiceEvent(e)},platform:"qywx",jweixinUrl:"https://res.wx.qq.com/open/js/jweixin-1.2.0.js"})}):e.isMob()&&(e.isWeixin()||e.isMiniProgram())&&this.urlParamObj.wx_appid?require(["lib/wechat-record"],function(e){e({appid:n.urlParamObj.wx_appid,cb:t,bindEvent:function(e){return n.bindWeixinVoiceEvent(e)},platform:"weixin"})}):(a=Recorder({type:"wav",bitRate:16,sampleRate:16e3,bufferSize:4096,onProcess:function(t,n,i,r){if(o&&new Date-o>200){o=+new Date;var a=Math.ceil(n/10)||1;e.ui.voiceWaveImg({src_idx:a})}o||(o=+new Date)}}),r.bindVoiceEvent(t),r.bindPageVisibility()))},bindPageVisibility:function(){p.safari()&&e.isIos()&&document.addEventListener("visibilitychange",function(){if(document.hidden)console.log("ç¦»å¼äº!"),a&&a.close();else if(console.log("åæ¥äº!"),a){var e=p.footerEl.find(".btn-voice");e.size()&&e.hasClass("icon-keyboard")&&(e.removeClass("icon-keyboard").addClass("icon-ic-mic-maikefeng"),moreBoxEl.hide(),voiceBoxEl.hide(),toolbarEl.show(),textInputEl.show())}})},bindWeixinVoiceEvent:function(t){var n,i,r=t.onStart,o=t.onEnd,a=t.onCancel,s=this,c=null,l=null,d=150;$(".down-voice").off().on("touchstart",function(t){function h(t){$(document.body).off("touchend",h),$(document.body).off("touchmove",f),clearTimeout(c),clearTimeout(l),e.ui.voiceWaveImg({hide:!0}),g=!1,p.footerEl.find(".voicebox").removeClass("bg-enter"),p.footerEl.removeClass("bg-enter"),$(".down-voice").find(".down-voice-txt").text(p.UDL.g("label.enterStart")),s.removeVoiceAnimation(),o&&o()}function f(t){i=Math.ceil(t.originalEvent.changedTouches[0].pageY),n-i>d&&(e.ui.voiceWaveImg({src_idx:"cancel"}),a&&a())}if(u.isVoice2texting)return void p.showTip(p.UDL.g("label.waitTurn"),"warn");n=Math.ceil(t.originalEvent.touches[0].pageY);var g=!0;e.ui.voiceWaveImg({hide:!0}),$(this).find(".down-voice-txt").text(p.UDL.g("label.leaveEnd")),$(this).parent().addClass("bg-enter"),p.footerEl.addClass("bg-enter"),c&&clearTimeout(c),e.ui.voiceWaveImg({src_idx:2}),r&&r(),$(document.body).off("touchend").on("touchend",h),$(document.body).off("touchmove").on("touchmove",f),t.preventDefault()})},bindVoiceEvent:function(t){var n,i,r=this,o=null,s=null,c=150;$(".down-voice").off().on("touchstart",function(l){function d(n){$(document.body).off("touchend",d),$(document.body).off("touchmove",h),clearTimeout(o),clearTimeout(s),e.ui.voiceWaveImg({hide:!0}),f=!1,p.footerEl.find(".voicebox").removeClass("bg-enter"),p.footerEl.removeClass("bg-enter"),p.safari()?u.isLongEnter&&p.addVoiceAnimation():$(".down-voice").find(".down-voice-txt").text(p.UDL.g("label.enterStart")),u.isLongEnter&&u.canOpenVoice?a&&(2!==a.state?a.stop(function(e,n){n>6e4?p.showTip(p.UDL.g("label.voiceTimeLimit"),"warn"):n<500?p.showTip(p.UDL.g("label.voiceTooShort"),"warn"):(u.isVoice2texting=!0,r.voice2text(e,t))},function(e,t){a.stop(),p.showTip((t?"UserNotAllowï¼":"")+p.UDL.g("label.openFali")+": "+e,"error")}):a.stop()):$(".down-voice").find(".down-voice-txt").text(p.UDL.g("label.enterStart")),u.isLongEnter=!1,r.removeVoiceAnimation(),a.close()}function h(t){i=t.originalEvent.changedTouches[0].pageY,i=Math.ceil(i),a&&u.canOpenVoice&&u.isLongEnter&&(n-i>c?2!==a.state&&(a.pause(),e.ui.voiceWaveImg({src_idx:"cancel"})):1!==a.state&&(a.resume(),e.ui.voiceWaveImg({src_idx:2})))}if(!p.safari()||!$(this).hasClass("down-voice-rolling")){n=l.originalEvent.touches[0].pageY,n=Math.ceil(n),e.ui.voiceWaveImg({hide:!0});var f=!0;if(u.isVoice2texting)return void p.showTip(p.UDL.g("label.waitTurn"),"warn");$(this).find(".down-voice-txt").text(p.UDL.g("label.leaveEnd")),$(this).parent().addClass("bg-enter"),p.footerEl.addClass("bg-enter"),o&&clearTimeout(o),o=setTimeout(function(){u.isLongEnter=!0,a.open(function(){u.canOpenVoice=!0,f&&u.canOpenVoice?(e.ui.voiceWaveImg({src_idx:2}),a.start()):(a.stop(),a.close(),r.reOpen())},function(e,t){u.canOpenVoice=!1,a.close(),r.reOpen(),p.showTip((t?"UserNotAllowï¼":"")+p.UDL.g("label.openFali")+": "+e,"error")}),p.safari()||u.canOpenVoice||(s&&clearTimeout(s),s=setTimeout(function(){p.showTip(p.UDL.g("label.notSupportTip"),"warn")},5e3))},300),$(document.body).off("touchend").on("touchend",d),$(document.body).off("touchmove").on("touchmove",h),l.preventDefault()}})},reOpen:function(e){var t=this;p.safari()&&a&&(e&&this.addVoiceAnimation(),a.open(function(){u.canOpenVoice=!0,t.removeVoiceAnimation()},function(){u.canOpenVoice=!1}))},addVoiceAnimation:function(){if(p.safari()){var e=p.footerEl.find(".down-voice");e.addClass("down-voice-rolling"),e.find(".voice-rolling").show(),e.find(".down-voice-txt").text(p.UDL.g("label.voiceTrunText"))}},removeVoiceAnimation:function(){if(p.safari()){var e=p.footerEl.find(".down-voice"),t=p.UDL.g("label.enterVoice");e.removeClass("down-voice-rolling"),e.find(".down-voice-txt").text(t)}},voice2text:function(n,i){if(n&&i){var r=this,o=new FormData,a="/spa1/im/audio_recognize?im_web_plugin_id="+(this.urlParamObj.web_plugin_id||"");o.append("file",n,"test.wav");var s=this.urlParamObj||null;s||(s=e.urlParams(t.location.href)||{});var c=s.language||"zh-cn";o.append("lang",c),"ja"===c&&(a=e.isTestENV()?"https://reocar.udeskb2.com/speech_recognition?im_web_plugin_id="+(this.urlParamObj.web_plugin_id||""):"https://cs-asr.udesk.cn/speech_recognition?im_web_plugin_id="+(this.urlParamObj.web_plugin_id||"")),u.isLongEnter=!1,p.safari()||p.showTip(p.UDL.g("label.voiceTruning"),"success",{time:1e3}),$.ajax({url:a,type:"POST",contentType:!1,processData:!1,data:o,headers:"ja"===c?{"Access-Control-Allow-Origin":"*"}:{},success:function(t){u.isVoice2texting=!1,1e3===t.code?(r.uploadBlob(n,function(e){t.url=e||"",i&&i("end",t)},function(){i&&i("end",t)}),e.ui.voiceWaveImg({hide:!0})):p.showTip(t.exception?t.exception.message:"è½¬æå­åééè¯¯","error")},error:function(e){u.isVoice2texting=!1,console.error("ä¸ä¼ å¤±è´¥",e),p.showTip(e,"error")}})}},uploadBlob:function(t,n){var i=this.company.id+"_voice_"+ +new Date+(""+1e6*Math.random()).substring(0,3)+".wav";e.uploader.uploadVoice({fileName:i,marking:"web.im.short_audio_recognize",data:t,successFn:function(e){n&&n(e)},errorFn:function(){n&&n()}})},needAddTokenByUrl:function(e){if(!e)return!1;e+="";var t=location.origin||"",n=e.indexOf("/spa1/")>-1;return/^(http:\/\/|https:\/\/)/.test(e)?!!(e.indexOf(t)>-1&&n):!!n},initAjaxOnlySetCSRFToken:function(e){var t=this;(e||this.csrf_token)&&$(document).ajaxSend(function(n,i,r){var o=r.url||"";t.needAddTokenByUrl(o)&&i.setRequestHeader("X-CSRF-Token",e||t.csrf_token)})},getSideBoxData:function(e){var t=this;$.get(t.apiPath+"im/im_newspaper/window",{im_web_plugin_id:t.urlParamObj.web_plugin_id},function(n){n=n||{};var i=[],r=t.company.robot||{},o="udesk_robot"===r.channel;$.each(n.side_data,function(e,t){t.enable&&(t.type=t.key,t.nick=t.name,"robot_auto_suggest"===t.key&&o&&i.push(t),"robot_auto_suggest"!==t.key&&i.push(t))}),n.side_data=i,t.sideRes=n,e&&e(n)})},needSideListion:function(e){var t=!1;return $.each(e||[],function(e,n){"custom_url"===n.key&&$.trim(n.url)&&(t=!0)}),t},initSidebox:function(){var t=this,n=p.innerController.isInnerMode;n||e.isMob()||this.getSideBoxData(function(n){e.im.sidebox.init({container:t.sideBoxEl,need_clear:!0,side_data:n.side_data,right_width:n.data.right_width,product:e.im.sidebox.getProductData(t.urlParamObj,!0),after:function(e){if(e){var n;t.bodyEl.removeClass("fullscreen").addClass("side"),n={right:Math.min(t.sideBoxEl.width(),$("#main").width()/2)+2,width:"auto"},t.contentEl.css(n),t.footerEl.css(n),t.bottomPanelEl.css(n),t.isWindowCenter&&t.abjuctCenterBox(null,!0)}}})})},imgViewerInit:function(){if(!e.isPC()||!p.innerController.isInnerMode){var t,n=".msg:not(.msg-file,.msg-shortcut,.msg_custom_card,.msg-map) .msg-content img",i=p.messagesEl,r=function(){var e=$.Deferred();return t?(e.resolve(),e.promise()):(t=!0,$.getScript("js/lib/img-viewer.js"))};r(),i.on("click",n,function(t){var o,a=$(this),s=[];i.find(n).map(function(e,t){a[0]===this&&(o=e);var n=t.naturalWidth?t.naturalWidth:$(t).width(),i=t.naturalHeight?t.naturalHeight:$(t).height();s.push({src:this.src,title:this.title,w:n,h:i})}),r().then(function(){e.imgViewer.load(s,{index:o})})})}},imClientValid:function(e,t){var n=this,i=this.urlParamObj||{},r=this.preloadData||{};return r.im_client_valid_enable=r.im_client_valid_enable||e.im_client_valid_enable||!1,r.im_client_valid_enable?void $.get(n.apiPath+"im_client_valid",{v_nonce:i.v_nonce||"",v_timestamp:i.v_timestamp||"",v_signature:i.v_signature||""}).always(function(e){return e?1e3!==e.code?n.showModal("no_through_valid"):void(t&&t()):n.showModal("networkError")}):t&&t()},doTransfer:function(){105343220!=p.customer.user_id&&81073504!=p.customer.user_id||e.log.error("doTransfer",{
user:p.customer.user_id});var t=this,n=l.els;l.chatAgent?($.each([">.queue-event","#noWordtimeEventMsg"],function(e,t){n.messages.append(n.messages.find(t))}),p.goBottom()):this.beforeTransfer(function(){var n=$("#btnTransfer"),i=n.is(":visible"),r=$("#btnTransfer2"),o=r.is(":visible");l.isTransfer=!0,l.chatAgent=l.chatAgent||e.chatAgent.create(),p.clearOfflineCount(!0),l.chatAgent.init({tryShowBtnTransfer:function(){i&&$("#btnTransfer").click(function(){l.chatAgent=null,t.doTransfer()}).show(),o&&$("#btnTransfer2").click(function(){l.chatAgent=null,t.doTransfer()}).show()}})})},beforeTransfer:function(t){var n=this.urlParamObj;n.user_id=this.customer.user_id;try{$.get(this.apiPath+"im_user/pre_form",n).always(function(n){n=n||{},e.setContext({show_pre_form:n.show_pre_form||!1,work_time:n.work_time||!1,workTime:n.work_time||!1,show_pre_session:n.show_pre_session||!1,queue_continue_robot_session:n.queue_continue_robot_session||!1}),t&&t()})}catch(i){t&&t()}},doTransferCount:function(n,i){var r=this,o=r.urlParamObj||e.urlParams(t.location.href);$.get(r.apiPath+"im/km_robot_transer",{customer_jid:r.customer.username,web_plugin_id:o&&o.web_plugin_id,session_id:n,window_init_time:this.supportStore("sessionStorage")?sessionStorage.getItem("window_init_time"):void 0}).always(function(){var e="Transfer||"+r.customer.username;r.sessionStore(e,e+"||"+(n||"")),i&&i(e)})},doTransferTurnPage:function(n,i){var r=this,o=this.urlParamObj||e.urlParams(t.location.href);$.ajax({async:2!==n,url:"/spa1/im/km_robot_transer",data:{customer_jid:r.customer.username,web_plugin_id:o&&o.web_plugin_id,session_id:i,operate_type:n,window_init_time:this.supportStore("sessionStorage")?sessionStorage.getItem("window_init_time"):void 0}})},loadUser:function(e){var t=this,n=this.urlParamObj||{},i={};n.sdk_token?(i={device_type:n.platform_name,device_info:{app_name:n.app_name,app_version:n.app_version,platform_name:n.platform_name,version:n.platform_version,device:n.device,phoneModal:n.phoneModal,phoneVersion:n.phoneVersion,networkStatus:n.networkStatus,carrier:n.carrier,scaleScreen:n.scaleScreen}},$.each(["app_name","app_version","platform_version","device","phoneModal","phoneVersion","networkStatus","carrier","scaleScreen"],function(e,t){delete n[t]})):(i={device_type:"web",device_info:t.getDevices()},$.each(["cur_url","cur_title","pre_url","src_url"],function(e,t){delete n[t]}));var r=$.extend({device:i},n);t.getUser(r,e)},getUser:function(t,n){var i=this,r=this.urlParamObj||{},o=r.echostr,a=i.getUserTimes;t=$.extend({ud_check_cookie:navigator.cookieEnabled,ud_check_ws:"undefined"!=typeof WebSocket,window_init_time:this.supportStore("sessionStorage")?sessionStorage.getItem("window_init_time"):void 0},t),r.session_id&&(t.im_robot_session_id=r.session_id),$.ajax({url:i.apiPath+"im_user",type:"post",headers:{"X-Url-Scheme":location.protocol.replace(":","")},dataType:"json",data:t}).always(function(s){if(429===s.status)return void i.showModal("http_code_429");if(r.sdk_token&&(!s||200!=s.code)&&a<1)return a++,i.getUserTimes=a,void setTimeout(function(){i.getUser(t,n)},1e3);i.getUserTimes=0,s=s||{};var c=s.im_user,l=s.company;if(o&&o!==s.echostr)return i.showModal("customError",{content:i.UDL.g("tip.accessError")});switch(s.code){case 9001:return i.showModal("customError",{content:i.UDL.g("tip.robotError")});case 9002:case 9003:return i.showModal("customError",{content:s.message});case 9200:return i.showModal("noAuthorityAdmin");case 9206:return i.hideModal(),$(".black-list-tip").text(s.message||"è¯¥é¾æ¥ä¸å­å¨ï¼è¯·èç³»ç®¡çå"),$(".del-plugin-img").show(),i.blackListEl.show(),void i.headerEl.show()}c=e.decrypt_username(c),c?n(c,l,s.role,s.is_blocked,s.black_list_notice,s.agent_resp):i.showModal("error")})},showBotomPanel:function(e,t){var n=this.frameConfig.theme_color;switch(e){case"chat_done":this.btpTextEl.text(this.UDL.g("agent.over")),this.btpBtnsEl.html('<a style="width:140px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;background-color:'+n+'" href="javascript:;" class="btn btn-sm btn-success btn-chat-done" title="'+this.UDL.g("agent.newChat")+'">'+this.UDL.g("agent.newChat")+"</a>");break;case"agent_offline":this.btpTextEl.text(this.UDL.g("agent.agOffline")),this.btpBtnsEl.html('<a style="width:85px;margin-right:17px;border-radius: 1px;background-color:'+n+'" href="javascript:;" class="btn btn-sm btn-success btn-chat-done">'+this.UDL.g("label.refresh")+'</a><a style="width:85px;border-radius: 1px;background-color:'+n+'" class="btn btn-default btn-sm theme-bg btn-feedback">'+this.UDL.g("label.leaveMsg")+"</a>");break;case"queuing":this.btpTextEl.text(this.UDL.g("agent.leaveMsgTip")),this.btpBtnsEl.html('<a style="width:140px;border-radius: 1px;background-color:'+n+'" class="btn btn-sm btn-default theme-bg btn-feedback">'+this.UDL.g("label.leaveMsg")+"</a>")}this.goBottom(),$(".btn-chat-done").off("click").on("click",function(){return location.reload(),!1}),$(".ui-appbar .btn-customer-close").hide().remove(),this.bottomPanelEl.css({height:p.footerEl.css("height")}).show()},showModal:function(t,n){var i,r,o,a,s=!0,l=this,u="",d=!0,p=$("#main");switch(!p.size()&&(p=null),t){case"loading":r="<i></i>";break;case"networkError":r="<p></br>"+l.UDL.g("tip.networkError")+"<p>";break;case"no_through_valid":r='<img src="images/no-valid.png"><p>'+l.UDL.g("tip.wrongRequest")+"<p>",e.ui.appBar({title:l.UDL.g("tip.validRequest")});break;case"chat_done":r="{iconbar-smile}<p>"+l.UDL.g("agent.over")+"<p>";break;case"disconnect":r="{iconbar-alert}<p>"+l.UDL.g("tip.disconnect")+" </p>";break;case"queuing":d=!1,r="<p>{message}</p>";break;case"agent_offline":r=["{iconbar-smile}","<p>"+l.UDL.g("tip.agOffline")+"</p>",'<p class="btnbar">','  <a class="btn btn-default btn-feedback">'+l.UDL.g("label.leaveMsg")+"</a> &nbsp; &nbsp; &nbsp;",'  <a href="'+location.href+'" class="btn btn-default">'+l.UDL.g("label.refresh")+"</a>","</p>"].join("");break;case"agent_notfound":r="{iconbar-alert}<p>"+l.UDL.g("tip.noAgent")+'</p><p><a class="btn btn-default btn-sm btn-feedback">'+l.UDL.g("label.leaveMsg")+"</a></p>";break;case"noAuthority":a=!0,r="{iconbar-smile}<p>"+l.UDL.g("tip.forbid")+"</p><p>"+l.UDL.g("tip.logoutTip")+"</p>";break;case"noAuthorityAdmin":a=!0,r="{iconbar-smile}<p>"+l.UDL.g("tip.forbidAdmin")+"</p><p>"+l.UDL.g("tip.logoutTip")+"</p>";break;case"error":r="{iconbar-alert}<p>"+l.UDL.g("tip.connectFail")+' <a href="'+location.href+'">'+l.UDL.g("label.refresh")+"</a>   "+l.UDL.g("tip.retry")+"</p > ";break;case"reConnectError":r="{iconbar-alert}<p>"+l.UDL.g("tip.reConnectFail")+' <a href="'+location.href+'">'+l.UDL.g("label.refresh")+"</a>   "+l.UDL.g("tip.retry")+"</p > ";break;case"customError":r="{iconbar-smile}<p>{content}</p>";break;case"feedbackError":r="{iconbar-alert}<p>"+l.UDL.g("tip.dataFail")+"</p>";break;case"robotError":var h=location.search&&location.search.replace("?",""),f=c+"?transfer=true"+(h?"&"+h:"");r="{iconbar-alert}<p>"+l.UDL.g("tip.robotWrong")+'&nbsp;<a style="text-decoration:underline;" href='+f+">"+l.UDL.g("tip.agentService")+"</a></p>";break;case"robotDelay":var h=location.search&&location.search.replace("?",""),f=c+"?transfer=true"+(h?"&"+h:"");r="{iconbar-alert}<p>"+l.UDL.g("tip.networkWeek")+'&nbsp;<a style="text-decoration:underline;" href='+f+">"+l.UDL.g("tip.agentService")+"</a></p>";break;case"http_code_429":r='<div class="http-code-429"><h1 class="text-center">'+l.UDL.g("tip.http-code-429.title")+'</h1><p class="text-left">'+l.UDL.g("tip.http-code-429.tip-1")+'</p><p class="text-left">'+l.UDL.g("tip.http-code-429.tip-2")+'</p><div class="text-center timer-wrapper"><i class="icon icon-clock-o"></i><span data-countdown="300000"></span>'+l.UDL.g("tip.http-code-429.tip-3")+'</div></div><script>(function(){$("[data-countdown]").countdown()})()</script>';break;case"http_code_429":r='<div class="http-code-429"><h1 class="text-center">'+l.UDL.g("tip.http-code-429.title")+'</h1><p class="text-left">'+l.UDL.g("tip.http-code-429.tip-1")+'</p><p class="text-left">'+l.UDL.g("tip.http-code-429.tip-2")+'</p><div class="text-center timer-wrapper"><i class="icon icon-clock-o"></i><span data-countdown="300000"></span>'+l.UDL.g("tip.http-code-429.tip-3")+'</div></div><script>(function(){$("[data-countdown]").countdown()})()</script>';break;default:d=!1}if(r=e.replaceTpl(r,$.extend({"iconbar-smile":'<p class="iconbar"><i class="icon icon-tixing text-info"></i></p>',"iconbar-alert":'<p class="iconbar"><i class="icon icon-alert text-warning"></i></p>',"iconbar-ok":'<p class="iconbar"><i class="icon icon-ok text-success"></i></p>'},n)),o=e.ui[s?"tinyModal":"modal"]({container:p,clz:t,title:i,content:r,contentClz:u,needClose:!1,isMob:l.isMob,cssAttrs:d?{color:"#fff"}:null,mask:{container:p}}),l.modal=o,"queuing"===t){var g=l.sideBoxEl,m=$(".side"),v=m.find(".mask.queuing"),y=m.find(".im-pop.queuing"),b=g.css("width").replace("px","")||270;g.is(":visible")&&(v.css({right:b+"px"}),y.css({left:"15px",right:parseFloat(b)+15+"px",margin:0})),v.height()<300&&y.css("top","35%")}return o},hideModal:function(e){var t=this.modal;t&&(e?t.el.is("."+e)&&t.hide():t.hide())},sendTransferRobotSocket:function(e){p.innerController.postMsg({type:e})},showTransferAgentDialog:function(t){var n,i=this;return n=e.ui.dialog({title:!1,body:'<div><div style="text-align: left;margin-bottom: 16px;"><i class="icon icon-msg-ok text-success" style="margin-right: 8px;color: #4abd1b;"></i><strong style="color: #696969;">'+i.UDL.g("tip.agentRequest")+'</strong></div><div style="margin-bottom: 16px;color: #ddd;"><p>'+i.UDL.g("tip.transferAgent")+'</p></div><div style="display: flex;align-items: center;justify-content: flex-end;"><button class="btn btn-primary" style="padding: 6px 12px; margin-right: 5px;line-height: 1;"data-act="accept">æ¥å</button><button class="btn btn-default" style="padding: 6px 12px;line-height: 1;"data-act="close">åæ¶</button></div></div>',onClick:function(e,n){"accept"===e?(l.chatAgent=null,t.dispatchEvent(new CustomEvent("acceptedTransferAgent")),i.doTransfer()):"close"===e&&(i.agent_id="",i.urlParamObj.agent_id="",t.dispatchEvent(new CustomEvent("rejectedTransferAgent"))),i.hideTransferAgentDialog()}}),i.dialog=n,n},hideTransferAgentDialog:function(t){var n=this.dialog,i=e.ui.mask();n&&(t?n.el.is("."+t)&&(n.hide(),i.hide()):(n.hide(),i.hide()))},showReConnectModal:function(){var e='<div class="re-box"><p>ç³»ç»çæµå°æ¨çé¾æ¥å­å¨å¼å¸¸, è¯·   <a href="'+location.href+'" >å·æ°</a></p></div>';$(document.body).append(e),setTimeout(function(){$(".re-box").hide().remove()},5e3)},getFileType:function(t){t=t||{};var n=t.name||"",i=t.type||"",r="image/"===i.slice(0,6)?"image":"file",o=!1;return e.platform({weixin:function(){o=!0},mqq:function(){o=!0}}),"file"===r&&0===n.indexOf("image%3A")&&o&&"application/octet-stream"===i&&(r="image"),!e.isAndroid()||"file"!==r||"application/octet-stream"!==i||0!==n.indexOf("wx_camera_")&&0!==n.indexOf("mmexport")||(r="image"),r},autoCalcWidth:function(e,t){t=$.extend({tagName:"span"},t);var n,i=$("<"+t.tagName+">").text(e);return t.css&&i.css(t.css),i.appendTo(this.bodyEl),n=i.width(),i.remove(),n},getDevices:function(){var t=this,n=this.urlParamObj||{},i=n.pre_url||l.pre_url||"",r=n.cur_url||l.cur_url||this.getReferrer()||location.href,o=n.src_url||l.src_url||this.getReferrer()||"",a=i,s=n.cur_title||l.cur_title||"",c=this.getSearchInfo(location.href,o||a),u=n.channel||l.channel||"",d=i,p=r,h=o;i&&(e.context.pre_url=i),r&&(e.context.cur_url=r),o&&(e.context.src_url=o),s&&(e.context.cur_title=s),u&&(e.context.channel=u);try{d=decodeURIComponent(i)||""}catch(f){}try{p=decodeURIComponent(r)||""}catch(f){}try{h=decodeURIComponent(o)||""}catch(f){}return{version:1,referrer:a||"",accessUrl:d,accessUrl_desc:"",cur_url:p,cur_url_desc:s,channel:u,searchType:c.searchType,src_url:h,keyword:c.keyword,sysInfo:t.getSystem(),bowserInfo:t.getBrowser(),resolution:window.screen.width+"*"+window.screen.height,cur_im_client_url:location.href}},escapeXSS:function(t){return e.xss(t)},replaceEmotions:function(e){return e.replace(/\[emoji([^\].]+)\]/g,'<span class="udesk_im_client_emoji udesk_im_client_emoji$1"></span>')},IsImgOrVideo:function(e,t){var n="image"===t?["jpeg","gif","jpg","png","bmp","pic","svg"]:["avi","flv","mpg","mpeg","mpe","m1v","m2v","mpv2","mp2v","dat","ts","tp","tpr","pva","pss","mp4","m4v","m4p","m4b","3gp","3gpp","3g2","3gp2","ogg","mov","qt","amr","rm","ram","rmvb","rpm"];if(e=e.split("?")[0],e.indexOf(".")>-1){var i=e.lastIndexOf("."),r=e.substring(i+1,e.length);if(r=r.toLowerCase(),n.indexOf(r)>-1)return!0}return!1},replaceLinks:function(e){return e.replace(/((http|https):\/\/([\w-]+\.)+[\w-:]+(\/[\w-.\/\?\;%&+=#\ï¼\:\d]*)?)/g,'<a href="$1" target="_blank">$1</a>')},isEmail:function(e){var t=/^([\.a-zA-Z0-9_-])+@([a-zA-Z0-9_-])+(\.[a-zA-Z0-9_-])+/;return t.test(e)},isPhone:function(e){var t=/^1[345789]\d{9}$/;return t.test(e)},isLink:function(e){var t=/((http|https):\/\/([\w-]+\.)+[\w-]+(\/[\w-.\/\?\;%&=]*)?)/g;return t.test(e)},compareStr:function(e,t,n){var i=(""+e).split("."),r=(""+t).split("."),o=Math.max(i.length,r.length),a=[],s=[],c=function(e){for(var t=e.length;t<o;t++)e.push("0");return e},l=function(e){for(var t=e,n=e.length;n<=3;n++)t="0"+t;return t};i=c(i),r=c(r);for(var u=0,d=i.length;u<d;u++)a.push(l(i[u]));for(var p=0,h=r.length;p<h;p++)s.push(l(r[p]));var f=a.join("."),g=s.join(".");switch(n){case">":return f>g;case"<":return f<g;default:return f>=g}},hasFlash:function h(){var h=!1;try{if(document.all){var e=new ActiveXObject("ShockwaveFlash.ShockwaveFlash");e&&(h=!0)}}catch(t){}return h},flashChecker:function(){var e=0,t=0;if(document.all)try{var n=new ActiveXObject("ShockwaveFlash.ShockwaveFlash");if(n){e=1;var i=n.GetVariable("$version");t=parseInt(i.split(" ")[1].split(",")[0])}}catch(r){}return{f:e,v:t}},getReferrer:function(){var e;try{e=window.top.document.referrer}catch(t){if(window.parent)try{e=window.parent.document.referrer}catch(n){e=""}}if(e||(e=document.referrer),!e)try{window.opener&&(e=window.opener.location.href)}catch(i){e=""}return e},getKeyword:function(t,n){if(!t)return"";n=n||"";var i,r=e.urlParams(t,{isUrlStr:!0}),o=e.urlParams(n,{isUrlStr:!0}),a={baidu:{key:"wd|word"},bing:{key:"q|pq"},sogou:{key:"keyword|query"},yahoo:{key:"p"}},s=n.split("/")[2]||"",c=s.split("."),l=c[c.length-2],u=a[l];if(r.udesk_wd)return r.udesk_wd;if(u){i=u.key.split("|");for(var d=0,p=i.length;d<p;d++)if(o[i[d]])return o[i[d]]}else if(o.q)return o.q;return""},getSearchInfo:function(e,t){try{t=decodeURIComponent(t||"")}catch(n){}var i={baidu:"ç¾åº¦",google:"è°·æ­",haosou:"å¥½æ",so:"å¥½æ",bing:"å¿åº",youdao:"æé",taobao:"æ·å®",sogou:"æç",sm:"ç¥é©¬",yahoo:"éè",toutiao:"ä»æ¥å¤´æ¡"},r=t.split("/")[2]||"",o=r.split("."),a=o[o.length-2];return{searchType:i[a]||r.replace("www.","")||"ç´æ¥è®¿é®",keyword:this.getKeyword(e,t)}},_mime:function(e,t){try{var n=navigator.mimeTypes;for(var i in n)if(n[i][e]==t)return!0;return!1}catch(r){return!1}},getBrowser:function(){var t,n="",i=navigator.userAgent;if(/[Ff]irefox(\/\d+\.\d+)/.test(i))tempArray=/([Ff]irefox)\/(\d+\.\d+)/.exec(i),n+=tempArray[1]+tempArray[2];else if(/MSIE \d+\.\d+/.test(i))tempArray=/MS(IE) (\d+\.\d+)/.exec(i),n+=tempArray[1]+tempArray[2];else if(/[Vv]ersion\/\d+\.\d+\.\d+(\.\d)* *[Ss]afari/.test(i))tempArray=/[Vv]ersion\/(\d+\.\d+\.\d+)(\.\d)* *([Ss]afari)/.exec(i),n+=tempArray[3]+tempArray[1];else if(/[Oo]pera.+[Vv]ersion\/\d+\.\d+/.test(i))tempArray=/([Oo]pera).+[Vv]ersion\/(\d+)\.\d+/.exec(i),n+=tempArray[1]+tempArray[2];else if(/edge/i.test(i))n+="Edge";else if(/[Cc]hrome\/\d+/.test(i)){if(window.chrome){var r=this._mime("type","application/vnd.chromium.remoting-viewer");r?n="360":(tempArray=/([Cc]hrome)\/(\d+)/.exec(i),n+=tempArray[1]+tempArray[2])}t=!0}else t=!0;return t&&e.platform({weixin:function(){n="å¾®ä¿¡"},qq:function(){n="QQ"},weibo:function(){n="å¾®å"}}),n},getSystem:function(){var t,n=navigator.platform,i=navigator.userAgent,r="";return n.indexOf("Win")>-1?r+=i.indexOf("Windows NT 5.0")>-1?"Win2000":i.indexOf("Windows NT 5.1")>-1?"WinXP":i.indexOf("Windows NT 5.2")>-1?"Win2003":i.indexOf("Windows NT 6.0")>-1?"WindowsVista":i.indexOf("Windows NT 6.1")>-1||i.indexOf("Windows 7")>-1?"Win7":i.indexOf("Windows NT 6.2")>-1||i.indexOf("Windows 8")>-1?"Win8":i.indexOf("Windows NT 6.3")>-1||i.indexOf("Windows 8.1")>-1?"Win8.1":i.indexOf("Windows NT 10")>-1||i.indexOf("Windows 10")>-1?"Win10":"Win"+((/Windows (\d+\.\d+)/.exec(i)||[])[1]||"dows"):n.indexOf("Mac")>-1?r+="Mac":n.indexOf("X11")>-1?r+="Unix":n.indexOf("Linux")>-1?(r+="Linux",t=!0):t=!0,t&&e.platform({android:function(){r="Android"},ios:function(e){r="IOS("+e+")"},wp:function(e){r="Windows phone"}}),r||(r+="Other"),r},setFavicon:function(t){$.get("/favicon",function(n){if(e.isIE11()&&n){var i=document.createElement("link");i.rel="shortcut icon",i.type="image/x-icon",i.href=n,$("head").append($(i))}else n&&$("head").append('<link rel="shortcut icon bookmark" href="'+n+'" type="image/x-icon">');t&&t(n)})},getFrameConfig:function(n){n=n||{};var i=this,r=i.preloadData||{},o=i.urlParamObj||e.urlParams(t.location.href)||{},a=function(t){t=t||{};var a=$.extend({theme_color:"#307AE8"},t.data),s=a.theme_color;a.customerTextColor=i.darkOrLight(a.customer_bg_color||s),a.customerBgColor=a.customer_bg_color||s,a.web_plugin_id=a.web_plugin_id||r.web_plugin_id,a.im_client_valid_enable=t.im_client_valid_enable||!1,e.isMob()&&(a.h5Mode_enabled=o.udesk_h5mode||(a.h5_intergration||{}).enabled,a.h5Mode=!0,a.h5Mode_enabled&&i.bodyEl&&i.bodyEl.addClass("newh5"),a.h5Mode_enabled&&(i.isHeadless=!0)),a.logo_url=a.logo_url||"images/default_head.png",a.frame_title=e.xss(a.frame_title);for(var c in n)if(c.indexOf("Selector")>0){var l;"themeColorSelector"===c?l="color":"themeBGSelector"===c?l="background":"themeBDSelector"===c&&(l="border"),$(n[c]).css(l,a.theme_color)}i.frameConfig=a,i.renderPage(a,$.extend({},n,{renderLang:function(){n.renderLang&&n.renderLang(),n.cb&&n.cb(a)}}))};if(!n.isTicket&&r.window)return a({data:r.window,im_client_valid_enable:r.im_client_valid_enable||!1});var s={code:1e3,data:{buttons_enable:{emoji_enabled:!1,upload_enabled:!1,screenshot_enabled:!1,download_logs_enabled:!1,agent_cellphone_enabled:!1,agent_cellphone:"",vcall:!1,remote:null,vc_app_id:null},frame_close:"",frame_name:"",frame_title:"",pc_no_max_window:{},h5_intergration:{}},im_client_valid_enable:!1};n.isTicket?a(s):$.get(i.apiPath+"im/im_customize/window",{im_web_plugin_id:o.web_plugin_id,language:o.language}).always(a)},setBodyClassnames:function(e){console.log(e);var t=e.avatar_agent_robot_enabled,n=e.avatar_customer_enabled;t&&this.bodyEl.addClass("has-agent-avatar"),n&&this.bodyEl.addClass("has-customer-avatar"),(t||n)&&this.bodyEl.addClass("has-avatar")},getLangCfg:function(t,n){var i=$("#localesId"),r=i.data("src"),o=r;t=t||"zh-cn",e.setContext({lang:t}),r&&("zh-cn"===t?$.getJSON(r,function(e){p.UDL.setData(e),n&&n()}):($.getJSON(r,function(e){p.UDL.setDefaultData(e)}),o=r.replace(/\/[^\/]+\.json/,"/"+t+".json"),$.getJSON(o).always(function(e){p.UDL.setData(e),n&&n()})))},renderPage:function(n,i){i=i||{};var r=this,o=this.urlParamObj||null;o||(o=e.urlParams(t.location.href)||{});var a=i.language||o.language||n.lang;this.getLangCfg(a,function(){var e=r.UDL;i.feedback||i.isTicket||(n.frame_name=e.g("agent.onlineAg"),document.title=n.frame_title||n.frame_name,$("#copy-right a").text(e.g("label.copyRight")),$(".black-list-tip").text(e.g("agent.blackList"))),i.renderLang&&i.renderLang()})},getRoot:function(){var e=window.parent;try{return e.udesk&&e.udesk.ui?e:window}catch(t){return window}},genPageUrl:function(e,t){var n,i=this.customer,r=this.frameConfig||{};return t=t||{},n=t.params||{},r.h5Mode&&(n.udesk_h5_mode=1),i&&(n.udesk_access_token=i.access_token,n.udesk_customer_id=i.user_id),(e||"")+location.search+(location.search?"&":"?")+this.jsonParam(n)},goTicket:function(){l.getAgentTimer&&clearTimeout(l.getAgentTimer);var e,t=this,n=this.getRoot();cfg={btnBack:!0,onClick:function(t,n){"back"===t&&e.removeClass("open")}},$.get("/spa1/im/web_ticket_plugin",{im_web_plugin_id:t.urlParamObj.web_plugin_id}).then(function(i){e=n.udesk.ui.board({id:"ticketPlugin",type:"iframe",title:p.frameConfig.ticket_plugin.name,noAnimate:cfg.noAnimate,header:{btnBack:cfg.btnBack,onClick:cfg.onClick},body:t.genPageUrl("ticketPlugin.html",{params:{appid:i.appid,signature:i.sign,type:i.type,content:i.content}}),onReady:function(e,n){t.setHeaderTitleBoxWith(e,n)}}),l.menu_id="",p.stopQueuing=!0})},closeMerchant:function(){merchantEl&&merchantEl.removeClass("open")},goMerchant:function(){var e=this,t=this.getRoot();document.title="åè¡¨é¡µ",merchantEl=t.udesk.ui.board({id:"Merchant",type:"iframe",title:"åè¡¨é¡µ",header:p.innerController.isInnerMode?{buttons:[{act:"minimize",iconName:"line",title:p.UDL.g("minimize"),"data-toggle":"tooltip","data-placement":"bottom"}],onClick:function(e){"minimize"===e&&p.innerController.postMsg({type:"hidePanel"})}}:null,noAnimate:!0,body:e.genPageUrl("merchant.html",{}),onReady:function(t,n){e.setHeaderTitleBoxWith(t,n)}}),l.menu_id="",p.stopQueuing=!0},goFeedback:function(t){var n=this,i=l.imFeedback,r=l.chatAgent;if("chatFeedback"!==l.stage){if(i)return e.setContext({stage:"chatFeedback"}),r.initChatFeedback(),void(t.cb&&t.cb());l.getAgentTimer&&clearTimeout(l.getAgentTimer);var o,a=this,s=this.getRoot(),c=t.hideBoardAll;t=$.extend({btnBack:!0,onClick:function(e,n){if("back"===e){var i=o.parent(),r=i.find("#pre-form"),s=i.find("#choiceAgent");if(t.onBack&&t.onBack()===!1)return;a.urlParamObj.backbutton?location.href=a.urlParamObj.backbutton:(i.children().removeClass("open"),c||(r.size()?r.addClass("open"):s.size()&&s.addClass("open")))}}},t),o=s.udesk.ui.board({id:"feedbackPage",type:"iframe",title:"",noAnimate:t.noAnimate,header:{btnBack:t.btnBack,onClick:t.onClick},body:this.genPageUrl("feedback.html",{params:{deep:"deep"}}),onReady:function(e,t){a.setHeaderTitleBoxWith(e,t),n.frameConfig.font_family&&e.find("iframe").get(0).contentWindow.addEventListener("load",function(e){e.target.body.style.fontFamily=n.frameConfig.font_family+', Arial, "Helvetica Neue", Helvetica, "Hiragino Sans GB", "Microsoft YaHei", sans-serif'})}}),l.menu_id="",p.stopQueuing=!0,t.cb&&t.cb()}},goChatLog:function(e){var t=this,n=this.getRoot();this.clearOfflineCount();var i=this,r=i.customer;if(!r)try{r=window.parent.udesk.common.customer||{}}catch(o){r={}}var a=n.udesk.ui.board({id:"chatLogPage",type:"iframe",title:p.UDL.gl("msgLog"),header:{btnBack:!0,onClick:function(e,t){"back"===e&&a.removeClass("open")}},body:this.genPageUrl("chat_log.html",{params:{im_session_id:r.last_im_session_id||0,session_key:i.urlParamObj.session_key||""}}),onReady:function(e,n){i.setHeaderTitleBoxWith(e,n),t.frameConfig.font_family&&e.find("iframe").get(0).contentWindow.addEventListener("load",function(e){e.target.body.style.fontFamily=t.frameConfig.font_family+', Arial, "Helvetica Neue", Helvetica, "Hiragino Sans GB", "Microsoft YaHei", sans-serif'})}})},_store:function(e,n,i){e="UDESK_"+e;try{if(i=i||t.localStorage,!i)return;if(void 0===n)return i.getItem(e)||"";i.setItem(e,n||"")}catch(r){}},store:function(e,t){return this._store(e,t)},supportStore:function(e){var t;try{t=window[e];var n="__storage_test__";return t.setItem(n,n),t.removeItem(n),!0}catch(i){return i instanceof DOMException&&(22===i.code||1014===i.code||"QuotaExceededError"===i.name||"NS_ERROR_DOM_QUOTA_REACHED"===i.name)&&t&&0!==t.length}},sessionStore:function(e,n){if(this.supportStore("sessionStorage"))return this._store(e,n,t.sessionStorage)},clearMsgs:function(){p.messagesEl.empty()},showTip:function(t,n,i){i=i||{},t=t||this.UDL.g("tip.optSuccess"),n=n||"success",n="error"===n?"danger":n,n="warn"===n?"warning":n,e.ui.tip(t,$.extend({type:n,css:{marginTop:this.isHeadless?0:62}},i))},winAlert:function(e){setTimeout(function(){window.alert(e)},300)},goBottom:function(){setTimeout(function(){try{p.contentEl.removeClass("scrollbar").addClass("scrollbar"),p.contentEl.scrollTop(p.messagesEl.height()+999)}catch(e){}},100)},loadJS:function(e,t,n){if(e){if(!n){if($.inArray(e,this.loadFiles)>-1)return t&&t();this.loadFiles.push(e)}$.getScript(e,t)}},formatDateTime:function(e,t){function n(e){return e<10?"0"+e:e}if(e){var i;try{i=new Date(e)}catch(r){p.log.info(r)}var o=""+n(i.getHours())+":"+n(i.getMinutes())+":"+n(i.getSeconds());return((new Date).toDateString()!==i.toDateString()||t)&&(o=""+i.getFullYear()+"/"+(i.getMonth()+1)+"/"+i.getDate()+" "+o),o}},moveCursor:function(e,t){if(e.focus(),t=$.isNumeric(t)?t:e.value.length,document.selection){var n=e.createTextRange();n.moveStart("character",t),n.collapse(),n.select()}else $.isNumeric(e.selectionStart)&&$.isNumeric(e.selectionEnd)&&(e.selectionStart=e.selectionEnd=t)},formatRichMsg:function(e){if(!e)return""},getIosVersion:function(){var e=navigator.userAgent.toLowerCase(),t=e.match(/cpu iphone os (.*?) like mac os/);return t?t[1].replace(/_/g,"."):""},abjuctCenterBox:function(n,i){if(!e.isMob()&&(n=n||p.frameConfig.pc_no_max_window||{},n.enabled)){var r=t.document,o=this.bodyEl,a=o.find("#main"),s=l.els.sideBox,c=(r.documentElement||o[0]).clientWidth,d=(r.documentElement||o[0]).clientHeight,h=function(){var e={},t=u.initMainWidth,n=s.width();i&&(t+=n,a.width(t),e.maxWidth="100%"),a.css($.extend(e,{"margin-top":-(a.height()/2)+"px","margin-left":-(t/2)+"px",overflow:"hidden"})),i&&(n=s.width(),p.contentEl.css("right",n+2),p.footerEl.css("right",n+2),p.bottomPanelEl.css("right",n+2))};p.hasWinParent()||(c>=n.maxWidth||d>=n.maxHeight)&&(p.isWindowCenter=!0,o.addClass(" center-box"),n.background_url&&o.css("background-image","url("+n.background_url+")"),u.isAbjuctCenterBox||(u.initMainWidth=a.width(),u.isAbjuctCenterBox=!0),setTimeout(function(){h(),$(t).resize(h)},5))}},applyH5Mode:function(){var e=this.frameConfig,t=this.footerEl.find(".toolbar");t.find("a").each(function(){var e=this,t=e.className||"",n="icon-",i="icon-h5-";"btnSurvey"===e.id?e.className=t.replace(/icon-good[1]?/,"icon-good1"):"btnScreenShot"===e.id&&(e.className=t.replace(i,n).replace(n,i))}),this.bodyEl.addClass("h5mode"),this.urlParamObj.sdk_token||e.h5Mode_enabled||this.bodyEl.addClass("has-header"),e.h5Mode_enabled&&this.bodyEl.addClass("has-agent-avatar has-avatar"),this.h5TransferEl.css("color",e.theme_color)},autoSize:function(t){t=t||{};var n=this,i=(n.innerController.isInnerMode,n.frameConfig.h5Mode,$("#copy-right")),r=i.is(":visible")?i.height():0,o=Math.max(n.footerEl.outerHeight(),n.footerEl.find(".textbox").outerHeight())+r,a=r;n.footerEl.is(".singleline")&&(r+=12,o+=12,a+=12),$(".customButton").length?o+=47:e.isMob()&&(o+=12),t.offsetY&&(r+=t.offsetY,o+=t.offsetY),n.contentEl.css("bottom",o+"px");var s=42;try{"custom_robot"===e.common.company.robot.channel&&(s=22)}catch(c){console.log("è¾å¥èæ³ä½ç½®è®¾ç½®æ¶è·åæºå¨äººéç½®éè¯¯")}n.footerEl.find("#guideList").css("bottom",(e.isMob()||p.innerController.isInnerMode?n.footerEl.outerHeight():n.footerEl.outerHeight()-s)+"px"),n.bottomPanelEl.css("bottom",r+"px"),n.footerEl.css("bottom",r+"px"),e.isPC()&&n.sideBoxEl.css("bottom",r+"px"),t.cb&&t.cb()},editorAutoShow:function(){if(this.frameConfig.h5Mode){var t=l.isRobotChat;if(t){if($(".ui-editor .toolbar #btnSurvey").size){var n=$("#btnSurvey");$("#btnSurvey").remove(),$(".ui-editor .textbox").before(n)}}else if($(".ui-editor>#btnSurvey").size()){var i=$("#btnSurvey");$("#btnSurvey").remove(),$(".ui-editor .toolbar").append(i)}var r=this,o=p.footerEl,a=o.find(".more-box");a.width(0).hide().empty();var s,c=o.find(".toolbar"),u=o.find(".textbox"),d=$('<a href="javascript:;" class="icon icon-ic-add-circle-jia more-btn" style="width:initial;position:relative"></a>'),h=o.find(".btn-voice"),f=o.find(".voicebox"),g=o.outerWidth()-28,m=o.find(".more-btn");m.size()&&m.remove();var v=c.find("a").filter(function(){var e=$(this);return e.width("initial"),e.attr("clickshow")||"none"!==e.css("display")});$.each(v,function(e,t){var n=$(t);n.css({width:"initial",position:"initial",top:"auto",right:"auto"}),n.removeAttr("clickShow")});var y=v.length;if(y){var b=5;e.isIos()?b=6:e.isAndroid()&&(b=7),!t&&y<=2?$.each(v,function(e,t){if(e>0){var n=$(t);n.css({width:"initial",position:"relative",top:"auto",right:"auto",display:"inline-block"}),n.removeAttr("clickShow"),a.hide()}}):t&&y||y>2&&y<b?(v.eq(0).after(d),$.each(v,function(e,n){if(t||!t&&e>0){var i=$(n);i.css({width:"62px",position:"absolute",top:"-68px",right:10+62*(e-1+(t?1:0))+"px",display:"none"}),i.attr({clickShow:!0});var r=i.data("tip")||"",o=$('<div class="btn-tip">'+r+"</div>");o.css({right:62*(e-1+(t?1:0))+"px"}),a.append(o);var s=a.width()||0;a.width(s+62)}}),d.off("click").on("click",function(e){"block"!==a.css("display")?($.each(v,function(e,t){$(t).attr("clickshow")&&$(t).show()}),a.show()):r.hideMoreBox(),e.preventDefault(),e.stopPropagation()})):($.each(v,function(e,t){var n=$(t);n.css({width:"auto",position:"relative",top:"auto",right:"auto",display:"block"}),n.removeAttr("clickShow"),a.hide()}),v.css("width",g/y-1+"px"),s=!0)}h.off("click").on("click",function(e){h.hasClass("icon-keyboard")?(h.removeClass("icon-keyboard").addClass("icon-ic-mic-maikefeng"),a.hide(),f.hide(),c.show(),u.show()):(h.addClass("icon-keyboard").removeClass("icon-ic-mic-maikefeng"),a.hide(),c.hide(),u.hide(),f.show()),e.preventDefault()}),s&&o.addClass("bottom-line"),this.autoSize(),this.setBtnSendActive()}},hideMoreBox:function(){var e=this.frameConfig||{},t=p.footerEl,n=t.find(".toolbar"),i=t.find(".more-box");if(e.h5Mode){var r=n.find("a").filter(function(){var e=$(this);return"none"!==e.css("display")});$.each(r,function(e,t){$(t).attr("clickshow")&&$(t).hide()}),i.hide()}},getBtnMsgLogsHtml:function(e){var t=this,n="btn-msg-logs",i="click."+n,r=p.frameConfig.ticket_plugin,o=[];o=r&&r.enable?['<div class="history-and-ticket">','   <div class="'+n+' history-and-ticket-item flex1-end">'+p.UDL.gl("viewMsgLog")+"</div>",'   <div class="history-and-ticket-line"></div>','   <div class="btn-ticket history-and-ticket-item">'+r.name+"</div>","</div>"]:['<div class="text-center">','   <a class="'+n+' text-muted">'+p.UDL.gl("viewMsgLog")+"</a>","</div>"];var o=o.join("");return p.bodyEl.off(i).on(i,"."+n,function(){t.goChatLog(e)}),p.bodyEl.off("click.btn-ticket").on("click.btn-ticket",".btn-ticket",function(){t.goTicket()}),o},getOfflineUnreadMsgHtml:function(t){var n=e.context||{},i=n.offline||{},r=i.count,o=this;if(!r)return"";var a="robot"===t,s="agent"===t,c=a||s?"load-history":"btn-msg-logs",l=['<div class="unread-box">','   <a class="'+c+' red">'+r+p.UDL.g("tip.hasUnreadMsgs")+"</a>","<span>|</span>",'   <a class="icon icon-guanbi close-unread"></a>',"</div>"].join("");return p.bodyEl.off("click.btn-msg-logs").on("click",".btn-msg-logs",function(){o.goChatLog(t)}).off("click.load-history").on("click",".load-history",function(){if(r){var e=document.getElementById("event-bar-line");return $("#content").animate({scrollTop:e?e.offsetTop:""},500),o.clearOfflineCount(),!1}o.getCustomerLogs({isRobot:n.isRobotChat,isAgent:!n.isRobotChat,isHistory:!0,cb:function(e){var t=n.chatRobot||{},i=n.chatAgent||{},r=n.isRobotChat;try{r&&t.showHistoryMsg(e||[]),!r&&i.showHistoryMsg(e||[])}catch(o){}}})}).off("click.close-unread").on("click",".close-unread",function(){o.clearOfflineCount(),$(".unread-box").remove()}),l},formatImgContent:function(e){return e=(e||"").replace(/<img [^>]*\/>/g,function(e){var t=$(e).attr("src");return'<a href="'+t+'" target="_blank">'+e+"</a>"})},formatAttachment:function(e){var t=[];if(!e.address||!e.name||!e.size)return"";var n=WebUploader.Base.formatSize(e.size),i=p.getFileImgByFileUrl(e.address,"02");return t=['<div class="attachment-item">',i+" ",'<span class="attachment-name">'+e.name+"</span>",'<span class="attachment-size">('+n+")</span>",'<a href="'+e.address+'" class="attachment-download" target="_blank" download="'+e.name+'" >'+p.UDL.g("label.download")+"</a>","</div>"].join("")},jsonParam:function(e){var t=[];if("object"==typeof e){for(var n in e){var i=encodeURIComponent(n),r=encodeURIComponent(e[n]);t.push(i+"="+r)}return t.join("&")}return e},findValueInArr:function(e,t){t=t||[];for(var n=0,i=t.length;n<i;n++)if(t[n]===e)return!0;
return!1},needXss:function(t,n,i){var r=["text","number","numeric","link","area_text","location"];return t?(i=i||r,this.findValueInArr(t,i)?e.xss(n):n):e.xss(n)},setBtnSendActive:function(t){var n={},i=this.frameConfig||{},r=i.theme_color,o=$.trim(this.txtMsgEl.val()),a=this.btnSendEl,s=this.footerEl.find(".toolbar"),c=this.footerEl.find(".textbox"),l=s.find("a").filter(function(){var e=$(this);return e.attr("clickshow")||"none"!==e.css("display")}),u=s.find(".more-btn").size()>0,d=$("body").hasClass("robot");if(l.each(function(e,t){$(t).css("margin-right",0)}),i.h5Mode)if(t=!0,o){a.show();var h,f=0;u?(l.eq(0).css({marginRight:d?0:18}),h=f-30):1==l.size()?(h=f+12,l.eq(0).css({marginRight:18})):2==l.size()?(l.eq(0).css({marginRight:18}),h=f-30):l.size()>=5&&(l.eq(0).css({marginRight:0}),h=f-30),l.size()&&h&&s.css({left:"auto",right:h+"px"}),d?(c.css({marginRight:0}),c.find("textarea").css("padding-right","30px")):(c.css({marginRight:f+(l.size()?this.toolbarIconMarginRight(36):2),marginLeft:p.footerEl.find(".btn-voice").size()?"30px":0}),c.find("textarea").css("padding-right","30px"))}else d?(s.css({right:"12px",left:"auto"}),c.css({marginLeft:$(".ui-editor #btnSurvey").size()&&$(".ui-editor .btn-voice").size()?"68px":$(".ui-editor #btnSurvey").size()||$(".ui-editor .btn-voice").size()?"38px":0,marginRight:l.size()>1?this.toolbarIconMarginRight(38):"0"})):(s.css({right:"12px",left:"auto"}),c.css({marginRight:1==l.size()?this.toolbarIconMarginRight(38):this.toolbarIconMarginRight(76),marginLeft:p.footerEl.find(".btn-voice").size()?"30px":0}),c.find("textarea").css("padding-right",0)),a.hide(),u||l.size()>=2&&l.size()<5?l.eq(0).css({marginRight:d?0:18}):l.eq(0).css({marginRight:0});else t="undefined"==typeof t||t,t=t&&!!o,n.color=t?e.context.isLowIE?"#242e33":"#FFF":"rgba(0, 0, 0, 0.25)";e.isMob()?n.color=r:(n.backgroundColor=t?r:"#F5F5F5",n.borderColor=t?r:"rgba(0, 0, 0, 0.15)",n.cursor=t?"pointer":"default"),a.css(n)},toolbarIconMarginRight:function(t){try{if(!e.isWeixin())return t;var n=$(".toolbar.clearfix"),i=window.getComputedStyle(n[0],null).getPropertyValue("font-size");return i<="14px"?t:t+24}catch(r){return console.log(r),t}},orderedCuttingGroupTime:function(e){e=e||{};var t="orderedCuttingGroupTime",n="senderName",i=t+".isRecv",r=new Date(e.time).getTime();return u[t]?e.isRecv===u[i]&&e.senderName===u[n]&&r-u[t]<=3e4?r=u[t]:(u[t]=r,u[i]=e.isRecv,u[n]=e.senderName):(u[t]=r,u[i]=e.isRecv),(e.isRecv?"RECV":"")+r},parseMsgGroupTime:function(e){var t=e.data("group-time"),n=p.messagesEl.find('[data-group-time="'+t+'"]'),i=[],r=n.size(),o="time-item",a="time-first-item",s="time-last-item",c=[o,a,s];r>1&&(n.each(function(e){var t=$(this),n=[o],c=!t.is(".no-group"),l=t.data("msgid")||"";c&&l&&0!==l.indexOf("SYS-")?(e?e===r-1?n.push(s):t.removeClass(a+" "+s):n.push(a),t.addClass(n.join(" "))):i.push(t)}),$.each(i,function(){var e=$(this),t=e.prev(),n=e.next();t.is("."+o)&&(t.is("."+a)?t.removeClass(c.join(" ")):t.addClass(s)),n.is("."+o)&&(n.is("."+s)?n.removeClass(c.join(" ")):n.addClass(a))}))},setReaded:function(){var e=this.messagesEl.find(".first-unread-msg");if(e.size()){var t=this.contentEl.scrollTop(),n=e.position().top;this.setFloatMsgBase(),this.animateScroll(n-t+22)}},setFloatMsgBase:function(){var e=this.footerEl.find(".float-box"),t=this.messagesEl.find(".first-unread-msg");e.hide().remove(),u.unreadCount=0,u.unreadMsgsHeight=0,t.size()&&t.removeClass("first-unread-msg")},bindContentScroll:function(){var e=this;this.contentEl.off("scroll").on("scroll",function(){var t=e.footerEl.find(".float-box");if(t.size()){var n=e.contentEl.scrollTop(),i=e.messagesEl.outerHeight()+12,r=e.contentEl.outerHeight()-24;i-r-n<u.unreadMsgsHeight&&(e.setFloatMsgBase(),e.sendMsgOfRead())}})},showUnreadMsg:function(e,t,n){var i=this.footerEl.find(".float-box"),r=this;if(!t&&n){if(u.unreadCount++,i.size())i.find("span").html(u.unreadCount+this.UDL.g("tip.unreadMsgs"));else{var o='<div class="float-box"><div class="float-msg"><i class="icon icon-xiajiantou"></i> <span> '+u.unreadCount+"æ¡æ°æ¶æ¯</span></div></div>";this.footerEl.append(o),e.addClass("first-unread-msg")}this.footerEl.off("click",".float-msg").on("click",".float-msg",function(){r.setReaded()})}},judgeScrollDistance:function(t,n){if(n=n||{},e.ifIE(8))return this.goBottom();var i=this,r=t.find(".msg img");if(r.size()){var o=r.size();$.each(r,function(e,r){r.complete?(o--,o<=0&&i.judgeMsgElNeedAction(t,n)):($(r).load(function(){o--,o<=0&&i.judgeMsgElNeedAction(t,n)}),$(r).error(function(){o--,o<=0&&i.judgeMsgElNeedAction(t,n)}))})}else i.judgeMsgElNeedAction(t,n)},judgeMsgElNeedAction:function(e,t){var n=this.messagesEl.children(),i=n.eq(-2).outerHeight()+parseInt(n.eq(-2).css("marginTop")),r=n.eq(-3).outerHeight()+parseInt(n.eq(-3).css("marginTop")),o=n.eq(-4).outerHeight()+parseInt(n.eq(-4).css("marginTop")),a=i+r+o+24,s=this.contentEl.scrollTop(),c=this.contentEl.outerHeight()-24,l=this.messagesEl.outerHeight()+12,u=parseInt(e.css("marginTop"))||0,d=e.outerHeight()+u+(t.isRobot?-20:0),p=!1,h=!1;if(t.isRobot)p=t.isRecv||!1;else{var f=e.data("group-time")||"";p=(f+"").indexOf("RECV")>-1,h=e.hasClass("item-loading")}var g;if(t.isRobot){var m=e.prev();g=m.find("> .msg-recv").size()>=1}else{var m=e.prev(),v=m?m.data("group-time"):"";g=(v+"").indexOf("RECV")>-1}var y={msgsElHeight:l,currentScrollHeight:s,contentElHeight:c,resaultHeight:d,lastHeight:a,msgIsRecv:p,previsRecv:g,isMsgLoading:h,isRobot:t.isRobot,msgEl:e};this.doScrollOrSetUnread(y)},doScrollOrSetUnread:function(e){e=e||{};var t=e.msgsElHeight,n=e.currentScrollHeight,i=e.contentElHeight,r=e.resaultHeight,o=e.lastHeight,a=e.msgIsRecv,s=e.isMsgLoading,c=e.isRobot,l=e.msgEl,d=e.previsRecv;if(a){var p=l.data("msgid");u.unreadMsgs&&u.unreadMsgs.length?p&&u.unreadMsgs.push(p):p&&(u.unreadMsgs=[p])}var h=t-n-i-r;return o<=h&&(a||s)&&!c?(s||(u.unreadMsgsHeight+=r),void this.showUnreadMsg(l,s,a)):void this.scrollDistance({previsRecv:d,resaultHeight:r,diffScroll:h,isRobot:c,msgIsRecv:a})},scrollDistance:function(e){var t=e.previsRecv,n=e.resaultHeight,i=e.isRobot,r=r,o=e.diffScroll,a=this.contentEl.outerHeight(),s=!r&&i;t?n>a-46?this.animateScroll(a+o-60):this.scrollBottom(s):n>a-66?this.animateScroll(a+o-80):this.scrollBottom(s)},sendMsgOfRead:function(){var e=p.messagesEl.outerHeight(),t=l.chatAgent;if(t){var n=t.getIMSubSessionId();if(u.unreadMsgs&&u.unreadMsgs.length>0&&e>0&&this.isVisibility&&n&&this.company.web_message_display_status){t.sendMsg("","",{needSave:!1,needReceived:!1,needCheckReceived:!1,attributes:{},children:[{name:"action",value:"",attributes:{xmlns:"udesk:action",type:"customer_read",source:u.unreadMsgs.join(",")}}]});var i=this.apiPath+"im/im_logs/customer_read_status";$.post(i,{message_ids:u.unreadMsgs,im_sub_session_id:n}).always(function(e){1e3==e.code}),u.unreadMsgs=[]}}},animateScroll:function(e){var t=this;u.scrollTimer&&clearTimeout(u.scrollTimer),u.scrollTimer=setTimeout(function(){try{p.contentEl.removeClass("scrollbar").addClass("scrollbar");var n=t.contentEl.scrollTop(),i=e,r=Math.floor(.4*i);r>600&&(r=600),p.contentEl.animate({scrollTop:n+e},r),t.sendMsgOfRead()}catch(o){}},50)},animateScrollBottom:function(){var e=(this.messagesEl.find(".msg img"),this);e.scrollBottom()},scrollBottom:function(e){var t=this;if(e){var n=t.messagesEl.outerHeight();p.contentEl.removeClass("scrollbar").addClass("scrollbar"),p.contentEl.scrollTop(n+9999)}else u.scrollBottomTimer&&clearTimeout(u.scrollBottomTimer),u.scrollBottomTimer=setTimeout(function(){try{var e=t.messagesEl.outerHeight();p.contentEl.removeClass("scrollbar").addClass("scrollbar"),p.contentEl.animate({scrollTop:e+9999}),t.sendMsgOfRead()}catch(n){}},50)},getFileImgByFileUrl:function(t,n,i){var r;return i=i||{},n=n||"01",r=/\.(pdf)/.test(t)?"pdf":/\.(doc|docx|odt)/.test(t)?"word":/\.(xls|xlsx|csv)/.test(t)?"excel":/\.(ppt|pptx)/.test(t)?"ppt":/\.(txt)/.test(t)?"txt":"unknow",e.createHtml("img",{src:"images/"+r+n+".png",css:i.css})},hasWinParent:function(){var e=window,t=e.parent;try{return!(e.top===e.self||!t.udesk||!t.udesk.ui)}catch(n){return!1}},getWeixinBrowser:function(){var t="";return e.platform({weixin:function(){var e=navigator.userAgent.toLocaleLowerCase().match(/micromessenger\/([\d\.]+)/i)||[];t=e[1]||""}}),t},initFooter:function(){var t=l.els,n=p.getIosVersion()||"0.0.0",i=/[Vv]ersion\/\d+\.\d+(\.\d+)* .*[Ss]afari/.test(navigator.userAgent),r=(/mqqbrowser|mqq/.test(navigator.userAgent.toLowerCase()),e.isIos()),o=!1;e.platform({weixin:function(){o=!0}});var a=p.compareStr(n,"11.0","<"),s=p.compareStr(n,"11.0",">=")&&p.compareStr(n,"11.4","<"),c=p.compareStr(n,"11.4",">=");p.setBtnSendActive();try{t.txtMsg.placeholder()}catch(u){}$(window).resize(function(){l.isMob&&p.goBottom()});var d,h=document.documentElement.clientHeight||document.body.clientHeight;t.footer.off("click","textarea").on("click","textarea",function(){var t=this;r&&(s||a||c&&setTimeout(function(){i?h<580?document.body.scrollTop=291:h>=580&&h<630&&(document.body.scrollTop=300):t.scrollIntoView()},300),e.isMob()&&p.goBottom())}).off("blur","textarea").on("blur","textarea",function(){d&&clearInterval(d);try{var e,t=1;setTimeout(function(){e=document.documentElement.scrollTop||document.body.scrollTop,e-=t,window.scrollTo(0,e),e+=t,window.scrollTo(0,e);var n=p.innerController.isInnerMode;n&&p.innerController.postMsg({type:"innerInputBlur"})},100)}catch(n){}}).off("input propertychange","textarea").on("input propertychange","textarea",function(){p.setBtnSendActive()})},checkFileCanPreview:function(t){t=t||"";var n=/\.((doc)|(docx)|(odt)|(rtf)|(wps)|(ppt)|(pptx)|(odp)|(dp)|(xls)|(xlsx)|(ods)|(csv)|(et)|(pdf))($|\?)/g,r=/\.(pdf)($|\?)/g,o=/\?download/g,a=t.match(n),s=t.match(r),c="",l=location.hostname,u=l.indexOf("s2.udesk.cn")>-1?"s2.":"",d=l.indexOf("s3.udesk.cn")>-1?"s3.":"",p=d?"http://preview-proxy.":"https://preview-proxy.";if(!a)return"";if(s&&e.isMob()){var h=t.split("?"),f="file:"===location.protocol?"http:":location.protocol,c=f+"//static-ud.s2.udesk.cn/lib/pdf/pdf@2.4.456/web/viewer.html?file="+(t.includes("=")?escape(t):t);return c}try{if(o.test(t)){var h=t.split("?");c=p+(u||d)+"udesk.cn/preview/wopi/files/"+i(h[0],!0)+"/documents"}else c=p+(u||d)+"udesk.cn/preview/wopi/files/"+i(t,!0)+"/documents";return c}catch(g){return""}},renderCustomButtons:function(t,n,i){!p.frameConfig.ticket_plugin||!p.frameConfig.ticket_plugin.enable||t.length&&"tsSdk"===t[0].type||t.unshift({name:p.frameConfig.ticket_plugin.name,type:"tsSdk"});var r=$(".customButton"),o=$(".float-box");if(r.find("[data-type]").off("click"),r.remove(),0===t.length)return $(".messages").css("margin-bottom","12px"),o.css("top",""),this.autoSize(),void $("#footer").removeClass("has-custom-button");$("#footer").addClass("has-custom-button");for(var a=$('<div class="customButton"></div>'),s=$('<ul class="custom-button-list"></ul>'),c=0,u=t.length;c<u;c++){var h,f=t[c],g=$("#content").outerWidth();if("link"===f.type){var m=function(){var t=f.content,n=p.customer,i=p.urlParamObj,r=encodeURIComponent(null),o=[{key:"{{customer_email}}",vo_value:n.emails?n.emails:r},{key:"{{customer_phone}}",vo_value:n.cellphones?n.cellphones:r},{key:"{{web_token}}",vo_value:n.web_token?n.web_token:r},{key:"{{customer_token}}",vo_value:n.customer_token?n.customer_token:r},{key:"{{web_plugin_id}}",vo_value:i.web_plugin_id?i.web_plugin_id:r}];if(e.context.chatAgent){var a=e.context.chatAgent.getIMAgentInfo();a&&(o=[].concat(o,[{key:"{{assignee_email}}",vo_value:a.email},{key:"{{sub_session_id}}",vo_value:a.im_sub_session_id}]))}return o.forEach(function(e,n){var i=new RegExp(e.key);i.test(f.content)&&(t=t.replace(i,e.vo_value))}),t}();h=$("<li style='transform:translateX("+g+"px)'><a href='"+m+"' target=_blank >"+f.name+"</a></li>")}else if("mini"===f.type){if(!e.isMiniProgram())continue;h=$("<li style='transform:translateX("+g+"px)'><a data-miniprogram-path=\""+f.content+'">'+f.name+"</a></li>"),h.on("click",d)}else if("tsSdk"===f.type)h=$("<li data-type="+f.type+" style='transform:translateX("+g+"px)' >"+f.name+"</li>"),h.on("click",function(){p.hideMoreBox(),p.goTicket()});else if("im_survey"===f.type){var v=l.chatAgent;v&&0!==v.getIMSubSessionId()&&(h=$("<li class='im_survey' data-type="+f.type+" data-hitSource=2 style='transform:translateX("+g+"px)'>"+f.name+"</li>"),h.on("click",function(){p.hideMoreBox();var e=p.customer||{},t=v.getIMSubSessionId(),n=p.urlParamObj.agent_id,i="/spa1/im_sessions/has_survey";$.post(i,{agent_id:n,customer_id:e.user_id,customer_jid:e.username,im_sub_session_id:t,window_init_time:p.supportStore("sessionStorage")?sessionStorage.getItem("window_init_time"):void 0}).always(function(e){e=e||{},v.showModalOfSurveys({im_sub_session_id:t,agent_id:n,jid:"",hasSurvey:e.has_survey})})}))}else h=$("<li data-type="+f.type+" data-content="+encodeURI(f.content)+" data-hitSource=2 style='transform:translateX("+g+"px)'>"+f.name+"</li>"),h.on("click",function(){var e=decodeURI($(this).data("content"));n&&n(e,{hitSource:2})});if(f.classNames&&h.addClass(f.classNames.join(" ")),f.attrs)for(var y in f.attrs)h.attr(y,f.attrs[y]);f.highlight_tips&&h.addClass("tips"),s.append(h)}a.append($('<div class="s-arrow custom-btn-left"><i class="icon icon-arrow-left"></div>')),a.append(s),a.append($('<div class="s-arrow custom-btn-right"><i class="icon icon-arrow-right"></div>')),o.css("top","-75px"),$("#footer").append(a),$(".customButton li").each(function(e,t){i?$(t).css("transform","none"):setTimeout(function(){$(t).css("transition-duration",600-100*e+"ms"),$(t).css("transform","none")},100*e)});var b=function(){var e=$(".custom-button-list").scrollLeft(),t=$(".custom-button-list").outerWidth(),n=$(".custom-button-list")[0].scrollWidth;e>0?($(".customButton .custom-btn-left").show(),$(".customButton").css("padding-left","0")):($(".customButton .custom-btn-left").hide(),$(".customButton").css("padding-left","24px")),e+t>=n?($(".customButton .custom-btn-right").hide(),$(".customButton").css("padding-right","24px")):($(".customButton .custom-btn-right").show(),$(".customButton").css("padding-right","0"))};!e.isMob()&&$(".custom-button-list").off("scroll").on("scroll",function(){b()}),$(".customButton .s-arrow").off("click").on("click",function(){var e=$(this),t=e.is(".custom-btn-left"),n=e.is(".custom-btn-right"),i=$(".custom-button-list").outerWidth(),r=$(".custom-button-list").scrollLeft(),o=0;t&&(o=r-i),n&&(o=r+i),$(".custom-button-list").animate({scrollLeft:o},function(){b()})});var _=$(".custom-button-list").outerWidth(),x=0;$(".custom-button-list li").each(function(e,t){x=x+$(t).outerWidth()+8}),!e.isMob()&&_&&x>_&&$(".customButton .custom-btn-right").show(),this.autoSize()},initPlaceholder:function(e){"agent"==e?this.txtMsgEl.attr("placeholder",p.frameConfig.agent_input_guidance?p.frameConfig.agent_input_guidance:p.UDL.g("tip.placeInputHere")):this.txtMsgEl.attr("placeholder",p.frameConfig.robot_input_guidance?p.frameConfig.robot_input_guidance:p.UDL.g("tip.placeInputHere"))},initCustomButtons:function(e,t){var n=[];this.initPlaceholder(e);var i=p.frameConfig.agent_custom_buttons||[],a=p.frameConfig.robot_custom_buttons||[];if("agent"===e)n=i;else if(n=a,"rainbowfish"===p.company.subdomain){var s=/\?/;n.forEach(function(e){"link"===e.type&&(s.test(e.content)?e.content+="&webtoken="+p.customer.web_token:e.content+="?webtoken="+p.customer.web_token)})}r=n,o=t,this.renderCustomButtons(n,t,!1)},initCustomButtonsByGuessQuestions:function(e,t){for(var n=[],i=0,a=e.length;i<a;i++){var s=e[i];s.isButtonCopywriting&&n.push({type:"text",name:s.buttonCopywriting,content:s.question||s.content,attrs:{"data-question-id":s.questionId||"","data-query-type":"10","data-params":JSON.stringify({hitSource:2})},highlight_tips:s.highlightTips})}0===n.length&&(n=r,t=o),this.renderCustomButtons(n,t,!0)},noticeRun:function(){if(null==this.noticeTime){var e=$(".marqueebox-content");if(e.size()>0){var t=e&&e[0].parentNode.offsetWidth;this.noticeTime=setInterval(function(){t-=1,t<-e[0].offsetWidth&&(t=e[0].parentNode.offsetWidth),e[0].style.transform="translateX("+t+"px)"},20)}}},noticeStop:function(){var e=$(".marqueebox-content");e.size()>0&&(e[0].style.transform="translateX(0px)"),clearInterval(this.noticeTime),this.noticeTime=null},showNoticeMsg:function(){var e=this,t="",n=this.company.affiche_content_position,i=this.company.affiche_content_style;if(!this.company.affiche_content)return"";var r=/<\/?.+?\/?>/g,o=this.company.affiche_content.replace(r,"");t='<div class="noticeMsg '+("fixed_top"===n&&"keepTop")+" "+("inline"===i?"noticeUnExpandLine":"inline_with_marquee"===i&&"noticeUnExpand")+'"><div class="noticeVoice"><div class=\'noticeVoice-img\'></div></div>'+('<div class="marqueebox"><div class="marqueebox-content">'+("expand"!==i?o:this.company.affiche_content)+"</div></div>")+('<div id="arrowBtn" class="icon icon '+("expand"!==i&&"icon-arrow-down")+'"></div>')+"</div>";var a=$(".messages"),s="show-history",c=$("#"+s),l=$(".noticeMsg");if(setTimeout(function(){var t=$("#arrowBtn"),n=$(".noticeMsg");if(n.css("width",a[0].offsetWidth+"px"),"inline_with_marquee"===i&&e.noticeRun(),t){var r=e,s=$(".marqueebox-content");n.off("click").on("click",function(){t.hasClass("icon-arrow-up")?(t.removeClass("icon-arrow-up"),t.addClass("icon-arrow-down"),s[0].innerHTML=o):(t.removeClass("icon-arrow-down"),t.addClass("icon-arrow-up"),s[0].innerHTML=r.company.affiche_content),"inline"===i&&(n.hasClass("noticeExpand")?(n.removeClass("noticeExpand"),n.addClass("noticeUnExpandLine")):(n.removeClass("noticeUnExpandLine"),n.addClass("noticeExpand"))),"inline_with_marquee"===i&&(n.hasClass("noticeExpand")?(n.removeClass("noticeExpand"),n.addClass("noticeUnExpand")):(n.removeClass("noticeUnExpand"),n.addClass("noticeExpand")),r.noticeTime?r.noticeStop():r.noticeRun())})}},0),l.length<1)if(c.length<1)p.messagesEl.prepend(t);else{var u=c.parents("dt");u.before(t)}else{var d=c.parents("dt");l.after(d)}},showHistoryTip:function(e){var t="show-history",n=p.UDL.g("tip."+e)||e,i=$("#"+t);return i.size()?i.html(n):(i=$('<dt><h4><a id="'+t+'">'+n+"</a></h4></dt>"),p.messagesEl.prepend(i)),this.showNoticeMsg(),i},getCustomerLogs:function(t){var n,i=this,r=t.isCurrent,o=t.isHistory,a=e.context,s="/spa1/im/im_logs/customer_logs",c=this.urlParamObj;r?(n=$.extend({session_key:a.urlParams.session_key||"",im_web_plugin_id:a.urlParams.web_plugin_id||""},t.data),a.isTransfer&&(n.robot_transfer=!0),c.session_id&&(n.im_robot_session_id=c.session_id,delete c.session_id)):n={session_key:a.urlParams.session_key||"",im_web_plugin_id:a.urlParams.web_plugin_id||"",more_marking:p.last_more_marking,robot_session_associated_id:p.last_robot_session_associated_id},c.history_scope&&(n.history_scope=c.history_scope),t.current_session_type&&(n.current_session_type=t.current_session_type),u.getCustomerIng||(u.getCustomerIng=!0,$.get(s,n).always(function(e){if(u.getCustomerIng=!1,1e3==e.code){var n=function(){e.more_marking?p.showHistoryTip("moreMsg"):(p.showHistoryTip("noMoreMsg"),p.bodyEl.off("click","#show-history"))};p.last_more_marking=e.more_marking,p.last_robot_session_associated_id=e.robot_session_associated_id;var r=e.im_logs||[];r=i.filterSurveyLogs(r,e.now,o),n(),t.isShowTips||o&&p.clearOfflineCount(),t.cb&&t.cb(r,n)}else p.showHistoryTip("noMoreMsg"),p.bodyEl.off("click","#show-history"),t.cb&t.cb([])}))},filterSurveyLogs:function(t,i,r){t=t||[],i=i||new Date;for(var o=e.context||{},a=o.surveyData||{},s=a?a.survey_expire:"",c=!!a&&a.enabled,l=60*(s||48)*60*1e3,u=!1,d=0,p=t.length;d<p;d++){var h=t[d],f=e.parseJSON(h.content||{});if("survey"===f.type&&f.survey_option_id){u=!0;break}}if(u)for(var g=0;n=t.length,g<n;g++){var h=t[g],f=e.parseJSON(h.content||{});"survey"===f.type&&"undefined"==typeof f.survey_option_id&&(t.splice(g,1),g--)}else for(var m=0;k=t.length,m<k;m++){var h=t[m],f=e.parseJSON(h.content||{}),v=new Date(i)-new Date(h.created_at);"survey"===f.type&&(!c||r&&v>l)&&(t.splice(m,1),m--)}return t},isRecvMsg:function(e){return"agent"===e||(""+e).indexOf("robot")>0},bindSurveyEvent:function(){p.bodyEl.on("click",".show-survey,.has-survey",function(){p.hideMoreBox();var e=$(this).attr("data-im_sub_session_id"),t=$(this).attr("data-agent_id"),n=$(this).attr("data-jid"),i=$(this).attr("data-history");if(!i||!$(this).is(".has-survey")){var r=l.chatAgent;r.showModalOfSurveys({notShowTitle:!0,notShowSurveyEvent:!0,im_sub_session_id:e,agent_id:t,jid:n||""})}})},clearOfflineCount:function(t){var n=this.apiPath+"sdk_offline_messages/customer_clear_message",i=this.customer||{};if(t)return void $(".unread-box").remove();var r=e.context.offline||{};r.count&&$.post(n,{user_id:i.user_id,access_token:i.access_token,appid:"",session_key:this.urlParamObj.session_key,customer_id:i.user_id}).always(function(t){1e3==t.code&&($(".unread-box").remove(),e.setContext({offline:{}}))})},getSurveyData:function(t){function n(){}return t=t||n,e.context.surveyData?t(e.context.surveyData):void $.get(p.apiPath+"im_surveys").always(function(n){return n&&1e3==n.code?(n.im_survey.star.options.reverse(),e.setContext({surveyData:n.im_survey}),t(n.im_survey)):t()})},checkMsgSensitivity:function(e){e=e||{};var t=e.content||"",n=e.type||"",i=$.Deferred();("message"!==n||e.skip)&&i.resolve();var r=l.customer.text_sensitivity_api;return r?$.ajax({type:"POST",url:r,data:JSON.stringify({body:t,content_type:n}),dataType:"json",contentType:"application/json",no_additional_params:!0}).then(function(e){1e3===e.code?i.resolve():i.reject(new Error(e.message||"åéæ¶æ¯å¤±è´¥ï¼åå«ææè¯æ±"))},function(){i.resolve()}):i.resolve(),i.promise()},setQueueMsgGoBottom:function(){var e=p.messagesEl.find(".queue-event");if(e.size()>0){var t=$(e).clone(!0);e.remove(),p.messagesEl.append(t[0])}},bindAudio:function(){$(document.body).on("click",".audio-static",function(){var e=$(this),t=e.find("audio")[0];try{t.onended=function(){e.removeClass("audio-playing"),t.pause()}}catch(n){}if(e.hasClass("audio-playing"))e.removeClass("audio-playing"),t.pause();else{e.addClass("audio-playing");try{t.play()["catch"](function(){})}catch(n){}}})},setHeaderTitleBoxWith:function(e,t){setTimeout(function(){var n=e||$(".ui-appbar"),i=n.find(".pull-right").outerWidth(),r=n.find(".ui-appbar").size()>0?n.find(".ui-appbar").width():n.width();t&&t.containerWidth&&(r=Math.min(r,t.containerWidth));var o=n.find(".icon-arrow-left");n.find(".title-box").width(r-i-50-(o.size()>0?30:0))},50)},getWithDefault:function(e,t,n){var i=e;if(t instanceof Array)for(var r=0;r<t.length;r++){if(null===i||void 0===i){i=n;break}i=i[t[r]]}return i},miniProgramLinkClickHandler:d,initScrollBtn:function(){var e=null,t=function(){clearTimeout(e),e=setTimeout(function(){$(".to-top").hide(),$(".to-bottom").hide()},3e3)};this.contentEl[0].addEventListener("scroll",function(){t();var e=$(".to-top"),n=$(".to-bottom"),i=$("#content").scrollTop();i<10?e.hide():i>$(".messages").height()-$("#content").height()-$(".customButton").outerHeight()?n.hide():(e.show(),n.show())}),this.mainEl.on("click",".to-top",function(){t();var e=0;$("body").hasClass("robot")&&($(".common-question").size()?e=$($(".common-question")[$(".common-question").size()-1]).position().top:$(".msg-shortcut").size()&&(e=$(".msg-shortcut").position().top)),$("#content").animate({scrollTop:e})}),this.mainEl.on("click",".to-bottom",function(){t(),$("#content").animate({scrollTop:$(".messages").height()-$("#content").height()+12})})}};p.UDL={setData:function(e){this.data=e,this.parseElements()},setDefaultData:function(e){this.defaultData=e},parseElements:function(e){$("[udl-g],[udl-gl],[udl-gt]",e).each(function(){var e,t=$(this),n=t.attr("udl-g"),i=t.attr("udl-gl"),r=t.attr("udl-gt"),o=t.attr("udl-property"),a="g",s=n,c={};i&&(a="gl",s=i),r&&(a="gt",s=r),e=p.UDL[a](s),o?(c[o]=e,t.attr(c)):t.html(e)})},g:function(t,n){var i=p.UDL.data||{},r=p.UDL.defaultData||{},o=arguments[2]||!1;t=t||"";for(var a="",s=t.split("."),c=i[s[0]],l=1;l<s.length;l++)"object"==typeof c&&(c=c[s[l]]||"");if(!o&&!c&&!$.isEmptyObject(r)){for(var a=r[s[0]],l=1;l<s.length;l++)"object"==typeof a&&(a=a[s[l]]||"");c=a}return n&&c&&"object"!=typeof c&&(c=e.replaceTpl(c,n)),o?c||"":c||s[s.length-1]||""},gl:function(e,t){return p.UDL.g("label."+e,t)},gt:function(e,t){return p.UDL.g("tip."+e,t)}},p.tipsNewMessage={id:null,time:300,music:null,_music:null,title:document.title||"",muted:!1,soundBuf:null,init:function(){var e=this;this.title=document.title,this._music=document.getElementById("audio-music");try{window.Audio||audiojs.events.ready(function(){e.music=audiojs.create($("#audio-music")[0])}),e._music.play()["catch"](function(){}),e._music.pause(),$(document).one("touchstart",function(){e._music.play()["catch"](function(){}),e._music.pause()})}catch(t){}$(document.body).on("mouseover",function(){e.stop()})},start:function(t,n,i){var r=this,o="ãããããã",a="ã"+p.UDL.g("tip.newMsgTitle")+"ã",s=o+this.title,c=a+this.title;if(!this.muted){n.indexOf("emoji")>-1&&(n="");var n=n||p.UDL.g("tip.newMsg"),t=t||p.UDL.g("label.notify");document.title=c;try{e.isIos()?r._music&&r._music.play()["catch"](function(){}):r.music?r.music.play():r._music&&r._music.play()["catch"](function(){})}catch(l){p.log.info(l)}if(!p.innerController.isInnerMode)try{e.notification(t,n,{messageId:i})}catch(l){}r.id||(clearInterval(r.id),r.id=setInterval(function(){document.title=document.title===s?c:s},r.time))}},stop:function(){var e=this;"undefined"!=typeof e.id&&(clearInterval(e.id),e.id=void 0,document.title=e.title)},mute:function(){this.muted=!0},unmute:function(){this.muted=!1}},p.log={init:function(e){$.getScript("/im_client/cmps/raven-js/dist/raven.min.js").then(function(){$.getJSON("/im_client/log_filters/sentry.json").then(function(t){var n=0;Raven.config("https://cd85964a2473493893a800f2c92500ce@sentry.udesk.cn/3",$.extend({shouldSendCallback:function(e){return++n<=50}},t)).install(),Raven.setUserContext({id:e.user_id,username:e.username})})})},info:function(){console.log(arguments)},debug:function(e){e&&this.error(e,{extra:"debug"})},error:function(e,n){if(e){var i="[object Error]"==Object.prototype.toString.call(e);console.log(e,n),t.Raven&&Raven[i?"captureException":"captureMessage"](e,{extra:n})}}},p.innerController={isInnerMode:!1,msgListener:function(e){window.addEventListener?window.addEventListener("message",function(t){try{var n=JSON.parse(t.data)||{};e&&e(n)}catch(t){}}):window.attachEvent("onmessage",function(t){try{var n=JSON.parse(t.data)||{};e&&e(n)}catch(t){}})},storageListener:function(e){try{window.addEventListener?window.addEventListener("storage",function(t){e&&e(t)}):document.attachEvent&&!K.Browser.opera?document.attachEvent("onstorage",function(t){e&&e(t)}):window.attachEvent("onstorage",function(t){e&&e(t)})}catch(t){}},postMsg:function(e,t){var n=p.getRoot();e=JSON.stringify(e)||"",t=t||"*",n.parent.postMessage(e,t)},postNewMsg:function(e,t){switch(t){case"redirect":case"timeout":return;case"file":case"audio":e="ï¼»"+p.UDL.g("label.file")+"ï¼½";break;case"image":e="ï¼»"+p.UDL.g("label.image")+"ï¼½";break;case"message":e=e;break;default:e=p.UDL.g("tip.newMsgTitle")}this.postMsg({msg:e,type:"newMsg"})},postAgentInfo:function(e){var t={type:"agent",nick:e.nick,src:e.avatar};this.postMsg(t)},fnStore:{openPanel:function(e){p.preloadData=e.preloadData,l.els.txtMsg.focus(),p.goBottom(),p.sendMsgOfRead()},clearUnread:function(n){try{p.store("unread",0),n.content&&n.content.clearHistory&&(p.customer?p.clearOfflineCount():(p.urlParamObj=e.urlParams(t.location.href),p.initAjax(),p.loadUser(function(t){p.customer=t,p.offline=t.offline||{},t.offline&&t.offline.count&&e.setContext({offline:t.offline||{}}),p.clearOfflineCount()})))}catch(i){}},postClearUnread:function(e){try{p.innerController.postMsg({type:"clearUnread"})}catch(t){}},forceChat:function(e){t.location.reload()},autoSize:function(e){p.autoSize()},transferAgent:function(e){var n=setInterval(function(){p.robotHasInitok&&(clearInterval(n),p.agent_id=e.agentId,p.urlParamObj.agent_id=e.agentId,p.showTransferAgentDialog(t))},1e3)}},registeFn:function(e,t){if(e&&t){var n=this.fnStore[e];n?$.isArray(n)?n.push(t):$.isFunction(n)?this.fnStore[e]=[n,t]:this.fnStore[e]=t:this.fnStore[e]=t}},execFn:function(e,t){var n=this.fnStore;if(e&&n[e]){t=t||{};var i=n[e];if(i)if($.isArray(i))for(var r=0,o=i.length;r<o;r++)$.isFunction(i[r])&&i[r](t);else $.isFunction(i)&&i(t)}},listeneStorage:function(){var e=this;this.storageListener(function(t){t=t||{},"UDESK_msg"===t.key?e.execFn("showStoreMsg"):"UDESK_unread"===t.key&&e.execFn("postClearUnread")})},init:function(e){var t=this;this.isInnerMode=!0,this.msgListener(function(e){e=e||{};var n=e.type||"";t.execFn(n,e)})}},t.console=t.console||{log:function(){}},e.common=p}(this.udesk,this),function(e){var t;e.fn.msgVoice=function(){function n(){var e=setInterval(function(){var e=d.attr("class"),t=parseInt(e.match(new RegExp(o+"([1-4])"))[1]),n=t+1;n>4&&(n=1),d.attr("class","icon "+o+n)},500);i.one("pause",function(t){clearInterval(e),d.attr("class","icon "+o+"4")})}var i=this,r=document.createElement("div"),o="icon-sound-wave-",a=this.parents(".msg"),s=a.has("msg-recv");s?r.innerHTML='<span class="wave"><i class="icon '+o+'4"></i></span><span class="duration">0â³</span><span class="current-time">0â³</span>':r.innerHTML='<span class="current-time">0â³</span><span class="duration">0â³</span><span class="wave"><i class="icon '+o+'4"></i></span>';var c=e(r);c.addClass("voice-wrapper");var l=c.find(".duration"),u=c.find(".current-time"),d=c.find(".wave i");this.on("durationchange",function(e){l.text(Math.ceil(e.target.duration)+"â³")}),this.on("playing",function(e){t&&t.pause(),t=e.target,c.addClass("playing"),n()}),this.on("pause",function(e){t===e.target&&(t=null),c.removeClass("playing"),e.target.currentTime=0}),this.on("timeupdate",function(e){var t=Math.ceil(e.target.currentTime);u.text()!==t+"â³"&&u.text(t+"â³")}),c.click(function(){var e=i.get(0);e.paused?e.play()["catch"](function(){}):e.pause()}),this.parent().append(c)}}(window.$),ud_define("lib/imLog-templates/common-msg-tpl",[],function(){var e='<img class="wait-img" src="images/loading-sun.gif"/>',t='<img class="fail-img" src="images/msg-resend.png"/>';return function(n){n=n||{};var i=["clearfix"],r=[],o=udesk.common.frameConfig||{},a=n.theme_color||o.theme_color,s=a;"#000"===udesk.context.customerTextColor&&(s="#000");var c='<p class="read-status" style="color:'+(n.read_status?"rgba(36, 46, 51, .4)":s)+'">'+(n.read_status?udesk.common.UDL.gl("read"):udesk.common.UDL.gl("unread"))+"</p>";n.groupTime&&r.push('data-group-time="'+n.groupTime+'"'),n.clz&&i.push(n.clz);var l=udesk.common||{},u=l.company||{},d=u.agent_message_display_status||!1;return['<dd class="'+i.join(" ")+'" data-msgId={msgId} data-received=0 '+r.join(" ")+">",'    <div class="msg {clz} {typeClz}" style="color:'+udesk.context.customerTextColor+'">','       <i class="msg-avatar" {avatarStyle}></i>','       <div class="sender">','           <span class="sender-text">{senderName}</span>','           <span class="time-text">{msgTime}&#8197;<b> </b></span>',"       </div>",'       <div class="msg-content {themeBg}" style="{style}">',"           {msg}","       </div>","       {moreHtml}",'       <span class="msg-read-status">',d?c:"","       </span>",'       <span class="msg-status">',e,t,"       </span>","   </div>","</dd>"].join("")}}),ud_define("lib/imLog-templates/msg-with-voice-tpl",[],function(){var e='<img class="wait-img" src="images/loading-sun.gif"/>',t='<img class="fail-img" src="images/msg-resend.png"/>';return function(n){var i=["clearfix"],r=[];n=n||{},n.groupTime&&r.push('data-group-time="'+n.groupTime+'"'),n.clz&&i.push(n.clz);var o="message-voice-{msgId}";return'<dd class="'+i.join(" ")+' im-log-wrapper message-with-voice" data-msgId={msgId} data-received=0 '+r.join(" ")+'><div class="msg {clz} {typeClz}"><i class="msg-avatar" {avatarStyle}></i><div class="sender"><span class="sender-text">{senderName}</span><span class="time-text">{msgTime}&#8197;<b></b></span></div><div class="msg-content {themeBg}" style="{style}"><div class="audio-box message-with-voice text-right"><audio id="'+o+'" src="{voice_url}" preload="metadata" class="hide {themeBg}"/><script>(function(){$(document.getElementById("'+o+'")).msgVoice()})()</script></div></div></div><span class="msg-status">'+e+t+"</span></dd>";
}}),ud_define("lib/imLog-templates/msg-type-audio",[],function(){var e='<img class="wait-img" src="images/loading-sun.gif"/>',t='<img class="fail-img" src="images/msg-resend.png"/>';return function(n){var i=["clearfix"],r=[];console.log(n),n=n||{},n.groupTime&&r.push('data-group-time="'+n.groupTime+'"'),n.clz&&i.push(n.clz);var o="message-audio-{msgId}";return'<dd class="'+i.join(" ")+' im-log-wrapper message-with-voice" data-msgId={msgId} data-received=0 '+r.join(" ")+'><div class="msg {clz} {typeClz}"><i class="msg-avatar" {avatarStyle}></i><div class="sender"><span class="sender-text">{senderName}</span><span class="time-text">{msgTime}&#8197;<b></b></span></div><div class="msg-content {themeBg}" style="{style}"><div class="audio-box message-with-voice"><audio id="'+o+'" src="{msg}" preload="metadata" class="hide {themeBg}"/><script>(function(){$(document.getElementById("'+o+'")).msgVoice()})()</script></div></div></div><span class="msg-status">'+e+t+"</span></dd>"}}),function(e){function t(e){return a?e&&a.hasOwnProperty([e])?a[e]:a["default"]:null}function n(e,t){if("number"==typeof e&&t instanceof Array){var n=e%t.length;return t[n]}return null}function i(e){return o?e&&o.hasOwnProperty([e])?o[e]:o["default"]:null}function r(e){var t=e.initialSize||1,n=e.criterion||1,i=e.multiple||1,r=Number(t),o=Number(n),a=Number(i);(Number.isNaN(r)||r<=0)&&(r=1),(Number.isNaN(o)||o<=0)&&(o=1),(Number.isNaN(a)||a<=0)&&(a=1);var s=Math.ceil(r/o);return s*a}var o={"default":[{selector:"node",style:{label:"data(name)",width:"data(width)",height:"data(width)","font-size":6,"overlay-opacity":0,"border-width":1,"border-style":"solid","border-color":"#fff",opacity:1}},{selector:"edge",style:{"curve-style":"bezier","target-arrow-shape":"triangle",width:1,"arrow-scale":.2,"overlay-opacity":0,opacity:.5}},{selector:"node.hover",style:{width:"data(hoverWidth)",height:"data(hoverWidth)",opacity:1}},{selector:"edge.hover",style:{width:4,"arrow-scale":.6,opacity:1}},{selector:"node.click",style:{width:"data(hoverWidth)",height:"data(hoverWidth)",opacity:1}},{selector:"edge.click",style:{width:4,"arrow-scale":.6,opacity:1}}]},a={"default":{nodesColors:["#D6162E","#294254","#46A1A9","#E38163","#7BCEAE","#61A682","#D58D16","#C3A29A","#6E6F74"],nodesHighLightColors:["#D6162E","#294254","#46A1A9","#E38163","#7BCEAE","#61A682","#D58D16","#C3A29A","#6E6F74"],edgesColors:["#D6162E","#294254","#46A1A9","#E38163","#7BCEAE","#61A682","#D58D16","#C3A29A","#6E6F74"],edgesHighLightColors:["#D6162E","#294254","#46A1A9","#E38163","#7BCEAE","#61A682","#D58D16","#C3A29A","#6E6F74"]}};e.fn.knowledgeGraph=function(o){function a(e){var o=[];if(e&&e.nodes&&e.relations){var a={};e.relations instanceof Array&&e.relations.length>0&&e.relations.forEach(function(e){a.hasOwnProperty(e.startNodeId)?a[e.startNodeId]++:a[e.startNodeId]=1}),e.nodes instanceof Array&&e.nodes.length>0&&e.nodes.forEach(function(e){var t=a[e.id];o.push({data:{id:"knowledgeNode"+e.id,name:e.name,group:"knowledgeNode"+e.id,properties:e.properties,width:r({initialSize:t,criterion:6,multiple:8}),hoverWidth:r({initialSize:t,criterion:6,multiple:10})}})}),e.relations instanceof Array&&e.relations.length>0&&e.relations.forEach(function(e){o.push({data:{id:"relation"+e.id,name:e.name,properties:e.properties,source:"knowledgeNode"+e.startNodeId,target:"knowledgeNode"+e.endNodeId,group:"relation"+e.id}})})}if(o instanceof Array&&o.length>0){var s=t(),c=/knowledgeNode+/,l=[],u=0,d=0,p={};o.forEach(function(e){if(c.test(e.data.group)){var t=n(u,s.nodesColors),i=n(u,s.nodesHighLightColors);t&&(l.push({selector:'node[group="'+e.data.group+'"]',style:{"background-color":t?t:null}},{selector:'node[group="'+e.data.group+'"].click',style:{"background-color":i?i:null}},{selector:'node[group="'+e.data.group+'"].hover',style:{"background-color":i?i:null}}),u++)}else{var t,i;p.hasOwnProperty(e.data.group)?(t=p[e.data.group].color,i=p[e.data.group].highLightColor):(t=n(d,s.edgesColors),i=n(d,s.edgesHighLightColors),p[e.data.group]={color:t,highLightColor:i}),t&&(l.push({selector:'edge[group="'+e.data.group+'"]',style:{"line-color":t?t:null,"target-arrow-color":t}},{selector:'edge[group="'+e.data.group+'"].click',style:{"line-color":i?i:null,"target-arrow-color":i}},{selector:'edge[group="'+e.data.group+'"].hover',style:{"line-color":i?i:null,"target-arrow-color":i}}),d++)}});var h=i();return l=h.concat(l),[o,l]}return[[],[]]}function s(e){var t=e.target,n=u;if(n&&("nodes"===n._private.group?n.neighborhood(function(e){e.removeClass("hover")}):"edges"===n._private.group&&n.connectedNodes(function(e){e.removeClass("hover")}),n.removeClass("hover")),t.length>0){if("nodes"===t._private.group){var i=e.target.neighborhood(),r=t._private.data.id,o=[];i.forEach(function(e){if("edges"===e._private.group&&e._private.data.source===r){var t=e._private.data.target;e.hasClass("click")||e.addClass("hover"),o.includes(t)||o.push(t)}}),i.forEach(function(e){"nodes"===e._private.group&&o.includes(e._private.data.id)&&(e.hasClass("click")||e.addClass("hover"))})}else if("edges"===t._private.group){t.connectedNodes(function(e){e.hasClass("click")||e.addClass("hover")})}t.hasClass("click")||t.addClass("hover"),u=t,t.hasClass("click")||(d=e.originalEvent.offsetX,p=e.originalEvent.offsetY,null!=t._private.data.name&&""!==t._private.data.name&&(h=!0,f=t._private.data.name))}}function c(e){var t=u;t&&("nodes"===t._private.group?t.neighborhood(function(e){e.removeClass("hover")}):"edges"===t._private.group&&t.connectedNodes(function(e){e.removeClass("hover")}),t.removeClass("hover")),h=!1}function l(e){var t=e.target,n=g;if(n){if("nodes"===n._private.group)var i=n.neighborhood(function(e){e.removeClass("click")});else if("edges"===n._private.group){n.connectedNodes(function(e){e.removeClass("click")})}n.removeClass("click"),m=!1}if(t.length>0){if("nodes"===t._private.group){var i=e.target.neighborhood(),r=t._private.data.id,o=[];i.forEach(function(e){if("edges"===e._private.group&&e._private.data.source===r){var t=e._private.data.target;e.addClass("click"),e.removeClass("hover"),o.includes(t)||o.push(t)}}),i.forEach(function(e){"nodes"===e._private.group&&o.includes(e._private.data.id)&&(e.addClass("click"),e.removeClass("hover"))})}else if("edges"===t._private.group){t.connectedNodes(function(e){e.addClass("click"),e.removeClass("hover")})}t.addClass("click"),t.removeClass("hover"),g=t,m=!0,h=!1,v=e.originalEvent.offsetX,y=e.originalEvent.offsetY;var a=t._private.data.properties;if("object"==typeof a){var s=Object.keys(a),c=[];s.length>0?s.forEach(function(e){c.push({key:e,value:a[e]})}):m=!1,a=c}}}var u,d,p,h,f,g,m,v,y,b=this,_=e(this),x=e('<div style="width:calc(100% - 47px);height:300px;margin-top:5px;background-color: #fff"></div>');_.replaceWith(x);var w=o.knowledgeId;e.getScript("/im_client/cmps/cytoscape.js-3.16.3/cytoscape.umd.js",function(){cytoscape?e.get("/spa1/im_robots/knowledge_diagram",{knowledgeId:w,maxHops:1}).done(function(t){var n=a(t);x.empty();var i=cytoscape({container:x.get(),elements:n[0],layout:{name:"cose"},style:n[1]});i.on("vclick",l),i.on("tapdragover",s),i.on("tapdragout",c);var r=e('<button style="border:0;background:transparent;position:absolute;right:0;top:0;font-size:20px">&times;</button>');r.on("click touchend",function(){i.destroy()}),i.on("destroy",function(){r.off(),x.replaceWith(b)}),x.append(r)}):x.replaceWith(b)})},e(document).on("click.knowledge-graph","[data-knowledge-id]",function(){var t=e(this);t.knowledgeGraph({knowledgeId:t.data("knowledge-id"),params:t.data("params")})})}(window.$),function(e){function t(e){var t=Math.floor(e/6e4),n="0"+Math.floor(e%6e4/1e3);return n.length>2&&(n=n.substring(1)),t+":"+n}e.fn.countdown=function(){var e=this.data("countdown");if(e){this.text(t(e));var n=this,i=setInterval(function(){e=Math.max(e-1e3,0),e<=0&&(clearInterval(i),window.location.reload()),n.text(t(e))},1e3)}}}(window.$),function(e,t){var n={},i=e.common;n.chat={imgItemTpl:function(t,n){var r=this,o='<img src="{msg}">';return e.isMob()?o='<img src="{msg}">':i.innerController.isInnerMode&&(o='<a href="{msg}" target="_blank"><img src="{msg}"></a>'),e.replaceTpl(r.msgItemTpl(n),{typeClz:"msg-img",msg:o})},fileItemTpl:function(t,n,r){r=r||{};var o,a=i.getFileImgByFileUrl(n,r.isRecv?"02":"03"),s=[],c=10;t&&(s.push({href:t,target:"_blank",className:"preview-btn",text:i.UDL.g("label.preview")}),c+=e.context.previewTextWidth),r.noDownload||(s.push({href:"{msg}",target:"_blank",text:i.UDL.g("label.download")}),c+=e.context.downloadTextWidth);var l=Math.floor(1e5*Math.random())+""+(new Date).getTime();o=e.joinStr('<div class="file-box" style="padding-right:'+c+'px">',a+" ",'<div class="file-name" id="'+l+'">',"</div>",'<div class="btns">',e.map(s,function(t,n){return e.createHtml("a",n)}),"</div>","</div>");var u=e.replaceTpl(this.msgItemTpl(r),{typeClz:"msg-file",msg:o,avatarStyle:r.avatarStyle});return function(e){var t=$(u),n=t.find("#"+l),i=document.createElement("a");i.setAttribute("href",e.msg),i.setAttribute("target","_blank"),i.innerText=e.filename,n.append(i);var r=document.createElement("div");return r.className="text-muted",r.innerText=e.filesize,n.append(r),n.removeAttr("id"),$("<div></div>").append(t).html()}},videoItemTpl:function(){var t=this;return function(n){var i=n.msg.replace(/"/g,"&quot;");return e.replaceTpl(t.msgItemTpl(),{typeClz:"msg-video",msg:'<video src="'+i+'" controls="controls">Video addressï¼{msg}</video>'})}},uploadingTpl:function(){var t=this;return e.replaceTpl(t.msgItemTpl(),{typeClz:"msg-uploading",msg:'<div class="progress-max" id={fileId}><div class="progress-per"></div></div>'})},titleItemTpl:function(e){return'<dt class="hide '+e+'"><h4>{msg}</h4></dt>'},titleRadiusItemTpl:function(t){var n;return t=t||{},n=t.msg,delete t.msg,e.createHtml("dt",$.extend({html:'<span class="event-bar">'+n+"</span>"},t))},unreadMessageTpl:function(t){var n;return t=t||{},n=t.msg,delete t.msg,e.createHtml("dt",$.extend({html:'<span class="event-bar-line" id="event-bar-line"><b>'+n+"</b></span>"},t))},ads_textTpl:function(){return['<div class="side-text scrollbar">','<div class="side-title">{title}</div>','<div class="side-content">{links}</div>',"</div>"].join("")},ads_imgTpl:function(){return['<div class="side-img">','<a href="{image_link}" target="_blank">','<img src="{image}" /></a></div>'].join("")},structTpl:function(t){t=t||{};var n,i=this,r=t.buttons||[],o="",a="",s="",c="";t.img_url&&(o=['<li class="list-group-item">','<img src="'+t.img_url+'" class="struct-img">',"</li>"].join("")),t.title&&(s="<label>"+t.title+"</label>"),t.description&&(c='<p class="text-muted">'+t.description+"</p>"),(s||c)&&(a='<li class="list-group-item text-left">'+s+c+"</li>"),n='<ul class="list-group">'+o+a;for(var l=0;l<r.length;l++){var u=r[l];"link"===u.type?n+='<li class="list-group-item"><a href="'+u.value+'" target="_blank">'+u.text+"</a></li>":"phone"===u.type&&(n+='<li class="list-group-item"><a class="show-tel" href="tel:'+u.value+'">'+u.text+"</a>")}return n+="</ul>",e.replaceTpl(i.msgItemTpl(),{typeClz:"msg-struct",msg:n})},productTpl:function(t){var n=["msg-product"],i=[];if(t=t||{},t.imgUrl&&(n.push("has-img"),i.push('<img src="'+t.imgUrl+'" />')),t.url?e.isMiniProgram()&&!/^https?|^\/\//.test(t.url)?i.push('<a data-miniprogram-path="'+t.url+'">'+t.name+"</a>"):i.push('<div class="product-title"><a href="'+t.url+'" target="_blank">'+t.name+"</a></div>"):i.push('<div class="product-title">'+t.name+"</div>"),t.params){i.push('<div class="params clearfix">');for(var r,o=0,a=t.params.length;o<a;o++)r=t.params[o],i.push('<span style="'),r.color&&i.push("color: "+r.color+";"),r.size&&i.push("font-size: "+(r.size||12)+"px;"),r.bold&&i.push("font-weight: bold;"),i.push('">'+r.text+"</span>"),r["break"]&&i.push("<br/>");i.push("</div>")}return e.replaceTpl(this.msgItemTpl(),{typeClz:n.join(" "),msg:i.join("")})},surveyTpl:function(t){var n=['<dd class="clearfix survey-event" data-received=1>','    <div class="text-center">','<div class="sender survey-sender">','<span class="sender-text">{senderName}</span>',"</div>",'<div class="survey-text event-bar">',"<span>"," &nbsp;{iconText} &nbsp;",'<a href="javascript:;" class="{surveyClass}" data-im_sub_session_id="{im_sub_session_id}" data-agent_id="{agent_id}" data-methods="{methodFlag}" data-jid="{jid}" data-history="{history}">{surveyText}</a>',"</span>","</div>","</div>","</dd>"].join("");return e.replaceTpl(n,$.extend({clz:"",senderName:"",msgTime:"",iconText:"",surveyText:"",surveyClass:""},t))},costomerCloseTpl:function(){var e=['<dd class="clearfix close-event text-center" data-received=1>','<div class="close-text event-bar">','<p class="">',i.UDL.g("label.chatEnd"),"</p>","</div>","</dd>"].join("");return e},queueTpl:function(t){var n=['<dd class="clearfix queue-event text-center" data-received=1 {groupTimeAttr}>','<div class="queue-text event-bar">','<p class="queue-num">',"{queueText} ",t.leaveText?"{leaveText}":"","</p>","</div>","</dd>"].join("");return e.replaceTpl(n,$.extend({clz:"",senderName:"",msgTime:"",queueText:"",leaveText:"",groupTimeAttr:t.groupTime?'data-group-time="'+t.groupTime+'"':""},t))},loadingTpl:function(t){return t=t||{},e.replaceTpl(this.msgItemTpl({clz:"item-loading"}),$.extend({msg:i.UDL.g("agent.typing","",!0)+'<img src="images/loading3.gif" />'},t,{msgTime:i.formatDateTime(t.msgTime)}))},eventTpl:function(){var e=['<dd class="clearfix event-msg {clz}" data-received=1>','   <div class="event-box">','       <p><span class="event-time">{eventTime}&#8197;<b> </b></span></p>','       <p><span class="event-text">{eventText}</span></p>',"   </div>","</dd>"].join("");return e},eventTplNoTime:function(){var e=['<dd class="clearfix event-msg {clz}" data-received=1>','   <div class="event-box">','       <p><span class="event-text">{eventText}</span></p>',"   </div>","</dd>"].join("");return e}},n.feedback={basicFieldTpl:function(){return['<div class="form-group {classHidden}" data-valid="{isValid}" data-field="{name}">',this.usePlaceholder?"":"<label>{title}</label>","   {content}","</div>"].join("")},basicInputTpl:function(){var e="";return this.usePlaceholder&&(e=' placeholder="{title}"'),'<input type="{content_type}" {val} value="{value}" data-title="{title}" name="{name}" data-otype="{otype}" {checkedAttr} class="{clazz}" '+e+" />"},basicOptionTpl:function(){return"<option {val} {checkedAttr} title={text}>{text}</option>"},basicSelectInputTpl:function(){return'<div><label class="check-btn">'+this.basicInputTpl()+"<span>{text}</span></label></div>"},basicCheckboxTpl:function(){return e.replaceTpl(this.basicSelectInputTpl(),{clazz:"field",content_type:"checkbox"})},basicRadioTpl:function(){return e.replaceTpl(this.basicSelectInputTpl(),{clazz:"field",content_type:"radio"})},basicTextTpl:function(){return e.replaceTpl(this.basicInputTpl(),{clazz:"form-control",content_type:"text"})},numberFieldTpl:function(){return e.replaceTpl(this.basicFieldTpl(),{content:this.basicTextTpl(),placeholder:i.UDL.g("tip.positiveInt"),otype:"number"})},dateFieldTpl:function(){return e.replaceTpl(this.basicFieldTpl(),{content:this.basicTextTpl(),placeholder:i.UDL.g("tip.date"),otype:"date"})},timeFieldTpl:function(){return e.replaceTpl(this.basicFieldTpl(),{content:this.basicTextTpl(),placeholder:i.UDL.g("tip.time"),otype:"time"})},datetimeFieldTpl:function(){return e.replaceTpl(this.basicFieldTpl(),{content:this.basicTextTpl(),placeholder:i.UDL.g("tip.time"),otype:"datetime"})},linkFieldTpl:function(){return e.replaceTpl(this.basicFieldTpl(),{content:this.basicTextTpl(),placeholder:i.UDL.g("tip.link"),otype:"link"})},numericFieldTpl:function(){return e.replaceTpl(this.basicFieldTpl(),{content:this.basicTextTpl(),placeholder:i.UDL.g("tip.int"),otype:"numeric"})},textFieldTpl:function(){return e.replaceTpl(this.basicFieldTpl(),{content:this.basicTextTpl()})},selectFieldTpl:function(){return e.replaceTpl(this.basicFieldTpl(),{content:'<select name="{name}" class="form-control" style="color:#9DA1A5;">{content}</select>'})},textareaFieldTpl:function(){return e.replaceTpl(this.basicFieldTpl(),{content:'<textarea data-title="{placeholder}" name="{name}" class="form-control" placeholder={placeholder} >{value}</textarea>'})},selectInputField:function(){return e.replaceTpl(this.basicFieldTpl(),{content:'<span class="lab">{title}ï¼</span><div class="selectedInput">{content}</div>'})},cascadeFieldTpl:function(){return e.replaceTpl(this.basicFieldTpl(),{content:'<span class="lab">{title}ï¼</span><div class="cascade-field">{content}</div>'})},getFieldTpl:function(t,n,r,o){r=r||null;var o=o||"",a=n.rq===!0||"true"===n.rq,s=n.name+(a?"("+i.UDL.g("label.required")+")":""),c={title:s,name:n.id,isValid:a?n.id:0,val:o,placeholder:n.name,value:n.value||"",classHidden:n.hiddenClass?"hidden-group":""};return r&&(c.content=r),e.replaceTpl(t,c)},customFieldsHandler:function(t,n,r){var o,a=this;switch(t.content_type){case"text":o=a.getFieldTpl(a.textFieldTpl(),t);break;case"area_text":case"location":o=a.getFieldTpl(a.textareaFieldTpl(),t);break;case"radio":var s=[];$.each(t.select_options,function(n,i){s.push(e.replaceTpl(a.basicRadioTpl(),{name:t.id,val:"value="+i.value||n,text:i.title,checkedAttr:t.value&&t.value===i.value?"checked='checked'":""}))}),o=a.getFieldTpl(a.selectInputField(),t,s.join(""));break;case"checkbox":var c=[],l=[];t.value&&(l=t.value.split(",")),$.each(t.select_options,function(n,i){c.push(e.replaceTpl(a.basicCheckboxTpl(),{name:t.id,val:"value="+i.value||n,text:i.title,checkedAttr:l.length&&$.inArray(i.value,l)!=-1?"checked='checked'":""}))}),o=a.getFieldTpl(a.selectInputField(),t,c.join(""));break;case"droplist":var u=[];u.unshift("<option value=''>"+t.name+"</option>"),$.each(t.select_options,function(n,i){u.push(e.replaceTpl(a.basicOptionTpl(),{val:"value="+i.value||n,text:i.title,checkedAttr:t.value&&t.value===i.value?"selected = 'selected'":""}))}),o=a.getFieldTpl(a.selectFieldTpl(),t,u.join(""));break;case"chained_droplist":var u=[],l=[];t.value&&(l=t.value.split(",")),n.classes=["cascade-0"];var d=a.getFormatOptions(t.select_options,n.classes);$.each(n.classes,function(e,t){var n=l[e];r?u.push('<div class="cascade '+t+' hide form-control" data-value="'+(n||"")+'" data-floor="'+e+'"></div>'):e<1?u.push('<select data-value="'+n+'" data-first-title="'+i.UDL.g("tip.pleaseChoice")+'" class="'+t+' form-control"></select>'):u.push('<select data-value="'+n+'" class="'+t+' form-control"></select>')}),o=a.getFieldTpl(a.cascadeFieldTpl(),t,u.join("")),n.fields.push({id:t.id,options:d,selects:n.classes,value:l});break;case"date":o=a.getFieldTpl(a.dateFieldTpl(),t);break;case"time":o=a.getFieldTpl(a.timeFieldTpl(),t);break;case"datetime":o=a.getFieldTpl(a.datetimeFieldTpl(),t);break;case"number":o=a.getFieldTpl(a.numberFieldTpl(),t);break;case"numeric":o=a.getFieldTpl(a.numericFieldTpl(),t);break;case"link":o=a.getFieldTpl(a.linkFieldTpl(),t)}return o},getFormatOptions:function(e,t){var n=this,i=[];return e=e||[],$.each(e,function(e,r){var o=r||{},a={name:o.title,value:r.value||e+""};o.subs&&(n.setCascadeClass(t),a.sub=n.getFormatOptions(o.subs,t)),i.push(a)}),i},setCascadeClass:function(e){var t=e.length;e.push("cascade-"+t)},fieldHandler:function(n,i,r){$.each(n.fields,function(t,n){r?e.cascade&&e.cascade({el:$('[data-field="'+n.id+'"]').find(".cascade-field"),valueIds:n.value,url:n.options,selects:n.selects}):$('[data-field="'+n.id+'"]').find(".cascade-field").cxSelect({jsonName:"name",jsonValue:"value",jsonSub:"sub",url:n.options,selects:n.selects,nodata:"none"})}),i.on("change",".cascade-field select",function(e){try{var t=$(e.target);t.val()||0===t.val()?t.css("color","#555"):t.css("color","#999")}catch(n){}}),i.find('[data-otype="date"]').click(function(){WdatePicker()}),i.find('[data-otype="time"]').click(function(){WdatePicker({dateFmt:"HH:mm:ss"})}),i.find('[data-otype="datetime"]').click(function(){WdatePicker({dateFmt:"yyyy-MM-dd HH:mm"})}),i.find('[data-otype="numeric"]').on("keyup",function(){var e=$(this),t=/[^-?\d+\.?\d+]/g;e.val(e.val().replace(t,""))}).on("beforepaste",function(){t.clipboardData.setData("text",t.clipboardData.getData("text").replace(reg,""))}),i.find('[data-otype="number"]').on("keyup",function(){var e=$(this);e.val(parseInt(e.val())||0)}).on("beforepaste",function(){t.clipboardData.setData("text",parseInt(t.clipboardData.getData("text"))||0)});try{$("[data-title]").placeholder()}catch(o){}},fieldValueHandler:function(e,t){switch(e.content_type){case"droplist":t=[t];break;case"radio":case"checkbox":var n=[];$('input[name="'+e.id+'"]:checked').each(function(){n.push($(this).val())}),t=n;break;case"chained_droplist":var n=[];$.each($('[data-field="'+e.id+'"]').find("select"),function(e,t){var i=$(t).val();(i||0===i)&&$(t).val()&&n.push($(t).val())}),t=n.join(",")}return t},fieldValid:function(e,t){var n=[],r=[],o=["droplist","radio","checkbox","chained_droplist"];if("true"!==e.rq&&e.rq!==!0||t||r.push(e.name),"email"===e.id&&t&&!i.isEmail(t)&&n.push(i.UDL.g("tip.emailError")),"link"===e.content_type&&t&&!i.isLink(t)&&n.push(e.name+i.UDL.g("tip.fmtError")),$.inArray(e.content_type,o)>-1&&("true"===e.rq||e.rq===!0))if("chained_droplist"===e.content_type&&(t=t.split(",")),t.length){var a=[];$.each(t,function(e,t){$.trim(t)&&a.push($.trim(t))}),a.length||r.push(e.name)}else r.push(e.name);return{errorArr:n,rqArr:r}}},n.feedback_tab={basicFieldTpl:function(){return['<div class="form-group {classHidden} {clz}" data-valid="{isValid}" data-field="{name}">','<label class="">{labelText}</label><span class="required">*</span>',"{content}</div>"].join("")},basicInputTpl:function(){return'<input type="{content_type}" {val} value="{value}" data-title="{title}" name="{name}" data-otype="{otype}" {checkedAttr}  class="{clazz}" />'},basicOptionTpl:function(){return"<option {val} {checkedAttr}>{text}</option>"},basicSelectInputTpl:function(){return'<div><label class="check-btn">'+this.basicInputTpl()+"<span>{text}</span></label></div>"},basicCheckboxTpl:function(){return e.replaceTpl(this.basicSelectInputTpl(),{clazz:"field",content_type:"checkbox"})},basicRadioTpl:function(){return e.replaceTpl(this.basicSelectInputTpl(),{clazz:"field",content_type:"radio"})},basicTextTpl:function(){return e.replaceTpl(this.basicInputTpl(),{clazz:"form-control",content_type:"text"})},numberFieldTpl:function(){return e.replaceTpl(this.basicFieldTpl(),{content:this.basicTextTpl(),placeholder:i.UDL.g("tip.positiveInt"),otype:"number"})},dateFieldTpl:function(){return e.replaceTpl(this.basicFieldTpl(),{content:this.basicTextTpl(),placeholder:i.UDL.g("tip.date"),otype:"date"})},timeFieldTpl:function(){return e.replaceTpl(this.basicFieldTpl(),{content:this.basicTextTpl(),placeholder:i.UDL.g("tip.time"),otype:"time"})},datetimeFieldTpl:function(){return e.replaceTpl(this.basicFieldTpl(),{content:this.basicTextTpl(),placeholder:i.UDL.g("tip.time"),otype:"datetime"})},linkFieldTpl:function(){return e.replaceTpl(this.basicFieldTpl(),{content:this.basicTextTpl(),placeholder:i.UDL.g("tip.link"),otype:"link"})},numericFieldTpl:function(){return e.replaceTpl(this.basicFieldTpl(),{content:this.basicTextTpl(),placeholder:i.UDL.g("tip.int"),otype:"numeric"})},textFieldTpl:function(){return e.replaceTpl(this.basicFieldTpl(),{content:this.basicTextTpl()})},selectFieldTpl:function(){return e.replaceTpl(this.basicFieldTpl(),{content:'<select name="{name}" class="form-control" style="color:#9DA1A5;">{content}</select>'})},textareaFieldTpl:function(){return e.replaceTpl(this.basicFieldTpl(),{content:'<textarea data-title="{title}" name="{name}" value="{value}" class="form-control" >{value}</textarea>'})},selectInputField:function(){return e.replaceTpl(this.basicFieldTpl(),{content:'<div class="selectedInput">{content}</div>'})},cascadeFieldTpl:function(){return e.replaceTpl(this.basicFieldTpl(),{content:'<div class="cascade-field">{content}</div>'})},getFieldTpl:function(t,n,i,r){i=i||null;var r=r||"",o={labelText:n.field_label,title:n.field_label,name:n.field_name,isValid:n.required?n.field_name:0,val:r,clz:n.required?"req":"",value:n.value||"",classHidden:n.hiddenClass?"hidden-group":""};return i&&(o.content=i),e.replaceTpl(t,o)},customFieldsHandler:function(t,n){var r,o=this;switch(t.content_type){case"text":r=o.getFieldTpl(o.textFieldTpl(),t);break;case"area_text":case"location":r=o.getFieldTpl(o.textareaFieldTpl(),t);break;case"radio":var a=[];$.each(t.select_options,function(n,i){a.push(e.replaceTpl(o.basicRadioTpl(),{name:t.field_name,val:"value="+i.value||n,text:i.title,checkedAttr:t.value&&t.value===i.value?"checked='checked'":""}))}),r=o.getFieldTpl(o.selectInputField(),t,a.join(""));break;case"checkbox":var s=[],c=[];t.value&&(c=t.value.split(",")),$.each(t.select_options,function(n,i){s.push(e.replaceTpl(o.basicCheckboxTpl(),{name:t.field_name,val:"value="+i.value||n,text:i.title,checkedAttr:c.length&&$.inArray(i.value,c)!=-1?"checked='checked'":""}))}),r=o.getFieldTpl(o.selectInputField(),t,s.join(""));break;case"droplist":var l=[];l.unshift("<option value=''>"+t.field_label+"</option>"),$.each(t.select_options,function(n,i){l.push(e.replaceTpl(o.basicOptionTpl(),{val:"value="+i.value||n,text:i.title,checkedAttr:t.value&&t.value===i.value?"selected = 'selected'":""}))}),r=o.getFieldTpl(o.selectFieldTpl(),t,l.join(""));break;case"chained_droplist":var l=[],c=[];t.value&&(c=t.value.split(","));var u=o.getFormatOptions(t.select_options,n.classes);$.each(n.classes,function(e,t){var n=c[e];e<1?l.push('<select data-value="'+n+'" data-first-title="'+i.UDL.g("tip.pleaseChoice")+'" class="'+t+' form-control"></select>'):l.push('<select data-value="'+n+'" class="'+t+' form-control"></select>')}),r=o.getFieldTpl(o.cascadeFieldTpl(),t,l.join("")),n.fields.push({id:t.field_name,options:u,selects:n.classes});break;case"date":r=o.getFieldTpl(o.dateFieldTpl(),t);break;case"time":r=o.getFieldTpl(o.timeFieldTpl(),t);break;case"datetime":r=o.getFieldTpl(o.datetimeFieldTpl(),t);break;case"number":r=o.getFieldTpl(o.numberFieldTpl(),t);break;case"numeric":r=o.getFieldTpl(o.numericFieldTpl(),t);break;case"link":r=o.getFieldTpl(o.linkFieldTpl(),t)}return r},getFormatOptions:function(e,t){var n=this,i=[];return e=e||[],$.each(e,function(e,r){var o=r||{},a={name:o.title,value:r.value||e+""};o.subs&&(n.setCascadeClass(t),a.sub=n.getFormatOptions(o.subs,t)),i.push(a)}),i},setCascadeClass:function(e){var t=e.length;e.push("cascade-"+t)},fieldHandler:function(e,n){$.each(e.fields,function(e,t){$('[data-field="'+t.id+'"]').find(".cascade-field").cxSelect({jsonName:"name",jsonValue:"value",jsonSub:"sub",url:t.options,selects:t.selects,nodata:"none"})}),n.on("change",".cascade-field select",function(e){try{var t=$(e.target);t.val()||0===t.val()?t.css("color","#555"):t.css("color","#999")}catch(n){}}),n.find('[data-otype="date"]').click(function(){WdatePicker()}),n.find('[data-otype="time"]').click(function(){WdatePicker({dateFmt:"HH:mm:ss"})}),n.find('[data-otype="datetime"]').click(function(){WdatePicker({dateFmt:"yyyy-MM-dd HH:mm"})}),n.find('[data-otype="numeric"]').on("keyup",function(){var e=$(this),t=/[^-?\d+\.?\d+]/g;e.val(e.val().replace(t,""))}).on("beforepaste",function(){t.clipboardData.setData("text",t.clipboardData.getData("text").replace(reg,""))}),n.find('[data-otype="number"]').on("keyup",function(){var e=$(this);e.val(parseInt(e.val())||0)}).on("beforepaste",function(){t.clipboardData.setData("text",parseInt(t.clipboardData.getData("text"))||0)});try{$("[data-title]").placeholder()}catch(i){}},fieldValueHandler:function(e,t){switch(e.content_type){case"droplist":t=[t];break;case"radio":case"checkbox":var n=[];$('input[name="'+e.id+'"]:checked').each(function(){n.push($(this).val())}),t=n;break;case"chained_droplist":var n=[];$.each($('[data-field="'+e.id+'"]').find("select"),function(e,t){var i=$(t).val();(i||0===i)&&$(t).val()&&n.push($(t).val())}),t=n.join(",")}return t},fieldValid:function(e,t){var n=[],r=[],o=["droplist","radio","checkbox","chained_droplist"];if("true"!==e.rq&&e.rq!==!0||t||r.push(e.field_label),"email"===e.id&&t&&!i.isEmail(t)&&n.push(i.UDL.g("tip.emailError")),"link"===e.content_type&&t&&!i.isLink(t)&&n.push(e.field_label+i.UDL.g("tip.fmtError")),$.inArray(e.content_type,o)>-1&&("true"===e.rq||e.rq===!0))if("chained_droplist"===e.content_type&&(t=t.split(",")),t.length){var a=[];$.each(t,function(e,t){$.trim(t)&&a.push($.trim(t))}),a.length||r.push(e.field_label)}else r.push(e.field_label);return{errorArr:n,rqArr:r}}},n.ticket={msgItemTpl:function(e){var t=["clearfix"],n=[];return e=e||{},e.clz&&t.push(e.clz),['<dd class="'+t.join(" ")+'" data-msgId={msgId} '+n.join(" ")+">",'   <div class="msg {clz} {typeClz}">','       <i class="msg-avatar" {avatarStyle}></i>','       <div class="sender">','           <span class="sender-text">{senderName}</span>','           <span class="time-text">{msgTime}&#8197;<b> </b></span>',"       </div>",'       <div class="msg-content {themeBg}" style="{style}">',"           {msg}","       </div>","       {moreHtml}","   </div>","</dd>"].join("")},imgItemTpl:function(t,n){var r=this,o='<img src="{msg}">';return e.isMob()?o='<img src="{msg}">':i.innerController.isInnerMode&&(o='<a href="{msg}" target="_blank"><img src="{msg}"></a>'),e.replaceTpl(r.msgItemTpl(n),{typeClz:"msg-img",msg:o})},fileItemTpl:function(t,n,r){r=r||{};var o,a=i.getFileImgByFileUrl(n,r.isRecv?"02":"03"),s=[],c=10;return t&&(s.push({href:t,target:"_blank",text:i.UDL.g("label.preview")}),c+=e.context.previewTextWidth),r.noDownload||(s.push({href:"{msg}",target:"_blank",text:i.UDL.g("label.download")}),c+=e.context.downloadTextWidth),o=e.joinStr('<div class="file-box" style="padding-right:'+c+'px">',a+" ",'<div class="file-name">','<a href="{msg}" target="_blank">{filename}</a>','<div class="text-muted">{filesize}</div>',"</div>",'<div class="btns">',e.map(s,function(t,n){return e.createHtml("a",n)}),"</div>","</div>"),e.replaceTpl(this.msgItemTpl(r),{typeClz:"msg-file",msg:o})},videoItemTpl:function(){return function(t,n){var i=t.msg.replace(/"/g,"&quot;");return e.replaceTpl(self.msgItemTpl(),{typeClz:"msg-video",msg:'<video src="'+i+'" controls="controls">Video addressï¼{msg}</video>'})}},uploadingTpl:function(){var t=this;return e.replaceTpl(t.msgItemTpl(),{typeClz:"msg-uploading",msg:'<div class="progress-max" id={fileId}><div class="progress-per"></div></div>'})},titleItemTpl:function(e){return'<dt class="hide '+e+'"><h4>{msg}</h4></dt>'},titleRadiusItemTpl:function(t){var n;return t=t||{},n=t.msg,delete t.msg,e.createHtml("dt",$.extend({html:'<span class="event-bar">'+n+"</span>"},t))},ads_textTpl:function(){return['<div class="side-text scrollbar">','<div class="side-title">{title}</div>','<div class="side-content">{links}</div>',"</div>"].join("")},ads_imgTpl:function(){return['<div class="side-img">','<a href="{image_link}" target="_blank">','<img src="{image}" /></a></div>'].join("")},structTpl:function(t,n){t=t||{};var i,r=this,o=t.buttons||[],a="",s="",c="",l="";t.img_url&&(a=['<li class="list-group-item">','<img src="'+t.img_url+'" class="struct-img">',"</li>"].join("")),t.title&&(c="<label>"+t.title+"</label>"),t.description&&(l='<p class="text-muted">'+t.description+"</p>"),(c||l)&&(s='<li class="list-group-item text-left">'+c+l+"</li>"),i='<ul class="list-group">'+a+s;for(var u=0;u<o.length;u++){var d=o[u];"link"===d.type?i+='<li class="list-group-item"><a href="'+d.value+'" target="_blank">'+d.text+"</a></li>":"phone"===d.type&&(i+='<li class="list-group-item"><a class="show-tel" href="tel:'+d.value+'">'+d.text+"</a>")}return i+="</ul>",e.replaceTpl(r.msgItemTpl(n),{typeClz:"msg-struct",msg:i})},productTpl:function(t,n){var i=["msg-product"],r=[];if(t=t||{},t.imgUrl&&(i.push("has-img"),r.push('<img src="'+t.imgUrl+'" />')),t.url?r.push('<a href="'+t.url+'" target="_blank">'+t.name+"</a>"):r.push(t.name),t.params){r.push('<div class="params clearfix">');for(var o,a=0,s=t.params.length;a<s;a++)o=t.params[a],r.push('<span style="'),o.color&&r.push("color: "+o.color+";"),o.size&&r.push("font-size: "+(o.size||12)+"px;"),
o.bold&&r.push("font-weight: bold;"),r.push('">'+o.text+"</span>"),o["break"]&&r.push("<br/>");r.push("</div>")}return e.replaceTpl(this.msgItemTpl(n),{typeClz:i.join(" "),msg:r.join("")})},surveyTpl:function(t){var n=['<dd class="clearfix survey-event" data-received=1>','    <div class="text-center">','<div class="sender survey-sender">','<span class="sender-text">{senderName}</span>',"</div>",'<div class="survey-text event-bar">',"<span>"," &nbsp;{iconText} &nbsp;",'<a href="javascript:;" class="{surveyClass}" data-im_sub_session_id="{im_sub_session_id}" data-agent_id="{agent_id}" data-methods="{methodFlag}" data-jid="{jid}">{surveyText}</a>',"</span>","</div>","</div>","</dd>"].join("");return e.replaceTpl(n,$.extend({clz:"",senderName:"",msgTime:"",iconText:"",surveyText:"",surveyClass:""},t))},queueTpl:function(t){var n=['<dd class="clearfix queue-event text-center" data-received=1 {groupTimeAttr}>','<div class="queue-text event-bar">','<p class="queue-num">',"{queueText} ",t.leaveText?"{leaveText}":"","</p>","</div>","</dd>"].join("");return e.replaceTpl(n,$.extend({clz:"",senderName:"",msgTime:"",queueText:"",leaveText:"",groupTimeAttr:t.groupTime?'data-group-time="'+t.groupTime+'"':""},t))},loadingTpl:function(t){return t=t||{},e.replaceTpl(this.msgItemTpl({clz:"item-loading"}),$.extend({msg:i.UDL.g("agent.typing","",!0)+'<img src="images/loading3.gif" />'},t,{msgTime:i.formatDateTime(t.msgTime)}))}},e.template=n}(this.udesk,this),require(["lib/udesk.core","lib/imLog-templates/common-msg-tpl","lib/imLog-templates/msg-with-voice-tpl","lib/imLog-templates/msg-type-audio"],function(e,t,n,i){e.template.chat.msgItemTpl=function(e){return function(r){return r.voice_url&&r.voice_url.trim()?n(e):"audio"===r.type?i(e):t(e)}}}),function(e,t,n){var i=e.common,r=i.UDL.g,o=(i.company,/(vipkid|vipkid-tr)/.test(location.host));e.ns("im.index.sidebox");var a,s,c,l=e.im||{},u=[],d=!1,p=!0,h=['<div class="media">','  <div class="media-left">','    <a href="{url}" target="_blank">','      <img src="{image}" alt="{title}">',"    </a>","  </div>",'  <div class="media-body word-break">','    <a class="media-heading" href="{url}" target="_blank" style="{title_style}">{title}</a>',"    {innerDetails}","  </div>","  {details}","  {sendBtn}","</div>"].join(""),f=function(e){return e+"_TabPanel"},g=function(t){if(t){var n;for(var i in t)if(0===i.indexOf("product_")){n=n||{};var r="product_url"===i?t[i]:e.xss(t[i]);n[i.replace("product_","")]=r}return n}},m=function(t){if(t){var n=t.product_params;if(n)return n;for(var i in t)"title"!==i&&"url"!==i&&"image"!==i&&"send"!==i&&"title_style"!==i&&"hideMsgTip"!==i&&(n=n||{},n[i]=e.xss(t[i]));return n}},v=function(t){o||e.context.chatAgent.getClickSendProduct()||a.append(a.find(">.sidebox"))},y=function(t,n){if(!t)return"";var i="";return t.enable&&(i=e.unXss(t.content)||"<div></div>"),i},b=function(t){if(!t)return"";t=n.extend({},t);var r="",o=m(t);if(!n.isEmptyObject(o)){for(var a in o)if(!/_style$/.test(a)){var s=o[a].trim();r+=e.replaceTpl('<p style="{s}">{k}{v}</p>',{k:a,v:s?"ï¼"+s:"",s:o[a+"_style"]})}r='<div class="details">'+r+"</div>"}var l="",u=e.context||{},d=u.isRobotChat;t.send&&t.title&&(l='<div class="send-product-box '+(d?"hide-product":"")+'"><a href="javascript:;" class="send-product">'+i.UDL.g("label.send")+"</a></div>"),t.innerDetails=c?r:"",t.details=c?"":r,t.sendBtn=l,!t.url&&(t.url="javascript:;");var p=e.replaceTpl(h,t,{omitXss:"details,innerDetails,sendBtn"});return"javascript:;"===t.url&&(p=p.replace(/target=\"_blank\"/g,"")),p},_=function(){var e=['<div class="sidebox '+(c?"inner":"")+'">','<div class="tab-content" style="top: '+(d?"0px":"48px")+'">'];return n.each(u,function(t,n){e.push('<div id="'+f(n.sort_key)+'" class="'+n.clz+'">'+n.html+"</div>")}),e.push("</div></div>"),e.join("")},x=function(e){if(!e.url)return"";var t=i.urlParamObj||{};n.each(["cur_url","cur_title","pre_url","src_url"],function(e,n){delete t[n]});var r="",o=[],a=e.url;for(var s in t)o.push(encodeURIComponent(s)+"="+encodeURIComponent(t[s]));return r=o.join("&"),a+=a.indexOf("?")>-1?"&"+r:"?"+r,'<iframe src="'+a+'"></iframe>'},w=function(e,t){return t.im_sub_session_id?'<div class="loading-div"><p class="loading"></p></div>':""},k=function(){return'<div class="loading-div"><p class="loading"></p></div>'},T=function(e){p&&n.get(i.apiPath+"im/im_newspaper/window/agent_card",{im_sub_session_id:e,im_web_plugin_id:i.urlParamObj.web_plugin_id||""}).always(function(e){if(e&&1e3===e.code){var t='<div class="agent-div">',o={aliase_nick_name:r("agent.name"),work_id:r("agent.jobNo"),email:r("agent.email"),cellphone:r("agent.telephone")};n.each(e.data,function(e,n){if("aliase_nick_name"===n.key&&(n.content=i.frameConfig.agent_fixed_nickname||n.content),n.enable)switch(n.key){case"avatar":t+='<div class="agent-avatar"><img src="'+(i.frameConfig.agent_avatar||n.content||"images/agent-on.png")+'" /></div>';break;case"aliase_nick_name":case"work_id":case"email":case"cellphone":var r=['   <div class="agent-item">','       <label class="">'+o[n.key]+"ï¼</label>",'       <div class="">'+(n.content||"")+"</div>","   </div>"].join("");t+=r;break;case"desc":t+='<div class="agent-desc">'+(n.content||"")+"</div>"}}),t+="</div>",n(".agent_card_TabPanel").empty().append(t),p=!1}else n(".agent_card_TabPanel").empty(),i.showTip("æ°æ®è¯·æ±å¼å¸¸,è¯·èç³»å®¢æ","error")})},S=function(e,t){var r={};n.each(e.side_data,function(e,n){"robot_auto_suggest"===n.key&&n.sort_key==t&&(r=n)});var o=r.question||{},a=r.hot_question||{},s=o.enable,c=a.enable,l=i.urlParamObj.web_plugin_id,u=r.isLoadCommonQ,d=r.isLoadHotQ,p=r.commonQuestionData,h=r.hotQuestionData,f=n(".robot_auto_suggest_TabPanel");f.empty(),f.html('<div class="loading-div"><p class="loading"></p></div>'),s&&!u?n.get(i.apiPath+"im/im_newspaper/window/robot_auto_suggest",{im_web_plugin_id:l||"",s:"common",model_key:o.id}).always(function(e){if(e&&1e3===e.code){var o=e.data||[],a='<div class="common-qustion"><h4>'+(r.question_title?r.question_title:"å¸¸è§é®é¢")+"</h4>";n.each(o,function(e,t){var i='<div class="common-div"><p class="common-title">'+t.name+"</p><ul>",r=t.questionList||[],o="";n.each(r,function(e,t){var n=['<li class="hot-li clearfix">',"<span>"+(e+1)+'. </span><a href="javascript:;" >'+t.content+"</a>",t.answer&&t.answer.content?'<div class="hot-answer">'+t.answer.content+"</div>":"","</li>"].join("");o+=n}),i+=o,i+="</ul></div>",a+=i}),a+="</div>",f.find(".loading-div").remove(),n("ul.nav-ul").find(".active a").attr("data-sortkey")==t&&f.append(a),r.commonQuestionData=a,r.isLoadCommonQ=!0}else i.showTip("æ°æ®è¯·æ±å¼å¸¸,è¯·èç³»å®¢æ!","error")}):(f.find(".loading-div").remove(),f.append(p)),c&&!d?n.get(i.apiPath+"im/im_newspaper/window/robot_auto_suggest",{im_web_plugin_id:l||"",s:"hot",limit_day_num:a.max,limit_result_num:a.top}).always(function(e){if(e&&1e3===e.code){var o=e.data||[],a='<div class="hot-qustion"><h4>'+(r.hot_question_titile?r.hot_question_titile:"ç­ç¹é®é¢")+"</h4><ul>";n.each(o,function(e,t){var n=['<li class="hot-li clearfix">',"<span>"+(e+1)+'. </span><a href="javascript:;" >'+t.content+"</a>",t.answer&&t.answer.content?'<div class="hot-answer">'+t.answer.content+"</div>":"","</li>"].join("");a+=n}),a+="</ul></div>",f.find(".loading-div").remove(),n("ul.nav-ul").find(".active a").attr("data-sortkey")==t&&f.prepend(a),r.hotQuestionData=a,r.isLoadHotQ=!0}else i.showTip("æ°æ®è¯·æ±å¼å¸¸,è¯·èç³»å®¢æ!","error")}):(f.find(".loading-div").remove(),f.prepend(h)),f.off("click",".hot-li a").on("click",".hot-li a",function(){var e=n(this).parent().find(".hot-answer");e.slideToggle()})},C=function(e){var t=n("ul.nav-ul > li").eq(0).find("a")[0];"agent_card"===n(t).attr("data-id")&&T(e.im_sub_session_id),"robot_auto_suggest"===n(t).attr("data-id")&&S(e,n(t).attr("data-sortkey"))},E=function(e){var t,i=[];i.push('<ul class="nav nav-tabs nav-justified">'),n.each(u,function(e,t){i.push("<li "),!e&&i.push('class="active"'),i.push('><a data-id="'+t.key+'"data-sortkey="'+t.sort_key+'" href="#'+f(t.sort_key)+'" style="border-left:0;">'+t.nick+"</a>"),i.push("</li>")}),i.push("</ul>"),t=n(i.join("")),t.on("click","a",function(t){t.preventDefault();var i=n(this).attr("data-id")||this.getAttribute("data-id");"agent_card"===i&&T(e.im_sub_session_id),"robot_auto_suggest"===i&&S(e,n(this).attr("data-sortkey")),n(this).tab("show")}),a.find(">.sidebox").prepend(t),C(e)},A=function(e){var t,i=[],r=70,o=a.outerWidth(),c=a.outerWidth()-56,l=Math.floor(o/r)>=s,p=Math.floor(c/r)||1;if(e.isInner)return E(e);if(l){var h=(100/s).toFixed(1);n.each(u,function(e,t){1!==u.length||t.nick.replace(/(^\s*)|(\s*$)/g,"")||(d=!0),i.push('<li style="width: '+h+'%;"'),!e&&i.push('class="active"'),i.push('><a title= "'+t.nick+'" data-id="'+t.key+'"data-sortkey="'+t.sort_key+'" href="#'+f(t.sort_key)+'" >'+t.nick+"</a>"),i.push("</li>")}),i.push("</ul>"),i.unshift('<ul class="nav-ul clearfix" style="border-bottom: '+(d?"none":"1px solid #EAEAEA")+'">'),t=n(i.join(""))}else{var h=(100/p).toFixed(1),g=27,m=Math.ceil(c/p),v=s*m,y=c||100-h+.2,b=['<div class="nav-div"><button class="left" style="width:'+(g-1)+'px"><i class="icon icon-arrow-left"></i></button>','<div class="scroll-div scrollbar-x scrollbar-hover" style="width:'+(y+2)+'px"><ul class="nav-ul clearfix" style="width:'+v+'px">'].join("");i.push(b),n.each(u,function(e,t){i.push('<li style="width:'+m+'px;"'),!e&&i.push('class="active"'),i.push('><a title= "'+t.nick+'" data-id="'+t.key+'"data-sortkey="'+t.sort_key+'" href="#'+f(t.sort_key)+'" >'+t.nick+"</a>"),i.push("</li>")});var _=["</ul></div>",'<button class="right" style="width:'+(g-1)+'px"><i class="icon icon-arrow-right"></i></button></div>'].join("");i.push(_),t=n(i.join(""))}t.on("click","li a",function(t){t.preventDefault();var i=n(this).attr("data-id")||this.getAttribute("data-id");"agent_card"===i&&T(e.im_sub_session_id),"robot_auto_suggest"===i&&S(e,n(this).attr("data-sortkey")),n(this).tab("show")}).on("click","button.left",function(){var e=n(".scroll-div").scrollLeft();e<m?n(".scroll-div").animate({scrollLeft:0},"fast"):n(".scroll-div").animate({scrollLeft:e-m},"fast")}).on("click","button.right",function(){var e=n(".scroll-div").scrollLeft(),t=n(".scroll-div").width();e+t>=v?n(".scroll-div").animate({scrollLeft:v-t},"fast"):n(".scroll-div").animate({scrollLeft:e+m},"fast")}),a.find(">.sidebox").prepend(t),C(e)},I=function(e){var t=0,r=e.side_data||[{key:"product",nick:e.product&&e.product.hideMsgTip?"":i.UDL.g("label.consulting")},{key:"custom_content",nick:i.UDL.g("label.official")}];e.product&&e.product.hideMsgTip&&delete i.urlParamObj.product_hideMsgTip;var o={custom_content:y,custom_url:x,product:b,agent_card:w,robot_auto_suggest:k};u.length=0,n.each(r,function(n,r){"product"===r.key?i.urlParamObj.udesk_hide_product||(r.html=b(e.product)||"",r.html&&(r.clz="tab-pane "+(t?"":"active"),t++,s++,u.push(r))):c||(r.html=o[r.key](r,e)||"",r.html&&(r.clz="tab-pane scrollbar "+(t?" ":"active ")+f(r.key),t++,s++,u.push(r)))})},L=function(e){e=e||{},a=n(e.container),s=0,c=e.isInner,p=!0;var t,i,r,l;if((!c||!o)&&(!e.isInner&&a.empty(),!(!e.side_data||e.side_data.length<1||c)||e.product)){if(I(e),A(e),t=n(window).width()/2,e.right_width){if(e.right_width>=t&&(e.right_width=t),!c)var u=Math.max(e.right_width,100);a.css("width",u+"px")}i=_(),r=a.children(),l=r.first(),r.size()>2?a.append(i):l.size()?l.after(i):a.prepend(i),s>0&&A(e),e.after&&e.after(s)}};l.sidebox={init:L,moveTo:v,getProductData:g,getProductParams:m}}(this.udesk,this,$),function(e,t,n){function i(e,t){var i,r=x.urlParamObj;i=r.web_plugin_id?"/spa1/im/im_pre_form/"+r.web_plugin_id+"?channel_type=ImWebPlugin&channel_type_id="+r.web_plugin_id+(r.language?"&language="+r.language:""):"/spa1/im/im_pre_form/undefined?channel_type=&channel_type_id=",n.get(i).always(function(i){if(i=i||{},1e3==i.code){var r=i.im_pre_form||{};if(b.isOldCustomer){var o=[];n.each(r.fields,function(e,t){t.hidden||o.push(t)}),r.fields=o}e&&e(r)}else t&&t()})}function r(){b.en_captcha&&(C.codeEl.val(""),n.get(S.getCaptcha).always(function(e){return 1e3!==e.code?p(x.UDL.g("tip.getCodeError")):(C.captcha_key=e.captcha_key,C.img_url=e.img_url,void C.imgEl.attr("src",C.img_url))}))}function o(e){var t=[];return n.each(e,function(e,n){var i="";n=n||{},b.isOldCustomer&&n.hidden||(i=n.content_type?k.customFieldsHandler(n,T):k.getFieldTpl(k.textFieldTpl(),n),t.push(i))}),t.join("")}function a(){return e.joinStr('<div id="preform-captcha" class="form-group no-form" data-valid="captcha" data-field="captcha">',"   <label>"+w("verifiyCode")+' <span class="star">*</span></label>','   <input id="preform-captcha-code" value="" class="form-control" />','   <div class="preform-captcha-img">','       <img id="preform-cap-pic" alt="" src="" />','       <a class="toggle-cap">'+w("changeASheet")+"</a>","   </div>","</div>")}function s(t){return b.en_privacy_policy=t.en_privacy_policy,t.en_privacy_policy?e.joinStr('<div id="preform-privacy-policy" class="form-group no-form" data-valid="privacy_policy" data-field="privacy_policy">','<div class="checkbox">',"<label>",'   <input id="preform-privacy-policy" type="checkbox" value="" />',t.privacy_policy,"</label>","</div>","</div>"):""}function c(){b.en_captcha&&C.containerEl.on("click",".toggle-cap",function(){r()})}function l(e){var t=b.validate_phone_number,n=b.phone_number_regex,i=b.fields;if(!t)return!0;var r=e.find(function(e){return"cellphone"===e.id}),o=i.find(function(e){return"cellphone"===e.id});if(!r)return!0;var a=/^\d{11}$/,s=/^\d+$/,c=/^(\d*|\+*|-*)*$/;if(o.rq){var l=r.value;switch(String(n)){case"0":return!!a.test(l)||(p(x.UDL.g("tip.phoneError-0")),!1);case"1":return!!s.test(l)||(p(x.UDL.g("tip.phoneError-1")),!1);case"2":return!!c.test(l)||(p(x.UDL.g("tip.phoneError-2")),!1);default:return!!a.test(l)||(p(x.UDL.g("tip.phoneError-0")),!1)}}return!0}function u(){var e,t=[],i=[],o=[],a=C.codeEl.val();n.each(b.fields,function(e,r){var a=n("[name="+r.id+"]").val();a=k.fieldValueHandler(r,a);var s=k.fieldValid(r,a)||{};i=i.concat(s.rqArr),t=t.concat(s.errorArr),o.push({id:r.id,value:x.needXss(r.content_type,a),tp:r.tp})}),t=n.unique(t||[]),i=n.unique(i||[]);var s="";if(t.length||i.length)return i.length&&(s=i.join(", ")+x.UDL.g("tip.rq")),t.length&&(s&&(s+=", "),s+=t.join(", ")),p(s);if(l(o)){if(b.en_captcha&&!a)return p(x.UDL.g("tip.validCode"));if(b.en_privacy_policy&&(null==(e=E.checkboxEl)||!e.prop("checked")))return p(x.UDL.g("tip.privacyPolicyError"));var c=x.urlParamObj,u={fields:o};b.en_captcha&&(u.captcha=a,u.captcha_key=C.captcha_key),c.web_plugin_id&&(u.web_plugin_id=c.web_plugin_id),c.session_key&&(u.session_key=c.session_key),n.post(S.saveForm,u).always(function(e){return e=e||{},1e3!=e.code?9200==e.code?(r(),p(x.UDL.g("tip.reenter"))):p(e.message||x.UDL.g("tip.saveFail")):void f()})}}function d(e){b.en_captcha=e,e||C.containerEl.hide()}function p(e){x.showTip(e,"danger")}function h(e){x.hideModal(),b.allReady&&b.allReady(e)}function f(){v&&v.removeClass("open"),b.allDone&&b.allDone()}function g(){x.hideModal(),v&&v.addClass("open")}function m(t){t=t||{},b=t,y=t.isInner;var l=x.frameConfig.theme_color,p=t.board||{};i(function(i){return b.fields=i.fields,b.validate_phone_number=i.validate_phone_number||!1,b.phone_number_regex=i.phone_number_regex||"0",i.en_captcha||i.fields.length||i.en_privacy_policy?(v=e.ui.board(n.extend({id:"pre-form",title:i.title,body:e.ui.form({container:t.container,desc:i.welcome_enable?i.welcome:"",body:e.joinStr(o(i.fields),a(),s(i)),buttons:[{tagName:"a",act:"submit",text:w("submit"),"class":"btn btn-success",css:{backgroundColor:l}},{html:x.getBtnMsgLogsHtml("preform")},{html:x.getOfflineUnreadMsgHtml("preform")}],onClick:function(e){"submit"===e&&u()}})},p)),C.containerEl=v.find("#preform-captcha"),C.imgEl=v.find("#preform-cap-pic"),C.codeEl=v.find("#preform-captcha-code"),E.checkboxEl=v.find("#preform-privacy-policy [type='checkbox']"),d(i.en_captcha),k.fieldHandler(T,v),r(),h(i),void c()):f()},function(){f()})}e.ns("im");var v,y,b,_=e.im||{},x=e.common,w=x.UDL.gl,k=e.template.feedback,T={classes:["cascade-0"],fields:[]},S={saveForm:"/spa1/im/im_pre_form/customer.json",getCaptcha:"/spa1/im/web_im_feedbacks/captcha"},C={containerEl:"",imgEl:"",codeEl:"",captcha_key:"",img_url:""},E={checkboxEl:null};_.preform={init:m,show:g}}(this.udesk,this,$),function(e,t){function n(e,t,n,i){var r=b+"file_upload_policy";i=i||{},v.get(r,{marking:t,key:e,qs:i.qs}).then(function(t){1e3===t.code?(t.imageName=e,n&&n(t)):y.winAlert("ä¸ä¼ æ¶è·åtokenå¤±è´¥")},function(e){y.winAlert("ä¸ä¼ æ¶è·åtokenå¤±è´¥")})}function i(e){var t=e.file||{},n=t.name.split(".")[0],i=Math.random().toString(32).slice(-5);return n+"_"+ +new Date+"_"+i+"."+t.ext}function r(e){var t,n,i,r,a,s,c,l="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",u="",d=0;for(e=o(e);d<e.length;)t=e.charCodeAt(d++),n=e.charCodeAt(d++),i=e.charCodeAt(d++),r=t>>2,a=(3&t)<<4|n>>4,s=(15&n)<<2|i>>6,c=63&i,isNaN(n)?s=c=64:isNaN(i)&&(c=64),u=u+l.charAt(r)+l.charAt(a)+l.charAt(s)+l.charAt(c);return u}function o(e){e=e.replace(/\r\n/g,"\n");for(var t="",n=0;n<e.length;n++){var i=e.charCodeAt(n);i<128?t+=String.fromCharCode(i):i>127&&i<2048?(t+=String.fromCharCode(i>>6|192),t+=String.fromCharCode(63&i|128)):(t+=String.fromCharCode(i>>12|224),t+=String.fromCharCode(i>>6&63|128),t+=String.fromCharCode(63&i|128))}return t}function a(e){var t=e.config||{},n=t.imageName||"";return v.ajax({url:w+"/putb64/-1/key/"+r(n),type:"POST",data:e.data,noParams:!0,beforeSend:function(e){e.setRequestHeader("Content-Type","application/octet-stream"),e.setRequestHeader("Authorization","UpToken "+t.token)},success:function(n){n&&n.key?e.success&&e.success({src:_[t.bucket]+"/"+n.key}):e.error&&e.error(n)},error:function(){e.error&&e.error(),!e.noTip&&y.tips.error("ä¸ä¼ å¤±è´¥ï¼è¯·éæ°ä¸ä¼ ")}})}function s(e){return v.post(b+"upload_base64_file",{key:e.key,marking:"web.mg.rich_editor_copy",img_base64:e.data}).always(function(t){t&&1e3===t.code&&t.src?e.success&&e.success(t):e.error&&e.error()})}function c(e){return s(e)}function l(e){var t=e.config||{};return v.ajax({url:t.host,type:"PUT",data:e.data,noParams:!0,beforeSend:function(e){var n=t.fields||{};e.setRequestHeader("Content-Type","image/jpg"),e.setRequestHeader("X-Udesk-Minio-policy",n.policy),e.setRequestHeader("X-Udesk-Minio-x-amz-algorithm",n["x-amz-algorithm"]),e.setRequestHeader("X-Udesk-Minio-x-amz-credential",n["x-amz-credential"]),e.setRequestHeader("X-Udesk-Minio-x-amz-date",n["x-amz-date"]),e.setRequestHeader("X-Udesk-Minio-x-amz-signature",n["x-amz-signature"]),e.setRequestHeader("X-Udesk-Minio-key",n.key),e.setRequestHeader("X-Amz-Meta-Content-Encoding","base64,=")},success:function(n){e.success&&e.success({src:t.host+"/"+t.file_path})},error:function(){e.error&&e.error(),!e.noTip&&y.tips.error("ä¸ä¼ å¤±è´¥ï¼è¯·éæ°ä¸ä¼ ")}})}function u(e){if(e){var t=e.fileName,i=e.marking,r=e.successFn,o=e.errorFn,a=e.data;n(t,i,function(e){e.random_filename=t,e.key=(e.dir||"")+t;var n=d(a,t),i=p(n,e);v.ajax({url:e.host,type:"POST",data:i.formObj,noParams:!0,cache:!1,contentType:!1,processData:!1,success:function(){r&&r(i.url)},error:function(){o&&o(),e.error&&e.error(),!e.noTip&&y.tips.error("ä¸ä¼ å¤±è´¥ï¼è¯·éæ°ä¸ä¼ ")}},"json")})}}function d(e,t){return new File([e],t,{type:e.type})}function p(e,t){var n,i=new FormData;switch(i.append("name",e.name),i.append("type",e.type),i.append("lastModifiedDate",e.lastModifiedDate),i.append("size",e.size),t.storage_policy){case"ali":i.append("policy",t.policy),i.append("OSSAccessKeyId",t.accessid),i.append("Signature",t.signature),i.append("key",t.key),n=t.host+"/"+t.key;break;case"qiniu":i.append("token",t.token),i.append("key",t.key),n=_[t.bucket]+"/"+t.key;break;case"minio":var r=t.fields||{};for(var o in r)i.append(o,r[o]);n=t.host+"/"+t.file_path;break;case"huawei_cloud_obs":i.append("policy",t.policy),i.append("AccessKeyId",t.accessid),i.append("Signature",t.signature),i.append("key",t.key),n=t.host+"/"+t.key}return i.append("file",e),{formObj:i,url:n}}function h(e,t,n){return delete t.code,e.policy_config=t,e.tokenOption=n,e}function f(e){var t=e.policy_config||{};return e.formatSize=WebUploader.Base.formatSize(e.size),e._type=0===(e.type||"").indexOf("image/")?"image":"file",e.storage_policy=t.storage_policy,e.bucket=t.bucket,"minio"===t.storage_policy?e.dir=t.dir:t.key?e.dir="":e.dir=t.dir,e}function g(e){m&&m.removeFile(e)}var m,v=e.$,y=e.common,b=y.apiPath,_={udeskim:"https://qn-im.udesk.cn",udeskpub:"https://qn-public.udesk.cn"},x="https:"===location.protocol,w=x?"https://up.qbox.me":"http://up.qiniu.com",k=["exe","html","htm"],T=function(t){return m=WebUploader.create({auto:!1,swf:"/im_client/cmps/webuploader/dist/Uploader.swf",dnd:t.dnd,paste:t.paste,disableGlobalDnd:t.disableGlobalDnd,pick:t.pick,duplicate:t.duplicate,fileSingleSizeLimit:t.fileSingleSizeLimit||52428800,fileSizeLimit:t.fileSizeLimit||1047527424,resize:!1}),m.on("fileQueued",function(e){if(v.inArray(e.ext,k)>-1)return m.cancelFile(e),void y.winAlert(y.UDL.g("tip.fileError",{ext:e.ext}));var i={};"function"==typeof t.tokenOption&&(i=t.tokenOption(e)),n(e.name,t.marking,function(n){function r(){m.upload(e),t.fileQueued&&t.fileQueued(e,m)}e=h(e,n,i),t.manualUpload?t.manualUpload(m,e,function(){r()}):r()},i)}),m.on("uploadBeforeSend",function(e,n,r){var o=e.file,a=o.policy_config;switch(a.storage_policy){case"qiniu":n.token=a.token,n.key=i(e),e.file.random_filename=n.key,e.file.url=_[a.bucket]+"/"+n.key;break;case"ali":if(n.policy=a.policy,n.OSSAccessKeyId=a.accessid,n.Signature=a.signature,a.key)n["x-oss-object-acl"]=a["x-oss-object-acl"],n["Cache-Control"]="public, max-age=604800",n.key=a.key,e.file.dir="",e.file.random_filename=a.key;else{var s=i(e);n.key=a.dir+s,e.file.random_filename=s}if(a.signed_url)e.file.url=a.signed_url;else{var c=a.dir+(t.needUrlEncode?encodeURIComponent(s):s),l=v.param(o.tokenOption&&o.tokenOption.qs||{});e.file.url=a.host+"/"+c,l&&e.file.url.indexOf("?")>-1?e.file.url+="&"+l:l&&(e.file.url+="?"+l)}break;case"minio":e.file.random_filename=a.file_name,e.file.url=a.host+"/"+a.file_path,n=v.extend(n,a.fields);break;case"huawei_cloud_obs":if(n.policy=a.policy,n.AccessKeyId=a.accessid,n.Signature=a.signature,a.key)n["x-obs-acl"]=a["x-obs-acl"],n["Cache-Control"]="public, max-age=604800",n.key=a.key,e.file.dir="",e.file.random_filename=a.key;else{var s=i(e);n.key=a.dir+s,e.file.random_filename=s}if(a.signed_url)e.file.url=a.signed_url;else if(a.key)e.file.url=a.host+"/"+a.key;else{var c=a.dir+(t.needUrlEncode?encodeURIComponent(s):s);e.file.url=a.host+"/"+c}delete n.id,delete n.name,delete n.type,delete n.lastModifiedDate,delete n.size;break;default:n.token=a.token,n.key=i(e),e.file.random_filename=n.key,e.file.storage_policy=a.storage_policy}}),m.on("uploadStart",function(t){var n=t.policy_config||{};"qiniu"===n.storage_policy&&e.ifIE(9,"lte")?m.options.server=w:m.options.server=t.policy_config.host}),m.on("uploadProgress",function(e,n){t.uploadProgress&&t.uploadProgress(e,n)}),m.on("uploadSuccess",function(e,n){e=f(e),t.uploadSuccess&&t.uploadSuccess(e,n)}),m.on("uploadError",function(e,n){t.uploadError&&t.uploadError(e,n)}),m.on("error",function(e,n){if(!n||0!==n.size){var i="",r=t.fileSingleLimit||50;switch(e){case"Q_EXCEED_NUM_LIMIT":i=y.UDL.g("tip.overLimit");break;case"Q_TYPE_DENIED":i=y.UDL.g("tip.forbidType");break;case"Q_EXCEED_SIZE_LIMIT":i=y.UDL.g("tip.overSize");break;case"F_DUPLICATE":i=y.UDL.g("tip.uploadSuccess");break;case"F_EXCEED_SIZE":i=y.UDL.g("tip.overxm",{num:r});break;default:i=y.UDL.g("tip.uploadError")}y.winAlert(i)}}),m.on("dndAccept",function(e){t.dndAccept&&t.dndAccept(e)}),m},S=function(e){e=e||{};var t=e.config||{};switch(t.storage_policy){case"qiniu":a(e);break;case"ali":s(e);break;case"minio":l(e);break;case"huawei_cloud_obs":c(e)}},n=n,u=u;e.uploader={init:T,removeFile:g,getToken:n,getImgByBase64:S,baseCode64:r,uploadVoice:u}}(this.udesk,this),function(e,t,n){e.chatAgent={create:function(){return e.setContext({isRobotChat:!1}),n(e,t)}}}(this.udesk,this,function(e,t){function n(){}function i(){}function r(e,t){return Bt=nn.showModal(e,t),i(),Bt}function o(e,t){var n=!1;return t&&t.enabled&&tn.each(t.methods,function(){if((!e||this.flag===e)&&this.enabled)return n=!0,!n}),n}function a(t){u(),t=t||{};var i=t.jid||"",r=t.cancelFn||n,a=t.noAuthFn||n,l=t.needCloseWin,d=t.notShowSurveyEvent||!1,p=!t.im_sub_session_id||t.im_sub_session_id===Kn,f=o("revote",Nt),g=t.hasSurvey||"";return(g||jt)&&p&&!f?(nn.showTip(nn.UDL.g("robot.hasSurvey"),"error"),l&&We()):void nn.getSurveyData(function(n){function p(e){var t=[],n=e?e.split(/,|ï¼/):[],i=n.length;return i&&tn.each(n,function(e,n){t.push('<li class="tag-item item-col-2"><span>'+n+"</span></li>")}),t.join("")}function f(e,t,n,i){var r="",o="";tn.each(e,function(e,n){n.id===t&&(r=n.tags||"",o=n.remark_option)}),tn(".survey-options-tags").empty().append(p(r)),tn(".survey-mark-wrapped").empty(),n&&"required"===o?tn(".survey-mark-wrapped").append('<span class="survey-mark-required">*</span><textarea class="survey-mark" maxlength=200 placeholder="'+i+'"></textarea>'):n&&"optional"===o&&tn(".survey-mark-wrapped").append('<textarea class="survey-mark" maxlength=200 placeholder="'+i+'"></textarea>')}function g(){tn.post(vn+"im_sessions/surveys",M).always(function(e){$n=!1,tn(".submit-error-text").hide(),e&&1e3===e.code?(c(t.im_sub_session_id||Kn),s("success",Bt),M={},jt=!0,t.successFn&&t.successFn()):e&&9200===e.code?(c(t.im_sub_session_id||Kn),s("error",Bt,e)):s("error",Bt,e),l&&We(),"after_session"===t.methodFlag&&(Un=!0,nn.showBotomPanel("chat_done"),h(!0)),"agent_invite"===t.methodFlag&&ii&&(Un=!0,nn.showBotomPanel("chat_done"),h(!0))})}if(!n||!o(t.methodFlag,n))return a();!d&&P(t),u();var m=[],v="",y="",b=n.resolved_extra||{},_=b.value||"",x=['<div class="survey-result">','   <p class="survey-label">'+(b.title||"")+"</p>",'   <div class="survey-result-btns">'];if(tn.each(b.options||[],function(e,t){var n;"undefined"!=typeof b.value?n=_&&_===e+"":t.option_select&&(n=!0),x.push('<button class="survey-btn '+(e?"survey-btn-no ":"survey-btn-yes ")+(n?"active":"")+'"><div class="icon '+(e?"icon-frown":"icon-smile1")+'"></div><div style="display: inline-block;vertical-align: text-bottom;">'+t.option_name+"</div></button>")}),x=x.concat(["   </div>","</div>"]),n.resolved_enabled&&m.push(x.join("")),"text"===n.show_type){var w=n.text.default_option_id||null;m.push('<div class="survey-options-wrapped option-text">'),tn.each(n.text.options,function(t){this.enabled+""=="true"&&(w===this.id?(m.push(e.replaceTpl('<label><input type="radio" checked="checked" name="survey_options" data-option="{id}"/> {text}</label>',this)),this.tags&&(v=this.tags||""),y=this.remark_option||"optional"):m.push(e.replaceTpl('<label><input type="radio" name="survey_options" data-option="{id}"/> {text}</label>',this)))}),m.push("</div>")}else if("expression"===n.show_type){var k=n.expression.default_option_id||n.expression.options[0].id,T=n.expression.options[0].text;tn.each(n.expression.options,function(e){k===this.id&&(T=this.text||"")}),m.push('<div class="survey-options-wrapped option-expression">'),m.push('<ul class="expression-image-wrapped clearfix">'),tn.each(n.expression.options,function(t){0===t?k===this.id?(m.push(e.replaceTpl('<li data-type="survey01" data-option="{id}" class="survey-expression-item selected"><img src="images/survey01-selected.png" /><br/>{text}</li>',this)),this.tags&&(v=this.tags||""),y=this.remark_option||"optional"):m.push(e.replaceTpl('<li data-type="survey01" data-option="{id}" class="survey-expression-item"><img src="images/survey01.png" /><br/>{text}</li>',this)):1===t?k===this.id?(m.push(e.replaceTpl('<li data-type="survey02" data-option="{id}" class="survey-expression-item selected"><img src="images/survey02-selected.png" /><br/>{text}</li>',this)),this.tags&&(v=this.tags||""),y=this.remark_option||"optional"):m.push(e.replaceTpl('<li data-type="survey02" data-option="{id}" class="survey-expression-item"><img src="images/survey02.png" /><br/>{text}</li>',this)):2===t&&(k===this.id?(m.push(e.replaceTpl('<li data-type="survey03" data-option="{id}" class="survey-expression-item selected"><img src="images/survey03-selected.png" /><br/>{text}</li>',this)),this.tags&&(v=this.tags||""),y=this.remark_option||"optional"):m.push(e.replaceTpl('<li data-type="survey03" data-option="{id}" class="survey-expression-item"><img src="images/survey03.png" /><br/>{text}</li>',this)))}),m.push("</ul>"),m.push("</div>")}else if("star"===n.show_type){var S=n.star.default_option_id||n.star.options[4].id,C=4,T="";tn.each(n.star.options,function(e){S===this.id&&(C=e,T=this.text,v=this.tags||"",y=this.remark_option)}),m.push('<div class="survey-options-wrapped option-star">'),m.push('<div class="star-image-wrapped">'),tn.each(n.star.options,function(t){t<C?m.push(e.replaceTpl('<img class="star-rating-item" alt="{text}" src="images/star-selected.png" data-option="{id}">',this)):t===C?m.push(e.replaceTpl('<img class="star-rating-item selected" alt="{text}" src="images/star-selected.png" data-option="{id}">',this)):t>C&&m.push(e.replaceTpl('<img class="star-rating-item" alt="{text}" src="images/star-normal.png" data-option="{id}">',this))}),m.push("</div>"),m.push('<span class="star-option-desec">'+T+"</span>"),m.push("</div>")}m.push('<ul class="survey-options-tags">'),m.push(p(v)),m.push("</ul>"),m.push('<div class="survey-mark-wrapped">'),n.remark_enabled&&"hide"!==y&&("required"===y?m.push('<span class="survey-mark-required">*</span><textarea class="survey-mark" maxlength=200 placeholder="'+(n&&n.remark)+'"></textarea>'):"optional"===y&&m.push('<textarea class="survey-mark" maxlength=200 placeholder="'+(n&&n.remark)+'"></textarea>')),m.push("</div>"),m.push(['<p class="btnbar clearfix">','  <a class="survey-sub-btn btn btn-yes btn-tg">'+nn.UDL.g("label.submit")+"</a>","</p>"].join("")),Bt=nn.modal=e.ui.modal({clz:"statsurvey",container:nn.mainEl,title:n.title||nn.UDL.g("agent.askSurvey"),content:m.join(""),closeContent:'<a class="close-survey btn-tg icon icon-guanbi"></a>',contentClz:"scrollbar",needClose:!1}),nn.autoSize();var E=tn(".im-modal.statsurvey dd.scrollbar");if(Mn&&e.isMob()&&on.config.proportion<=70?E.height(230):(E.css("max-height","90%"),E.css("height","auto")),tn(".mask.statsurvey").height()<300&&e.isMob()&&Mn&&tn(".im-modal.statsurvey dd").css("max-height",170),tn(".survey-options-tags").on("click",".tag-item",function(){tn(this).toggleClass("tag-item-active")}),"text"===n.show_type)tn('.option-text [name="survey_options"]').on("change",function(){var e=parseInt(tn(this).data("option"));f(n.text.options,e,n.remark_enabled,n.remark)});else if("expression"===n.show_type)tn(".survey-expression-item").on({mouseenter:function(){var e=tn(this);e.find("img").attr("src","images/"+e.data("type")+"-selected.png")},click:function(){var e=tn(this),t=e.find("img"),i=parseInt(e.data("option"));return!e.hasClass("selected")&&(e.siblings().each(function(){var e=tn(this);e.find("img").attr("src","images/"+e.data("type")+".png"),e.removeClass("selected")}),t.attr("src","images/"+e.data("type")+"-selected.png"),e.addClass("selected"),void f(n.expression.options,i,n.remark_enabled,n.remark))},mouseleave:function(){var e=tn(this);e.hasClass("selected")||e.find("img").attr("src","images/"+e.data("type")+".png")}});else if("star"===n.show_type){var A=function(e){D.text(n.star.options[e-1].text),B.each(function(t){t<e?tn(this).attr("src","images/star-selected.png"):tn(this).attr("src","images/star-normal.png")})},I=C+1,L=tn(".star-image-wrapped"),B=L.find(".star-rating-item"),D=tn(".star-option-desec");L.on("mouseover",".star-rating-item",function(){A(tn(this).index()+1)}).on("click",".star-rating-item",function(){if(tn(this).index()+1===I)return!1;I=tn(this).index()+1;var e=parseInt(tn(this).data("option"));f(n.star.options,e,n.remark_enabled,n.remark)}).on("mouseout",function(){A(I)})}var M=("star"===n.show_type,{});Bt.el.on("click",".btn-tg",function(){var e=tn(this);if(e.is(".btn-no")||e.is(".close-survey"))u(),l&&We(),("after_session"===t.methodFlag||"agent_invite"===t.methodFlag&&ii)&&(Un=!0,
nn.showBotomPanel("chat_done"),h(!0)),r();else if(e.is(".btn-yes")){var o=Bt.el.find(".survey-mark").val(),a=Bt.el.find(".survey-btn.active").eq(0),s="";a.length>0&&(s=a.hasClass("survey-btn-yes")?"0":"1");var c=0,d="",p="optional",f=[];if("text"===n.show_type?c=Bt.el.find(":checked").data("option"):"expression"===n.show_type?c=Bt.el.find(".option-expression .selected").data("option"):"star"===n.show_type&&(c=n.star.options[I-1].id),$n)return;if(!c)return nn.showTip(nn.UDL.g("tip.pleaseSurvey"),"error");if(n.resolved_enabled&&a.length<1)return nn.showTip(b.title+nn.UDL.g("tip.rq"),"error");if(tn.each(n[n.show_type].options,function(e){c===this.id&&(p=this.remark_option)}),n.remark_enabled&&"required"===p&&!o.trim())return tn(".survey-mark-wrapped").has(".mark-required").length||tn(".survey-mark-wrapped").append("<span class='mark-required'>"+nn.UDL.g("tip.surveyRemarkRequire")+"</span>"),nn.showTip(nn.UDL.g("tip.surveyRemarkRequire"),"error");if(o&&o.length>200)return nn.showTip(nn.UDL.g("tip.overMaxLength"),"error");e.addClass("disabled"),"text"===n.show_type?d=Bt.el.find(":checked").parent().text():"expression"===n.show_type?d=Bt.el.find(".option-expression .selected").attr("alt"):"star"===n.show_type&&(d=n.star.options[I-1].text),Bt.el.find(".tag-item-active").each(function(){f.push(tn(this).text())}),$n=!0;var m=i.split("_")[1]||t.agent_id||"";M={customer_id:dn.user_id,agent_id:t.agent_id||m||Rn.agent_id,im_sub_session_id:t.im_sub_session_id||Kn,option_id:c,survey_remark:o,type:n.show_type,tags:f.join(","),window_init_time:nn.supportStore("sessionStorage")?sessionStorage.getItem("window_init_time"):void 0},s&&(M.resolved_state_v2=s),g(M)}}).on("click",".agent-retry",function(){g(M)}).on("click",".survey-btn",function(){var e=tn(this);e.hasClass("active")||e.addClass("active"),e.siblings().removeClass("active")})})}function s(e,t,n){void 0===n&&(n={});var i=t.el.find("dd.scrollbar");i.empty();var r="";r="success"===e?['<div class="survey-success-box" style="margin-top: 30px;">','   <p><i class="icon icon-ic-right-circle-duigou1" style="font-size: 80px;color: #29CF73;"></i></p>','   <p style="font-size: 18px;">'+nn.UDL.g("label.surveySubmitSuccess")+"</p>",'   <p style="margin-top: 20px; color: #999;">'+nn.UDL.g("label.submitSuccessTip")+"</p>","</div>"].join(" "):['<div class="survey-error-box" style="margin-top: 30px;">','   <p><i class="icon icon-ic-question-circle-linebeifen" style="font-size: 80px;color: #EA3447;"></i></p>','   <p style="font-size: 18px;">'+nn.UDL.g("label.submitError")+"</p>",'   <p style="margin-top: 20px; color: #999;">'+(n.message||nn.UDL.g("label.submitErrorTip"))+"</p>","</div>","<div>",'<p class="agent-survey-btn">','  <a class="btn-agent-survey survey-error-retry agent-retry">'+nn.UDL.g("label.reTrySubmit")+"</a>","</p>","</div>"].join(" "),i.append(r)}function c(e){nn.messagesEl.find(".show-survey[data-im_sub_session_id="+e+"]").each(function(e,t){tn(t).text(nn.UDL.g("label.hasEvaluation")).off("click").addClass("has-survey").removeClass("show-survey")})}function u(e){console.log("hide"),nn.hideModal(e)}function d(){nn.bottomPanelEl.hide()}function p(t){var n="chatFeedback"===on.stage;n||It.connect(t,{connected:function(){u(),Hn++,L(),f(),I(),B(),J(),qn||ae(on.km_rule_group_id||"",on.km_rule_agent_id||"",{},!0).then(function(e){e||me()}),ki=!1,Hn>1&&(clearTimeout(Lt),Lt=setTimeout(function(){M({isEmpty:!0,data:{mode:"reconnected"}})},Math.ceil(30*Math.random()*1e3))),tn(".tip-bar").hide(),setTimeout(function(){!Ft&&(Ft=e.im.sidebox.getProductData(xn)),Ft&&ie(Ft)},1e3)},disconnected:function(){(qn||hn)&&(Ot=setTimeout(function(){p(t),li=1e3,Si=!1},li||1e3))},connfail:function(e){"shouqianba"===nn.company.subdomain&&nn.log.error("æ¶é±å§æ­çº¿åå æ¶é",{reason:e}),Hn||(clearTimeout(Lt),r("disconnect"))},always:function(e){On={},On[e]=!0},log:nn.log})}function h(e){qn=!1,clearInterval(Rt);try{e&&It.flush(),It.disconnect()}catch(t){}on.company.offline_generate_shut_queue&&it(),e&&clearTimeout(Ot)}function f(){It.receivePresenceListener(function(e){var t=e.attributes,n=t.type||"",i=t.jid,r=e.children;t.curjid||"";if(i!==dn.username)switch(n){case"unavailable":E([Rn.jid],function(e){e&&"off"===e[0][Rn.jid]&&C()});break;default:r.status&&S(r.status.value,i)}})}function g(e,t){V(e,{sessionKey:wn,customer_id:dn.user_id,room_id:t&&t.room_id});var n={type:e,data:{content:cn("event."+e,{name:dn.nick})}},i=K();Q(n,K()),z({msg:n.data.content,type:n.type,msgId:i,msgTime:new Date,created_time:new Date})}function m(e){g("video_call_invitation_accept",{room_id:e}),T(e,"video")}function v(e){g("voice_call_invitation_accept",{room_id:e}),T(e,"audio")}function y(){g("video_call_invitation_deny"),Ai=!1}function b(){g("voice_call_invitation_deny"),Ii=!1}function _(e,t){for(var n="",i=0;i<t;i++)n+=e;return n}function x(e,t,n){if(e.length>=t)return e;var i=_(n,t-e.length);return i.substr(0,t-e.length)+e}function w(e){var t=e+"",n=x(t,6,"0");n.length>6&&(n=n.substring(n.length-6));var i=Math.ceil(99*Math.random())+n;return parseInt(i)}function k(){nn.hideMoreBox(),g("video_call_invitation",{room_id:w(dn.id)});var t=function(){return n.destroy()},n=e.ui.confirm("åèµ·è§é¢éè¯",null,function(){return g("video_call_invitation_cancel")},{icon:"shipin",confirmText:"",title:"å"+Rn.nick,onClosed:function(){e.off("video_call_invitation_accept",t),e.off("video_call_invitation_deny",t),e.off("video_call_invitation_busy",t)},onShown:function(){return Ai=!0}});e.on("video_call_invitation_accept",t),e.on("video_call_invitation_deny",t),e.on("video_call_invitation_busy",t)}function T(e,t){tn.getJSON(vn+"im/mpv_mini_redirection_info",{room_id:e,agent_id:Rn.agent_id,im_msg_type:t}).done(function(e){1e3===e.code&&e.openlink?window.location.href=e.openlink:nn.showTip(e.exception&&e.exception.message||"å¼å¯é³è§é¢éè¯å¤±è´¥","error")})}function S(e,t){return"online"===e&&t===Rn.jid&&(Fn=!0),!0}function C(){return Fn=!1,!0}function E(e,t){tn.get(vn+"im/status",{jids:e},function(e){t&&t(e)})}function A(){try{var e="/im/session_close";setTimeout(function(){tn.post(e,{im_sub_session_id:Kn,customer_id:dn.user_id,session_key:wn}).always(function(e){e&&1e3===e.code&&nn.showBotomPanel("chat_done")})},300)}catch(t){console.log(res)}}function I(){It.receiveMessageListener(function(t){console.log("onmessage",t);var n=t.attributes,i=n.type||"chat",r=n.jid,o=t.children,s=o.delay,c=n.id,l=o.request||null,d=o.received||null,p=o.session||{},h=p.attributes?p.attributes.session_key:"";"default"===h?h="":h;var f,g,_,x=o["input-notice"],w=wn===h;if(!(Kn&&n.im_sub_session_id&&n.im_sub_session_id<Kn)){s&&(g=s.attributes||{},_=g.stamp||"");var k,S,C,E,A,I,L,B,D,M,N,j,O=new Date;_&&(O=_);try{k=tn.parseJSON(o.body.value)}catch(F){}tn.isPlainObject(k)||(k=$e()),n.im_sub_session_id&&w&&(Kn=n.im_sub_session_id||""),k.is_welcome&&!s&&w&&(Kn=k.im_sub_session_id);var U=o.action||{};U.attributes=U.attributes||{};var P=U.value||"",H=U.attributes.type||"",$=U.attributes.source||"";if(!i||"error"!==i)if(Rn.jid||hn||(Rn.jid=r,le(Rn),Pt?fe("agent",Rn):he("agent",Rn)),e.ui.appBar({inputting:""}),clearTimeout(sn.inputNoticeTimer),x)try{x=tn.parseJSON(x.value),"input"===x.type?(e.ui.appBar({inputting:ln("inputting")}),z({isLoading:!0,msgTime:O},!0),sn.inputNoticeTimer=setTimeout(function(){e.ui.appBar({inputting:""})},5e3)):"cancel"===x.type&&tn("dd.item-loading").remove()}catch(F){}else{if("isover"===H)return nn.autoSize(),Y(P,r,h,{actionSource:$,delay:s});if(n.isreqsurvey||o.isreqsurvey){if(!wn&&!h||h&&wn==h)return a({methodFlag:"agent_invite",successFn:u,jid:r,im_sub_session_id:Kn})}else{if("read"===H){var W=$.split(",");return void W.forEach(function(e){Ae(e).find(".msg-read-status .read-status").html(ln("read")).css({color:"rgba(36, 46, 51, .4)"})})}if("video_call_invitation"===H){if(Ai=!0,wn===h){var V=e.ui.confirm("åèµ·è§é¢éè¯",function(){return m(JSON.parse(P).room_id)},function(){return y()},{onClosed:function(){return e.off("video_call_invitation_cancel",V.close)},confirmText:"æ¥å",cancelText:"æç»",icon:"shipin",title:Rn.nick});e.on("video_call_invitation_cancel",V.destroy,V)}return}if("video_call_invitation_accept"===H)return e.fire("video_call_invitation_accept"),void T(JSON.parse(P).room_id,"video");if("video_call_invitation_cancel"===H)return e.fire("video_call_invitation_cancel"),void(Ai=!1);if("video_call_invitation_deny"===H)return e.fire("video_call_invitation_deny"),void(Ai=!1);if("video_call_invitation_hangup"===H)return void(Ai=!1);if("video_call_invitation_busy"===H)return e.fire("video_call_invitation_busy"),void(Ai=!1);if("voice_call_invitation"===H){if(Ii=!0,wn===h){var Q=e.ui.confirm("åèµ·é³é¢éè¯",function(){return v(JSON.parse(P).room_id)},function(){return b()},{onClosed:function(){return e.off("voice_call_invitation_cancel",Q.close)},confirmText:"æ¥å",cancelText:"æç»",icon:"shipin",title:Rn.nick});e.on("voice_call_invitation_cancel",Q.destroy,Q)}return}if("voice_call_invitation_accept"===H)return e.fire("voice_call_invitation_accept"),void T(JSON.parse(P).room_id,"audio");if("voice_call_invitation_cancel"===H)return e.fire("voice_call_invitation_cancel"),void(Ii=!1);if("voice_call_invitation_deny"===H)return e.fire("voice_call_invitation_deny"),void(Ii=!1);if("voice_call_invitation_hangup"===H)return void(Ii=!1);if("voice_call_invitation_busy"===H)return e.fire("voice_call_invitation_busy"),void(Ii=!1)}if(d&&d.attributes)return ke(d.attributes.id,"normal","",d.attributes);if(f="rollback"===k.send_status,l&&n.id&&!f&&Z(n.id,r,h,s),(l||k.monitor)&&n.id&&!f){if(tn.inArray(n.id,Pn)>-1)return;G(n.id)}if(w&&(k.auto&&"market"!==k.push_type&&zn&&!hn&&ce("","","","",!0),S=k.type,C=k.data||{},D="market"===k.push_type,N="sys_welcome_msg"===k.push_type,j="agent_welcome_msg"===k.push_type,E=C.content||"",A=C.duration||"",msgStyle=k.monitor?C.font||k.font:k.font,msgStyle||(msgStyle=""),I=kn.agent_fixed_nickname||n.nick||"",M=k.invitation&&k.inviter?k.inviter.nick_name:"",M&&(I=kn.agent_fixed_nickname||M),msgFormId=k.form_id||"",afterTransferAgent=k.new_agent_name||"","survey"!==S&&"close"!==S)){var X=!1;switch(S){case"redirect":var J=e.id();if(Ci=!0,s){if(be(dn.im_group))return;ce(E.group_id,E.agent_id,{},function(e){tn(".agentName"+J).text(e.nick)})}else ce(E.group_id,E.agent_id,{redirect:!0},function(e){tn(".agentName"+J).text(e.nick)});if(X=!0,tn.get(vn+"/im_sessions/message_display_hide_count",{im_sub_session_id:Kn}).always(function(e){if(e&&1e3===e.code&&e.hide_count!==-1){delete e.code,E=nn.UDL.g("tip.transferSuccess")+',<span class="agentName'+J+'"></span>&nbsp;&nbsp;'+nn.UDL.g("tip.service")+'<p style="color:#666;margin-top: 8px">è½¬æ¥æ¶å·²éèå¯¹è¯ä¸­æææ¶æ¯'+e.hide_count+"æ¡</p>";var t={type:S,msg:E,filename:C.filename||"",filesize:C.filesize||"",fileext:C.fileext||"",msgTime:O};z(t,!0),E&&nn.tipsNewMessage.start(n.nick,"",c)}else X=!1,E=nn.UDL.g("tip.transferSuccess")+',<span class="agentName'+J+'"></span>&nbsp;&nbsp;'+nn.UDL.g("tip.service")}),s){if(be(dn.im_group))return;ce(E.group_id,E.agent_id,{},function(e){tn(".agentName"+J).text(e.nick)})}else ce(E.group_id,E.agent_id,{redirect:!0},function(e){tn(".agentName"+J).text(e.nick)});break;case"rich":E&&nn.tipsNewMessage.start(n.nick,"",c);break;case"form":X=!0,tn.get(vn+"im/im_session_forms/"+msgFormId,{property:"true",im_sub_session_id:Kn}).always(function(e){if(e&&1e3===e.code){delete e.code,L=e,ei["formFields_"+e.id]=L,B=R(L);var t={type:S,msg:B,filename:C.filename||"",filesize:C.filesize||"",fileext:C.fileext||"",msgTime:O};z(t,!0)}E&&nn.tipsNewMessage.start(n.nick,"",c)});break;case"struct":E&&nn.tipsNewMessage.start(n.nick,"",c);break;case"product":E&&nn.tipsNewMessage.start(n.nick,"",c);break;default:E&&nn.tipsNewMessage.start(n.nick,E,c)}if(!X){Mn&&Dn.postNewMsg(E,S);var K={isRecv:!0,type:S,msgId:"struct"===S?(""+c).replace("to_customer",""):c,msg:E,style:msgStyle,filename:C.filename||"",filesize:C.filesize||"",fileext:C.fileext||"",filePreviewUrl:C.previewUrl||"",msgTime:O,senderName:I,send_status:k.send_status,duration:A,fromDelay:!!s};afterTransferAgent?K.senderName=kn.agent_fixed_nickname||afterTransferAgent:C.timeout_freq||D||C.timeout_auto_msg||N?K.senderName=kn.agent_fixed_nickname||kn.system_message_name||nn.UDL.g("label.system"):j&&(K.senderName=I||Rn.nick||""),xn.merchant_id&&(K.senderName=xn.merchant_name),f&&(Ae(c).remove(),q(c)),z(tn.extend({},K),!0),console.log("ãåæ§åºå·ã"+k[Li.key],Li.value)}}}}})}function L(){var e=function(){try{It.sendPresence({attributes:{},children:{name:"status",value:"online",attrs:{}}})}catch(e){}};e(),Dt=setInterval(function(){e()},3e4)}function B(){try{jn.ping.ping(dn.username,function(){},function(){},3e4),jn.ping.addPingHandler(function(e){return jn.ping.pong(e),!0})}catch(e){}}function D(t){return t.msg&&(t.msg=t.msg.replace(/&(#[\d]+)/g,"&amp;$1"),t.msg=nn.replaceLinks(e.xssNotSymbol(t.msg,"&")),t.msg.search("emoji")>-1&&(t.msg=e.ui.emotionToHtml(t.msg)),t.msg.search("/:")>-1&&(t.msg=e.ui.wechatEmotionToHtml(t.msg)),t.msg.search("(\\[).*?(\\])")>-1&&(t.msg=e.ui.wechatEmotionWordToHtml(t.msg))),t}function M(e){e=e||{},nn.getCustomerLogs({data:e.data,isCurrent:!0,cb:function(t,n){if(t.forEach(function(e){return e.invalidTransfer=!0}),nn.showNoticeMsg(),0!=t.length)try{e.isEmpty&&(nn.messagesEl.empty(),on.showedMsgIds=[],n&&n(),nn.showNoticeMsg());var i=on.showedMsgIds||[],r=j(t);tn.each(r,function(e,t){if(t.message_id&&"robot"!==t.session_type){Ae(t.message_id).remove();var n=tn.inArray(t.message_id,i);n>-1&&i.splice(n,1)}if(t.local)t.noScroll=!0,z(t,t.isRecv);else{var r=xe(t.sender),o="";"agent"===t.sender&&"system"===t.status&&(o=kn.system_message_name||nn.UDL.g("label.system")),"monitor"===t.status&&(o=t.user_nick_name);try{var a=JSON.parse(t.content);"survey"===a.type?P({agent_id:t.agent_id,id:t.message_id,im_sub_session_id:t.im_sub_session_id,jid:"",created_at:t.created_at,hasSurvey:!!a.survey_option_id,noScroll:!0}):"customer_close"===a.type?H():z({type:a.type,msg:a.data.content,msgId:t.message_id,senderName:(xn.merchant_id?xn.merchant_name:"")||kn.agent_fixed_nickname||o||t.agent_nick_name,style:a.font?a.font:"",msgTime:t.created_at,filename:a.filename||a.data.filename||"",filesize:a.filesize||a.data.filesize||"",fileext:a.fileext||a.data.fileext||"",filePreviewUrl:a.filePreviewUrl||"",session_type:t.session_type,content_raw:t.content_raw,noScroll:!0,voice_url:a.data.voice_url,read_status:t.read_status,invalidTransfer:t.invalidTransfer,content:t.content,logId:t.logId},r)}catch(s){console.error(s)}}}),N(),nn.animateScrollBottom(),gn.agent_message_display_status||nn.messagesEl.find(".msg-read-status").hide(),e.cb&&e.cb()}catch(o){}}})}function N(){en||(en=!0,!Ft&&(Ft=e.im.sidebox.getProductData(xn)),Ft&&"inner"!==xn.currentMode&&e.isMob()&&e.im.sidebox.init({isInner:!0,container:nn.messagesEl,product:Ft}))}function j(e){for(var t,n,i=0;l=e.length,i<l;i++){var r=e[i];r.message_id;try{var o=JSON.parse(r.content),a=o.data||{},s="assign_queue"===o.type||"leave_message_assign"===o.type||"close"===o.type||"form"===o.type||"form_received"===o.type||"invitation"===o.type||"system"===r.status&&"survey"!==o.type&&!a.timeout_freq&&!a.timeout_auto_msg&&"market"!==o.push_type&&"sys_welcome_msg"!==o.push_type&&"agent_welcome_msg"!==o.push_type||"monitor"===r.status&&"internal"===r.log_type;"robot_transfer"===o.type?t=i:s&&(e.splice(i,1),i--)}catch(c){}}return n=t?e.slice(0,t+1).concat(e.slice(t+1)):e}function R(t){var n,i=[];return di.usePlaceholder=!0,tn.each(t.fields,function(e,t){n=t.content_type?di.customFieldsHandler(t,pi):di.getFieldTpl(di.textFieldTpl(),t),i.push(n)}),di.usePlaceholder=!1,e.joinStr('<div class="ui-form form-msg-box" data-fields-id="'+t.id+'">','   <p class="form-scheme">'+t.scheme+"</p>",'   <form class="form-list">'+i.join("")+"</form>",'   <span class="red"></span>','   <hr class="hr-1" />','   <a class="from-submit-btn" data-submit-success-tip="'+tn("<div></div>").text(t.submit_success_tip||"").html()+'">'+ln("submit")+"</a>","   </a>","</div>")}function O(e,t){t=t||{};var n=0,i=3,r=!1;e&&!function o(a,s){return n++,n>i?s():void tn.ajax({url:vn+"im/im_logs/customer_save",type:"POST",data:a(e),timeout:5e3}).always(function(n){if(1e3!==n.code){if(5013===n.code)return Un=!0,nn.sessionStore("input_text",t.content),void setTimeout(function(){location.reload()},10);!r&&Q(e,t.message_id,{needSave:!1,only_need_save:!0,needCheckReceived:!1}),r=!0,o(a,s)}else s(n)})}(function(e){var n=Rn.agent_id,i=dn.user_id,r={message_id:t.message_id||"",user_id:i,reply_user_type:"customer",content:e};return{last_replier:"customer",agent_id:n,customer_id:i,im_sub_session_id:Kn,platform:"web",reply:r,xmppStatus:On,window_init_time:nn.supportStore("sessionStorage")?sessionStorage.getItem("window_init_time"):void 0}},function(e){t.cb&&t.cb(e)})}function q(e){var t=on.showedMsgIds||[],n=tn.inArray(e,t);n>-1&&t.splice(n,1)}function F(e){var t=on.showedMsgIds||[];return!e||!(tn.inArray(e,t)>-1)&&(t.push(e),on.showedMsgIds=t,!0)}function z(e,t,n){var i=e.msgId||e.message_id,r=e.noScroll||!1,o=F(i);if(!e.fromDelay&&!o)return void(n&&n());e.senderName=e.senderName||kn.agent_fixed_nickname||Rn.nick||ln("system"),nn.messagesEl.find(">.item-loading").remove();var a=U(e,t);if(a){var s=!1;if(gn.agent_message_display_status&&!t){var c=new Date(gn.agent_message_display_status_start_at).getTime(),l=a.data("group-time");s=l<c}(e.read_status||s)&&a.find(".msg-read-status .read-status").html(ln("read")).css({color:"rgba(36, 46, 51, .4)"}),o&&nn.messagesEl.append(a),nn.parseMsgGroupTime(a),!r&&nn.judgeScrollDistance(a),di.fieldHandler(pi,tn(".form-list")),nn.setQueueMsgGoBottom()}return n&&n(),a}function U(t,n,i){var r,o,a=!1,s="icon icon-arrow-left",c="rollback"===t.send_status,l=t.isLoading,u="image"===t.type,d=!0,p=(xn.c_avatar,function(e){return e.replace(/\+/g,"%2B")});if("file"===t.type&&n&&(t.msg=p(t.msg)),"image"===t.type&&n&&(t.msg=p(t.msg)),i=i||{},"robot"===t.session_type)return void on.chatRobot.showMsgByLog(t,{isRecv:n,renderFn:i.renderFn,delayShowWelcomeMsg:i.delayShowWelcomeMsg,invalidTransfer:i.invalidTransfer});if(on.isTransfer&&"robot_transfer"===t.type)return void at(t.msg);if(n?(t.clz="msg-recv",s+="-copy",t.agent_avatar?t.avatarStyle='style="background-image: url('+t.agent_avatar+')"':sn.avatar&&(t.avatarStyle='style="background-image: url('+sn.avatar+')"')):(t.themeBg=u?"":" theme-bg",t.clz="msg-send ",t.avatarStyle='style="background-image: url('+(dn.avatar||kn.sys_customer_logo||"/im_client/images/im_client_customer_header_default.png")+')"'),t.leaveWelcome&&(t.clz+=" leave-msg-welcome"),t.iconClz=s,t.typeClz=t.type||"message",kn.h5Mode_enabled&&n&&(t.agent_avatar?t.avatarStyle='style="background-image: url('+t.agent_avatar+')"':sn.avatar&&(t.avatarStyle='style="background-image: url('+sn.avatar+')"')),c)r=tn(ui.titleRadiusItemTpl({msg:nn.UDL.g("label.withdrawed",{agent:t.senderName})}));else if(l)r=tn(ui.loadingTpl(t));else{var h=nn.orderedCuttingGroupTime({time:t.msgTime,isRecv:n||!1,senderName:t.senderName});switch(t.type){case"image":o=ui.imgItemTpl(Mn,{clz:"no-group",groupTime:h,read_status:t.read_status});break;case"file":if(!e.isAllIE()&&tn.inArray(t.fileext,e.canVideoExts)>-1)o=ui.videoItemTpl({read_status:t.read_status});else{var f=t.filePreviewUrl||nn.checkFileCanPreview(t.msg);f&&(t.file_pre=f),o=ui.fileItemTpl(f,t.msg,{noDownload:!n,isRecv:n,clz:"no-group",groupTime:h,read_status:t.read_status,avatarStyle:t.avatarStyle})}break;case"audio":t.clz+=" no-group";break;case"video":o=e.ifIE(9,"lt")?ui.fileItemTpl("",t.msg,{noDownload:!n,isRecv:n,themeBg:t.themeBg,read_status:t.read_status}):ui.videoItemTpl({read_status:t.read_status});break;case"uploading":o=ui.uploadingTpl();break;case"redirect":o=ui.titleItemTpl("event-redirect"),a=!1;break;case"reassign":o=ui.titleRadiusItemTpl({msg:t.msg}),a=!1;break;case"rich":e.isPC()&&nn.innerController.isInnerMode&&(t.msg=nn.formatImgContent(t.msg)),t.msg.search("/:")>-1&&(t.msg=e.ui.wechatEmotionToHtml(t.msg)),a=!1;break;case"form":a=!1,d=!1;break;case"struct":o=ui.structTpl(t.msg,{read_status:t.read_status}),a=!1;break;case"vcall":case"video_call_invitation":case"video_call_invitation_accept":case"video_call_invitation_deny":case"video_call_invitation_cancel":case"video_call_invitation_hangup":case"video_call_invitation_busy":o='<dt class="msg-'+t.type+'"><h5>{msgTime}</h5><p><span class="event-bar">{msg}</span></p></dt>',a=!1;break;case"voice_call_invitation":case"voice_call_invitation_accept":case"voice_call_invitation_deny":case"voice_call_invitation_cancel":case"voice_call_invitation_hangup":case"voice_call_invitation_busy":o='<dt class="msg-'+t.type+'"><h5>{msgTime}</h5><p><span class="event-bar">{msg}</span></p></dt>',a=!1;break;case"product":o=ui.productTpl(t.msg,{read_status:t.read_status});break;case"robot_transfer":o=ui.titleRadiusItemTpl({msg:t.msg}),a=!1;break;case"unreadMessage":o=ui.unreadMessageTpl({msg:t.msg}),a=!1;break;case"customer_close":o=ui.costomerCloseTpl(),a=!1;break;default:a=!0}o||(o=ui.msgItemTpl({groupTime:d?h:"",read_status:t.read_status})),t.msgTime=nn.formatDateTime(t.msgTime||t.created_at),t=tn.extend({},t,{moreHtml:t.moreHtml||"",style:t.style||"",themeBg:t.themeBg||""}),r=tn(e.replaceTpl(o,a?D(t):t))}return i.renderFn&&i.renderFn(r),n&&r.find(".read-status").hide(),r}function P(e){var t='<i class="icon icon-good"></i> &nbsp;'+nn.UDL.g("label.survey"),n=e.hasSurvey?nn.UDL.g("label.hasEvaluation"):nn.UDL.g("label.evaluation"),i=e.hasSurvey?"has-survey":"show-survey";if(!F(e.msgId))return void(cb&&cb());nn.orderedCuttingGroupTime();var r=ui.surveyTpl(tn.extend({},{clz:"",msgTime:nn.formatDateTime(e.created_at||new Date),iconText:t,surveyClass:i,surveyText:n,agent_id:e.agent_id||Rn.agent_id,im_sub_session_id:e.im_sub_session_id||Kn,jid:e.jid||"",history:e.history||""},e));return e.needStr?r:(nn.messagesEl.append(r),void nn.animateScrollBottom())}function H(){var e=ui.costomerCloseTpl();nn.messagesEl.append(e),nn.animateScrollBottom()}function $(e){var t=nn.messagesEl.find(".queue-event");if(t.size()>0)return void t.find(".queue-tip").text(e.msg);var n=new Date,i='<span class="queue-tip">'+e.msg+"</span>",r=bn?'<a class="goFeedbackBtn">'+nn.UDL.g("label.leaveMsg")+"</a>":"",o=ui.queueTpl(tn.extend({},{clz:"",msgTime:nn.formatDateTime(n),queueText:i,leaveText:r,groupTime:nn.orderedCuttingGroupTime({time:n,isRecv:!1})},e));return e.needStr?o:(nn.messagesEl.append(o),nn.animateScrollBottom(),on.chatRobot.tryShowBtnTransfer(),void tn(".goFeedbackBtn").off("click").on("click",function(){nn.hideMoreBox(),nn.goFeedback({hideBoardAll:!0,cb:function(){h()}})}))}function W(){var e="noWordtimeEventMsg";return tn("#"+e).remove(),on.chatRobot&&on.chatRobot.tryShowBtnTransfer(),bn?void tn.get(vn+"im/web_im_feedbacks/setting_templet",xn,function(t){if(1e3===t.code){var n=t.setting||{},i="im"===n.leave_message_type?n.im_offwork_hint:n.digest2;an.messages.append(ui.titleRadiusItemTpl({id:e,msg:(""+i).replace(/(^<p>)|(<\/p>$)/g,"")+' <a class="btn-feedback">'+ln("leaveMsg")+"</a>"})),nn.goBottom()}}):(an.messages.append(ui.titleRadiusItemTpl({id:e,msg:_n?(""+_n).replace(/(^<p>)|(<\/p>$)/g,"")+"":nn.UDL.g("tip.noAgentOnline")})),nn.goBottom(),!1)}function V(e,t){var n=t.sessionKey,i=_objectWithoutPropertiesLoose(t,_excluded),r=[{name:"action",value:_extends({im_sub_session_id:parseInt(Kn)},i),attributes:{xmlns:"udesk:action",type:e}}];n&&r.push({name:"session",value:"session",attributes:{xmlns:"udesk:session",type:"session",platform:"web",session_key:n}}),It.sendMessage({attributes:{id:K(),im_sub_session_id:Kn},children:r})}function Q(t,n,i){i=i||{};var r,o=!("needSave"in i)||i.needSave,a=!("needReceived"in i)||i.needReceived,s=!("needCheckReceived"in i)||i.needCheckReceived,c="only_need_save"in i&&i.only_need_save,l=i.session_key||wn,u=[];if(clearTimeout(Mt),t){if("string"==typeof t)try{t=JSON.parse(t)}catch(d){}if(tn.isPlainObject(t)){if(o?t.no_need_save=!0:t.no_need_save=!1,t.im_sub_session_id=t.im_sub_session_id||Kn,c&&(t.only_need_save=!0),s&&(t[Li.key]=Li.increment()),r=t.data?t.data.content:"",t.data&&t.data.content){var p=t.type||"";"message"===p&&(t.data.content=e.xssNotEnter(r))}t=JSON.stringify(t)}}u.push({name:"body",value:t}),i.children&&(u=u.concat(i.children)),(a||s)&&u.push({name:"request",value:"",attributes:{xmlns:"urn:xmpp:receipts"}}),l&&u.push({name:"session",value:"session",attributes:{xmlns:"udesk:session",type:"session",platform:"web",session_key:l}}),It.sendMessage({attributes:tn.extend({id:n},i.attributes),children:u}),o&&O(t,{message_id:n,content:r,cb:function(e){var t=e.im_log,r={};try{r=JSON.parse(t.content)}catch(o){}if("file"===r.type){var a=nn.messagesEl.find("[data-msgid="+n+"]"),s=a.find(".preview-btn");s.length>0&&s.attr("href",nn.checkFileCanPreview(r.data.content))}i.onSaveSuccess&&i.onSaveSuccess(e)}}),s&&Ce(t,n)}function X(){gn.ejd_reconnect&&!On.disconnected&&(li=100,Si=!0,It.disconnect())}function J(){Rn.jid&&Q($e({type:"private"}),"",{needSave:!1,needReceived:!1,needCheckReceived:!1})}function G(e){Pn.push(e)}function K(){return e.guid("msg",wn)}function Y(e,t,n,i){if(("overtest"===e||"over"===e)&&n==wn){if(Dn.postMsg({type:"chatDone"}),ii=!0,t!==Rn.jid)return;"timeout"!==i.actionSource&&"reassign"!==i.actionSource||!Nt.sys_close_reminded?Ve(function(){jt?(Un=!0,nn.showBotomPanel("chat_done"),!i.delay&&h(!0)):a({methodFlag:"after_session",needCloseWin:!1,im_sub_session_id:Kn,noAuthFn:function(){Un=!0,nn.showBotomPanel("chat_done"),!i.delay&&h(!0)}})}):(Un=!0,nn.showBotomPanel("chat_done"),!i.delay&&h(!0))}return!0}function Z(e,t,n,i){e&&(n&&n!=wn?setTimeout(function(){ee(e,t,n,i)},500):ee(e,t,n,i))}function ee(e,t,n,i){var r="";!n||i?r="":!i&&n&&n!=wn?r="offline":!i&&n&&n==wn&&(r=""),Q("","",{needSave:!1,needReceived:!1,needCheckReceived:!1,attributes:{to:t},children:[{name:"received",value:"",attributes:{xmlns:"urn:xmpp:receipts",id:e,status:r,is_self:n==wn}}]})}function te(){Gn.off("input propertychange"),Gn.on("input propertychange",function(){nn.setBtnSendActive();var e=$e({content:Gn.val()});clearTimeout(Mt),Mt=setTimeout(function(){ne(e)},300)})}function ne(e){Q(e,"",{needSave:!1,needReceived:!1,needCheckReceived:!1,children:[{name:"premsg",value:"",attributes:{xmlns:"udesk:premsg",premsg:"true"}}]})}function ie(e){e&&e.hideMsgTip&&delete e.hideMsgTip,Q("","",{needReceived:!1,needCheckReceived:!1,children:[{name:"product",value:JSON.stringify({data:e,type:"product",platform:"web",im_session_id:Yn})}]})}function re(e,t,n,i){e=e||"",t=t||"",n=n||{},"agent"===nn.chat_creator&&(n.active_guest=nn.chat_creator),"agent"===nn.chat_creator||dn.chatting||nn.invited||(n.ask_chatting=!0),n.web_plugin_id=xn.web_plugin_id||"",Xt=tn.extend({group_id:e,agent_id:t,customer_jid:dn.username,session_key:wn,menu_id:n.menu_id,needLoading:!0,window_init_time:nn.supportStore("sessionStorage")?sessionStorage.getItem("window_init_time"):void 0},n),tn.get(vn+"im/pre_sessions",Xt).always(function(e){e=e||{},tn.each(e.im_logs||[],function(e,t){var n=xe(t.sender);if(!on.isTransfer)try{var i=JSON.parse(t.content);z({type:i.type,msg:i.data.content,msgId:t.message_id,senderName:(xn.merchant_id?xn.merchant_name:"")||kn.agent_fixed_nickname||t.agent_nick_name||kn.system_message_name||nn.UDL.g("label.system"),style:i.font?i.font:"",msgTime:t.created_at,filename:i.filename||i.data.filename||"",filesize:i.filesize||i.data.filesize||"",fileext:i.fileext||i.data.fileext||"",session_type:t.session_type,voice_url:i.data.voice_url,duration:i.duration||t.duration||""},n)}catch(r){}}),!e.is_worktime&&W(),i&&i()}),he("agent",{}),nn.messagesEl.find("dt").removeClass("hide"),u(),d()}function oe(e){var t=new RegExp("(^|&)"+e+"=([^&]*)(&|$)","i"),n=window.location.search.substr(1).match(t);return null!=n?unescape(n[2]):null}function ae(t,n,i,r){void 0===r&&(r=!1);var o=tn.Deferred(),a={customer_id:dn.user_id,im_web_plugin_id:xn.web_plugin_id,agent_id:t||xn.agent_id,group_id:n||xn.group_id,menu_id:i.menu_id||on.menu_id};return on.isTransfer||"true"===oe("transfer")||"agent"===nn.chat_creator?(tn(".appbar-right").append('<a class="btn-transfer icon icon-ic-customer-service-kefu" id="btnTransfer" data-act="transfer"><span>'+cn("agent.transfer")+"</span></a>"),o.resolve(!1)):(tn.get(vn+"im/confirm_manual_reception_strategy",a).always(function(t){if(t=t||{},"enable_robot"!==t.result||"ignore"===t.result)return o.resolve(!1);if(!r){nn.company.robot=t.robot_info,an.btnEmotion.hide(),an.btnFile.hide(),an.btnScreenShot.hide();var n=e.chatRobot.create();tn("body").addClass("robot "+(t.robot_info?t.robot_info.channel:"")),e.setContext({stage:"robot",hasRobot:!0,isRobotChat:!0,chatRobot:n,company:nn.company,robotConfig:t.robot_info}),n.init(),setTimeout(function(){t.robot_info.manual_reception_strategy.manual_strategy_robot_msg&&an.messages.append(ui.titleRadiusItemTpl({id:sn.transferEventMsgId,msg:t.robot_info.manual_reception_strategy.manual_strategy_robot_msg})),0===t.robot_info.show_robot_times&&t.robot_info.enable_agent?tn(".appbar-right").append('<a class="btn-transfer icon icon-ic-customer-service-kefu" id="btnTransfer" data-act="transfer" style="display: flex;"><span>'+cn("agent.transfer")+"</span></a>"):tn(".appbar-right").append('<a class="btn-transfer icon icon-ic-customer-service-kefu" id="btnTransfer" data-act="transfer"><span>'+cn("agent.transfer")+"</span></a>"),nn.goBottom()},1500),o.resolve(!0)}}),o.promise())}function se(){var e=new Date,t=e.getMonth()+1,n=e.getDate();t>=1&&t<=9&&(t="0"+t),n>=0&&n<=9&&(n="0"+n);var i=e.getFullYear()+"-"+t+"-"+n+" "+e.getHours()+":"+e.getMinutes()+":"+e.getSeconds();return i}function ce(t,n,i,o,a,s){t=on.km_rule_group_id||t||"",n=on.km_rule_agent_id||n||"",i=i||{},!i.isTimerOn&&on.menu_id&&i.menu_id&&i.menu_id!==on.menu_id?(it(),on.menu_id=i.menu_id):!i.isTimerOn&&i.menu_id&&dn.queueing?(it(dn.queue_name),on.menu_id=i.menu_id):!i.isTimerOn&&i.menu_id&&(on.menu_id=i.menu_id),on.menu_id_leave=i.menu_id,"agent"===nn.chat_creator?i.active_guest=nn.chat_creator:"sys"===xn.sender&&(i.active_guest="sys"),nn.invited&&(i.invite_guest=!0),"agent"===nn.chat_creator||dn.chatting||nn.invited||(i.ask_chatting=!0),i.web_plugin_id=xn.web_plugin_id||"",zt=tn.get(vn+"im/agent",tn.extend({group_id:t||xn.group_id,agent_id:n||xn.agent_id,customer_jid:dn.username,session_key:wn,h5push:xn.h5push,menu_id:i.menu_id,needLoading:!0,window_init_time:nn.supportStore("sessionStorage")?sessionStorage.getItem("window_init_time"):void 0,merchant_name:xn.merchant_name,merchant_avatar:xn.merchant_avatar},i)).always(function(s){if(delete on.km_rule_group_id,delete on.km_rule_agent_id,s=s||{},Vn=!1,zn=!1,Jt=!1,Rn=s.agent||{},s.exception)return r("error");switch(s.code){case 2e3:Gt&&fn&&Yt&&(sn.hasInitFooter=!1,Kt=!1,on.chatRobot.destroy(),Gt=!1);var c=encodeURIComponent(null),l={email:c,im_sub_session_id:c};s.agent&&s.agent.email&&(l=_extends({},l,{email:s.agent.email})),s.im_sub_session_id&&(l=_extends({},l,{im_sub_session_id:s.im_sub_session_id})),Zn=l,ve(s,o);break;case 2001:if(Yt||(Yt=!0,fn?(sn.hasInitFooter=!1,on.chatRobot.initFooter()):(Xe(),_t("queuingPage"))),hn=!1,vi++,zn=!0,Pt=!0,Dn.postMsg({type:"queuing"}),on.isTransfer&&!Ei){++Ei;var d=0;d=on.transferStatus?-1:-2,2===on.switchStaffType&&(d=-3);var p={s:"transfer_route",sessionId:on.sessionId,sessionLogId:on.sessionLogId,transferRoute:d,isHit:!on.transferStatus,timestamp:se(),isSwitchStaff:1,im_web_plugin_id:xn&&xn.web_plugin_id,window_init_time:nn.supportStore("sessionStorage")?sessionStorage.getItem("window_init_time"):void 0};tn.get("/udesk_im/aifaq/v1/web_proxy",p),on.switchStaffType=""}if(vi<2?(!on.isTransfer&&_t("queuingPage"),u(),je(function(){nn.animateScrollBottom(),Bi&&Bi<s.location||$({type:"queue",msg:s.message||[]})})):(!Bi||Bi>=s.location)&&$({type:"queue",msg:s.message}),Bi=Math.min(isNaN(Bi)?s.location:Bi,s.location),nn.setBtnSendActive(),on.isTransfer||(fe("agent",{}),nn.last_im_session_id&&nn.showHistoryTip("moreMsg")),e.ui.appBar.removeBackBtn(),e.setContext({stage:"queue"}),on.queueStr=s.queue,nn.stopQueuing)return;a||(clearTimeout(on.getAgentTimer),on.getAgentTimer=setTimeout(function(){zn&&ce(t,n,tn.extend(i,{needLoading:!1,isTimerOn:!0
}),o)},8e3));break;case 2002:if(Pt&&!Ut)return Ut=!0,clearTimeout(on.getAgentTimer),void(on.getAgentTimer=setTimeout(function(){ce(t,n,tn.extend(i,{needLoading:!1,isTimerOn:!0}),o)},5e3));if(on.menu_id="",on.queueStr="",ye(3),!s.is_worktime)return void W();h(!0),nn.goFeedback({noAnimate:!0,replace:!0,btnBack:!0,onBack:function(){return tn(window).off("beforeunload"),xn.backbutton?location.href=xn.backbutton:location.reload(),!1}});break;default:on.menu_id="",on.queueStr="",r("error"),h(!0),e.setContext({stage:"error"})}})}function le(e){e&&(e.username||e.jid)&&(Rn=e||{},It&&It.setToUser(Rn))}function ue(){e.isPC()&&!Ln||e.isMob()&&!Bn||(tn("#header").addClass("stage-agent"),nn.setHeaderTitleBoxWith(),tn("body").off("click.close").on("click.close",".btn-customer-close",function(){var t=[];t.push(['<div style="height: 100px;display: flex;justify-content: center;align-items: center;margin-top: 20px">','<img src="/im_client/images/close_c.png" style="width:60px" />',"</div>",'<div style="text-align: center;color: #797979;">'+cn("tip.customerClose")+"</div>",'<p class="btnbar clearfix">','  <a class="btn btn-danger btn-tg">'+cn("tip.closeChat")+"</a>","</p>"].join("")),Bt=e.common.modal=e.ui.modal({clz:"customerClose",container:e.common.mainEl,title:"",content:t.join(""),contentClz:"colseFooter",needClose:!0}),Bt.el.on("click",".btn-tg",function(){var e=tn(this);e.is(".btn-danger")&&A(),an.btnSend&&an.btnSend.off("click"),an.btnEmotion&&an.btnEmotion.off("click"),an.btnScreenShot&&an.btnScreenShot.off("click"),nn.setBtnSendActive(!1),tn(".textbox > textarea").attr("disabled",!0),an.btnFile&&an.btnFile.find("input").attr("disabled",!0),nn.hideModal(),H()})}))}function de(t){var n=nn.innerController.isInnerMode;n||e.isMob()||!t||(yn?pe(yn,t):nn.getSideBoxData(function(e){pe(e,t)}))}function pe(t,n){var i;tn.each(t.side_data,function(e,t){"agent_card"===t.key&&t.enable&&(i=!0)}),i&&e.im.sidebox.init({container:nn.sideBoxEl,need_clear:!0,side_data:t.side_data,right_width:t.data.right_width,im_sub_session_id:n,product:e.im.sidebox.getProductData(xn),after:function(e){if(e){var t;nn.bodyEl.removeClass("fullscreen").addClass("side"),t={right:Math.min(nn.sideBoxEl.width(),tn("#main").width()/2)+2,width:"auto"},nn.contentEl.css(t),nn.footerEl.css(t),nn.bottomPanelEl.css(t),nn.isWindowCenter&&nn.abjuctCenterBox(null,!0)}}})}function he(e,n){fe(e,tn.extend({},n,{appBar:{btnBack:!!xn.backbutton||xn.showback,onClick:function(e){"back"===e&&(xn.showback||"default"===xn.backbutton?t.history.back():t.location.href=xn.backbutton)}}}))}function fe(t,n){var i="",r="",o="";if(n=n||{},i=(xn.merchant_id?xn.merchant_name:"")||n.nick||n.title||kn.frame_title||cn("agent.onlineAg"),o=(xn.merchant_id?xn.merchant_avatar:"")||n.avatar||kn.sys_agent_logo||kn.logo_url||"images/default_head.png",!hn&&"chatFeedback"!==on.stage){var a=/<\/?.+?\/?>/g;r=kn.agent_descript?n.desc&&n.desc.replace(a,""):kn.agent_introduce}"agent"===t&&(nn.store("agent_nick",n.nick),i===sn.title&&sn.avatar===o||(sn.title=kn.agent_fixed_nickname||i,sn.avatar=kn.agent_avatar||o)),e.ui.config({appBar:{btnBack:!1,title:"string"==typeof kn.navibar_fixed_nickname?kn.navibar_fixed_nickname:i,desc:r,avatar:"logo"===kn.header_avatar_type?kn.logo_url:o}}),e.ui.appBar(n.appBar)}function ge(e,t,n,i,r){return e=e||"",t=t||"",n=n||{},i=i||!1,i?(N(),_t("show_pre_session"),re(e,t,n,r)):ce(e,t,n,r)}function me(){var e=xn.group_id||"",t=xn.agent_id||"";return dn.chatting&&(Rn&&!tn.isEmptyObject(Rn)||pn)?ve(tn.isEmptyObject(Rn)?pn:Rn):dn.chatting?ge(e,t,{},hn):e||t?ge(e,t,{},hn):void 0}function ve(t,n){if(hn=!1,Jt=!1,Pt=!1,qn=!0,on.queueStr="",t.im_sub_session_id&&(Kn=t.im_sub_session_id),t.im_session_id&&(Yn=t.im_session_id),on.menu_id="",e.setContext({stage:"agent"}),nn.initCustomButtons("agent",function(e){ze(null,{content:e})}),_t("agent",{showVideoCallButton:t.react_workbench&&kn.buttons_enable.company_vcall&&kn.buttons_enable.mobile.vcall}),nn.setBtnSendActive(),le(t.agent),t.nick||he("agent",t.agent),ue(),nn.messagesEl.find("dt").removeClass("hide"),on.isTransfer&&!t.needLoadLog||Ci?(Ci&&(Ci=!1),N()):Be(),de(Kn),Se(),nn.clearOfflineCount(),u(),d(),ye(1),!Ft&&(Ft=e.im.sidebox.getProductData(xn)),setTimeout(function(){ie(Ft)},1e3),Mn&&(Dn.postAgentInfo(t.agent),Dn.postMsg({type:"chatting"})),dn.chatting=!0,n&&n(t.agent),ct(),an.messages.find(".queue-event").remove(),Xe(),te(),st(),(Cn||En||An||In)&&Je(),on.isTransfer){at(cn("agent.transferred"));var i=0;i=on.transferStatus?-1:-2,2===on.switchStaffType&&(i=-3);var r={s:"transfer_route",sessionId:on.sessionId,sessionLogId:on.sessionLogId,transferRoute:i,isHit:!on.transferStatus,timestamp:se(),isSwitchStaff:1,im_web_plugin_id:xn&&xn.web_plugin_id,window_init_time:nn.supportStore("sessionStorage")?sessionStorage.getItem("window_init_time"):void 0};tn.get("/udesk_im/aifaq/v1/web_proxy",r),on.switchStaffType=""}}function ye(e){xi&&(nn.sessionStore(bi,""),nn.doTransferTurnPage(e,xi))}function be(e){var t=e.group_menus||{};return!!(e.enable&&t.items&&t.items.length>0)}function _e(){var e=tn.Deferred(),t=dn.im_group;return t?e.resolve(t):tn.get(vn+"im/im_group",{im_web_plugin_id:xn.web_plugin_id}).always(function(t){t=t||{},e.resolve(t.data)}),e.promise()}function xe(e){return nn.isRecvMsg(e)}function we(e,t,n,i){tn.inArray(e,Jn)===-1&&Jn.push(e),t.hide(),n.show(),n.click(function(){Ie(e)||(Q(i,e),ke(e,"wait"),n.off("click"))})}function ke(e,t,n,i){i=i||{};var r=Ae(e),o=r.find(".wait-img"),a=r.find(".fail-img"),s=function(){a.hide(),o.show()};switch(t){case"wait":i.failFn?Te(e,{successFn:function(t){var n=tn.unique(t.message_ids||[]);tn.inArray(e,n)>-1?(a&&a.hide(),o&&o.hide(),r&&r.attr("data-received",1)):(s(),i.failFn())},errorFn:function(){s(),i.failFn()},needTimeout:!0,needReConnect:!0,needReloadLog:!0}):s();break;case"fail":Te(e,{successFn:function(t){var i=tn.unique(t.message_ids||[]);tn.inArray(e,i)>-1?(a&&a.hide(),o&&o.hide(),r&&r.attr("data-received",1)):we(e,o,a,n)},errorFn:function(){we(e,o,a,n)},needTimeout:!0,needReConnect:!0,needReloadLog:!0});break;case"normal":a&&a.hide(),o&&o.hide(),r&&r.attr("data-received",1);break;default:a.hide(),o.hide()}return!0}function Te(e,t){t=t||{};var n,i="/spa1/im/im_logs/customer_send";n="string"==typeof e?[e]:e,setTimeout(function(){tn.post(i,{im_sub_session_id:Kn,message_ids:n}).always(function(e){!e||1e3!==e.code&&5103!==e.code?t.errorFn&&t.errorFn():(t.successFn&&t.successFn(e),t.needReConnect&&X(),t.needReloadLog&&M({isEmpty:!0,data:{mode:"customer_send"}}))})},t.needTimeout?300:50)}function Se(){clearInterval(Rt),Rt=setInterval(function(){Jn=tn.unique(Jn),Jn.length>0&&Te(Jn,{successFn:function(e){Jn=tn.unique(Jn);for(var t=tn.unique(e.message_ids||[]),n=tn.unique(e.err_message_ids||[]),i=0,r=t.length;i<r;i++)ke(t[i],"normal");for(var i=0;r=Jn.length,i<r;i++){var o=Jn[i];if(!o)return;n.indexOf(o)>-1?(Jn.splice(i,1),i--):t.indexOf(o)>-1&&(Jn.splice(i,1),i--)}}})},1e4)}function Ce(e,t,n){return n=n||"first","first"===n?setTimeout(function(){return On.connected&&It._connection.connected?void(Ie(t)||ke(t,"wait","",{failFn:function(){Ee(e,t,1)}})):ke(t,"fail")},1e3):Ie(t)?ke(t,"normal"):ke(t,"fail",e)}function Ee(e,t,n){return n<=5?void setTimeout(function(){return On.connected?Ie(t)?ke(t,"normal"):void Te(t,{successFn:function(i){var r=tn.unique(i.message_ids||[]);tn.inArray(t,r)>-1||(Q(e,t,{needSave:!1,needReceived:!0,needCheckReceived:!1}),Ee(e,t,n+1))},errorFn:function(){Q(e,t,{needSave:!1,needReceived:!0,needCheckReceived:!1}),Ee(e,t,n+1)},needReloadLog:!0}):ke(t,"fail")},3e3):Ce(e,t,"last")}function Ae(e){return nn.messagesEl.find('[data-msgId="'+e+'"]')}function Ie(e){return 1==Ae(e).attr("data-received")}function Le(e,t){!Jt&&hn&&ce("","",Xt,t)}function Be(){setTimeout(function(){M()},100)}function De(t){var n;if("string"==typeof t)try{t=JSON.parse(t)}catch(i){}if(tn.isPlainObject(t)){if(n=t.data?t.data.content:""){var r=t.type||"";"message"===r&&(t.data.content=e.xssNotEnter(n))}t=JSON.stringify(t)}return t}function Me(e,t,n){if(Gt=!0,!e||!t)return n&&n();var i="/spa1/im/pre_sessions/msg";tn.post(i,{msg:e,msg_id:t,customer_id:dn.user_id,session_key:wn,timeout:2e3,msg_mode:"pre_session",local:!0,window_init_time:nn.supportStore("sessionStorage")?sessionStorage.getItem("window_init_time"):void 0}).always(function(i){i=i||{},1e3==i.code?(Vn=!1,gi=0,n&&n()):6e3==i.code?(Vn=!1,gi=0,n&&n()):gi<2?(Me(e,t,n),gi++):(Vn=!1,nn.setBtnSendActive(),gi=0,n&&n())})}function Ne(e,t){if(nn.findValueInArr(t,yi)||yi.push(t),!e||!t)return cb&&cb();var n="/spa1/im/pre_sessions/msg";tn.post(n,{msg:e,msg_id:t,customer_id:dn.user_id,session_key:wn,timeout:2e3,msg_mode:"queue",local:!0,window_init_time:nn.supportStore("sessionStorage")?sessionStorage.getItem("window_init_time"):void 0}).always(function(n){n&&1e3==n.code?mi=0:n&&9200==n.code?(nn.showTip(n.message,"warn"),mi=0):n&&6e3==n.code?ce("","","","","",{source:"queue",msgId:t}):mi<2&&(Ne(e,t),mi++)})}function je(e){var t="/spa1/im/pre_sessions/msg";tn.get(t,{customer_id:dn.user_id,session_key:wn,window_init_time:nn.supportStore("sessionStorage")?sessionStorage.getItem("window_init_time"):void 0}).always(function(t){t&&1e3==t.code?Re(t,e):nn.showTip("å è½½æ¶æ¯å¤±è´¥,è¯·å·æ°éè¯")})}function Re(t,n){tn.each(t.im_logs||[],function(t,n){"customer"!==n.sender||nn.findValueInArr(n.message_id,yi)||yi.push(n.message_id);var i=xe(n.sender),r="";try{var o=JSON.parse(n.content),a=o.data.content;"message"===o.type&&a&&(o.data.content=e.unXssNotEnter(a))}catch(s){}"agent"===n.sender&&"system"===n.status&&(r=nn.UDL.g("label.system")),z({noScroll:!0,type:o.type,msg:o.data.content,msgId:n.message_id,senderName:(xn.merchant_id?xn.merchant_name:"")||kn.agent_fixed_nickname||r||n.agent_nick_name,style:o.font?o.font:"",msgTime:n.created_at,filename:o.filename||o.data.filename||"",filesize:o.filesize||o.data.filesize||"",voice_url:o.data.voice_url,duration:o.duration||n.duration||""},i)}),n&&n()}function Oe(e,t,n){return yi.length>19?(nn.showTip("æéé¡µé¢æå¤åé20æ¡æ¶æ¯!","warn"),!0):(Ne(e,t),!1)}function qe(){for(var e=window.location.search.slice(1).split("&"),t=e.length,n={},i=0;i<t;i++){var r=e[i].split("=");n[r[0]]=r[1]}return n}function Fe(t,n){var i="/spa1/im/message_board_save";if(t&&n){var r={};try{"string"==typeof t&&(r=JSON.parse(t))}catch(o){}var a=qe();tn.post(i,{web_plugin_id:xn.web_plugin_id||"",message_id:n,content:t,msg_type:r.type||"message",session_key:wn,menu_id:on.menu_id_leave,agent_id:a.agent_id||"",group_id:a.group_id||""}).always(function(t){t=t||{},"6000"==t.code&&(clearInterval(wi),e.setContext({stage:"agent"}),On.connected||(ki=!0,p(dn)),tn.isEmptyObject(Rn)&&(t.needLoadLog=!0,ve(t)))})}}function ze(t,n){rn.indexOf(dn.user_id)>-1&&e.log.error("sendHandler",{user:dn.user_id,text:tn.trim(Gn.val()),xmpp:It&&It._connection?It._connection.connected:"",connectStatus:On}),n=n||{};var i=tn.trim(Gn.val());i=e.ui.wordToCode(i);var o=n.content||i,a=n.type?"text"===n.type?"":n.type:"",s=K(),c=new Date,l="chatFeedback"===on.stage;if(o){var u=function(){if(rn.indexOf(dn.user_id)>-1&&e.log.error("sendHandlerSuccess",{user:dn.user_id,text:o,xmpp:It&&It._connection?It._connection.connected:"",connectStatus:On,msgType:a}),!a&&"product"!==a)for(var t=0,i=Qn.length;t<i;t++){var u,d=Qn[t];u=Xn.customer_match_case?new RegExp(d,"mg"):new RegExp(d,"img");for(var p=d.length,h="";h.length<p;)h+="*";o=o.replace(u,h)}var f=$e({content:o,type:a,voice_url:n.voice_url||"",read_status:!1});if(!On.connected&&!Pt&&!l)return void r(Si?"reConnectError":"error");if(rn.indexOf(dn.user_id)>-1&&e.log.error("sendHandlerBeforeSend",{user:dn.user_id,text:o,xmpp:It&&It._connection?It._connection.connected:"",connectStatus:On,show_pre_session:hn,queuingPage:Pt,chatFeedback:l}),hn){Vn=!0,nn.setBtnSendActive(!1),setTimeout(function(){Vn=!1,nn.setBtnSendActive()},3e3);var g=De(f);Me(g,s,function(){Le(f,function(e){Jt=!1}),Jt=!0})}else if(Pt){var g=De(f);if(Oe(g,s))return}else if(l){var g=De(f);if(ki)return;Fe(g,s)}else Q(f,s);z({msg:o,type:a,msgId:s,msgTime:c,created_time:+new Date,local:!0,voice_url:n.voice_url,duration:f.duration||""},!1),Gn.val("").height(qt),!Pt&&ne($e({content:""})),Gn.trigger("autosize:resized"),oi.hide(),nn.setBtnSendActive(),Dn.postMsg({type:"sendMsg"})},d=function(t){rn.indexOf(dn.user_id)>-1&&e.log.error("sendHandlerError",{user:dn.user_id,text:o,xmpp:It&&It._connection?It._connection.connected:"",connectStatus:On,errorMsg:t}),t&&"check_sensitivity_failed"===t.message?an.txtMsg.val(""):(Wn=!0,nn.setBtnSendActive(!1),setTimeout(function(){Wn=!1,nn.setBtnSendActive()},3e3)),oi.hide(),nn.setBtnSendActive()};return l?void Ue(o,a).then(u,d):e.ifIE(9,"lte")&&!On.connected?void nn.showTip(nn.UDL.g("label.connecting")):void(!Pt&&(!hn&&!qn||Wn||Vn||ki)||Ue(o,a).then(u,d))}}function Ue(t,n){rn.indexOf(dn.user_id)>-1&&e.log.error("checkMsgBeforeSend",{user:dn.user_id,text:t,xmpp:It&&It._connection?It._connection.connected:"",connectStatus:On});var i=tn.Deferred();return Pe(t,n).then(function(){nn.checkMsgSensitivity({content:t,type:n||"message"}).then(function(){i.resolve()},function(e){nn.showTip(e.message,"error"),i.reject(new Error("check_sensitivity_failed"))})},function(){nn.showTip("åéè¿é¢ï¼è¯·ç¨ååè¯","error"),i.reject()}),i.promise()}function Pe(t,n){var i=tn.Deferred();if(nn&&nn.company&&"shouqianba"===nn.company.subdomain)return i.resolve(),i.promise();var r={content:t,type:n,success:i.resolve,fail:i.reject};return e.msgFrequency?e.msgFrequency(r):e.loader.js("./lib/msg-frequency.js").then(function(){e.msgFrequency(r)},i.resolve),i.promise()}function He(){nn.hideMoreBox(),ni||(ni=!0,tn.get("/spa1/im_sessions/save_chat_log",{customer_id:dn.user_id}).always(function(e){ni=!1;var t=e.file_url||"";t?window.open(t):nn.winAlert(nn.UDL.g("tip.downloadFail"))}))}function $e(e){function t(t,i){e[t]&&(n.data[t]=e[t],i&&(n[t]=e[t]))}e=e||{};var n=tn.extend({type:e.type||"message",read_status:e.read_status||void 0,version:1,platform:"web",data:tn.extend({content:e.content||"",filename:e.filename||"",filesize:e.filesize||"",fileext:e.fileext||""},e.data),filename:e.filename||"",filesize:e.filesize||"",fileext:e.fileext||"",im_sub_session_id:e.im_sub_session_id||Kn},e.appendProps);return t("voice_url"),JSON.stringify(n)}function We(){Un=!0,nn.showBotomPanel("chat_done"),h(!0);var t=!1;e.platform({weixin:function(){t=!0}}),Mn||t||e.isMob()||(e.closeWindow(),oi.hide())}function Ve(e){var t="/spa1/im_sessions/has_survey";tn.post(t,{agent_id:Rn.agent_id,customer_id:dn.user_id,customer_jid:dn.username,im_sub_session_id:Kn,window_init_time:nn.supportStore("sessionStorage")?sessionStorage.getItem("window_init_time"):void 0}).always(function(t){t=t||{},jt=t.has_survey,e&&e()})}function Qe(){t.uAnalytics&&t.uAnalytics.track("sendclick")}function Xe(){if(rn.indexOf(dn.user_id)>-1&&e.log.error("initFooter",{user:dn.user_id,hasInitFooter:sn.hasInitFooter}),!sn.hasInitFooter){if(sn.hasInitFooter=!0,on.isTransfer){if(Kt)return;Kt=!0,on.chatRobot.destroy(),sn.initUploader=!1,(Cn||En||An||In)&&Je()}else(Cn||En||An||In)&&Je(),nn.last_im_session_id&&hn&&nn.showHistoryTip("moreMsg");nn.initCustomButtons("agent",function(e){ze(null,{content:e})}),nn.showNoticeMsg(),tn(".send-product-box").size()>0&&tn(".send-product-box").removeClass("hide-product"),an.footer.show(),nn.initFooter(),qt=an.txtMsg.height(),nn.editorAutoShow(),nn.setBtnSendActive(),nn.initRecorder(function(e,t){if("end"===e){var n;if(t.translateResult||t.serverId)tn.post("/spa1/im/js_sdk/upload_voice",{appid:t.appid,platform:t.platform,media_id:t.serverId}).then(function(e){if(1e3!==e.code){var i,r;return void nn.showTip(null!=(i=null==(r=e.exception)?void 0:r.message)?i:"åéè¯­é³æ¶æ¯å¤±è´¥","error")}n={content:t.translateResult,voice_url:e.voice_url},ze("",n)});else{var i=an.txtMsg.val()||"";an.txtMsg.val(i+t.result),n={content:i+t.result,voice_url:t.url},ze("",n)}}});try{Gn.placeholder()}catch(n){}e.isIos()||Gn.focus(),oi=e.ui.emotion({isSdk:on.isSDK,isInner:Mn,isCopyRight:on.isCopyRight,target:an.btnEmotion,container:an.main,click:function(e){var t=tn(this).data("value");t&&an.txtMsg.val(an.txtMsg.val()+t),!ci&&nn.moveCursor(an.txtMsg[0]),oi.hide(),autosize.update(an.txtMsg[0]),nn.setBtnSendActive(),nn.hideMoreBox()},show:function(){if(ci){var e=tn(".im-emotion");nn.autoSize({offsetY:e.outerHeight(),cb:function(){}})}},hide:function(){ci&&nn.autoSize()}}),rn.indexOf(dn.user_id)>-1&&e.log.error("bindSendHandler",{user:dn.user_id}),an.btnSend.off("click").click(ze),an.btnSend.off(".uba").on("click.uba",Qe),an.btnDownload.click(He),an.txtMsg.off("keydown").on("keydown",function(e){if(13==e.keyCode){if(e.shiftKey)return;ze(),e.preventDefault(),t.uAnalytics&&t.uAnalytics.track("sendclick")}}).off("click").on("click",function(){oi&&oi.hide(),nn.hideMoreBox()}),e.isIos()&&an.txtMsg.on("touchend",function(e){return e.currentTarget.focus()}),an.footer.find('[data-act="video-call"]').off(".chat-agent").on("click.chat-agent",k),nn.btnDownloadEl.click(He)}}function Je(){if(!WebUploader.Uploader.support())return void nn.showTip(nn.UDL.g("tip.updateFlash"),"warn");if(!sn.initUploader){sn.initUploader=!0;var t=gn.upload_size_limit||50;Wt=e.uploader.init({marking:"client.chat_upload",auto:!1,swf:"/im_client/cmps/webuploader/dist/Uploader.swf",dnd:"#content,#footer textarea",paste:"#footer textarea",disableGlobalDnd:!0,pick:{id:"#btnFile",multiple:!e.isAndroid()||!e.isMiniProgram(),_accept:"*/*"},duplicate:!0,fileSingleSizeLimit:1024*t*1024,fileSingleLimit:t,resize:!1,needUrlEncode:!0,tokenOption:function(e){var t=nn.getFileType(e);if("image"===t&&"image/gif"!==e.type)return{qs:{"x-oss-process":"image/auto-orient,0"}}},dndAccept:function(){sn.isUploadDndAccept=!0},fileQueued:function(e,t){var n=new Date;if(!hn||!Vn){hn&&(Vn=!0,setTimeout(function(){Vn=!1},3e3));var i=z({fileId:e.id,type:"uploading",msgTime:n});i&&i.attr("data-file-id",e.id),$t=!1}},manualUpload:function(t,n,i){var r="image"===nn.getFileType(n),o=sn.isUploadDndAccept;if(clearTimeout(sn.uploadQueueTimer),sn.isUploadDndAccept=!1,sn.uploadQueueCounter=(sn.uploadQueueCounter||0)+1,sn.uploadQueueTimer=setTimeout(function(){sn.uploadQueueCounter=0},1e3),e.ifIE()&&("image.png"!==n.name||n.random_filename||($t=!0)),$t||!r||o||sn.uploadQueueCounter>1)return i&&i(n);try{t.makeThumb(n,function(r,o){e.ui.imgPreview({src:o,onClick:function(e){"close"===e?n&&t.cancelFile(n):"send"===e&&i&&i(n)}})},1,1)}catch(a){return i&&i()}},uploadProgress:function(e,t){var n=(100*t).toFixed(1),i=nn.messagesEl.find('>[data-file-id="'+e.id+'"]');n=n>99.9?99.9:n,i.find(".progress-per").css("width",n+"%")},uploadSuccess:function(t,n){if(Vn=!1,e.ifIE(9,"lte"))Ge(t,n);else if("qiniu"===t.storage_policy){var i="https://qn-im.udesk.cn/"+n.key,r=nn.getFileType(t),o="image"===r;tn.ajax({url:o?i+"?imageInfo":i+"?stat",type:"GET",noParams:!0}).always(function(e){e=e||{};var i=o?e.size:e.fsize;"undefined"==typeof i?(ti=1,Ge(t,n)):0===i&&ti<2?(Wt.upload(t),ti++):0===i&&ti>=2?(ti=1,tn("#"+t.id).parents(".clearfix").remove(),t&&Wt.removeFile(t,!0),nn.winAlert(nn.UDL.g("tip.sendFail"))):(ti=1,Ge(t,n))})}else Ge(t,n)},uploadError:function(e){Vn=!1,tn("#"+e.id).parents(".clearfix").remove(),nn.winAlert(nn.UDL.g("tip.sendFail"))}}),Wt.addButton({id:"#uploadPicture",multiple:!1,_accept:"image/*",capture:e.isAndroid()?"camera":""}),Wt.addButton({id:"#uploadVideo",multiple:!1,_accept:"video/*",capture:e.isAndroid()?"camcorder":""})}}function Ge(e,t){var n,i,r=e.url,o=r,a=nn.getFileType(e),s=K(),c=new Date,l="chatFeedback"===on.stage;"file"===a?("mp4"===e.ext&&(a="video"),n=e.name,o=r+(r.indexOf("?")>-1?"&":"?")+"download/"+n,i=WebUploader.Base.formatSize(e.size)):"image"===a&&("qiniu"===e.storage_policy?(r+="?imageMogr/auto-orient",o=r):"ali"===e.storage_policy&&(o=r));var u=$e({content:r,type:a,filename:n,filesize:i,fileext:e.ext}),d={msg:o,filename:n||"",filesize:i||"",fileext:e.ext,type:a,msgId:s,msgTime:nn.formatDateTime(c,!0),duration:u.duration||""};if(hn)Me(u,s,function(){Le(u,function(e){Jt=!1}),Jt=!0});else if(Pt){if(Oe(u,s))return}else if(l){if(ki)return;Fe(u,s)}else Q(u,s);tn("#"+e.id).parents(".clearfix").remove(),z(d)}function Ke(){e.isMob()||(nn.editorAutoShow(),Ye(function(){var e=function(e,t,n,i,r,o,a,s){if(e<0)return void Ze();if(tn.inArray(e,[1,4])>-1){if(4===e&&"0"!=o)return;et({src:"data:image/png;base64,"+a,data:a})}},t=function(){},n=function(){};Vt=new NiuniuCaptureObject,Vt.FinishedCallback=e,Vt.PluginLoadedCallback=t,Vt.VersionCallback=n,Vt.InitNiuniuCapture()}))}function Ye(e){nn.loadJS(hi+"/niuniucapture.js",e)}function Ze(){var e=fi?"dmg":"exe",t=hi+"/CaptureInstall."+e;nn.showTip(nn.UDL.g("tip.downloadPlugin2")+'<a class="btn-download" target="_blank" href="'+t+'" download="CaptureInstall.'+e+'">'+nn.UDL.g("tip.install")+"</a>","warn",{timer:3e4})}function et(t){Qt=t||{};var n="image_"+ +new Date+"_"+Math.random().toString(32).slice(-5)+".png";e.uploader.getToken(n,"web.mg.rich_editor_copy",function(t){e.ui.imgPreview({src:Qt.src,onClick:function(i){function r(e){if(e){var t;t=e.src?e.src:tt({key:e.key,isImg:!0});var n,i=nn.UDL.g("label.screenshot")+(new Date).getFullYear()+""+((new Date).getMonth()+1)+".png",r=K(),o=$e({type:"image",content:t,filename:i});if(Pt){if(Oe(o,r))return}else hn?Me(o,r,function(){Le(o,function(e){Jt=!1}),Jt=!0}):Q(o,r);var a={msg:t,filename:i||"",filesize:n||"",type:"image",msgId:r,msgTime:new Date};z(a)}else nn.showTip(nn.UDL.g("tip.uploadErrorRetry"),"error")}"send"===i&&("qiniu"===t.storage_policy?e.ifIE()?tn.post("/spa1/web_proxy/qiniu_putb64",{token:t.token,data:Qt.data,key:e.uploader.baseCode64(n),noParams:!0}).always(function(e){e&&e.data?r(e.data):nn.showTip(nn.UDL.g("tip.uploadErrorRetry"),"error")}):e.uploader.getImgByBase64({config:t,data:Qt.data,noTip:!0,success:function(e){r(e)},error:function(){nn.showTip(nn.UDL.g("tip.uploadErrorRetry"),"error")}}):e.uploader.getImgByBase64({config:t,data:Qt.data,key:n,noTip:!0,success:function(e){r(e)},error:function(){nn.showTip(nn.UDL.g("tip.uploadErrorRetry"),"error")}}))}})})}function tt(e){if(!e)return"";var t,n,i=e,r=typeof e;if("function"===r||"object"===r&&e){if(e.src)return e.src;i=e.key,t=e.isImg||(file.type||"").indexOf("image/")>=0}return n="https://qn-public.udesk.cn/"+i,t||(n+="?download/"+file.name),n}function nt(){tn(t).bind("beforeunload",function(t){if(!(Mn||Un||nn.isBeforeunload||xn.udesk_skip_preclose||e.isMob()||e.remoteControl.app.lanuchRemote||"chatFeedback"===on.stage)){var n=nn.UDL.g("tip.confirmClose");return setTimeout(function(){qn&&!zn&&!jt&&o("customer_invite",Nt)&&0===tn(".statsurvey.show").length&&(a({methodFlag:"customer_invite",im_sub_session_id:Kn,successFn:function(){u(),d()}}),n=nn.UDL.g("tip.haveNotSurvey")+"\n\n"+nn.UDL.g("tip.stay")+"\n"+nn.UDL.g("tip.leave"))},1),t.returnValue=n,Un=!0,n}}).bind("unload",function(){h(!0)})}function it(e){(on.queueStr||e)&&(ye(2),tn.ajax({async:!1,url:"/spa1/im/close_queue",data:{queue:on.queueStr||e,session_key:wn}}))}function rt(){tn.get(nn.apiPath+"im_sensitive_words/customer").always(function(e){if(e&&1e3===e.code&&e.customer_is_open){Xn=e;var t=e.customer_words_string||"";t&&(Qn=(t.split(",")||[]).sort(function(e,t){return t.length-e.length}))}})}function ot(e){var t=function(e){tn("#show-history").parents("dt").after(e),nn.contentEl.scrollTop()};e.reverse(),tn.each(e,function(e,n){var i=xe(n.sender),r=JSON.parse(n.content)||{};if(("system"!==n.status||"survey"===r.type||"customer_close"===r.type||"rich"===r.type||"message"===r.type||r.data.msg_close)&&"close"!==r.type&&"form"!==r.type&&"form_received"!==r.type&&"invitation"!==r.type&&("monitor"!==n.status||"internal"!==n.log_type)){var o=kn.agent_fixed_nickname||("monitor"===n.status?n.user_nick_name||Rn.nick||n.agent_nick_name:n.agent_nick_name);n.inviter&&(o=n.inviter.nick_name);var a;"survey"===r.type?(a=P({agent_id:n.agent_id,im_sub_session_id:n.im_sub_session_id,jid:"",hasSurvey:!!r.survey_option_id,created_at:n.created_at,needStr:!0,history:!0}),t(a)):"customer_close"===r.type?(a=ui.costomerCloseTpl(),t(a)):F(n.message_id)&&(a=U({msgId:n.message_id,type:r.type,msg:r.data.content,filename:r.filename||r.data.filename||"",filesize:r.filesize||r.data.filesize||"",fileext:r.fileext||r.data.fileext||"",filePreviewUrl:r.filePreviewUrl||"",senderName:(xn.merchant_id?xn.merchant_name:"")||kn.agent_fixed_nickname||o,style:r.font?r.font:"",msgTime:n.created_at,send_status:"rollback"===n.send_status?"rollback":"",session_type:n.session_type,content_raw:n.content_raw,duration:r.duration||n.duration||"",agent_avatar:n.agent_avatar||"",read_status:n.read_status,content:n.content,logId:n.logId},i,{delayShowWelcomeMsg:!0,renderFn:t}))}})}function at(e){var t=tn("#"+sn.transferEventMsgId);e&&t.find("span").html(e),t.show(),an.messages.find(">.bot").last().after(t)}function st(){var e=tn('[data-act="survey"]');return hn||Pt?(e.hide(),e.removeAttr("clickShow"),void nn.editorAutoShow()):void nn.getSurveyData(function(t){Nt=t;var n=o("revote",t);o("customer_invite",t)?(e.show(),nn.setBtnSendActive(),e.off("click").click(function(){nn.hideMoreBox(),Ve(function(){return jt&&!n?nn.showTip(nn.UDL.g("robot.hasSurvey"),"error"):void a({methodFlag:"customer_invite",im_sub_session_id:Kn,successFn:function(){d()}})})})):(e.hide(),e.removeAttr("clickShow")),nn.editorAutoShow()})}function ct(){kn.buttons_enable.remote&&e.remoteControl.app.init({user_id:dn.username})}function lt(){tn.get("/spa1/im/message_board",{web_plugin_id:xn.web_plugin_id||"",session_key:wn||""}).always(function(e){e=e||{};var t=e.data||{},n=t.leave_messages||[],i=n[0]||{},r=i.created_at||new Date;ut(),dt(r),tn.each(n,function(e,t){var n={},i=xe(t.sender);try{n=JSON.parse(t.content),z({type:n.type,msg:n.data.content,msgId:t.message_id,senderName:(xn.merchant_id?xn.merchant_name:"")||kn.agent_fixed_nickname||t.user_nick_name,style:n.font?n.font:"",msgTime:t.created_at,filename:n.filename||n.data.filename||"",filesize:n.filesize||n.data.filesize||"",fileext:n.fileext||n.data.fileext||"",session_type:t.session_type,voice_url:n.data.voice_url},i)}catch(r){}})})}function ut(){var t=ui.eventTplNoTime(),n=an.messages.find(".leave-msg-event");if(n.length<1){var i=e.replaceTpl(t,{clz:"leave-msg-event",eventText:nn.UDL.g("label.leaveMsg")});an.messages.append(i)}}function dt(t){var n=nn.company.web_im_feedback||{},i=on.workTime,r=n[i?"im_work_hint":"im_offwork_hint"],o=e.ui.config(),a=kn.agent_avatar||o.appBar.avatar||"";if(r){var s=an.messages.find(".leave-msg-welcome");if(s.length<1){var c=K();z({type:"rich",msg:n[i?"im_work_hint":"im_offwork_hint"],msgId:c,senderName:(xn.merchant_id?xn.merchant_name:"")||kn.agent_fixed_nickname||kn.system_message_name||nn.UDL.g("label.system"),style:"",msgTime:t||new Date,leaveWelcome:!0,agent_avatar:a},!0)}}}function pt(){_t("chatFeedback"),sn.hasInitFooter=!1,Xe(),he("company"),lt(),Hn=0,Pt=!1,hn=!1,nn.frameConfig.ticket_plugin&&nn.frameConfig.ticket_plugin.enable?tn(".customButton ul li").each(function(){var e=tn(this).attr("data-type");"tsSdk"!==e&&tn(this).remove()}):tn(".customButton").hide().remove(),an.messages.find(".queue-event").remove(),nn.autoSize(),nn.initPlaceholder("agent"),h(!0),setTimeout(function(){On.disconnected||It.disconnect()},1e3),ht(),on.getAgentTimer&&clearTimeout(on.getAgentTimer),on.menu_id="",on.queueStr="",ye(3)}function ht(){var t=15e3;wi&&clearInterval(wi),wi=setInterval(function(){tn.get("/spa1/im/chatting",{web_plugin_id:xn.web_plugin_id||"",session_key:wn||""}).always(function(t){t=t||{},1e3==t.code&&t.chatting&&t.agent&&(clearInterval(wi),e.setContext({stage:"agent"}),On.connected||p(dn),tn.isEmptyObject(t.agent)||(t.needLoadLog=!0,ve(t)))})},t)}function ft(e){var t=xn.group_id||"",n=xn.agent_id||"",i=on.km_rule_agent_id||"",r=on.km_rule_group_id||"",o=be(e);return!t&&!n&&!i&&!r&&!dn.chatting&&o}function gt(e){var t=[];return tn.each(ai,function(n,i){i.parentId===e&&t.push(i)}),t}function mt(e){var t={};return tn.each(ai,function(n,i){i.id===e&&(t=i)}),t}function vt(e){var t={},n=mt(e),i=n.parentId;return"item_0"===i?{parentId:i,item_name:si}:(tn.each(ai,function(e,n){n.id===i&&(t=n)}),{parentId:i,item_name:t.item_name})}function yt(){return rn.indexOf(dn.user_id)>-1&&e.log.error("initChatBase",{user:dn.user_id}),"chatFeedback"===on.stage?void ae(on.km_rule_group_id||"",on.km_rule_agent_id||"",{}).then(function(e){e||pt()}):void(on.isTransfer&&"undefined"!=typeof on.work_time&&!on.work_time?W():_e().then(function(e){var t=ft(e);if(t){var n=e.group_menus||{};ai=n.items,si=n.name,xt({data:gt("item_0"),title:n.name,level:"top",isHeaderBack:on.isTransfer,cb:function(){bt()}})}else ae(on.km_rule_group_id||"",on.km_rule_agent_id||"",{}).then(function(e){e||(ge(on.km_rule_group_id||"",on.km_rule_agent_id||"",{},hn||on.show_pre_session),bt())})},function(){nn.log.debug("[Im_group_menu]"),bt()}))}function bt(){rn.indexOf(dn.user_id)>-1&&e.log.error("initChatBaseUi",{user:dn.user_id}),on.isTransfer?(hn||on.show_pre_session)&&(Xe(),at(),nn.scrollBottom()):(hn&&_t("show_pre_session"),Xe(),hn&&fe("company")),nn.showNoticeMsg(),Sn&&Ke()}function _t(t,n){an.btnEmotion.show(),an.btnFile.show(),an.uploadPicture.show(),an.uploadVideo.show(),an.btnScreenShot.show(),e.isPC()||Tn.mobile.image_enabled||(an.uploadPicture.hide(),an.uploadPicture.removeAttr("clickShow")),(!Tn.pc.upload_enabled&&e.isPC()||!Tn.mobile.upload_enabled&&!e.isIos()&&on.isMob)&&an.btnFile.hide(),"show_pre_session"===t||"queuingPage"===t?(an.btnDownload.hide(),an.btnAgentTel.hide()):"agent"===t?(an.btnDownload.show(),an.btnAgentTel.show(),n&&n.showVideoCallButton&&an.btnVideoCall.show()):"chatFeedback"===t&&an.btnScreenShot.hide(),nn.editorAutoShow(),st()}function xt(t){tn("#side-box").size()>0&&"none"!==tn("#side-box").css("display")&&(Di=!0),sn.hasChoiceAgent=!0,sn.choiceAgentBoardEl=e.ui.board({id:"choiceAgent",title:e.xss(t.title)||cn("agent.choiceAgent"),noAnimate:!dn.show_pre_form,replace:!0,isback:!0,header:{btnBack:t.isHeaderBack,onClick:function(n){if(tn("#side-box").hide(),tn("#header .pull-left,#content,#footer").hide(),"back"===n)if("top"===t.level)nn.initCustomButtons("robot",function(e){on.chatRobot.sendMsg(e)}),an.txtMsg.off(),on.chatRobot.tryShowBtnTransfer(),on.chatRobot.agentTransferSelector(),on.chatRobot.agentTransferShow(),on.chatRobot.renderAppBar(),!e.isMob()&&Di&&tn("#side-box").show(),tn("#header .pull-left,#content,#footer").show(),tn("#transferEventMsg").remove(),sn.choiceAgentBoardEl.parent().children().removeClass("open"),e.context.chatAgent=null;else{var i=vt(Ti);Ti=i.parentId,xt({data:gt(i.parentId),title:i.item_name,level:"item_0"===i.parentId?"top":"",isHeaderBack:"item_0"!==Ti||on.isTransfer,cb:t.cb})}}},body:e.ui.form({body:e.joinStr('<ul class="list">',e.map(t.data,function(t,n){var i=["data-id="+n.id];return i.push("data-act="+(n.has_next?"next":"item")),n.group_id&&i.push("data-group_id="+n.group_id),e.joinStr("<li "+i.join(" ")+">",' <a class="btn btn-default can-wrap">'+e.xss(n.item_name)+"</a>","</li>")}),"</ul>"),buttons:[{html:nn.getBtnMsgLogsHtml("choiceAgent")},{html:nn.getOfflineUnreadMsgHtml("choiceAgent")}],onClick:function(n,i){var r=i.el.data("id"),o=i.el.data("group_id")||"";if("next"===n){tn("#side-box").hide(),tn("#header .pull-left,#content,#footer").hide(),Ti=r;var a=mt(r);xt({data:gt(r),title:a.item_name,level:"",isHeaderBack:!0,cb:t.cb})}else"item"===n&&(!e.isMob()&&Di&&tn("#side-box").show(),tn("#header .pull-left,#content,#footer").show(),sn.choiceAgentBoardEl.parent().children().removeClass("open"),ae(o,"",{menu_id:r}).then(function(e){if(!e)return t.cb&&t.cb(),ge(o,"",{menu_id:r},hn)}))}})})}function wt(){var n=nn.sessionStore("input_text");n&&(Gn.val(n),nn.sessionStore("input_text","")),_i=nn.sessionStore(bi),xi=(_i?_i.split("||")[2]:"")||xn.session_id,hn=e.context.show_pre_session||hn,rt(),nn.getSurveyData(),yt(),e.loader.js("./lib/msg-frequency.js"),t.WebSocket||console.log("WebSocket is not supported!");var i=dn.im_server;i=dn.im_ws_available&&t.WebSocket&&!e.ifIE()?dn["im_ws"+(Nn?"s":"")]:i.replace(/http[s]?:/i,location.protocol),console.log("server_url",i),jn=new Strophe.Connection(i),It=jn.udeskIM,
p(dn),Dn.registeFn("openPanel",function(){return On.connected?void nn.animateScrollBottom():t.location.reload()}),Dn.registeFn("setReferrer",function(e){saveDevices(dn.user_id,e.referrer)}),Dn.registeFn("clearProduct",function(){console.log("æ¥åæ¶æ¯ï¼å é¤åå"),nn.messagesEl.find(">.sidebox").size()&&(nn.messagesEl.find(">.sidebox").remove(),ie())}),Dn.registeFn("setProduct",function(t){t.product&&(nn.messagesEl.find(">.sidebox").size()?e.im.sidebox.moveTo({container:nn.messagesEl}):(e.im.sidebox.init({isInner:!0,container:nn.messagesEl,product:t.product}),Ft=t.product),nn.animateScrollBottom())}),Dn.registeFn("forceLoadPage",function(e){nn.isBeforeunload=!0}),nt(),Dn.registeFn("showStoreMsg",M),nn.bindSurveyEvent(),nn.bodyEl.on("click",".btn-feedback",function(){nn.hideMoreBox(),zt&&zt.abort(),zn=!1,nn.goFeedback({btnBack:!0,hideBoardAll:!0,cb:function(){h()}})}).on("click","#show-history",function(){nn.getCustomerLogs({isAgent:!0,isHistory:!0,cb:function(e){e.forEach(function(e){return e.invalidTransfer=!0}),ot(e)}})}),nn.btnFileEl.off("click").on("click",function(){nn.hideMoreBox(),$t=!0,sn.uploadQueueCounter=0}),nn.btnPictureEl.off("click").on("click",function(){nn.hideMoreBox(),$t=!0,sn.uploadQueueCounter=0}),nn.btnVideoEl.off("click").on("click",function(){nn.hideMoreBox(),$t=!0,sn.uploadQueueCounter=0}),nn.bodyEl.on("click",".from-submit-btn",function(e){var t=this,n=!0,i=tn(this).parents(".form-msg-box"),r=(tn(this).prev(),i.attr("data-fields-id")),o=ei["formFields_"+r],a=i.find(".form-list"),s=i.parents(".msg"),c=s.find(".msg-content "),l=/((http|https):\/\/([\w-]+\.)+[\w-]+(\/[\w-.\/\?\;%&=]*)?)/g,u=[];if(nn.hideMoreBox(),!Ht){o||(n=!1,tn.get(vn+"im/im_session_forms/"+r,{property:"true",im_sub_session_id:Kn}).always(function(e){e&&1e3===e.code&&(delete e.code,o=e)})),tn.each(o.fields,function(e,t){var i=a.find("[name="+t.id+"]").val(),r=t.content_type||"";switch(r){case"droplist":i=i?[i]:"";break;case"radio":case"checkbox":var o=[];a.find('input[name="'+t.id+'"]:checked').each(function(){o.push(tn(this).val())}),i=o;break;case"chained_droplist":var o=[];tn.each(a.find('[data-field="'+t.id+'"]').find("select"),function(e,t){var n=tn(t).val();(n||0===n)&&tn(t).val()&&o.push(tn(t).val())}),i=o.join(",")}return"true"!==t.rq&&t.rq!==!0||i?"email"===t.id&&i&&!nn.isEmail(i)?(n=!1,nn.showTip(nn.UDL.g("tip.emailError"),"danger"),!1):"link"===t.content_type&&i&&!l.test(i)?(n=!1,nn.showTip(nn.UDL.g("tip.WrongLink"),"danger"),!1):void u.push({id:t.id,value:i,tp:t.tp}):(n=!1,nn.showTip(t.name+nn.UDL.g("tip.noFill"),"danger"),!1)});var d={fields:u,id:o.id,customer_id:dn.user_id,agent_id:Rn.agent_id,company_id:gn.id,im_sub_session_id:Kn};if(n){Ht=!0;var p="/spa1/im/im_session_forms/message_save";tn.ajax({url:p,type:"POST",data:d}).always(function(e){var n=tn(t).data("submit-success-tip"),i='<i class="icon icon-msg-ok"></i> '+(n||un("subSuc")),r='<i class="icon icon-msg-close"></i> '+un("subFail");if(Ht=!1,s.removeClass("form"),c.addClass("bg-success"),c.html(i),1e3===e.code){var a,l=$e({type:"form_received",content:nn.UDL.g("tip.customerForm",{customer:o.describe})});e.result&&e.result.ticket_id&&(a={children:[{name:"action",value:JSON.stringify(e.result),attributes:{xmlns:"udesk:action",type:"ticket_created"}}]}),Q(l,K(),a)}else if(5104===e.code){var d="";u.forEach(function(e){if("cellphone"===e.id)return void(d=e.value)});var l=$e({type:"form_received",content:nn.UDL.g("tip.phoneForm",{num:d})});Q(l,K())}else if(5105===e.code){var p="";u.forEach(function(e){if("email"===e.id)return void(p=e.value)});var l=$e({type:"form_received",content:nn.UDL.g("tip.emailForm",{email:p})});Q(l,K())}else s.removeClass("bg-success").addClass("bg-danger"),c.html(r)})}}}),nn.messagesEl.on("click",".show-tel",function(e){nn.hideMoreBox();var t=tn(this).attr("href");t&&(nn.winAlert(nn.UDL.g("label.call")+t.substring(4)),e.preventDefault())}),nn.screenShotEl.off("click").on("click",function(){nn.hideMoreBox(),Vt||Ke();var e=["1.","png"].join(""),t=Vt.DoCapture(e,0,3,0,0,0,0);t&&Ze()}),nn.bodyEl.off("click.product").on("click.product",".send-product",function(){Zt=!0;var t=e.im.sidebox.getProductData(xn);if(t&&t.title){var n=[],i=function(){if("title"===r||"url"===r||"image"===r||"send"===r||/_style$/.test(r))return"continue";var e=[{text:r},{text:decodeURIComponent(t[r]),"break":!0}],i=document.createElement("div");i.style=t[r+"_style"],i.style.color&&e.forEach(function(e){return e.color=i.style.color}),"bold"!==i.style["font-weight"]&&"bolder"!==i.style["font-weight"]||e.forEach(function(e){return e.bold=!0}),n=n.concat(e)};for(var r in t){i()}var o={type:"product",content:{name:t.title,url:t.url,imgUrl:t.image,params:n}};ze(null,o)}}),nn.bodyEl.off(".wx").on("click.wx","[data-miniprogram-path]",nn.miniProgramLinkClickHandler),Mn&&on.isTransfer&&Dn.postMsg({type:"transfer"}),yn?nn.needSideListion(yn.side_data)&&kt(yn.side_data):nn.getSideBoxData(function(e){nn.needSideListion(e.side_data)&&kt(e.side_data)}),e.ui.appBar({btnBack:!!xn.backbutton||xn.showback,onClick:function(e){"back"===e&&(xn.showback||"default"===xn.backbutton?t.history.back():t.location.href=xn.backbutton)}})}function kt(t){e.loader.js("./lib/iframe-listener.js").then(function(){e.iframeListener.init({side_data:t}),e.iframeListener.setListenerPage("agent"),e.iframeListener.registeFn("agent_sendMsg",function(e){ze(null,e)})})}function Tt(t){sn.hasPreform=!0,e.im.preform.init({isInner:Mn,isOldCustomer:dn.has_pre_form,allDone:function(){t&&t()}})}function St(t){return rn.indexOf(dn.user_id)>-1&&e.log.error("initAgent",{user:dn.user_id}),t=t||{},sn.initCfg=t,"chatFeedback"===on.stage?void wt():void(gn.work_time&&dn.show_pre_form||on.show_pre_form?Tt(function(){e.setContext({show_pre_form:!1}),wt()}):wt())}function Ct(){return Kn}function Et(){return Zt}function At(){return Zn}var It,Lt,Bt,Dt,Mt,Nt,jt,Rt,Ot,qt,Ft,zt,Ut,Pt,Ht,$t,Wt,Vt,Qt,Xt,Jt,Gt=!1,Kt=!1,Yt=!1,Zt=!1,en=!1,tn=e.$,nn=e.common,rn=nn.shouqianbaCustomers,on=e.context,an=on.els,sn={transferEventMsgId:"transferEventMsg"},cn=nn.UDL.g,ln=nn.UDL.gl,un=nn.UDL.gt,dn=nn.customer,pn=nn.agentResp,hn=dn.show_pre_session||!1,fn=on.queue_continue_robot_session,gn=nn.company||{},mn=gn.web_im_feedback||{},vn=nn.apiPath,yn=nn.sideRes,bn=(nn.isMob,mn.leave_enable),_n=mn.no_reply_hint,xn=nn.urlParamObj,wn=xn.session_key||"",kn=nn.frameConfig||{},Tn=kn.buttons_enable||{},Sn=Tn.pc.screenshot_enabled,Cn=(Tn.download_logs_enabled,Tn.emoji_enabled,Tn.upload_enabled,Tn.pc.upload_enabled),En=Tn.mobile.upload_enabled,An=Tn.mobile.image_enabled,In=Tn.mobile.video_enabled,Ln=(Tn.agent_cellphone_enabled,Tn.agent_cellphone,Tn.pc.customer_close_session),Bn=Tn.mobile.customer_close_session,Dn=(kn.theme_color,nn.innerController),Mn=Dn.isInnerMode,Nn="https:"===location.protocol,jn=null,Rn={},On={},qn=!1,Fn=!1,zn=!1,Un=!1,Pn=[],Hn=0,$n=!1,Wn=!1,Vn=!1,Qn=[],Xn={},Jn=[],Gn=(nn.bodyEl,nn.txtMsgEl),Kn=0,Yn=0,Zn={},ei={},ti=1,ni=!1,ii=!1,ri="msg_"+dn.user_id;wn&&(ri=ri+"_"+wn);var oi,ai,si,ci=kn.h5Mode,li=1e3,ui=e.template.chat||{},di=e.template.feedback||{},pi={classes:["cascade-0"],fields:[]},hi="/static_cmps/NiuniuCapture/180509",fi=0===navigator.platform.indexOf("Mac"),gi=0,mi=0,vi=0,yi=[],bi="Transfer||"+dn.username,_i=nn.sessionStore(bi),xi=(_i?_i.split("||")[2]:"")||xn.session_id,wi=null,ki=!1,Ti="item_0",Si=!1,Ci=!1,Ei=0,Ai=!1,Ii=!1,Li={key:"seq_num",init:function(){this.value=parseInt(nn.sessionStore(Li.key))||0},increment:function(){return this.value=(this.value||0)+1,nn.sessionStore(Li.key,this.value),this.value},isSkip:function(e){var t=this.old_recv_sn;return this.old_recv_sn=e,"undefined"!=typeof t&&"undefined"!=typeof e&&parseInt(e)>parseInt(t)+1}};Li.init();var Bi,Di=!1;return{init:St,preShowMsg:U,showSurveyEvent:P,showMsg:z,showModalOfSurveys:a,showHistoryMsg:ot,canShow:F,showLeaveMsg:lt,initChatFeedback:pt,sendMsg:Q,getIMSubSessionId:Ct,getAgentOnPreSession:Le,getClickSendProduct:Et,getIMAgentInfo:At}}),function(e,t,n,i){e.ns("robot"),e.robot.structCardMsg=function(i){return new n(i,e,t)},$.extend(n.prototype,i)}(this.udesk,this,function(e,t,n){this.state={},this.props=this.mapProps(e),this.tpls={main:['<dl class="{className}">',"<dt>{title}</dt>",'<dd><ul class="clearfix">{content}</ul></dd>',"</dl>"].join(""),listItem:['<li data-act="item" data-data=\'{dataStr}\' class="ellipsis"><a>{value}</a></li>'].join(""),productItem:["<li data-act=\"item\" data-data='{dataStr}'>",'<img src="{image}" />','<a data-act="url" href="{url}" target="_blank">{name}</a>','<div class="expend-html clearfix">{expendHtml}</div>',"</li>"].join(""),productInfo:'<span style="{style}">{info}</span>',cardMain:['<dl class="{className}">',"<dt>{title}</dt>",'<dd class="custom-card-list-box"><ul class="clearfix custom_card-list">{content}</ul></dd>',"</dl>"].join(""),cardHorizontal:['<div class="card-horizontal-box">{content}</div>'].join(""),cardMainNoTitle:['<dl class="{className}">','<dd><ul class="clearfix">{content}</ul></dd>',"</dl>"].join(""),FAQListTpl:['<li class="card-li list-box">','    <div class="list-header">{suggestContent}</div>','    <ul class="list-body list-menu">',"       {msg}","    </ul>","</li>"].join(""),pagerItem:'<li class="text-right card-li"><a data-act="group">æ¢ä¸ç»</a></li>',titleItem:"<p>{title}</p>",horizontalMore:['<div style="padding: 20px 10px">','<div class="card-horizontal-item horizontal-more" page-size={pageSize} page-num={pageNum}>','<div class="icon icon-refresh"></div>',"<div>æ¢ä¸æ¹</div>","</div>","</div>"].join(""),verticalMore:'<div class="card-vertical-more show-card-popup" page-size={pageSize}>æ¥çæ´å¤<div>',drawerCard:['<a class="drawer-card" data-card-list-type={cardListType} data-act="drawer" data-data={drawer} data-page-size={pageSize} >',"{title}","</a>"].join("")},this.tpls.tableItem=this.tpls.listItem,this.loadSrc(),this.render()},{loadSrc:function(){udesk.loader.css("robot/struct-card-msg.css")},mapProps:function(e){e=e||{};var t=e.answer||{},n=t.msgType||"",i=n.replace(/^(selective|show)_/,""),r=/^selective_/.test(n),o=t.ansCon||{},a=o.cardList||[],s=(o.turnFlag||!1,e.insertMethod||"append"),c={},l="custom_card"===n?"custom-card-msg":"struct-msg",u=t.showType;c[i]=!0,"product"===i&&(r="show_product"===n);var d=o.showSize||o.pageSize;return{container:$(e.container),type:i,msgType:n,_className:l,typeIs:c,selectable:r,title:o.title,pageSize:d,insertMethod:s,answer:t,data:o.productList||o.optionList||a||[],turnFlag:1==o.cardListType&&1==o.pageType?0:1,render:e.render,afterRender:e.afterRender,on:e.on,cardListType:o.cardListType,pageType:o.pageType||e.clickChange,showType:u,onlyContent:e.onlyContent,hideMore:1==e.pageNum,pageNum:void 0===e.pageNum?1:e.pageNum,clickChange:e.clickChange,isVertical:e.isVertical,hideReselect:e.hideReselect}},needPage:function(){var e=this.props,t=e.pageSize,n=e.data,i=e.turnFlag,r=e.pageType;return!!e.clickChange||(r?i:!(!i||!t)&&Math.ceil(n.length/t)>1)},getPageData:function(){var e,t=this.props,n=this.state,i=t.data,r=n.pageIndex||0,o=t.pageSize;return this.needPage()&&(e=Math.ceil(i.length/o),r+1>e&&(r=0,n.pageIndex=0),i=i.slice(r*o,r*o+o)),i},genItem:function(e){if(!e)return"";var t=this.props.msgType,n=e.type;if("custom_card"!==t){var i=this.props.type,r=this.tpls[i+"Item"];return e=$.extend({dataStr:JSON.stringify(e),expendHtml:this.genExpendHtml(e)},e),udesk.replaceTpl(r,e)}return 1==n?this.genRichItem(e):2==n?this.genFAQItem(e):void 0},genRichItem:function(e){var t='<li class="card-li">{content}</li>',n=e.hitShowContent?encodeURI(e.hitShowContent):"";return e.isHit&&(1==e.hitType&&e.hitContent?t='<li class="card-li"><a href="{hitContent}" target="_blank" style="display: inline;">{content}</a></li>':2==e.hitType&&e.hitContent?t='<li data-act="item" data-data="{hitContent}" class="card-li">{content}</li>':3==e.hitType&&e.hitContent&&(t=this.props.isVertical?'<div data-act="struct" data-data="{hitContent}" class="card-vertical-item" data-size="{pageSize}" data-switch-staff-info="{switchStaffInfo}" >{hitShowContent}</div>':1==this.props.cardListType?'<div data-act="struct" data-data="{hitContent}" class="card-vertical-item" data-size="{pageSize}" data-switch-staff-info="{switchStaffInfo}">{content}</div>':'<div data-act="struct" data-data="{hitContent}" data-hitShowContent='+n+' class="card-horizontal-item" data-size="{pageSize}" data-switch-staff-info="{switchStaffInfo}" >{content}</div>')),e.pageSize=this.props.pageSize,e.switchStaffInfo?"object"==typeof e.switchStaffInfo&&(e.switchStaffInfo=encodeURI(JSON.stringify(e.switchStaffInfo))):e.switchStaffInfo="",udesk.replaceTpl(t,e)},genFAQItem:function(e){var t=this.tpls.FAQListTpl;return udesk.replaceTpl(t,{msg:udesk.joinStr(udesk.map(e.suggestList,function(e,t){return'<li class="list-item-disc" data-act="item" data-data="'+t.content+'"><a class="" href="javascript:;">'+t.content+"</a></li>"})),suggestContent:e.suggestContent||udesk.common.UDL.g("robot.guess")})},gen:function(){var e=this,t=this.props,n=(this.state,this.tpls),i=t.data,r=[],o=[t._className,t.type+"-"+t._className],a=this.needPage();if(a&&!t.pageType&&(i=this.getPageData()),t.className&&o.push(t.className),!t.selectable&&o.push("unselectable"),$.each(i,function(t,n){r.push(e.genItem(n))}),t.onlyContent)return r;if(a)if(1==t.cardListType){if(2==t.showType||3==t.showType)return;t.pageType&&r.push(udesk.replaceTpl(n.verticalMore,{pageSize:t.pageSize}))}else 2!=t.cardListType||t.hideMore?r.push(udesk.replaceTpl(n.pagerItem)):r.push(udesk.replaceTpl(n.horizontalMore,{pageSize:t.pageSize,pageNum:t.pageNum}));return 2==t.showType?udesk.replaceTpl(n.drawerCard,{title:t.title,drawer:encodeURI(i[0].content),cardListType:t.cardListType,pageSize:t.pageSize}):t.isVertical||1==t.cardListType?udesk.replaceTpl(n.cardMain,{title:t.title,className:o.join(" "),content:r.join("")}):2==t.cardListType?udesk.replaceTpl(n.cardHorizontal,{title:t.title,className:o.join(" "),content:r.join("")}):t.title?udesk.replaceTpl(n.cardMain,{title:t.title,className:o.join(" "),content:r.join("")}):udesk.replaceTpl(n.cardMainNoTitle,{className:o.join(" "),content:r.join("")})},genExpendHtml:function(e){if(!e||!e.infoList)return"";var t=this.tpls.productInfo,n=[];return $.each(e.infoList,function(e,i){var r=[];i.color&&r.push("color: "+i.color),i.boldFlag&&r.push("font-weight: bold"),n.push(udesk.replaceTpl(t,{info:i.info,style:r.join(";")}))}),n.join("")},on:function(e){var t=this,n=this.props;this.el.off(),this.el.on("click","[data-act]",function(i){var r=$(this),o=r.data("act"),a=r.data("data")||r.parents("li").data("data"),s=r.data("size"),c=r.parents("dd.bot"),l={},u=r.data("hitshowcontent");if(o){if(l[o]=!0,l.group)return void t.incrementPage();if(n.selectable){if(l.url)return void i.stopPropagation()}else i.preventDefault();if(a&&!($("body").attr("class").indexOf("robot")<0||c.attr("data-invalid-transfer"))){if("struct"===o){var d="";d=u?'<div class="card-vertical-item">'+decodeURI(u)+"</div>":r.prop("outerHTML"),a={hitContent:a,switchStaffInfo:r.data("switch-staff-info"),el:['<div class="send-struct-card">',d,n.hideReselect?"":'<div class="card-vertical-more show-card-popup" page-size='+s+">éæ°éæ©<div>","</div>"].join("")}}else"drawer"===o&&(a={hitContent:a,cardListType:n.cardListType,pageSize:n.pageSize});if("struct"===o||"drawer"===o){var c=$(this).parents("dd.bot");c.size()||(c=$(this).parents(".card-choice-popup")),a.logid=c.attr("logid"),a.im_robot_log_id=c.attr("im_robot_log_id")}e&&e(o,a,n.answer),n.on&&n.on(o,a,n.answer)}}})},incrementPage:function(){this.state.pageIndex=(this.state.pageIndex||0)+1,this._render("replace")},_render:function(e){var t=this.props,n=this.gen(),i=$(n),r="replace"===e;t.render&&(i=$(t.render(n,this))),r&&this.el.replaceWith(i),this.el=i,this.on()},render:function(){var e=this.props;this.destroy(),this._render(),e.afterRender&&e.afterRender(this.el)},destroy:function(){this.el&&(this.el.off(),this.el.remove())}}),function(e,t,n){e.chatRobot={create:function(){return n(e,t)}}}(this.udesk,this,function(e,t){function n(e,t,n){var i,r,o,a=null,s=0;n||(n={});var c=function(){s=n.leading===!1?0:(new Date).getTime(),a=null,o=e.apply(i,r),a||(i=r=null)};return function(){var l=(new Date).getTime();s||n.leading!==!1||(s=l);var u=t-(l-s);return i=this,r=arguments,u<=0||u>t?(a&&(clearTimeout(a),a=null),s=l,o=e.apply(i,r),a||(i=r=null)):a||n.trailing===!1||(a=setTimeout(c,u)),o}}function i(e){console.log("[CHATROBOT]",e,arguments)}function r(t,n){var i=["list-body"];t=t||{title:Ae.UDL.g("robot.questions")},i.push(n?"list-menu submenu one-submenu":"accordion");var r="";switch(Bt.pictureSetting){case 1:r='<img class="common-question-img" src="images/cainixiangwen1.png" />';break;case 2:r='<img class="common-question-img" src="images/cainixiangwen2.png" />';break;case 3:r='<img class="mar-top-9 common-question-img" src='+Bt.image+" />"}return e.replaceTpl(jt,{typeClz:"",msg:e.joinStr('<div class="list-box">',1==Bt.type?'   <div class="common-qustion-title">'+Bt.title+"</div>":"",'<div class="horizontal-list-wrapper">',1!==Bt.type?'<div class=" horizontal-list-left">'+r+"</div>":"",'<div class="horizontal-list-right" type="vertical" refresh='+mt+">",'   <ul id="accordion" class="horizontal-list '+i.join(" ")+'">',"       {msg}","   </ul>","</div>","</div>",mt?'<div class="change" picture-setting='+Bt.pictureSetting+" type="+Bt.type+' ><i class="icon icon-ic-refresh-shuaxin"></i>'+Ae.UDL.g("robot.refresh")+"</div>":"","</div>")})}function o(){if(ct)return ct;var e={};for(var t in We)0===t.indexOf("robot_")&&(e[t]=We[t]);return We.sdk_token&&(e.app_id=We.app_id,e.sdk_token=We.sdk_token,e.sdk_version=We.sdk_version,e.sdk_platform=We.platform_name||""),e}function a(){var e={};for(var t in We)0===t.indexOf("c_")&&(e[t]=We[t]);return e}function s(e){return Ee.extend(e||{},o(),{im_web_plugin_id:We&&We.web_plugin_id,window_init_time:Ae.supportStore("sessionStorage")?sessionStorage.getItem("window_init_time"):void 0})}function c(e,t){t=t||{},!Je.name&&(Je.name=e.webConfig.robotName),!Je.logoUrl&&(Je.logoUrl=e.webConfig.logoUrl),!Je.sessionId&&(Je.sessionId=e.sessionId);var n=t.delayShowWelcomeMsg,i={isRecv:!1,clz:"msg-recv",log_created_at:e.log_created_at||t.log_created_at,content:e.webConfig.helloWord,messagesEl:t.messagesEl,renderFn:t.renderFn,noScroll:t.noScroll,isWelcome:!0,invalidTransfer:t.invalidTransfer};!n&&D(i),qe&&!Je.name&&(Je.name=Ae.UDL.g("robot.aicpRobotName")),!Je.logoUrl&&(Je.logoUrl="images/bot.png"),(Oe||Fe||qe||ze)&&e.topAsk&&e.topAsk.length&&(Oe&&(Je.logid=e.logId),D({isRecv:!0,clz:"msg-recv",log_created_at:e.log_created_at||t.log_created_at,content:{gusList:e.topAsk,listType:"commonQuestion",leadingWord:e.webConfig.leadingWord||Ae.UDL.g("robot.questions"),shortcutEntryList:1===e.shortcutEntryPosition?e.shortcutEntryList:null,shortcutEntryPosition:e.shortcutEntryPosition},renderFn:t.renderFn,noScroll:t.noScroll,invalidTransfer:t.invalidTransfer})),n&&D(i),!(Oe&&e.shortcutEntryList&&e.shortcutEntryList.length>0)||1===e.shortcutEntryPosition&&e.topAsk&&e.topAsk.length||Ee(".bot.bot-shortcut").length<1&&D({isRecv:!0,tpl:Ft,shortcutMsg:!0,content:{shortcutEntryList:e.shortcutEntryList}})}function l(e,t){var n=p(),i=s({s:Wt.BASE,dialogueParam:JSON.stringify({knowledge_point_name:decodeURI(n.dialogueParam||"")||""})});We&&We.shortcutCustomId&&(i.shortcutCustomId=We.shortcutCustomId),i.customer=a(),setTimeout(function(){Te||Ae.showModal("robotDelay")},5e3),Ee.post(Ve,i).always(function(n){if(n&&1e3==n.code){if($t=n.topAskStyle||1,u(n),Ae.setBtnSendActive(),e&&e(n),(qe||Fe||ze)&&Ae.surveyEl.hide(),n.initMessage&&n.initMessage.message){var i=n.initMessage.isDisplay;R(n.initMessage.message,{s:"aq",features:i?[]:["not_display_log"]},{skip:!i})}}else t&&t()})}function u(e){Jt||(Jt=!0,e&&1e3==e.code&&(Ce="CHINESE"===e.language,e.switchStaffAnswer=e.switchStaffAnswer||"",e.switchStaffTips=e.switchStaffTips||"",e.switchStaffType=e.switchStaffType||"",Array.isArray(e.topAsk)&&e.topAsk.forEach(function(e){return e.questionTypeId=e.questionTypeId||""}),Mt=e.im_robot_session_id||Mt,Ge=JSON.stringify(e),e.webConfig&&(Je.name=e.webConfig.robotName,Je.logoUrl=e.webConfig.logoUrl,e.sessionId&&(Je.sessionId=e.sessionId)),Je.satisfactionFlag=e.satisfactionFlag,Re.topAskStyle=e.topAskStyle||1,Bt={type:e.form,image:e.formUrl,title:e.description,pictureSetting:e.pictureSetting},yt=e.refreshWindowSize,2===e.topAskStyle?(Array.isArray(e.topAsk)&&e.topAsk.forEach(function(e,t){for(var n=[],i=Math.ceil(e.optionsList.length/yt),r=0;r<i;r++)n.push(e.optionsList.slice(r*yt,(r+1)*yt));e.totalNum=i,e.optionsList=n}),gt=e.topAsk):Array.isArray(e.topAsk)&&e.topAsk.forEach(function(e){e.optionsList.forEach(function(t,n){t.questionTypeId=e.questionTypeId,t.sort=n+1,bt.push(t)})}),2===e.topAskStyle?mt=e.enableRefresh:e.enableRefresh&&bt.length>e.refreshWindowSize&&(mt=e.enableRefresh),St=e.satisfiedAutoPush))}function d(e,t,n,i,r,o,a){var c={s:e?Wt.HELP:Wt.UNHELP,aId:t||"",cluid:n||"",logId:i||"",sessionId:Je.sessionId,taskAppraise:o};a&&(c.multiMessageId=a);var l=s(c);Fe&&(l.hitQuestion=r),Ee.post(Ve,l,function(e){if(e.switchStaffType&&2!==e.switchStaffType){var t={isRecv:!0,clz:"msg-recv",log_created_at:e.log_created_at,content:{switchStaffAnswer:e.switchStaffAnswer,switchStaffTips:e.switchStaffTips,switchStaffType:e.switchStaffType,ansCon:"æè°¢æ¨å¯¹æºå¨äººçåé¦ãç±äºæªè½è§£å³æ¨çé®é¢ï¼æ¨å¯ä»¥ç¹å»ä¸æ¹çè½¬äººå·¥æé®è¿å¥äººå·¥æå¡ã"}};D(t)}O(e)})}function p(){for(var e=window.location.search.slice(1).split("&"),t=e.length,n={},i=0;i<t;i++){var r=e[i].split("=");n[r[0]]=r[1]}return n}function h(e,t){if(!Fe){var n=p(),i=s({s:Wt.GUIDE,q:e,sessionId:Je.sessionId,dialogueParam:JSON.stringify({knowledge_point_name:decodeURI(n.dialogueParam||"")||""})});Ee.post(Ve,i,function(e){t&&t(e.list,e.smartTipType,e.wordList)})}}function f(){et.unbind("input"),et.unbind("propertychange");var e=Ae.getIosVersion()||"0.0.0",t=Ae.compareStr(e,"11.0.3",">"),i=n(v,500);et.bind("input propertychange",function(){var e=!0;Vt.config.personifyRobot&&!Vt.config.smartHintEnable&&(e=!1),e&&i(),Ae.setBtnSendActive()}),et.on("click",function(){var e=this;t||setTimeout(function(){try{e.scrollIntoView()}catch(t){}},400)})}function g(e){var t="(?<![A-Za-z])"+e+"(?![A-Za-z])";return new RegExp(t)}function m(e,t){function n(e,t,i){void 0===i&&(i=0),console.log(e,t,"xx");var o=e.toLowerCase().indexOf(t.toLowerCase(),i),a=t.length,s=/^[A-Za-z]+$/,c=e.slice(o,o+a);if(o>-1){if(s.test(t)&&!Ce){var l="";if(0===o)l=e.slice(0,t.length+1+o);else{var u=o-1>=0?o-1:0;l=e.slice(u,t.length+1+o)}if(!g(t.toLowerCase()).test(l.toLowerCase()))return void n(e,t,o+a)}r.push({position:o,len:a,word:"<span style='color:red'>"+c+"</span>"}),n(e,t,o+a)}}if(!Ce){t=Ee.trim(et.val()).split(" ");for(var i=0;i<t.length;i++)t[i]||(t.splice(i,1),i-=1)}var r=[];Ee.each(t,function(t,i){n(e,i,0)});var o=e.split("");return r.forEach(function(e){for(var t=0;t<e.len;t++)0===t?o[e.position]=e.word:o[e.position+t]=""}),o.join("")}function v(){var t=Ee.trim(et.val());if(t!==st){if(!t||t.length<2)return Ze.empty().hide();st=t,h(t,function(t,n,i){var r=2===n?11:9;Ze.empty().hide(),Ee.isArray(t)&&t.length>0&&(e.$.each(t,function(e,t){!t||e>9||Ze.append("<li data-query-type="+r+' class="ql guide-anwser" data-question-id="'+t.questionId+'" data-suggestanswertype="'+(t.suggestAnswerType||"")+'">'+(e+1)+"."+m(t.question,i)+"</li>")}),Ee.trim(et.val())&&Ie.isRobotChat&&Ze.show())})}}function y(t,n){var i=Ee('<div class="survey-result"></div><div class="survey-options-wrapped option-'+t.show_type+'"></div><div class="survey-options-tags"></div><div class="survey-mark-wrapped"></div><p class="btnbar clearfix">  <a class="survey-sub-btn btn btn-yes btn-tg">'+Ae.UDL.g("label.submit")+"</a></p>"),r="",o="";t.resolved_enabled?i.filter(".survey-result").append(function(){var e=t.resolved_extra,n='<p class="survey-label">'+(e.title||"")+'</p><div class="survey-result-btns">';Ee.each(e.options||[],function(e,t){var i=t.option_select;n+='<button data-option="'+(e?0:1)+'" class="survey-btn survey-btn-'+(e?"no ":"yes ")+(i?"active":"")+'"><div class="icon '+(e?"icon-frown":"icon-smile1")+'"></div><div style="display: inline-block;vertical-align: text-bottom;">'+t.option_name+"</div></button>"}),n+="</div>";var i=Ee(n);return i.filter(".survey-result-btns").on("click.bot",".survey-btn",function(){Ee(this).addClass("active").siblings().removeClass("active")}),i}()):i.filter(".survey-result").css("display","none"),"text"===t.show_type?i.filter(".survey-options-wrapped").append(function(){var n=[];Ee.each(t.text.options,function(){this.enabled+""=="true"&&n.push(e.replaceTpl('<label><input type="radio" name="survey_options" data-option="{id}"/> {text}</label>',this))});var i=Ee(n.join(""));return i.on("click.bot",'[type="radio"]',function(){Ee(this).addClass("selected").parent().siblings().find("[data-option]").removeClass("selected")}),i}()):"expression"===t.show_type?i.filter(".survey-options-wrapped").append(function(){var n=[];n.push('<ul class="expression-image-wrapped clearfix">'),Ee.each(t.expression.options,function(t){var i="";switch(t){case 0:i="icon-ic-smile";break;case 1:i="icon-yiban";break;case 2:i="icon-hencha"}n.push(e.replaceTpl('<li data-type="survey0'+(t+1)+'" data-option="{id}" class="survey-expression-item"><div class="icon '+i+'"></div><div>'+Ae.UDL.g("robot."+this.code)+"</div></li>",this))}),n.push("</ul>");var i=Ee(n.join(""));return i.on("click.bot",".survey-expression-item",function(){Ee(this).addClass("selected").siblings().removeClass("selected")}),i}()):"star"===t.show_type&&i.filter(".survey-options-wrapped").append(function(){var n=[],i=t.star.default_option_id||t.star.options[4].id,a=4,s="";Ee.each(t.star.options,function(e){i===this.id&&(a=e,s=this.text,r=this.tags||"",o=this.remark_option)}),n.push('<div class="survey-options-wrapped option-star">'),n.push('<div class="star-image-wrapped">'),Ee.each([].concat(t.star.options).reverse(),function(){n.push(e.replaceTpl('<span class="star-rating-item icon icon-star-solid-2" title="{text}" data-option="{id}"></span>',this))}),n.push("</div>"),n.push('<span class="star-option-desec">'+s+"</span>"),n.push("</div>");var c=Ee(n.join(""));return c.on("click.bot",".star-rating-item",function(){var e=Ee(this);e.addClass("selected").siblings().removeClass("selected"),c.find(".star-option-desec").text(e.attr("title"))}),c}()),i.filter(".survey-options-wrapped").on("click.bot","[data-option]",function(){var e=t[t.show_type],n=Ee(this).data("option"),r=e.options.find(function(e){return n===e.id});r.tags?i.filter(".survey-options-tags").empty().append(function(){function e(e){var t=[],n=e?e.split(/,|ï¼/):[],i=n.length;return i&&Ee.each(n,function(e,n){t.push('<li class="tag-item item-col-2"><span>'+n+"</span></li>")}),t.join("")}var t=[];t.push(e(r.tags));var n=Ee(t.join(""));return n.filter(".tag-item").on("click.bot",function(){Ee(this).toggleClass("tag-item-active")}),n}()):i.filter(".survey-options-tags").empty(),t.remark_enabled&&"hide"!==r.remark_option?i.filter(".survey-mark-wrapped").empty().append(function(){var e=[],n="required"===r.remark_option;return n&&e.push('<span class="survey-mark-required">*</span>'),e.push('<textarea class="survey-mark" maxlength="200" '+(n?'required="required"':"")+' placeholder="'+(t&&t.remark)+'"></textarea>'),Ee(e.join(""))}()):i.filter(".survey-mark-wrapped").empty()});var a="number"==typeof t[t.show_type].default_option_id?t[t.show_type].default_option_id:null;return i.filter(".survey-options-wrapped.option-"+t.show_type).find("[data-option="+a+"]").trigger("click"),i.filter(".btnbar").on("click.bot",".btn-yes",function(){if("function"==typeof n.onSubmit){var e=i.filter(".survey-options-wrapped").find(".selected").data("option");if(null===e||void 0===e)return Ae.showTip(Me("tip.pleaseSurvey"),"warn");var r=i.filter(".survey-mark-wrapped").find(".survey-mark"),o="";if(r.length>0){if(o=r.val(),o&&o.length>200)return Ae.showTip(Me("tip.overMaxLength"),"warn");if(r.prop("required")&&!o.trim())return Ae.showTip(Me("tip.surveyRemarkRequire"),"warn")}n.onSubmit({option_id:e,survey_remark:o,type:t.show_type,tags:i.filter(".survey-options-tags").find(".tag-item-active > span").map(function(){return this.innerText}).toArray().join(","),resolved_state_v2:i.filter(".survey-result").find(".active").data("option")})}}),i}function b(){var e=Ee.Deferred();return Ee.get("/udesk_im/aifaq/v1/web_proxy",s({s:Wt.GET_FEEDBACK_V2})).done(function(t){1e3===t.code?e.resolve(t):e.reject(new Error(t.message))}).fail(function(){e.reject.apply(this,arguments)}),e}function _(e){Ee.get("/udesk_im/aifaq/v1/web_proxy",s(Ee.extend({s:Wt.FEEDBACK_V2,sessionId:Je.sessionId},e))).done(function(e){if(Ae.showTip(Me("robot.thanks")),e=_extends({},e,e.data),e.switchStaffType&&2!==e.switchStaffType){var t={isRecv:!0,clz:"msg-recv",log_created_at:e.log_created_at,content:{switchStaffAnswer:e.switchStaffAnswer,switchStaffTips:e.switchStaffTips,switchStaffType:e.switchStaffType,ansCon:"æè°¢æ¨å¯¹æºå¨äººçåé¦ãç±äºæªè½è§£å³æ¨çé®é¢ï¼æ¨å¯ä»¥ç¹å»ä¸æ¹çè½¬äººå·¥æé®è¿å¥äººå·¥æå¡ã"}};D(t)}O(e)}).fail(function(){Ke=!1}),Ke=!0}function x(t){if(t){var n=e.ui.modal({clz:"statsurvey",contentClz:"scrollbar",container:Ae.mainEl,title:t.title||"",content:y(t,{onSubmit:function(e){_(e),n.close()}}),hide:null,needClose:!0,isMob:Qe});n.el.on("change","input[name='survey_options']:eq(2)",function(){var e=Ee(this),t=n.el.find(".survey-mark").parent();e.is(":checked")?t.removeClass("hide"):t.addClass("hide")})}}function w(t){return t&&(t=e.xssNotSymbol(t,"&")),t}function k(t,n){function i(e){var t=Ee("#content").outerWidth(),i=n.noAnimation?"":"transform:translateX("+t+"px)";return['<li  class="shortcut-li" data-id="'+e.id+'" data-model-id="'+e.modelId+'" data-content="'+e.content+'" data-robot-type="'+e.robotId+'" data-type="'+e.type+('" style="'+i+'">'),2===e.type?'<a href="'+e.content+'" target="_blank">':"","   <img src="+e.pic+' class="s-img"  />','   <p class="s-text" title="'+e.name+'">'+e.name+"</p>",2===e.type?"</a>":"","</li>"].join("")}void 0===n&&(n={});var r=e.map(t,function(e,t){return i(t)}),o=['<div class="shortcut-box">','   <ul class="shortcut-ul">',r.join(""),"   </ul>","</div>"].join("");return o}function T(e){if(!e)return"";var t=Ee("<div />").html(e),n=t.find(".flow-item");return n.length&&n.each(function(e,t){var n=Ee(this),i=n.data("type"),r=n.data("id")||"",o=2===i?"wflink":"ql";n.addClass(o+" robot-flow"),n.attr("data-query-type",8),n.attr("data-question-id",r)}),t.html()}function S(t){var n,i=t.msgType,r=t.ansCon;if("image"===i)return'<img src="'+r+'" />';if("audio"===i){if(e.ifIE(9,"lt"))return'<a href="'+r+'" target="_blank">'+r+"</a>";var o=document.createElement("audio");return o.src=r,o.style.display="none",Ee(document.body).append(o),o.onloadedmetadata=function(){var e=Math.ceil(o.duration);Ee('[data-src="'+r+'"]').html(" "+e+'<sup>"</sup>')},n=['<div class="audio-static-wrapper">',"<span>è¯­é³</span>",'<a class="audio-static" href="javascript:;">','<audio src="'+r+'" class="hide"></audio>',"</a>",'<b class="duration" data-src="'+r+'"></b>',"</div>"].join("")}if("link"===i){var a=r.faviconUrl||"images/link-lue.png",s=r.faviconUrl?"":"default-fav",c=r.title||r.answerUrl;return n=['<a href="'+r.answerUrl+'" target="_blank" class="link-outside-a">','<span style="background-image: url('+a+')" class="favicon-img '+s+'"></span>','<span class="ellipsis word-break favicon-text" title="'+c+'">'+c+"</span>","</a>"].join("")}if("task_button"===i)return'<div class="task-button-rich-title">'+r.richText+"</div>"+function(){return r.buttons.map(function(e){return'<div class="task-button-rich">'+e.customStyle+"</div>"}).join("")}();if("map"===i)return'<a href="/im_client/map.html?location='+r.location+"&name="+r.name+"&address="+r.address+'" rel="noreferrer noopener" target="_blank">'+("<p>"+r.name+"<br><small>"+r.address+"</small></p>")+('<img alt="map" src="https://restapi.amap.com/v3/staticmap?location='+r.location+"&zoom=12&size=240*94&markers=,,:"+r.location+'&key=db5a6f6037d44f9056293e9e41b02c71">')+"</a>";var l=Ee("#content"),u=document.createElement("div");u.setAttribute("className","msg-content"),u.innerHTML=r,l.append(u);
var d=u.scrollHeight;return Ee(u).remove(),d>145&&t.abbreviation?e.replaceTpl(zt,{msg:r}):r}function C(t,n,i){Ee.isArray(t.ansCon)&&(t.ansCon=t.ansCon.map(function(e){return e.content}).join("<br/>"));var r=S(t);n+=t.msgType?" msg-"+t.msgType:"",e.isPC()&&pt&&"link"!==t.msgType&&(r=Ae.formatImgContent(r));var o=t.attachmentList||[],a=[],s="";if(Ee.each(o,function(e,t){a.push(Ae.formatAttachment(t))}),s=a.join(""),s&&(r+=e.replaceTpl(Ut,{msg:s})),t.relateList&&t.relateList.length){var c=t.relateList.filter(function(e){return!e.isButtonCopywriting});c.length>0&&(r+='<hr class="hr-1" />',r+=e.replaceTpl(Ot,{msg:e.joinStr('<ul class="list-body list-menu">',e.map(c,function(e,t){return'<li class="list-item-disc"><a class="ql" data-question-id="'+(t.questionId||"")+'" data-suggestanswertype ="'+(t.suggestAnswerType||"")+'" data-query-type="7" href="javascript:;">'+(t.question||t.content)+"</a></li>"}),"</ul>"),robotQuestions:t.recommendationGuidance||Ae.UDL.g("robot.questions")}))}if(!qe&&t.enableAppraise){var l=['style="color: '+rt+'"'];Fe&&l.push('data-hit-question="'+t.hitQuestion+'"');var u='<div class="help-box" taskAppraise="'+t.taskAppraise+'" multiMessageId="'+(t.multiMessageId||"")+'"><div class="help help-yes"><i class="icon icon-ic-thumb-up-zan" ></i></div><div class="help help-no"><i class="icon icon-ic-thumb-down-cai" ></i></div></div>';i=jt.replace("{afterHtml}",u)}return{content:r,typeClz:n,tpl:i}}function E(t,n,i){var o=[],a="",s=jt,c="",l=t.switchStaffTips||"",u=t.switchStaffType||"",d=t.switchStaffAnswer||"",p=t.customerServiceId,h=t.customerServiceStatus,f="",g="",m=null;if(t.unsatisfied_tags_result&&(m=function(n){var i=n.find(".help-no .icon");i.removeClass("icon-ic-thumb-down-cai"),i.addClass("icon-ic-thumb-down"),n.find(".help-yes").hide(),Ae.messagesEl.append(n);var r=JSON.parse(t.unsatisfied_tags_result.tags).filter(function(e){return e.enable});if(r.length){for(var o="",a=0;a<r.length;a++){var s=r[a],c=s.id==t.unsatisfied_tags_result.tag_id;o+='<div class="no-reason-item '+(c?"active":"")+'" reasonId='+s.id+">"+s.content+"</div>"}D({isRecv:!0,clz:"msg-recv",themeBg:"no-reason",content:e.replaceTpl(Rt,{style:"is-success",content:o}),log_created_at:t.created_at,notRobotAnsHandler:!0,logid:t.logid,renderFn:function(e){e.find(".text-area").val(t.unsatisfied_tags_result.reason),e.find(".sub-btn")[0].innerText=Ae.UDL.g("robot.receiveFeedback"),setTimeout(function(){Ee("dd[logid="+t.logid+"]").after(e)})}})}}),!n&&Ae.initCustomButtonsByGuessQuestions(t.relateList||t.gusList||[]),"custom_form_sdk"===t.msgType){var v;t.extraData&&"object"==typeof t.extraData&&(v=t.extraData.formId);var y;t.extraData&&"object"==typeof t.extraData&&(y=t.extraData.taskNodeId),o='\n                <div><a class="km-bind-click-event show-custom-form-sdk" data-formid='+v+" data-tasknodeid="+y+">ç¹å»æäº¤è¡¨å</a></div>\n            "}else if("iframe_link"===t.msgType)o='<div>ç¹å»<a class="ticket-iframe" data-iframe="'+t.ansCon+'">æäº¤å·¥å</a></div>';else if("order_list"===t.msgType)Ct[t.logId]=t,o='<div>ç¹å»è¿å¥<a class="show-ticket-list">å·¥åæ¥è¯¢</a></div>';else if("db_answer"===t.msgType&&Ee.isArray(t.ansCon)&&t.ansCon.length&&"chart"===t.ansCon[0].answerType)o='<div class="robot-echart" id="echart-'+(i.logId||Je.logid)+'"></div>',a="max-width:unset;height: 0; width: calc(100% - 50px);padding: 40% 0 0;position:relative;";else if(t.shortcutEntryList&&t.shortcutEntryList.length>0&&1!==t.shortcutEntryPosition)a="display:flex",s=Ft,c+="msg-shortcut",o=k(t.shortcutEntryList);else if(t.flowId){t.ansCon=T(e.ui.emotionRegcodeToHtml(t.flowContent));var b=C(t,c,s);o=b.content,c=b.typeClz,s=b.tpl}else if(t.ansCon){if(!n){var _=C(t,c,s);o=_.content,c=_.typeClz,s=_.tpl}}else if(2===t.switchStaffType)o=t.switchStaffTips||Ae.UDL.g("robot.autoSwitchStaffTips");else if(t.gusList.length>0){var x=t.gusWords;if("commonQuestion"===t.listType)if(1==Re.topAskStyle){c+="common-question vertical-common";var w=1===JSON.parse(Ge).topAsk.length;s="commonQuestion"===t.listType?r({title:t.leadingWord},w):qt;var S=I();if(w){var E=S.length?S[0].optionsList:[];Ee.each(E,function(e,t){o.push('<li class="list-item-disc common-ql" data-question-id="'+t.questionId+'" data-query-type="6"><a style="color: '+Nt.unSelectQuestionFontColor+";opacity: "+Nt.unSelectQuestionFontDiaphaneity+'" href="javascript:;">'+t.sort+".<span>"+t.question+"</span></a></li>")})}else Ee.each(S,function(e,t){var n=t.questionTypeId||"",i=t.questionType||"";o.push('<li class="list-item"><div class="link" data-question-type-id="'+n+'" style="color: '+Nt.unSelectCategoryFontColor+";background: rgba(255,255,255,"+Nt.unSelectCategoryFontDiaphaneity+'">'+i+'<i class="icon icon-ic-arrow-right-s-youjiantou"></i></div><ul class="list-menu submenu">'),Ee.each(t.optionsList||[],function(e,t){o.push('<li class="list-item-disc common-ql" data-question-id="'+t.questionId+'" data-query-type="6"><a style="color: '+Nt.unSelectQuestionFontColor+";opacity: "+Nt.unSelectQuestionFontDiaphaneity+'" href="javascript:;">'+t.sort+".<span>"+t.question+"</span></a></li>")}),o.push("</ul></li>")})}else{mt?(t.gusList.forEach(function(e,t){var n=[],i=Math.ceil(e.optionsList.length/yt);e.optionsList.map(function(e,t){e.sort=t+1});for(var r=0;r<i;r++)n.push(e.optionsList.slice(r*yt,(r+1)*yt));e.totalNum=i,e.optionsList=n}),gt=t.gusList):(t.gusList.forEach(function(e,t){e.optionsList.map(function(e,t){e.sort=t+1})}),gt=t.gusList);var A=gt[0];c+="common-question horizontal-common";var L=[],B=!0;mt&&A.totalNum<2&&(B=!1),L=mt?A.optionsList[0]:A.optionsList;var M="";switch(Bt.pictureSetting){case 1:M='<img class="common-question-img" src="images/cainixiangwen1.png" />';break;case 2:M='<img class="common-question-img" src="images/cainixiangwen2.png" />';break;case 3:M='<img class="common-question-img" src='+Bt.image+" />"}o=e.joinStr('<div class="horizontal-list-box" picture-setting='+Bt.pictureSetting+">",1===Bt.type?'<div class="common-qustion-title">'+Bt.title+"</div>":"",'   <div class="horizontal-type-wrapper" type='+Bt.type+">",'       <div class="icon icon-ic-arrow-left-s-line previous hide page"></div>','<div class="horizontal-type-list-box">','       <div class="horizontal-type-list">','       <div class="scroll-line" style="background-color: '+Nt.selectCategoryFontColor+";opacity: "+Nt.selectCategoryFontDiaphaneity+'"></div>',e.map(t.gusList,function(e,t){return'<div class="horizontal-list-type '+(0===e?"active":"")+'" type-id="'+t.questionTypeId+'" style="color:'+(0===e?Nt.selectCategoryFontColor:Nt.unSelectCategoryFontColor)+";opacity:"+(0===e?Nt.selectCategoryFontDiaphaneity:Nt.unSelectCategoryFontDiaphaneity)+'">'+t.questionType+"</div>"}),"           </div>","       </div>",'       <div class="icon icon-ic-arrow-right-s-youjiantou next hide page"></div>',"   </div>",'   <div class="horizontal-list-wrapper">',1!==Bt.type?'<div class="horizontal-list-left">'+M+"</div>":"",'       <div class="horizontal-list-right">','           <div class="horizontal-list" refresh='+(mt?"1":"0")+">",e.map(L,function(t,n){return e.joinStr('       <div class="list-item-disc common-ql" style="color: '+Nt.unSelectQuestionFontColor+";opacity: "+Nt.unSelectQuestionFontDiaphaneity+'" data-question-id="'+n.questionId+'" data-query-type="6">','           <div class="horizontal-list-item-question">'+(t+1)+".<span>"+n.question+"</span></div>",'           <div class="icon icon-ic-arrow-right-s-youjiantou"></div>',"       </div>")}),"           </div>","       </div>","   </div>",mt?'<div class="change-horizontal-question "'+(B?"hide":"")+">"+function(){for(var e="",t=0;t<A.totalNum;t++)e+='<div class="change-horizontal-page-icon  '+(0===t?"active":"")+'" data-page='+t+" ></div>";return e}()+"</div>":"","</div>")}else x=Ee.isPlainObject(x)?x.afterWords:x,s="commonQuestion"===t.listType?r({title:t.leadingWord}):qt,o.push('<ul class="list-body list-menu">'),Ee.each(t.gusList,function(e,t){var n=t.questionId||"",i=t.question,r=t.suggestAnswerType||"";o.push('<li class="list-item-disc"><a class="ql" data-question-id="'+n+'" data-suggestanswertype ="'+r+'" data-query-type="7" href="javascript:;">'+i+"</a></li>")}),o.push("</ul>"),x&&o.push('<div class="list-header">'+x+"</div>");o=Ee.isArray(o)?o.join(""):o,1===t.shortcutEntryPosition&&Array.isArray(t.shortcutEntryList)&&t.shortcutEntryList.length>0&&(s=e.replaceTpl(s,{afterHtml:k(t.shortcutEntryList,{noAnimation:!0})+"{afterHtml}",clz:"with-shortcut-entry-list {clz}"}))}Ee.isEmptyObject(o)&&(c+=" empty-switch-msg"),ut&&!q("go_chat")||1!==u&&4!==u||(c+=" has-go-chat",g='<a class="btn-go-chat btn-hollow"'+(1===u?"data-udesk-go-chat":"data-udesk-show-go-chat")+" data-customerserviceid="+p+" data-customerservicestatus="+h+">"+(l||Ae.UDL.g("agent.transfer"))+"</a>");var N={baseContent:{tpl:s,param:{msg:o,moreHtml:g||"",msgArrow:f,clz:"msg-recv",typeClz:c,aid:t.aId||0,cluid:t.cluid||"",logid:t.logid||(i?i.logId:"")||Je.logid,robotQuestions:e.ui.emotionRegcodeToHtml(t.recommendationGuidance)||Ae.UDL.g("robot.questions"),switchStaffType:u,style:a,afterHtml:""}},renderFn:m};return 3!==u&&4!==u||(N.switchStaffAnswerMsg={tpl:s,param:{msg:e.ui.emotionRegcodeToHtml(d),clz:"msg-recv",typeClz:"switch-staff-answer-msg "+(4===u?"hide-switch-staff-answer-msg":""),aid:t.aId||0,cluid:t.cluid||"",logid:Je.logid||"",switchStaffType:u}}),N}function A(e){if(!mt)return e;var t=vt%Math.ceil(e.length/yt),n=e.slice(t*yt,(t+1)*yt);return n.length!==yt&&(bt.length&&(bt=bt.slice(yt-n.length).concat(bt.slice(0,yt-n.length))),n=n.concat(e.slice(0,yt-n.length))),n}function I(){var e=JSON.parse(Ge),t=[],n=A(bt);return Array.isArray(e.topAsk)&&e.topAsk.forEach(function(e){var i=[];n.forEach(function(t){t.questionTypeId===e.questionTypeId&&i.push(t)}),i.length&&(e.optionsList=i,t.push(e))}),t}function L(e,t){Ee.ajax({url:"/im_client/js/lib/echarts.js",dataType:"script",cache:!0}).done(function(){if(echarts){var n=echarts.init(document.getElementById("echart-"+t)),i=e.ansCon[0].chart,r=i.header.indicators[0].fieldKey,o=i.header.indicators[0].fieldTitle,a=i.header.dimensions[0].fieldKey,s=[{name:o,type:"line",data:i.rows.map(function(e){return e[r]})}],c=[{name:o,type:"bar",barMinWidth:"10",barMaxWidth:"40",barGap:"30%",data:i.rows.map(function(e){return e[r]})}],l={color:["#2878ff"],legend:{left:0,padding:5,itemGap:10,data:i.header.indicators.map(function(e){return e.fieldTitle})},grid:{top:35,bottom:10,left:0,right:10,containLabel:!0},tooltip:{trigger:"axis"},toolbox:{feature:{myTool1:{show:!0,title:"åæ¢",icon:"image://data:image/gif;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMgAAADICAYAAACtWK6eAAAREElEQVR4Xu2dfbBcZX3Hv7+zNyHQGZtJ9uzuvYnTe3fXhEErdVqnEhilCFOtClVxGrUYhL4wBUcMHaWzNxLLvbaKaKFDUVRsgYpThxdtppRSphlforbSMlhSkuxuQoC7Z/dskiGC5uXu+XXO3txLQt7u3T3n2efsfve/5J7n9/0+n99+57zvI+CHBEjgpASEbEiABE5OgAHht4METkGAAeHXgwQYEH4HSKAzAtyDdMaNowaEAAMyII3mNDsjwIB0xo2jBoQAAzIgjeY0OyPAgHTGjaMGhAADMiCN5jQ7I8CAdMaNowaEAAPS540uLlv2mmDx0IeBIDs7VUecLeVa49/6fOqRTI8BiQSjfUXyufS7oFgrImsBDJ3A4VOA3iOHgq+W9+7db98M7HDEgNjRh0hdFHPuBxT4p3kW/S8RGece5cS0GJB5fouSstkCw3HUtPTTFa95c1LmaconA2KKtAGd0dHRJc6Bl7cKMNah3L84KZR2vOA/2eH4vhvGgPRRS/Mj6Q9JIP/YzZQUuhfilKq1xpe7qdMvYxmQfukkgMKw+0Mo1kQ0pb8fmtbStmZzKqJ6iSzDgCSybcebHhkZOevM4PDLUU5HgGcCkXBv8mCUdZNUiwFJUrdO4bUwsuy1CFK745mO3rLUa5aeAA7HU9/eqgyIvb1ZkLPiiPsmDfDfCxq0gI0F+F5LML6z5n9/AcMSvykDkvgWzkygmMkU1NFyvNORQwBKFa/xhXh17KnOgNjTi66dFLLugxC8t+tCpykgwAMtR0s7p5rb4tbqdX0GpNcdiFA/P5x5n6g+EGHJk5dSvAAJ9yb+PxjR65EIA9Ij8HHJFnKZ7wB6aVz1X11XoHceWny4tHv3i/tMaZrUYUBM0jagNTq6dGnql4s2QXC+AblZif+ZOTfxHzGoaUSKATGC2azI6mx2rOUED6niXJPKAvnLste4yaRm3FoMSNyEe1T/7BUrlh9uHZwA5BrDFh6FaKlSaz5hWDcWOQYkFqz2FC3kMh8BdBLASoOuXhSgVPb8OwxqxiLFgMSC1a6i+RXpVWjJhAAfMOlMVe+D0ypVa/tiusMf/2wYkPgZW6NQHE5/QlXCvcmZxkwJdohivOz5832By5i1+QgxIPOh1EfbFDOZ89TBBKAXmZyWQr4YLDmrtGvXrgMmdbvVYkC6JZjQ8YWsOxHe6DNqX7BFVEtlr7nZqG4XYgxIF/CSPjSfTb/bcWTC8OXgQBWlat3/6yTwY0CS0KUYPc68R3LoVuOXg0UfFg1KZW/v1hin13VpBqRrhP1RoEeXg70je5O7baXIgNjamR74Cl+60iB1q+nLwVD5qohTKnue34Npn1KSAbGtIxb46cnlYOApUR0v15v/bAGCOQsMiE3dsMjLzBuK8gXTl4OhmKzU/XFbUDAgtnTCUh89uRwMfdzRVGlHvf6TXmNhQHrdgQToj2Uyl6RSeovJy8EKvIyZy8G39RIRA9JL+gnTLuTSd5q/HCz3DwVS2lav7+wFLgakF9QTrFnIptdC5BaTTwcrsBOqpWq9eb9pdAyIaeJ9oBe+tegcWHSX8cvBgtvPmEZpq++/ZAojA2KKdB/qFHLudQA+b/LpYIH8JFApVev1x00gZUBMUO5jjYLrFpGSrxi/HCwYr9T88NH9WD8MSKx4B6d4Ppe+SSAbTc5YgE2tQEo7G42n4tJlQOIiO4B1i9nsW+AEXzZ5ORiAD9HxSq15VxzIGZA4qA54zULO/VsA4fmJsY8Ad0+3UNrl+16UogxIlDRZa45AuIioQMJFeAz+WIRshYNSZarxcFStYECiIsk6JyKQKuTc+wCEK+0a+wjwubLnh29LtroVZUC6JcjxpyVQyLnrANxp8nIwgM0IpFRpNLac1uApNmBAuqHHsfMmMJbJZFMpvVcVl8x7UPcbHhDRUrnW/GKnpRiQTslxXEcEisPp9apya0eDOxykwLfRQqnq+zsWWoIBWSgxbt81gWJu2TmKVHhu8qaui827gOwWwXi51rh33kMAMCALocVtIyWQH3Y/K4q/iLToaYopcAcOTpeq+/a9OB9dBmQ+lLhNbAReN+y+NVCEe5PXxiZyfOEnRKRUrjUePZ0mA3I6Qvy7EQKFbOYuiP6xEbEjIgrdWPWanzmVJgNisiPUOiWBI0vIhecIZxlE9Yg4KJWn/HARoOM+JwzIWCZzbioVXBSonCfAeWbvhhpEQykSmCGwTyGlqtcI79Uc8zkuIPmse5UIwnUdlpAeCQwYgXump/XGZ5vN2uy8jwlIIeeGy/quGjAonC4JHE1gl6p+rFpvbgr/cy4gheH0Y1C5mKxIgAT0aTkUrCnv3bu/HZBCzr0SwDcIhgRIYIaAQj9T9ZobZwIy7P4QijWEQwIkMEdge8XzV0t7Xe0Di/pyEXg2mwS6ISDQ35FCdvlFEMfIL0R0Y5ZjSaAHBD4q+Vx6o0D6avH3HoCkZB8SCM9DuAfpw8ZySpER+D2eg0TGkoX6jcDBoYPLeRWr37rK+URF4EcVz1/D+yBR4WSd/iIgeGel5v8r76T3V1s5mwgIiMqXyvXG+rDUq5/Feo5P7kZAmCUSS0Age8teY/nsBI57mrcw7JagmEjsDGmcBDon8K2K53/w6OEnfB8kP5L+kBPI21WxGoLVANKda3IkCVhLIFx2+mmobFfRH1c9/7jnEflGobW9ozEbCDAgNnSBHqwlwIBY2xoas4EAA2JDF+jBWgIMiLWtoTEbCDAgNnSBHqwlwIBY2xoas4EAA2JDF+jBWgIMiLWtoTEbCDAgNnSBHqwlwIBY2xoas4EAA2JDF+jBWgIMiLWtoTEbCDAgNnSBHqwlwIBY2xoas4EAA2JDF+jBWgIMiLWtoTEbCDAgNnSBHqwlwIBY2xoas4EAA2JDF+jBWgIMiLWtoTEbCDAgNnSBHqwlwIBY2xoas4EAA2JDF+jBWgIMiLWtoTEbCDAgNnSBHqwlwIBY2xoas4EAA2JDF+jBWgIMiLWtoTEbCDAgNnSBHqwlwIBY2xoas4EAA2JDF+jBWgIMiLWtoTEbCDAgNnSBHqwlwIBY2xoas4EAA2JDF+jBWgIMiLWtoTEbCDAgNnSBHqwlwIBY2xoas4EAA2JDF+jBWgInDEg+m/11IHiziK4GpAhgmbUzoDES6JCAAj6gWx1xKuLoz3a84D/56lLHBaSYTV+qIl8D4Haoy2EkkEQCP1dgsur5nzva/DEByefcOwT4syTOjp5JIAoCAjxQ9vzLZ2vNBSSfy9wq0PVRiLAGCSSZgAJXVT3/G+Ec2gHJD7sXiOL7SZ4UvZNAlAQ0paurLzS3zwQk535XgPdEKcBaJJBoAoqHKnX/fXIhMPRc1vUhWJroCdE8CURLYP9Sz09LPrf8zQLnP6OtzWok0AcEHLlA8tn09SLypT6YDqdAApESENEbJD+cuUZU74y0MouRQD8QUKyVwrD7Dige6Yf5cA4kECWBFlJjR65ipfcIhI+TREmXtRJOQJ+ueM03tANSyLm3A/hYwmdE+yQQGQGBXFv2Gn/XDsiqkZF0KzhcAfCayBRYiASSSkD03yu15iWh/blHTQojmfMR6A+SOif6JoGoCAhSmbLn+ccEJPxHMbfsHEjqm6o4Nyox1iGBBBHYPDStl25rNn8+6/m4x93PXrFi+eHpg5MQ+dMETYxWSaBTArtEZQsQ/Ee53gxf8zjmc9I3Cgs5dx0UkxCs6FR5oeNE8BhUP7vQcdyeBDohkNLUs9vq9Z2nGnvKV27HRtKrU4FMKvD+Tgx0PkbWVbzGPZ2P50gSiIbAvN5JL+Qyfw7oBIAzopE9fRUR+ebKWmPdZmD69FtzCxKIh8C8AhJKH7nKNQngbfFYOWHVPQCuqHg+7/QbhE6pVwjMOyBHhqSKOTc85PqUUYiC2yo1/3qjmhQjgaPvgyyERjGbvUylNQnI6xcyrpttBXgmEL2iWmv+tJs6HEsCCyGw0D3IXO2xTCYrKZ0UxdULEex6W8GGSs0Pz4f4IYHYCXQckFlnxWz6j1Qk/MJmY3f7isAP0MJHK75fNqhJqQEk0HVAQmbFXO71KtOTULnMKEPRayq15leMalJsoAhEEpBZYvmse6MIwr1JyhhFxUOAc02lXm8Y06TQwBCINCAze5P021QlvAN/vkGKv1CRK6q1xoMGNSk1AAQiD0g7JMXiGfrS/klAbzDKUOWug4sWX//888//0qguxfqWQCwBmaU1lnMvd9A+5FptjqA+q5q6ulqvP25Ok0r9SiDWgITQVq1cvqI17YR34NcZhaiYrNT9caOaFOs7ArEHZO4EfubXU8K9yXKDFH8aILh2p7eHv/tlEHo/SRkLSAjtda77G0Gqfcj1LpMQVfQT1Vrzb0xqUqs/CBgNyCyywrA7DsXNhhE+0nKC9bum9jxjWJdyCSbQk4CEvPKZzMVwggmB/LZBfoEo/qRc979uUJNSCSbQs4CEzN6Yzf7Ky04wCcXHzTLUe4emceO2ZnPKrC7VkkagpwGZO+TKptdi5nmugkGADQGuK3v+tw1qUiphBKwISMhsNJcbHdJgQkU/bJSh4Lahw7rh6F+yMKpPMasJWBOQub1Jzr0OMzcXf9UcOX1axLmhXGs8ak6TSkkgYF1A2ifww+nfEm0fcv2uWYhyc8VrfNqsJtVsJmBlQGaBFXOZjQq9yTDAzQikVGk0thjWpZyFBKwOSMjryPIM4d7kN83yk09WvMYtZjWpZhsB6wPSPoFfunSps2TRhADXGgWo+jCQ2lCp1//XqC7FrCGQiIDMHXINZ/5QNZgA5NcMEtwP0U/yzUWDxC2SSlRA2odcrlvEzPNcf2CWo94byKINO2u1Z83qUq2XBBIXkFlY+eH09RK+uQicZRBgRVU3VOvN+w1qUqqHBBIbkJBZMZt9i0r4CL2+3SRDBe6YXnxow+7dL+4zqUst8wQSHZBZXIWsOwFBySQ+VTwJtPcmm0zqUsssgb4ISIgsn02/W6R9yPVGkwhV8FfVmr8BQMukLrXMEOibgIS42msttqYnIGp08R8FvictXM0fsjPzpTWp0lcBmTvkyrlXAgj3JiMGYf445Sx6z/apqaZBTUrFTKAvAxIyGx1ZfvZQ4EyYXPxHgE0rPf+9XNMk5m+twfJ9G5BX9ibh4j9B+Ev0i41wFYxXan649+KnDwj0fUDaJ/DD7gXheosCvNVAz7ZXPN/g74AZmNEASwxEQML+XggMPZ9zw0Ou2Bf/EdXLyvXmdwf4e9U3Ux+YgMwdco1kfh9BeAKv58TXRflUxWt8Pr76rGyKwMAFpH0C77o5ZwgTcS3+o4qrq3X/blNNpE58BAYyILM4jyz+E55QZ6JEzEOsKGn2ttZAByREX8hm3wDR8JDr0qha4Uhwzo7anv+Lqh7r9I7AwAfklb2Je6NK++ai02U7flTx/DVd1uBwSwgwIEc1ophLX6jh81yKzr/gio9X6v7tlvSXNrokwIC8CuDo6OgS58AvJgW6vgO2P4M6F3M5uA7IWTqEATlJY4o593KdeZ5r1Tx7txlO6yOVqb3PzXN7bpYAAgzIKZpUXLFspbacEiDh4j9nnmxTAR5Y3MKVW33/pQT0nBYXQIABmQes9mP0wfRVgL7z6M1FcV/gTD9Wre3bPY8y3CSBBBiQBDaNls0RYEDMsaZSAgkwIAlsGi2bI8CAmGNNpQQSYEAS2DRaNkeAATHHmkoJJMCAJLBptGyOAANijjWVEkiAAUlg02jZHAEGxBxrKiWQAAOSwKbRsjkCDIg51lRKIAEGJIFNo2VzBBgQc6yplEACDEgCm0bL5ggwIOZYUymBBBiQBDaNls0RYEDMsaZSAgn8PyQ1EKNS8ArpAAAAAElFTkSuQmCC",onclick:function(){"line"===n.getOption().series[0].type?n.setOption({series:c}):n.setOption({series:s})}}}},xAxis:[{type:"category",boundaryGap:[20,20],data:i.rows.map(function(e){return e[a]})}],yAxis:[{type:"value"}],dataZoom:[{type:"inside"}],series:s};n.setOption(l)}})}function B(e){var t=e.content,n=e.logid,i=e.im_robot_log_id,r=Ee(decodeURI(t)),o=r.find(".active").attr("udesk-card-category-type");r.find(".udesk-card-category-item").each(function(){Ee(this).attr("udesk-card-category-type")===o?Ee(this).removeClass("hide"):Ee(this).addClass("hide")}),Z(r.prop("outerHTML"),{logid:n,im_robot_log_id:i,from:"drawer"})}function D(t){t=Ee.extend({clz:"",log_created_at:new Date},t);var n=t.content||{};t.unsatisfiedTags&&(Pt[Je.logid]=t.unsatisfiedTags.filter(function(e){return e.enable})),t.noXss||t.isWelcome||t.isRecv||"string"!=typeof n||(n=w(n),Ae.IsImgOrVideo(n,"image")&&(n='<img src="'+n+'" />',t.clz+=" msg-image"));var i,r,o,a=jt,c={msg:n,clz:t.clz,senderName:t.senderName||Je.name,msgTime:t.msgTime||Ae.formatDateTime(t.log_created_at),themeBg:t.themeBg||"",logid:t.logid||t.logId,im_robot_log_id:t.im_robot_log_id,afterHtml:"",aid:t.aid,cluid:t.cluid},l=t.messagesEl||Le.messages;if("msg-recv"===t.clz||t.isRecv?c.avatarStyle='style="background-image: url('+(Ae.frameConfig.agent_avatar||Je.logoUrl||"/im_client//images/im_client_robot_header_default.png")+')"':(c.clz+=" msg-send ",c.avatarStyle='style="background-image: url('+($e.avatar||Ae.frameConfig.sys_customer_logo||"/im_client/images/im_client_customer_header_default.png")+')"'),t.isRecv){switch(n.msgType){case"selective_table":case"selective_list":case"selective_product":case"show_product":case"custom_card":r=!0}r&&n.ansCon&&e.robot.structCardMsg({container:l,answer:n,render:function(i,r){var o="";return o=Ee(2==n.ansCon.cardListType?e.replaceTpl(a,Ee.extend(c,{clz:"msg-recv msg-card-horizontal msg_"+n.msgType+(n.ansCon.title?"":" msg-card-horizontal-no-title"),msg:n.ansCon.title||i,moreHtml:n.ansCon.title?i:"",afterHtml:""})):e.replaceTpl(a,Ee.extend(c,{clz:"msg-recv msg_"+n.msgType,msg:i,moreHtml:c.moreHtml||"",themeBg:2!==n.showType&&n.ansCon.pageType?"vertical-card-content":"",afterHtml:""}))),t.invalidTransfer&&o.attr("data-invalid-transfer",!0),t.renderFn?t.renderFn(o):l.append(o),o},afterRender:function(e){2!=n.showType||3==n.ansCon.cardListType||Ct[n.logId]||(n.showType="",Ct[n.logId]=n);try{var i=e.data("invalid-transfer");if(i)return;var r=e.attr("logid"),o=e.attr("im_robot_log_id"),a=e.find(".drawer-card"),s=a.data("card-list-type");kt=a.data("page-size"),a.size()&&3!=s&&N(r,o)}catch(c){console.log(c)}t.renderFn||t.noScroll||(Ae.judgeScrollDistance(e,{isRecv:t.isRecv,isRobot:!0}),Ae.setQueueMsgGoBottom())},on:function(e,t,n){if("item"===e){var i=t.value||t.name||t;R(i)}else if("struct"===e){try{Et=JSON.parse(decodeURI(t.switchStaffInfo||Se))}catch(r){console.log("ä¼ éä¸å¡è®°å½å¤±è´¥")}R(t.el,{hitSource:3,hitContent:t.hitContent,question_type:"rich"},{noXss:!0,themeBg:"send-struct-card",im_robot_log_id:t.im_robot_log_id,logid:t.logid,deleteMore:!0})}else"drawer"===e&&(3==t.cardListType?B({content:t.hitContent,logid:t.logid,im_robot_log_id:t.im_robot_log_id}):(kt=t.pageSize,N(t.logid,t.im_robot_log_id)))}});var u={},d={};t.notRobotAnsHandler||(u=E(n,r,t)||{},d=u.baseContent||{},i=u.switchStaffAnswerMsg,t.before_renderFn=u.renderFn,a=d.tpl),c=Ee.extend({},c,d.param),c&&c.clz&&c.typeClz&&(c.clz+=" "+c.typeClz,delete c.typeClz)}else!t.clz&&(c.themeBg="theme-bg "+c.themeBg);if(n.knowledgeResponse&&n.knowledgeResponse.knowledgeId){var p=Ee('<button class="knowledge-graph">æ¥çå¾è°±</button>');p.attr("data-knowledge-id",n.knowledgeResponse.knowledgeId),p.attr("data-params",JSON.stringify(s({s:"knowledge_diagram"}))),c.moreHtml="<div>"+Ee("<div></div>").append(p).html()+"</div>"}if("uploading"===t.type&&(c.msg='<div class="progress-max" id='+t.fileId+'><div class="progress-per"></div></div>',c.clz+=" msg-uploading"),!Ee.isEmptyObject(c.msg)||!Ee.isEmptyObject(c.moreHtml)){c.msg=e.ui.emotionRegcodeToHtml(c.msg),c.moreHtml=e.ui.emotionRegcodeToHtml(c.moreHtml),c=Ee.extend({},c,{moreHtml:c.moreHtml||"",style:c.style||"",themeBg:c.themeBg||""}),Ee.isEmptyObject(c.msg)&&(o=c.style,c.style+="padding: 0px;");var h=function(){var n=Ee(e.replaceTpl(a,c));return t.invalidTransfer&&n.attr("data-invalid-transfer",!0),n}();if(t.before_renderFn&&t.before_renderFn(h),t.renderFn)t.renderFn(h);else{if(l.append(h),"db_answer"===n.msgType&&L(n,t.logId||Je.logid),t.invalidTransfer||"order_list"!==n.msgType||W(n.ansCon),Ee(h).find(".km-bind-click-event.chanpinzixun-a").size()&&!Ee(h).data("invalid-transfer")){var f=Ee(h).find(".km-bind-click-event.chanpinzixun-a").data("iframe");X({src:f,clz:"feedback-modal statsurvey",contentClz:"scrollbar"})}if(Ee(h).find(".km-bind-click-event.show-custom-form-sdk").size()&&!Ee(h).data("invalid-transfer")){var g=Ee(h).find(".km-bind-click-event.show-custom-form-sdk").data("formid"),m=Ee(h).find(".km-bind-click-event.show-custom-form-sdk").data("tasknodeid");G({formId:g,taskNodeId:m,clz:"feedback-modal statsurvey custom-form-modal",contentClz:"scrollbar"})}c.clz.indexOf("horizontal-common")>-1&&(Ee(h).find(".scroll-line").css("width",Ee(h).find(".horizontal-list-type.active").width()+"px"),!Ie.isMob&&Ee(".horizontal-type-list")[0].scrollWidth>Ee(".horizontal-type-list")[0].clientWidth&&Ee(".horizontal-type-wrapper .next").removeClass("hide"),M(h)),n.gusList&&setTimeout(function(){Ee(1==$t?".horizontal-list > .list-item":".horizontal-list > .list-item-disc").css("border-bottom","1px solid rgba(0, 0, 0, 0)"),Ee(".horizontal-list").css("transform","translateX(0)"),Ee(".horizontal-list").css("opacity","1"),setTimeout(function(){Ee(1==$t?".horizontal-list > .list-item":".horizontal-list > .list-item-disc").css("border-bottom","1px solid rgba(0, 0, 0, 0.1)")},600)}),t.noScroll||Ae.judgeScrollDistance(h,{isRecv:t.isRecv,isRobot:!0})}if(l.find(".more-btn").off("click").click(function(e){var t=Ee(e.currentTarget).text();t===Me("tip.seeMore")?(Ee(e.currentTarget.parentElement).addClass("more-show"),Ee(e.currentTarget).html(Me("tip.putItAway")+"<span class='icon icon icon-arrow-up'></span>")):(Ee(e.currentTarget.parentElement).removeClass("more-show"),Ee(e.currentTarget).html(Me("tip.seeMore")+"<span class='icon icon icon-arrow-down'></span>"))}),l.find(".theme-bg").each(function(){var e=Ee(this);e.css("background",ot),e.css("color",Ae.frameConfig.customerTextColor),e.find("i").css("color",ot).css("border-left-color",ot)}),Qe){var v=h.find(".btn-go-chat");v.css("left",l.width()/2-v.outerWidth()/2)}}if(t.shortcutMsg){var y=Ee(".shortcut-li").length,b=8,_=Ee(".shortcut-li").outerWidth()+b,x=Ee(".bot").outerWidth(),k=y*_-b;Ee(".shortcut-li").each(function(e,t){setTimeout(function(){Ee(t).css("transition-duration",1e3-100*e+"ms"),Ee(t).css("transform","none")},100*e)}),!Ie.isMob&&k>=x&&(Ee(".bot.bot-shortcut .msg-shortcut").css("padding","0 0 0 16px"),Ee(".bot.bot-shortcut .s-right").show()),!Ie.isMob&&Ee(".shortcut-box").off("scroll").on("scroll",function(){te()})}if("commonQuestion"===n.listType&&l.find("#accordion").length){new Qt(Ee("#accordion"),(!1))}if(i){c.msg=e.ui.emotionRegcodeToHtml(c.msg);var T=Ee.extend({},c,{style:o},i.param);T&&T.clz&&T.typeClz&&(T.clz+=" "+T.typeClz,delete T.typeClz),T.moreHtml="";var S=Ee(e.replaceTpl(jt,T));t.renderFn?t.renderFn(S):(l.append(S),t.noScroll||Ae.judgeScrollDistance(S,{isRecv:t.isRecv,isRobot:!0}))}}function M(t,n){var i=t.find(".horizontal-list-right");i.unbind(),Dt=i.width();var r="";!n&&(n=gt[0]);for(var o=1;o<n.totalNum;o++){var a=e.map(n.optionsList[o],function(t,n){return e.joinStr('<div class="list-item-disc common-ql" data-question-id="'+n.questionId+'" data-query-type="6">','   <div class="horizontal-list-item-question">'+n.sort+".<span>"+n.question+"</span></div>",'<div class="icon icon-ic-arrow-right-s-youjiantou"></div>',"</div>")}).join("");a='<div class="horizontal-list no-animation">'+a+"</div>",r+=a}i.append(r),i.scrollLeft(0),V(i)}function N(e,t){wt=1,Y({answer:Ct[e],logid:e,im_robot_log_id:t,hideReselect:!0})}function j(e){return Ae.checkMsgSensitivity(e)}function R(t,n,i){Lt=+new Date,i=i||{};var r=t||Ee.trim(et.val()),o=n?n.queryType:"",a=o?Wt.CLICK:Wt.CHAT,c=i.msgSource||"",l=i.skip||!1,u=i.notResault||!1;"iframe"===c&&(r=t.content),i.noXss||u||l||(r=w(r)),r&&j({content:r,type:"message",skip:l}).then(function(){clearTimeout(xt),!Ke&&(!n||!n.features||n.features.indexOf("volunteered_ask")<0)&&St&&St.satisfiedAutoPushFlag&&(xt=setTimeout(function(){e.context.els.body.hasClass("robot")&&R('<div class="auto-satisfaction">'+St.satisfiedAutoPushContent+"</div>",{s:"aq",personifyRobot:!0,clz:"msg-recv",features:["volunteered_ask"]},{notResault:!0,notRobotAnsHandler:!0,isSlienceMsg:!0,isAutoSatisfaction:!0})},1e3*St.satisfiedAutoPushTime));var t=r;i.deleteMore&&(t=Ee(r),t.find(".show-card-popup").remove(),t=t.prop("outerHTML"));var o=p(),c=s(Ee.extend({s:a,question:t,sessionId:Je.sessionId,dialogueParam:JSON.stringify({knowledge_point_name:decodeURI(o.dialogueParam||"")||""})},n));Ze.empty().hide(),Oe||(D({content:r}),et.val("").height(ke)),Ae.setBtnSendActive(),Ae.autoSize(),Ee.post(Ve,c,function(e){if(0!==e.status)return Ae.showTip(Ae.UDL.g("tip.newError"),"danger");if(6400===e.code)return Ae.showTip(Ae.UDL.g("tip.sensitiveWords"),"danger");if(u)return void D({isRecv:!0,clz:"msg-recv",content:r,notRobotAnsHandler:i.notRobotAnsHandler});Oe&&(Ze.empty().hide(),l||D({noXss:i.noXss,isRecv:i.isRecv||!1,content:r,notRobotAnsHandler:i.notRobotAnsHandler,themeBg:i.themeBg,logid:i.logid,im_robot_log_id:i.im_robot_log_id,type:i.type}),et.val("").height(ke),z()),qe&&z();for(var t=0;t<e.robotAnswer.length;t++){var n=0===t?_extends({},e):{};n=_extends({},n,{sessionId:e.sessionId,logId:e.robotAnswer[t].logId,im_robot_log_id:e.robotAnswer[t].im_robot_log_id||e.im_robot_log_id,robotAnswer:[_extends({aId:e.robotAnswer[t].aId||"",ansCon:e.robotAnswer[t].ansCon||[],msgbox:e.robotAnswer[t].msgbox||"",msgType:e.robotAnswer[t].msgType||"",showType:e.robotAnswer[t].showType||"",gusList:e.robotAnswer[t].gusList||[],relateList:e.robotAnswer[t].relateList||[],hitQuestion:e.robotAnswer[t].hitQuestion||"",flowId:e.robotAnswer[t].flowId||"",flowTitle:e.robotAnswer[t].flowTitle||"",flowContent:e.robotAnswer[t].flowContent||"",attachmentList:e.robotAnswer[t].attachmentList||[],delayMillis:e.robotAnswer[t].delayMillis||"",silenceSeconds:e.robotAnswer[t].silenceSeconds||"",recommendationGuidance:e.robotAnswer[t].recommendationGuidance||"",wechatRecommendationSuffix:e.robotAnswer[t].wechatRecommendationSuffix||"",enableAppraise:e.robotAnswer[t].enableAppraise||!1,knowledgeResponse:e.robotAnswer[t].knowledgeResponse||""},e.robotAnswer[t])]});var o=n.switchStaffType,a=n.switchStaffTips,s=n.switchStaffAnswer,c=n.unsatisfiedTags,d=n.customerServiceStatus,p=n.customerServiceId;0===t&&(Je.logid=n.logId);var h=Vt.judgeIsPersonification(n);h?Vt.pushItem(n):D({isRecv:!0,clz:"msg-recv",log_created_at:n.log_created_at,content:o&&2!==o?Ee.extend({switchStaffType:o,switchStaffTips:a,switchStaffAnswer:s,customerServiceStatus:d,customerServiceId:p},n.robotAnswer[0]):n.robotAnswer[0],unsatisfiedTags:c,im_robot_log_id:n.im_robot_log_id,logid:n.logId}),Vt.setSilenceMessage(n)}O(e,!0),Ae.setBtnSendActive()})},function(e){e&&e.message&&(Ae.showTip(e.message,"error"),Le.txtMsg.val(""))})}function O(e,t){1e3===e.code&&0===e.status&&2===e.switchStaffType&&(Ie.switchStaffType=e.switchStaffType,It=e.switchStaffType,D({isRecv:!0,log_created_at:e.log_created_at,content:{switchStaffTips:e.switchStaffTips,switchStaffType:e.switchStaffType}}),ut?t?setTimeout(function(){q("auto_transfer")&&F("auto_transfer")},200):q("auto_transfer")&&F("auto_transfer"):(0===e.customerServiceStatus?Ie.km_rule_agent_id=e.customerServiceId:1===e.customerServiceStatus&&(Ie.km_rule_group_id=e.customerServiceId),"shouqianba"===Ae.company.subdomain?P():setTimeout(function(){P()},2e3)))}function q(e){var t=We.udesk_sdk_features;return!!t&&(","+t+",").indexOf(","+e+",")>-1}function F(e,t){e&&(document.location="js://webview?"+Ee.param(Ee.extend({udesk_notice_type:e},t)))}function z(){Pe&&Ue&&!He&&(Ye++,Ye>=Ue&&(ut?Ae.compareStr(We.sdk_version,"4.0",">=")&&F("show_transfer"):ie(),He=!0))}function U(){var e=new Date,t=e.getMonth()+1,n=e.getDate();t>=1&&t<=9&&(t="0"+t),n>=0&&n<=9&&(n="0"+n);var i=e.getFullYear()+"-"+t+"-"+n+" "+e.getHours()+":"+e.getMinutes()+":"+e.getSeconds();return i}function P(){if("udesk_robot"===Ae.company.robot.channel){var t=e.common.frameConfig.urobot_transfer_manual;if(t&&t.enable&&t.jump_links){var n=t.jump_links+"&session_id="+Mt+"&web_token="+$e.web_token+"&openid="+We.openid+"&sessionId="+Je.sessionId+"&jump_url="+encodeURIComponent(window.location.href+"&transfer=true");return void window.location.replace(encodeURI(n))}}var i=function(){clearTimeout(xt),q("go_chat")?F("go_chat"):(Ee("#"+Be.transferEventMsgId).remove(),Le.messages.append(Ee(ft.titleRadiusItemTpl({id:Be.transferEventMsgId,msg:Me("agent.transferring")}))),Ae.doTransferCount(Je.sessionId,function(){var e=0;e=At?-1:-2,2===It?e=-3:Ie.switchStaffType="";var t={s:"transfer_route",sessionId:Je.sessionId,sessionLogId:Je.logid?Je.logid:"",transferRoute:e,isHit:!At,timestamp:U(),im_web_plugin_id:We&&We.web_plugin_id,window_init_time:Ae.supportStore("sessionStorage")?sessionStorage.getItem("window_init_time"):void 0};Ee.get("/udesk_im/aifaq/v1/web_proxy",t),Ie.chatAgent=null,Ae.doTransfer(),Ze.empty().hide(),De=!0,Ie.transferStatus=At,Ie.sessionId=Je.sessionId,Ie.sessionLogId=t.sessionLogId,It="",At=!1}))};if(Et){for(var r in Et)Et["c_cn_"+r]=Et[r],delete Et[r];Ae.urlParamObj=Object.assign(Ae.urlParamObj,Et),Ae.loadUser(function(){i()})}else i()}function H(e){return Ke?Ae.showTip(Me("robot.hasSurvey")):(e.stopPropagation(),x(Ie.robotSurveyData))}function $(){function t(e){var t=Ee(this),n=t.hasClass("guide-anwser"),i=(t.data("content")?decodeURI(t.data("content")):"")||t.text()||"",r=t.data("question-id"),o=t.data("query-type"),a=t.data("params"),s=t.data("suggestanswertype"),c={logId:Je.logid,queryType:o,suggestAnswerType:s};r&&(c.questionId=r),"object"==typeof a&&Ee.extend(c,a),n&&(i=i.replace(/^\d+./,"")),Oe||qe||Fe||ze?R(i,c):R(i),e.stopPropagation()}function n(e){var t=JSON.parse(Ge);vt++;var n={gusList:t.topAsk,listType:"commonQuestion",leadingWord:t.webConfig.leadingWord||Ae.UDL.g("robot.questions")},i=E(n,!1),r=1===t.topAsk.length,o="";if(Ee("#accordion"))try{o=Ee("#accordion")[0]}catch(e){console.log(e),o=Ee("#accordion")}if(o){r?Ee(o)[0].className="horizontal-list list-body list-menu submenu one-submenu":Ee(o)[0].className="horizontal-list list-body accordion";var a=i.baseContent.param.msg;o.innerHTML=a}if(!r){new Qt(Ee("#accordion"),(!1))}}f(),Ae.bodyEl.on("click.bot",".ql",t),Ae.footerEl.on("click.bot","[data-question-id][data-query-type]",t),Ae.bodyEl.on("click.bot",".change",n).on("click",".card-choice-mask",function(e){ee()}),Ae.btnInnerTransferEl.click(P),tt.on("click.bot",".help",function(t){var n=Ee(this),i=!0,r=n.parents("dd"),o=n.parents(".help-box"),a=n.find(".icon"),s=r.attr("aid"),c=r.attr("cluid"),l=r.attr("logid"),u=r.attr("im_robot_log_id"),p=o.data("hit-question"),h=(r.find(".more-msg-box"),"true"===o.attr("taskappraise")),f=o.attr("multimessageid");if(t.stopPropagation(),o.find(".active").size())return Ae.showTip(Ne("hasEvaluation"),"danger");n.is(".help-no")&&(i=!1);var g=Pt[l];if(!i&&g&&g.length){for(var m="",v=0;v<g.length;v++){var y=g[v];m+='<div class="no-reason-item" reasonId='+y.id+">"+y.content+"</div>"}D({isRecv:!0,clz:"msg-recv",themeBg:"no-reason",
content:e.replaceTpl(Rt,{style:"disable",content:m,taskAppraise:h,multiMessageId:f}),msgTime:r.find(".time-text").text(),notRobotAnsHandler:!0,aid:s,cluid:c,logid:l,im_robot_log_id:u,renderFn:function(e){Ee(r).after(e),Ee(e).offset().top+Ee(e).height()>Ee("#content").outerHeight(!0)+64&&Ee("#content").scrollTop(Ee("#content").scrollTop()+Ee(e).height())}})}d(i,s,c,l,p,h,f),i?(a.removeClass("icon-ic-thumb-up-zan"),a.addClass("help-gif"),a.css("background-image",'url("/im_client/images/like.gif?'+Math.random()+'")'),o.find(".help-no").hide()):(a.removeClass("icon-ic-thumb-down-cai"),a.addClass("help-gif"),a.css("background-image",'url("/im_client/images/dislike.gif?'+Math.random()+'")'),o.find(".help-yes").hide()),n.addClass("active"),a[0].className=a[0].className.replace("good1","good2")}).on("click.bot",".wflink",function(e){var t=Ee(this),n=t.hasClass("robot-flow"),i=t.attr("rel"),r=t.text(),o=t.parents("dd"),a=o.attr("logid"),c=s({s:Wt.GUIDEA,fid:i,sessionId:Je.sessionId,flowContent:r,logId:a});n&&(c.flowId=t.data("id")),Ee.post(Ve,c,function(e){Je.logid=e.logId,D({content:r});for(var t=0;t<e.robotAnswer.length;t++)D({isRecv:!0,content:e.robotAnswer[t]})}),e.stopPropagation()}).on("click.bot",".submenu li.common-ql,.horizontal-list-right .common-ql",function(e){var t=Ee(this),n=t.find("span").text()||"",i=t.data("question-id"),r=t.data("query-type"),o={logId:Je.logid,queryType:r,questionId:i};Oe||qe||Fe||ze?R(n,o):R(n),e.stopPropagation()}).on("click.bot",".shortcut-li",function(){var e=Ee(this),t=e.data("type"),n=e.data("content");2!=t&&R(n,{hitSource:1})}).on("click.bot",".s-arrow",function(){var e=Ee(this),t=e.is(".s-left"),n=e.is(".s-right"),i=Ee(".shortcut-box").outerWidth(),r=Ee(".shortcut-box").scrollLeft(),o=0;t&&(o=r-i),n&&(o=r+i),Ee(".shortcut-box").animate({scrollLeft:o},function(){te()})}).on("click.bot",'.km-bind-click-event[data-message-type="1"]',function(){var e=Ee(this).data("content");e&&R(e)}).on("click.bot",'.bot[data-invalid-transfer="true"] .km-bind-click-event[data-message-type="2"],.bot[data-invalid-transfer="true"] .btn-transfer,.bot[data-invalid-transfer="true"] [data-udesk-go-chat]',function(){Ae.showTip("æé®å·²ç»å¤±æï¼è¯·éæ°è·åè½¬äººå·¥æé®","error")}).on("click.bot",'.bot:not([data-invalid-transfer="true"]) .km-bind-click-event[data-message-type="2"]',function(){var e=Ee(this);try{var t=e.data("rule");t.agent_id&&(Ie.km_rule_agent_id=t.agent_id),t.group_id&&(Ie.km_rule_group_id=t.group_id)}catch(n){}P()}).on("click.bot",'.km-bind-click-event[data-message-type="4"]',function(){var e=Ee(this),t=e.attr("data-next-action-type");if("NEXT_NODE"===t){var n=e.attr("data-flow-id"),i=e.attr("data-node-id"),r=e.html();R(r,{flowId:n,nodeId:i})}else if("OPEN_LINK"===t){var o=e.attr("data-link-address");window.open(o,"_blank")}}).on("click.bot",".horizontal-list-type ",function(){var t=Ee(this),n=t.attr("type-id"),i=t.attr("class"),r=t.parents(".horizontal-list-box"),o=r.find(".horizontal-list-right"),a=r.find(".change-horizontal-question"),s=t.offset().left-r.offset().left-("none"===r.find(".previous").css("display")?12:34),c=r.find(".scroll-line"),l=t.width(),u=r.find(".horizontal-type-list").scrollLeft();if(!(i.indexOf("active")>-1)){c.css("left",s+u-(2==Bt.type?82:0)+"px"),c.css("width",l+"px"),r.find(".active").css({color:Nt.unSelectCategoryFontColor,opacity:Nt.unSelectCategoryFontDiaphaneity}),r.find(".active").removeClass("active"),t.addClass("active"),t.css({color:Nt.selectCategoryFontColor,opacity:Nt.selectCategoryFontDiaphaneity});var d=[],p=gt.find(function(e){return e.questionTypeId==n});p.totalNum>1?(a.removeClass("hide"),r.removeClass("no-page")):(a.addClass("hide"),r.addClass("no-page")),d=mt?p.optionsList[0]:p.optionsList;var h=e.map(d,function(t,n){return e.joinStr('<div class="list-item-disc common-ql" style="color: '+Nt.unSelectQuestionFontColor+";opacity: "+Nt.unSelectQuestionFontDiaphaneity+'" data-question-id="'+n.questionId+'" data-query-type="6">','   <div class="horizontal-list-item-question">'+n.sort+".<span>"+n.question+"</span></div>",'   <div class="icon icon-ic-arrow-right-s-youjiantou"></div>',"</div>")}).join("");o.html('<div class="horizontal-list no-animation">'+h+"</div>"),mt&&M(r,p);for(var f="",g=0;g<p.totalNum;g++)f+='<div class="change-horizontal-page-icon  '+(0===g?"active":"")+'" data-page='+g+" ></div>";a.html(f)}}).on("click.bot",".horizontal-type-wrapper .next",function(){var e=Ee(this),t=e.parents(".horizontal-type-wrapper"),n=t.find(".previous"),i=Ee(".horizontal-type-list")[0].scrollLeft,r=Ee(".horizontal-type-list")[0].clientWidth,o=Ee(".horizontal-type-list")[0].scrollWidth-r,a=i+r;n.hasClass("hide")&&n.removeClass("hide"),a>o&&(a=o,e.addClass("hide")),Ee(".horizontal-type-list").animate({scrollLeft:a})}).on("click.bot",".horizontal-type-wrapper .previous",function(){var e=Ee(this),t=e.parents(".horizontal-type-wrapper"),n=t.find(".next"),i=Ee(".horizontal-type-list")[0].scrollLeft,r=Ee(".horizontal-type-list")[0].clientWidth,o=i-r;o<0&&(o=0,e.addClass("hide")),n.hasClass("hide")&&n.removeClass("hide"),Ee(".horizontal-type-list").animate({scrollLeft:o})}).on("click.bot",".change-horizontal-page-icon",function(){var e=Ee(this),t=e.parents(".horizontal-list-box"),n=e.data("page");Q(t,n,"icon")}).on("click.bot",'.bot[data-invalid-transfer="true"] .show-card-popup,.bot[data-invalid-transfer="true"] .horizontal-more',function(){Ae.showTip("æé®å·²ç»å¤±æï¼è¯·éæ°è·å","error")}).on("click.bot",'.bot:not([data-invalid-transfer="true"]) .show-card-popup',function(){var e=Ee(this),t=e.parents("dd.bot"),n=t.attr("logid"),i=t.attr("im_robot_log_id");"drawer"==e.attr("from")?Ee("dd").each(function(e,t){Ee(t).attr("logid")==n&&Ee(t).find(".drawer-card").size()&&B({content:Ee(t).find(".drawer-card").data("data"),logid:n,im_robot_log_id:i})}):(kt=e.attr("page-size"),Ct[n]?N(n,i):(wt=1,K(n,i)))}).on("click.bot",'.bot:not([data-invalid-transfer="true"]) .horizontal-more',function(){var t=Ee(this).parents("dd.bot"),n=Ee(this).attr("page-size"),i=Ee(this).attr("page-num");i++;var r=s({s:Wt.PAGE,pageNum:i,pageSize:n,sessionId:Je.sessionId,logId:t.attr("logid"),im_robot_log_id:t.attr("im_robot_log_id"),need_update:1});Ee.post(Ve,r,function(r){var o=r.robotAnswer&&r.robotAnswer[0];try{n*i<o.ansCon.total||(i=0)}catch(a){console.log(a)}o&&e.robot.structCardMsg({container:tt,answer:o,pageNum:i,clickChange:!0,render:function(e,n){return t.find(".msg-card-horizontal-no-title").length?t.find(".msg-content").html(e):t.find(".more-msg-box").html(e),Ee(this).parents("dd")},on:function(e,t,n){if("struct"===e){try{Et=JSON.parse(decodeURI(t.switchStaffInfo||Se))}catch(i){console.log("ä¼ éä¸å¡è®°å½å¤±è´¥")}R(t.el,{hitSource:3,hitContent:t.hitContent,question_type:"rich"},{noXss:!0,themeBg:"send-struct-card",im_robot_log_id:t.im_robot_log_id,logid:t.logid,deleteMore:!0})}}})})}).on("click.bot",".no-reason-box:not(.is-success) .no-reason-item",function(e){var t=Ee(this),n=t.parents(".no-reason-box");n[0].className.indexOf("disable")>-1&&(n.removeClass("disable"),n.find(".text-area").removeAttr("readonly")),n.find(".active").length&&n.find(".active").removeClass("active"),t.addClass("active")}).on("click.bot",".no-reason-box:not(.is-success,.disable) .sub-btn",function(){if(!Ht){var e=Ee(this),t=e.parents("dd"),n=t.attr("aid"),i=t.attr("cluid"),r=t.attr("logid"),o=t.attr("im_robot_log_id"),a=e.parents(".no-reason-box"),c=a.find(".active").attr("reasonId"),l=a.find(".text-area").val(),u="true"===a.attr("taskappraise"),d=a.attr("multimessageid"),p=Pt[r];if(l.length>50)return void Ae.showTip("æè§åé¦åå®¹è¯·å°äº50å­","error");Ht=!0;var h={s:"unsatisfied_tags",tag_id:c,aId:n||"",cluid:i||"",logId:r||"",reason:l,tags:JSON.stringify(p),im_robot_log_id:o,taskAppraise:u};d&&(h.multiMessageId=d);var f=s(h);Ee.get("/udesk_im/aifaq/v1/web_proxy",f).always(function(e){Ht=!1,1e3===e.code||"1000"===e.code?(a.addClass("is-success"),a.find(".text-area")[0].setAttribute("readonly",!0),a.find(".sub-btn")[0].innerText=Ae.UDL.g("robot.receiveFeedback")):Ae.showTip(Ae.UDL.g("tip.saveFail"),"danger")})}}).on("input",".no-reason-box textarea",function(){var e=Ee(this).val(),t=Ee(this).parents(".no-reason-box");t.find(".text-area-num .num")[0].innerText=e.length,e.length>50?t.find(".text-area-num .num").addClass("red"):t.find(".text-area-num .num").removeClass("red")}).on("click.bot",'.bot:not([data-invalid-transfer="true"]) .show-ticket-list',function(){var e=Ee(this).parents("dd"),t=Ct[e.attr("logid")].ansCon;W(t)}).on("click.bot",'.bot:not([data-invalid-transfer="true"]) .ticket-iframe',function(){var e=Ee(this).data("iframe")+"&imclient=true&customerId="+Ae.customer.user_id;X({src:e,clz:"feedback-modal statsurvey",contentClz:""})}).on("mouseover",".list-item-disc",function(){Ee(this)[0].children[0].style.color=Nt.selectQuestionFontColor,Ee(this)[0].children[0].style.opacity=Nt.selectQuestionFontDiaphaneity}).on("mouseout",".list-item-disc",function(){Ee(this)[0].children[0].style.color=Nt.unSelectQuestionFontColor,Ee(this)[0].children[0].style.opacity=Nt.unSelectQuestionFontDiaphaneity}),Ae.bodyEl.on("click",".card-choice-popup",function(e){e.stopPropagation()}).on("click.card-choice-popup",".km-bind-click-event:not(.udesk-card-category-item)",function(){var e=Ee(this),t=e.attr("udesk-card-category-type");Ee("#show-card-box").find(".active").removeClass("active"),Ee(this).addClass("active"),Ee("#show-card-box").find(".udesk-card-category-item").each(function(){Ee(this).attr("udesk-card-category-type")===t?Ee(this).removeClass("hide"):Ee(this).addClass("hide")})}).on("click.bot",".card-choice-popup .udesk-card-category-item",function(){var e=Ee(this),t=e.parents(".card-choice-popup"),n=t.attr("from"),i=['<div class="send-struct-card">','<div class="card-vertical-item">',e.prop("outerHTML"),"</div>","<div from="+n+' class="card-vertical-more show-card-popup">éæ°éæ©<div>',"</div>"].join("");ee(),R(i,{hitSource:3,hitContent:e.attr("hit-content"),question_type:"rich"},{noXss:!0,themeBg:"send-struct-card",logid:t.attr("logid"),im_robot_log_id:t.attr("im_robot_log_id"),deleteMore:!0})}).on("click",".auto-satisfaction .km-bind-click-event",H).on("click",".chanpinzixun-a",function(){var e=Ee(this),t=e.data("iframe");X({src:t,clz:"feedback-modal statsurvey",contentClz:"scrollbar"})}).on("click",".show-custom-form-sdk",function(){var e=Ee(this),t=e.data("formid"),n=e.data("tasknodeid");G({formId:t,taskNodeId:n,clz:"feedback-modal statsurvey custom-form-modal",contentClz:"scrollbar"})}),Ae.bodyEl.off(".wx").on("click.wx","[data-miniprogram-path]",Ae.miniProgramLinkClickHandler)}function W(t){var n=t.meta.total_pages,i=t.data,r=function(e){var t="";switch(e){case"solving":t='<span class="ticket-status ticket-status-solving">è§£å³ä¸­</span>';break;case"resolved":t='<span class="ticket-status ticket-status-resolved">å·²è§£å³</span>';break;case"open":t='<span class="ticket-status ticket-status-open">å¼å¯</span>';break;case"closed":t='<span class="ticket-status ticket-status-closed">å·²å³é­</span>'}return t},o=function(e){var t="";return Ie.isPC&&!Ie.isInner?e.forEach(function(e){t+='    <tr>        <td class="ticket-table-num">'+e.field_num+'</td>        <td class="ticket-table-title" title='+e.subject+">"+e.subject+'</td>        <td class="ticket-table-status">'+r(e.status)+'</td>        <td class="ticket-table-time">'+e.created_at+'</td>        <td class="ticket-table-detail" data-id='+e.id+">è¯¦æ</td>    </tr>"}):e.forEach(function(e){t+='<div class="ticket-card" data-id='+e.id+'><div class="ticket-card-title">   <div>ç¼å·:&nbsp;'+e.field_num+"</div>   <div>"+r(e.status)+'</div></div><div class="ticket-card-content">'+e.subject+'</div><div class="ticket-card-time">'+e.created_at+'</div><div class="ticket-card-detail"><div>æ¥çè¯¦æ</div><div class="icon icon-arrow-right"></div></div></div>'}),t};if(Ie.isPC&&!Ie.isInner)var a='<div><table class="ticket-table">    <tr class="ticket-table-head">       <th style="padding-left: 16px">ç¼å·</th>       <th width="177">æ é¢</th>       <th width="93">å·¥åç¶æ</th>       <th width="176">åå»ºæ¶é´</th>       <th>æä½</th>    </tr>'+o(i)+'</table><div class="ticket-page-box">   <div class="ticket-page icon icon-ic-arrow-left-s-line"></div><input id="selectPage" onkeyup="this.value=this.value.replace(/\\D/g,\'\')" value="1" onafterpaste="this.value=this.value.replace(/\\D/g,\'\')" >   <div>&nbsp;/&nbsp;'+n+'</div>   <div class="ticket-page icon icon-ic-arrow-right-s-youjiantou"></div></div></div>';else var a='<div class="ticket-list">'+o(i)+"</div>";var c='<div class="ticket-back" style="display: none"><div class="icon icon-ic-arrow-left-s-line"></div><div>è¿å</div></div>',l=(e.ui.modal({clz:"statsurvey "+(Ie.isPC&&!Ie.isInner?"ticket-modal-pc":"ticket-modal-h5"),contentClz:"ticket-modal-content",container:Ae.mainEl,title:"å·¥åæ¥è¯¢",content:a,hide:null,needClose:!0,isMob:Qe,headerExtraHtml:c}),1),u=function(e){var t=s({s:Wt.TICKET,page:l,companyId:Ae.company.id,customerId:Ae.customer.user_id});Ee.post(Ve,t,function(t){var n=t.robotAnswer[0].ansCon;e&&e(n)})},d=function h(){Ee(this).scrollTop()+10>Ee(".ticket-list")[0].clientHeight-Ee(this)[0].clientHeight+24&&(Ee(".ticket-modal-content").off("scroll",h),l++,u(function(e){var t=o(e);Ee(".ticket-list").append(t),l<n&&Ee(".ticket-modal-content").scroll(h)}))};if(Ie.isPC&&!Ie.isInner){var p=function(e){var t=o(e);Ee(".ticket-table").find("tr:not(.ticket-table-head)").each(function(){Ee(this).remove()}),Ee(".ticket-table-head").after(t)};Ee("#selectPage").blur(function(){var e=Ee("#selectPage").val();e>n&&(e=n,Ee("#selectPage").val(e)),l=e,u(p)}),Ee(".ticket-page:first").on("click",function(){1!==l&&(l--,Ee("#selectPage").val(l),u(p))}),Ee(".ticket-page:last").on("click",function(){l>n-1||(l++,Ee("#selectPage").val(l),u(p))})}else Ee(".ticket-modal-content").scroll(d);Ae.bodyEl.on("click.bot",".ticket-table-detail,.ticket-list .ticket-card",function(){Ee(".ticket-modal-h5").addClass("detail");var e=Ee(this).data("id");Ee(".ticket-back").show(),Ee(".ticket-modal-content>div").hide();var t=s({s:Wt.TICKET_DETAIL,ticketId:e,companyId:Ae.company.id,customerId:Ae.customer.user_id});Ee.post(Ve,t,function(e){var t=e.robotAnswer[0].ansCon,n=t.down,i=t.up;Ee(".ticket-detail").remove(),Ee(".ticket-modal-content").append('<div class="ticket-detail"><div class="ticket-detail-up">'+i+'</div><div class="ticket-detail-show"><div class="icon icon-arrow-down"></div><div class="ticket-detail-show-text">å±å¼æ²éè¯¦æ</div></div><div class="ticket-detail-down" style="display: none">'+n+"</div></div>"),Ee(".ticket-detail-show").on("click",function(){Ee(".ticket-detail-down").is(":visible")?(Ee(".ticket-detail-down").hide(),Ee(".ticket-detail-show .icon").removeClass("change"),Ee(".ticket-detail-show-text").text("å±å¼æ²éè¯¦æ")):(Ee(".ticket-detail-down").show(),Ee(".ticket-detail-show .icon").addClass("change"),Ee(".ticket-detail-show-text").text("æ¶èµ·æ²éè¯¦æ"))})})}),Ee(".robot .ticket-back").on("click",function(){Ee(".ticket-back").hide(),Ee(".ticket-modal-content>div").show(),Ee(".ticket-detail").remove(),Ee(".ticket-modal-h5").removeClass("detail")})}function V(e){var t=0,n=0;e.on("touchstart",function(e){var i=e.originalEvent.targetTouches[0];t=i.pageX,n=i.pageX}),e.on("touchmove",function(t){var i=t.originalEvent.changedTouches[0],r=n-i.pageX;n-=r,e.scrollLeft(e.scrollLeft()+r)}),e.on("touchend",function(e){var n=Ee(this),i=n.parents(".horizontal-list-box"),r=i.find(".change-horizontal-page-icon.active").data("page"),o=i.find(".change-horizontal-page-icon"),a=o.size(),s=e.originalEvent.changedTouches[0],c=s.pageX,l=t-c,u=r+Math.ceil(Math.floor(l/(Dt/2))/2);u>a-1?u=a-1:u<0&&(u=0),Q(i,u,"move")})}function Q(e,t,n){var i=e.find(".horizontal-list-right"),r=e.find(".change-horizontal-question .active"),o=e.find(".change-horizontal-page-icon"),a=(o.size(),i.scrollLeft()),s=Dt*t,c=s-a,l="icon"===n?3:1;if(c){var u=setInterval(function(){c>0?a+=l:a-=l,c>0&&a>s||c<0&&a<s?(i.scrollLeft(s),clearInterval(u)):i.scrollLeft(a)},1);r.removeClass("active"),Ee(o[t]).addClass("active")}}function X(t){e.ui.modal({clz:t.clz,contentClz:t.contentClz,container:Ae.mainEl,title:"",content:"<p><iframe src="+t.src+' width="100%" height="458" frameborder="0" allowfullscreen="allowfullscreen"></iframe></p>',hide:null,needClose:!0,isMob:Qe})}function J(t,n){if(n){Xt.hide();var i=e.chatAgent.create();i.init()}}function G(t){Xt=e.ui.modal({clz:t.clz,contentClz:t.contentClz,container:Ae.mainEl,title:"",content:'<p><div id="custom_form_sdk" style="width: 100%; height: 368px;"></div></p>',hide:null,needClose:!0,isMob:Qe});var n=setInterval(function(){var i=document.querySelector("#custom_form_sdk");i&&(clearInterval(n),require(["js/lib/km-chat-sdk/manifest-loader.min.js"],function(){window.wfManifest=new window.ManifestLoader(e.common.company.kmhost+"/km-chat-sdk/manifest.json"),wfManifest.assets().then(function(n){var r;Array.isArray(n)&&(r=n.find(function(e){return e.isEntry}).SdkClass);var o={formId:t.formId,taskNodeId:t.taskNodeId,sessionId:Je.sessionId,kmhost:e.common.company.kmhost,submitForm:J};try{var a=new r({componentProps:o,componentName:"customForm"});a.renderTo(i)}catch(s){}})}))},20)}function K(e,t,n){Tt=!0;var i=s({s:Wt.PAGE,pageNum:wt,pageSize:kt||10,sessionId:Je.sessionId,logId:e,im_robot_log_id:t});Ee.post(Ve,i,function(i){Y({answer:i.robotAnswer[0],logid:e,im_robot_log_id:t,hideReselect:n})})}function Y(t){var n=t.answer,i=t.logid,r=t.im_robot_log_id,o=t.hideReselect,a=wt;e.robot.structCardMsg({hideReselect:o,container:Ee(".card-choice-popup"),answer:n,onlyContent:1!==wt,isVertical:!0,render:function(e,t){var s=!0,c=function(){try{a*kt<n.ansCon.total||(s=!1)}catch(e){console.log(e)}s?Ee(".card-choice-popup .custom-card-list-box").scroll(function(){var e=Ee(this);if(e.scrollTop()+e[0].clientHeight+10>e[0].scrollHeight){if(Tt)return;Ee(".card-choice-popup .custom-card-list-box").off(),K(i,r,o)}}):Ee(".card-choice-popup .custom-card-list-box").off()};1===wt?Z(e,{logid:i,im_robot_log_id:r}):Ee(".card-choice-popup .custom_card-list").append(e),c(),wt++,Tt=!1;var l=Ae.isMob?Ee(".card-choice-popup .custom-card-list-box").height():480;return console.log("cardPageSize:",kt,"pageNum:",a,"total",n.ansCon.total),Ee(".card-choice-popup .custom_card-list").height()<l&&n.ansCon.total&&kt&&a*kt<n.ansCon.total&&K(i,r,o),Ee(".card-choice-popup")},on:function(e,t,n){"struct"===e&&(Et=JSON.parse(decodeURI(t.switchStaffInfo||Se)),R(t.el,{hitSource:3,hitContent:t.hitContent,question_type:"rich"},{noXss:!0,themeBg:"send-struct-card",im_robot_log_id:t.im_robot_log_id,logid:t.logid,deleteMore:!0})),ee()}})}function Z(e,t,n){try{e=e.join(",")}catch(i){console.log(i)}Ee(".card-choice-mask").removeClass("hide"),Ee(".card-choice-popup").empty(),t&&Ee.each(t,function(e,t){Ee(".card-choice-popup").attr(e,t)}),Ee(".card-choice-popup").html(e),setTimeout(function(){Ee(".card-choice-popup").addClass("card-choice-popup-active"),n&&n()},10)}function ee(){Ee(".card-choice-popup").removeClass("card-choice-popup-active"),Ee(".card-choice-mask").addClass("hide")}function te(){var e=Ee(".shortcut-box").scrollLeft(),t=(Ee(".shortcut-ul").outerWidth(),Ee(".shortcut-box").outerWidth()),n=Ee(".shortcut-box")[0].scrollWidth;e>0?(Ee(".s-left").show(),Ee(".msg-shortcut").css("padding-left","0")):(Ee(".s-left").hide(),Ee(".msg-shortcut").css("padding-left","16px")),e+t>=n?(Ee(".s-right").hide(),Ee(".msg-shortcut").css("padding-right","16px")):(Ee(".s-right").show(),Ee(".msg-shortcut").css("padding-right","0"))}function ne(e){var t=Ze.find(".ql"),n="up"===e?t.last():t.first();if(Ze.find(".active").length){var i=Ze.find(".active"),r="up"===e?i.prev(".ql"):i.next(".ql");return r=r.length?r:n,r.addClass("active").siblings().removeClass("active")}return n.addClass("active")}function ie(){ut||(Ee("#btnTransfer").css("display","flex"),Ee(".inner #btnTransfer").css("color",at||rt),lt&&(Ee("#btnTransfer").hide(),Ae.h5TransferEl.css("display","inline-block"))),Be.hasShowBtnTransfer=!0,Ae.setHeaderTitleBoxWith()}function re(){Ie.isTransfer&&Be.hasShowBtnTransfer&&Ie.chatRobot.showBtnTransfer()}function oe(t,n){if(t){n=n||{};var i=t.content_raw,r=t.created_at||t.msgTime,o=n.isRecv?"msg-recv":"",a=!1,s="";try{a="rich"===JSON.parse(t.content).type,a&&!n.isRecv&&(s="send-struct-card")}catch(l){}try{return i=e.parseJSON(t.content_raw),i.selectCategoryFontColor&&(Nt={selectCategoryFontColor:i.selectCategoryFontColor,selectCategoryFontDiaphaneity:i.selectCategoryFontDiaphaneity,selectQuestionFontColor:i.selectQuestionFontColor,selectQuestionFontDiaphaneity:i.selectQuestionFontDiaphaneity,unSelectCategoryFontColor:i.unSelectCategoryFontColor,unSelectCategoryFontDiaphaneity:i.unSelectCategoryFontDiaphaneity,unSelectQuestionFontColor:i.unSelectQuestionFontColor,unSelectQuestionFontDiaphaneity:i.unSelectQuestionFontDiaphaneity}),!r&&(r=i.log_created_at),i.webConfig?(u(i),c(e.parseJSON(t.content_raw),{log_created_at:r,messagesEl:n.messagesEl,renderFn:n.renderFn,delayShowWelcomeMsg:n.delayShowWelcomeMsg,noScroll:n.noScroll,invalidTransfer:t.invalidTransfer})):(i.question||i.flowContent?i=i.question||i.flowContent:i.robotAnswer&&(i=Ie.isRobotChat?Ee.extend({switchStaffType:i.switchStaffType,switchStaffTips:i.switchStaffTips,switchStaffAnswer:i.switchStaffAnswer,created_at:r,logid:t.logId},i.robotAnswer[0]):Ee.extend({created_at:r,logid:t.logId},i.robotAnswer[0])),D({isRecv:n.isRecv,clz:o,log_created_at:r,content:i,messagesEl:n.messagesEl,renderFn:n.renderFn,noScroll:n.noScroll,senderName:t.agent_nick_name,logId:t.logId,invalidTransfer:t.invalidTransfer,noXss:a,themeBg:s}))}catch(d){}}}function ae(e,t){var n=function(e){var t=Ee(e).find(".horizontal-list");t.size()&&t.css({"transition-duration":0,transform:"translateX(0)",opacity:"1"}),Ee("#show-history").parents("dt").after(e),Ae.contentEl.scrollTop()},i=Ie.chatAgent||{};if(t){var r,o={content:JSON.stringify({type:"unreadMessage",data:{content:Me("tip.unreadMessage")}})};Ee.each(e,function(e,n){n.id===t&&(r=e)}),e.splice(r,0,o)}e.reverse(),Ee.each(e,function(e,o){var a=Ae.isRecvMsg(o.sender),s=JSON.parse(o.content)||{};if(o.id===t&&(r=e),("system"!==o.status||"survey"===s.type||"customer_close"===s.type||s.data.msg_close||"rich"===s.type||"message"===s.type)&&"assign_queue"!==s.type&&"leave_message_assign"!==s.type&&"close"!==s.type&&"form"!==s.type&&"form_received"!==s.type&&"invitation"!==s.type&&("monitor"!==o.status||"internal"!==o.log_type)){var c="monitor"===o.status?o.user_nick_name||agent.nick||o.agent_nick_name:o.agent_nick_name;o.inviter&&(c=o.inviter.nick_name),"agent"===o.sender&&We.merchant_id&&(c=We.merchant_name);var l;if("survey"===s.type)l=i.showSurveyEvent({agent_id:o.agent_id,im_sub_session_id:o.im_sub_session_id,jid:"",hasSurvey:!!s.survey_option_id,created_at:o.created_at,needStr:!0}),n(l);else{var u=(We.merchant_id?We.merchant_avatar:"")||o.agent_avatar||Ae.frameConfig.sys_agent_logo||Ae.frameConfig.logo_url;i.canShow(o.message_id)&&(l=i.preShowMsg({msgId:o.message_id,type:s.type,msg:s.data.content,filename:s.filename||s.data.filename||"",filesize:s.filesize||s.data.filesize||"",filePreviewUrl:s.filePreviewUrl||"",fileext:s.fileext||s.data.fileext||"",senderName:c,style:s.font?s.font:"",msgTime:o.created_at,send_status:"rollback"===o.send_status?"rollback":"",session_type:o.session_type,content_raw:o.content_raw,read_status:o.read_status,content:o.content,invalidTransfer:o.invalidTransfer,logId:o.logId,agent_avatar:u},a,{delayShowWelcomeMsg:!0,renderFn:n}))}}})}function se(e,t){Le.messages.empty(),Ae.showNoticeMsg(),e=ce(e);var n=e.length>1;Ee.each(e,function(){oe(this,{isRecv:(""+this.sender).indexOf("robot")>0,noScroll:n})}),Vt.judgeNeedWelNextMsg(),n&&Ae.scrollBottom(),t&&t()}function ce(t){var n=t[0]||{};try{var i=e.parseJSON(n.content_raw||"");if(i&&i.webConfig)return t;var r=JSON.parse(Ge),o=Ee.extend({agent_avatar:"",agent_id:"",agent_nick_name:"æºå¨äºº",content:"",content_raw:Ge,log_type:"",sender:"udesk_robot",session_type:"robot"},r);return t.unshift(o),t}catch(a){return t}}function le(){i("destroy"),Le.body.off(".bot"),Le.messages.off(".bot"),Le.footer.off(".bot"),Le.btnSend.off(),Le.txtMsg.off(),Le.btnSurvey.hide(),Le.body.removeClass("robot"),Le.body.removeClass(Ie.company.robot&&Ie.company.robot.channel),Ze.empty().hide(),Ee(Be.transferSelector).hide(),Ee(Be.transferSelector).parents(".empty-switch-msg").parent(".bot").hide(),Ee("#"+Be.transferEventMsgId).hide(),Ee(".has-go-chat").removeClass("has-go-chat"),Vt.destroy(),ge(),me(),Ae.bodyEl.off(".wx"),Jt=!1}function ue(){Le.body.off("click.bot",Be.transferSelector).on("click.bot",Be.transferSelector,function(){var e=Ee(this);"btnTransfer"!==e[0].id&&"btnTransfer2"!==e[0].id||(At=!0);var t=e.data("customerserviceid"),n=e.data("customerservicestatus");0===n?Ie.km_rule_agent_id=t:1===n&&(Ie.km_rule_group_id=t),P()}),Ee(".icon-stereos-on").hide(),Le.btnSend.off("click").on("click",function(){+new Date-Lt>500?R():Lt=+new Date}),Ae.surveyEl.off(".bot").on("click.bot",H)}function de(){Le.body.addClass("robot"),Le.body.addClass(Ie.company.robot?Ie.company.robot.channel:""),Ie.company.robot&&"custom_robot"===Ie.company.robot.channel||Ie.robotSurveyData.enabled&&Le.btnSurvey.show(),Ee("#"+Be.transferEventMsgId).show(),Ee(".has-go-chat").addClass("has-go-chat"),pe()}function pe(){Ae.initFooter(),ke=Le.txtMsg.height(),e.isIos()||Le.txtMsg.focus(),Ae.initRecorder(function(e,t){if("end"===e){if(t.translateResult)R(t.translateResult);else{var n=Le.txtMsg.val()||"";R(n+t.result)}Ae.setBtnSendActive()}}),Le.txtMsg.off("keydown").on("keydown",function(e){switch(e.keyCode){case 13:if(+new Date-Lt>500){if(e.shiftKey)return;if(Ze.find(".active").length){var n=Ze.find(".active").text();return R(n),e.preventDefault(),void(t.uAnalytics&&t.uAnalytics.track("sendclick"))}R(),t.uAnalytics&&Ee(this).val()&&t.uAnalytics.track("sendclick")}else Lt=+new Date;e.preventDefault();break;case 27:Ze.hide().empty();break;case 38:e.preventDefault(),ne("up");break;case 40:e.preventDefault(),ne("down")}}),e.isIos()&&Le.txtMsg.on("touchend",function(e){return e.currentTarget.focus()}),ue(),fe(),he()}function he(){t.uAnalytics&&Le.btnSend.off(".uba").on("click.uba",function(){t.uAnalytics.track("sendclick")})}function fe(){Ee("body").on("click.staff","[data-udesk-show-go-chat]",function(){var e=Ee(this),t=e.parents(".bot"),n=t.next();if(n.size()){var i=n.find(".switch-staff-answer-msg");i.hasClass("hide-switch-staff-answer-msg")&&(i.removeClass("hide-switch-staff-answer-msg"),Ae.animateScroll(i.outerHeight()||38))}})}function ge(){Ee("body").off(".staff"),Ae.surveyEl.off(".bot")}function me(){Ee("[data-udesk-show-go-chat]").hide();var e=Ee("[data-udesk-show-go-chat]").parents(".empty-switch-msg");e.length>0&&Ee.each(e,function(e,t){Ee(t).parent().hide()})}function ve(t){e.loader.js("./lib/iframe-listener.js").then(function(){e.iframeListener.init({side_data:t}),e.iframeListener.setListenerPage("robot"),e.iframeListener.registeFn("robot_sendMsg",function(e){R(e,"",{msgSource:"iframe"})})})}function ye(){e.ui.config({appBar:{title:"string"==typeof Ae.frameConfig.navibar_fixed_nickname?Ae.frameConfig.navibar_fixed_nickname:Je.name||Me("robot.title"),avatar:"logo"===Ae.frameConfig.header_avatar_type?Ae.frameConfig.logo_url:Je.logoUrl||"images/bot.png"}}),e.ui.appBar({btnBack:!!We.backbutton||We.showback,onClick:function(e){"back"===e&&(We.showback||"default"===We.backbutton?t.history.back():t.location.href=We.backbutton)}});var n="udesk_robot"===Re.channel&&Re.show_robot_times;Re.transfer&&!n&&ie()}function be(){if(Ae.btnFileEl.off("click").on("click",function(){Ae.hideMoreBox(),we=!0,Be.uploadQueueCounter=0}),Ae.btnPictureEl.off("click").on("click",function(){Ae.hideMoreBox(),we=!0,Be.uploadQueueCounter=0}),Ae.btnVideoEl.off("click").on("click",function(){Ae.hideMoreBox(),we=!0,Be.uploadQueueCounter=0}),!WebUploader.Uploader.support())return void Ae.showTip(Ae.UDL.g("tip.updateFlash"),"warn");if(!Be.initUploader){Be.initUploader=!0;var t=je.upload_size_limit||50;uploader=e.uploader.init({marking:"client.chat_upload",auto:!1,swf:"/im_client/cmps/webuploader/dist/Uploader.swf",dnd:"#content,#footer textarea",paste:"#footer textarea",disableGlobalDnd:!0,pick:{id:e.isPC()?"#btnFile":"#uploadPicture",multiple:!e.isAndroid()||!e.isMiniProgram(),_accept:"image/*"},duplicate:!0,fileSingleSizeLimit:1024*t*1024,fileSingleLimit:t,resize:!1,needUrlEncode:!0,tokenOption:function(e){var t=Ae.getFileType(e);if("image"===t&&"image/gif"!==e.type)return{qs:{"x-oss-process":"image/auto-orient,0"}}},dndAccept:function(){Be.isUploadDndAccept=!0},fileQueued:function(e,t){new Date;D({fileId:e.id,type:"uploading"}),we=!1},manualUpload:function(t,n,i){var r="image"===Ae.getFileType(n),o=Be.isUploadDndAccept;if(clearTimeout(Be.uploadQueueTimer),Be.isUploadDndAccept=!1,Be.uploadQueueCounter=(Be.uploadQueueCounter||0)+1,Be.uploadQueueTimer=setTimeout(function(){Be.uploadQueueCounter=0},1e3),e.ifIE()&&("image.png"!==n.name||n.random_filename||(we=!0)),we||!r||o||Be.uploadQueueCounter>1)return i&&i(n);try{t.makeThumb(n,function(r,o){e.ui.imgPreview({src:o,onClick:function(e){"close"===e?n&&t.cancelFile(n):"send"===e&&i&&i(n)}})},1,1)}catch(a){return i&&i()}},uploadProgress:function(e,t){var n=(100*t).toFixed(1),i=Ae.messagesEl.find("#"+e.id);n=n>99.9?99.9:n,i.find(".progress-per").css("width",n+"%")},uploadSuccess:function(t,n){if(e.ifIE(9,"lte"))_e(t,n);else if("qiniu"===t.storage_policy){var i="https://qn-im.udesk.cn/"+n.key,r=Ae.getFileType(t),o="image"===r;Ee.ajax({url:o?i+"?imageInfo":i+"?stat",type:"GET",noParams:!0}).always(function(e){e=e||{};var i=o?e.size:e.fsize;"undefined"==typeof i?(upNum=1,_e(t,n)):0===i&&upNum<2?(uploader.upload(t),upNum++):0===i&&upNum>=2?(upNum=1,Ee("#"+t.id).parents(".clearfix").remove(),t&&uploader.removeFile(t,!0),Ae.winAlert(Ae.UDL.g("tip.sendFail"))):(upNum=1,_e(t,n))})}else _e(t,n)},uploadError:function(e){Ee("#"+e.id).parents(".clearfix").remove(),Ae.winAlert(Ae.UDL.g("tip.sendFail"))}}),Ae.editorAutoShow()}}function _e(e,t){var n,i,r=e.url,o=r,a=Ae.getFileType(e);new Date,"chatFeedback"===Ie.stage;"file"===a?("mp4"===e.ext&&(a="video"),n=e.name,o=r+(r.indexOf("?")>-1?"&":"?")+"download/"+n,i=WebUploader.Base.formatSize(e.size)):"image"===a&&("qiniu"===e.storage_policy?(r+="?imageMogr/auto-orient",o=r):"ali"===e.storage_policy&&(o=r)),R(o,{meta:{question_type:"image"}},{type:"image"}),Ee("#"+e.id).parents(".clearfix").remove()}function xe(){Ae.initCustomButtons("robot",function(e,t){R(e,t)}),it&&(e.isPC()?Le.btnFile.show():Le.uploadPicture.show(),be()),Ae.surveyEl.hide(),Ae.footerEl.show(),l(function(t){Vt.init(t),ye(),pe(),$(),Ae.editorAutoShow(),Ae.bindSurveyEvent(),Ae.getSurveyData(),Oe&&b().then(function(t){e.setContext({robotSurveyData:t.data}),Ae.surveyEl[t.data.enabled?"show":"hide"](),Ae.editorAutoShow(),Ae.surveyEl.off(".bot").on("click.bot",H)},function(){Ae.showTip(Ae.UDL.g("robot.fetch_robot_config_failed"),"error")}),lt&&Ae.applyH5Mode(),Te=!0,Ae.hideModal(),Xe?Ae.needSideListion(Xe.side_data)&&ve(Xe.side_data):Ae.getSideBoxData(function(e){Ae.needSideListion(e.side_data)&&ve(e.side_data)}),Ae.getCustomerLogs({isRobot:!0,isCurrent:!0,current_session_type:"robot",cb:function(e,t){e.forEach(function(e){return e.invalidTransfer=!0}),se(e,t);var n=Ie.offline||{},i=n.count;if(i){var r=Ee("#content"),o=n.im_logs[0].id;Ae.getCustomerLogs({isRobot:!0,isHistory:!0,isShowTips:!0,cb:function(e){e.forEach(function(e){return e.invalidTransfer=!0}),ae(e,o);var t=Ee("#event-bar-line");t.length>0&&(r.scrollTop(Ee(".messages").height()),r.scroll(function(){var e=r.scrollTop(),n=t.offsetTop;e<n?(Ee(".unread-box").remove(),t.parent("dt").remove(),Ae.clearOfflineCount()):e==n&&Ee(".unread-box").remove()}))}})}}}),Ae.bodyEl.on("click","#show-history",function(){Ae.getCustomerLogs({isRobot:!0,isHistory:!0,cb:function(e){e.forEach(function(e){return e.invalidTransfer=!0}),ae(e)}})});var n=Ae.getOfflineUnreadMsgHtml("robot");n&&Ae.mainEl.append(n),Ee(".side .unread-box").css({right:Ae.sideBoxEl.width()+20+"px"}),Ae.company&&Ae.company.robot&&Ae.company.robot.enable_invite&&Ae.sendTransferRobotSocket("robot_chatting"),Ae.robotHasInitok=!0},function(){
Ae.showModal("robotError")});var t=(Ee(e.replaceTpl()),document.createElement("div"));t.className="card-choice-mask hide";var n=document.createElement("div");n.className="card-choice-popup",je.show_banner&&(n.style.bottom="30px"),t.appendChild(n),Ae.bodyEl.append(t)}var we,ke,Te,Se="{}",Ce=!0,Ee=(e.template.chat||{},e.$),Ae=e.common,Ie=e.context,Le=Ie.els,Be={transferSelector:'.bot:not([data-invalid-transfer="true"]) .btn-transfer,.bot:not([data-invalid-transfer="true"]) [data-udesk-go-chat],#btnTransfer,#btnTransfer2',transferEventMsgId:"transferEventMsg"},De=!1,Me=Ae.UDL.g,Ne=Ae.UDL.gl,je=Ae.company,Re=je.robot,Oe=Re&&"udesk_robot"===Re.channel,qe=Re&&"aicp_robot"===Re.channel,Fe=Re&&"zhuiyi_robot"===Re.channel,ze=Re&&"custom_robot"===Re.channel,Ue=Oe?Re.show_robot_times:0,Pe=Re.transfer,He=!1,$e=Ae.customer||{},We=Ae.urlParamObj,Ve="/udesk_im/aifaq/v1/web_proxy",Qe=Ae.isMob,Xe=Ae.sideRes,Je={},Ge={},Ke=!1,Ye=0,Ze=Ae.bodyEl.find("#guideList"),et=Ae.txtMsgEl,tt=Ae.messagesEl,nt=Ae.frameConfig.buttons_enable||{},it=nt.robot_upload_enabled,rt=Ae.frameConfig.theme_color,ot=Ae.frameConfig.customerBgColor,at=Ae.frameConfig.transfer_text_color,st="",ct=o(),lt=Ae.frameConfig.h5Mode,ut=!!We.sdk_token,dt=Ae.innerController,pt=dt.isInnerMode,ht="Transfer||"+$e.username,ft=e.template.chat||{};Ae.sessionStore(ht,"");var gt,mt=!1,vt=0,yt=2,bt=[],_t=0,xt=null,wt=1,kt="",Tt=!1,St=null,Ct={},Et=null,At=!1,It="",Lt=0,Bt={type:1,title:"",image:"",pictureSetting:1},Dt=0,Mt=0,Nt={},jt=e.joinStr('<dd class="bot clearfix" aid="{aid}" cluid="{cluid}" logid="{logid}" im_robot_log_id="{im_robot_log_id}">','   <div class="msg {clz} {typeClz}" style="color:'+e.context.textColor+'">','       <i class="msg-avatar" {avatarStyle}></i>','       <div class="sender">','           <span class="sender-text">{senderName}</span>','           <span class="time-text">{msgTime}&#8197;<b> </b></span>',"       </div>",'       <div class="msg-content-and-after">','           <div class="msg-content {themeBg}" style="{style}">{msg}</div>',"{afterHtml}","       </div>",'       <div class="more-msg-box">{moreHtml}</div>',"   </div>","</dd>"),Rt='<div class="no-reason-box {style}" taskAppraise={taskAppraise} multiMessageId={multiMessageId}><div class="no-reason-title">'+Ae.UDL.g("robot.feedback")+'</div>{content}<div style="position: relative"><textarea class="text-area" placeholder="'+Ae.UDL.g("tip.input")+'..." readonly="readonly"></textarea><span class="text-area-num"><span class="num">0</span>/50</span></div><div class="sub-btn">'+Ae.UDL.g("label.submit")+"</div></div>",Ot=(e.replaceTpl(jt,{typeClz:"",msg:["{msg}",'<div class="help-box" {helpBoxAttrs}>','<div class="help help-yes">','<i class="icon icon-ic-thumb-up-zan" ></i>',"</div>",'<div class="help help-no">','<i class="icon icon-ic-thumb-down-cai" ></i>',"</div>","</div>"].join(""),moreHtml:"{moreHtml}"}),e.joinStr('<div class="list-box '+Re.channel+'">',ze?"":'    <div class="list-header">{robotQuestions}</div>',"       {msg}","</div>")),qt=e.replaceTpl(jt,{typeClz:"",msg:Ot,moreHtml:"{moreHtml}",afterHtml:""}),Ft=e.joinStr('<dd class="bot bot-shortcut clearfix" aid="{aid}" cluid="{cluid}" logid="{logid}">','   <div class="msg {clz} {typeClz}">',"       <i {avatarStyle}></i>",'       <span style="{style}"><div class="s-arrow s-left"><i class="icon icon-arrow-left"></i></div>{msg}<div class="s-arrow s-right"><i class="icon icon-arrow-right"></i></div></span>',"   </div>","{msgArrow}","</dd>"),zt=['<div class="more-tpl">',"{msg}",'<div class="more-btn">'+Me("tip.seeMore")+'<span class="icon icon icon-arrow-down"></span></div>',"</div>"].join(""),Ut=['<hr class="hr-1" />','<div class="attachment-list-wrapped">',"{msg}","</div>"].join(""),Pt={},Ht=!1,$t=1,Wt={BASE:"p",GUIDE:"ig",CHAT:"aq",SCHAT:"avq",GUIDEA:"getflw",HELP:"addufc",UNHELP:"addulc",CLICK:"hit",FEEDBACK_V2:"feedback_v2",GET_FEEDBACK_V2:"get_feedback_v2",PAGE:"page",TICKET:"order_list",TICKET_DETAIL:"order_details"},Vt={queue:[],config:{},queueTimer:null,silenceTimer:null,slienceNum:0,silenceMessageSeconds:0,silenceMessageTimer:null,loadingTpl:ft.loadingTpl,init:function(e){e=e||{};var t=e.personification_config||{},n=t.silenceConfig||{},i=n.enable||!1,r=n.askQuestions||[],o=!0;(!i||r.length<1)&&(o=!1),this.config={first_init_log:e.first_init_log||!1,personifyRobot:e.personifyRobot||!1,robotType:e.robotType,silenceConfigCan:o,silenceConfig:n||{},silenceEnable:i,silenceList:r,smartHintEnable:t.smartHintEnable||!1}},openQueueTimer:function(){var e=this,t=this.queue||[];if(t.length<1)return void(this.silenceMessageSeconds>0?this.openSilenceMessageTimer():this.config.silenceConfigCan&&this.openSlienceTimer());if(!this.queueTimer){this.showLoading();var n=t[0]||{},i=n.robotAnswer[0]||{},r=i.delayMillis;r&&(this.queueTimer=setTimeout(function(){e.removeLoading(),e.shiftItem();var t=n.switchStaffType,r=n.switchStaffTips;D({isRecv:!0,log_created_at:new Date,content:1===t?Ee.extend({switchStaffType:t,switchStaffTips:r},i):i,logId:n.logId}),e.noticeUdeskApi(i.ansCon||""),e.correctRobotMsgOrder(n),e.queueTimer=null,e.openQueueTimer()},r))}},correctRobotMsgOrder:function(e){if(e){var t="/spa1/im/im_robot_logs/delay_send",n={im_robot_log_id:e.im_robot_log_id,im_web_plugin_id:We.web_plugin_id,send_time:new Date};Ee.ajax({url:t,method:"PUT",data:n,success:function(){console.log("ok")},error:function(){console.log("error")}})}},openSilenceMessageTimer:function(){var e=this,t=this.silenceMessageSeconds;0!==t&&(this.silenceMessageTimer=setTimeout(function(){e.getSilenceMsg()},1e3*t))},getSilenceMsg:function(){var e=this.silenceMessageSeconds+"";"0"!==e&&(R(e,{s:"aq",features:["silence_seconds","discard_request_log"]},{skip:!0}),this.silenceMessageTimer&&(clearTimeout(this.silenceMessageTimer),this.silenceMessageTimer=null),this.silenceMessageSeconds=0)},openSlienceTimer:function(){var e=this,t=this.slienceNum||0,n=this.config.silenceList.length;if(!(t>=n)){var i=this.config.silenceList[t];this.silenceTimer=setTimeout(function(){e.slienceNum++,e.saveSlienceMsg(i)},1e3*parseInt(i.seconds))}},saveSlienceMsg:function(e){R(e.question,{s:"aq",personifyRobot:!0,clz:"msg-recv",features:["volunteered_ask"]},{notResault:!0,notRobotAnsHandler:!0,isSlienceMsg:!0}),this.noticeUdeskApi(e.question),this.silenceTimer&&(clearTimeout(this.silenceTimer),this.silenceTimer=null),this.openSlienceTimer()},shiftItem:function(){this.queue.shift()},pushItem:function(e){this.queue.push(e),this.showLoading(),this.slienceNum=0,this.silenceTimer&&(clearTimeout(this.silenceTimer),this.silenceTimer=null),this.queueTimer||this.openQueueTimer()},setSilenceMessage:function(e){var t=e.robotAnswer[0]||{};t.silenceSeconds&&""!==t.silenceSeconds?this.silenceMessageSeconds=t.silenceSeconds:this.silenceMessageSeconds=0,this.silenceMessageTimer&&(clearTimeout(this.silenceMessageTimer),this.silenceMessageTimer=null),this.queueTimer||this.openQueueTimer()},showLoading:function(){var e=Le.messages,t=e.find(".item-loading");t.length>0&&t.remove(),D({content:'<img src="images/loading3.gif" style="height:24px"/>',isRecv:!0,msgTime:+new Date,clz:"msg-recv item-loading",notRobotAnsHandler:!0})},removeLoading:function(){var e=Le.messages,t=e.find(".item-loading");t.length>0&&t.remove()},sendWelNext:function(){R("test",{s:"aq",personifyRobot:"true",features:["discard_request_log"]},{skip:!0})},judgeIsPersonification:function(e){e=e||{};var t=e.robotAnswer[0],n=this.config;return!(!t.delayMillis||!n.personifyRobot)},judgeNeedWelNextMsg:function(){var e=this.config;e.first_init_log&&e.personifyRobot&&this.sendWelNext()},destroy:function(){this.queueTimer&&clearTimeout(this.queueTimer),this.silenceTimer&&clearTimeout(this.silenceTimer),this.silenceMessageTimer&&clearTimeout(this.silenceMessageTimer),this.queue.length=0,this.slienceNum=0},noticeUdeskApi:function(e){pt&&dt.postNewMsg(e,"message")}},Qt=function(e,t){this.el=e||{},this.multiple=t||!1;var n=this.el.find(".link");if(_t){var i=Ee('div[data-question-type-id="'+_t+'"]');if(i&&i.length)Ee(i[0]).parent().toggleClass("open"),Ee(i[0]).css({color:Nt.selectCategoryFontColor,opacity:Nt.selectCategoryFontDiaphaneity});else if(n&&n.length){var r=n[0];_t=Ee(r)[0].dataset.questionTypeId,Ee(r).parent().toggleClass("open"),Ee(r).css({color:Nt.selectCategoryFontColor,opacity:Nt.selectCategoryFontDiaphaneity})}}n.on("click",{el:this.el,multiple:this.multiple},this.dropdown)};Qt.prototype.dropdown=function(e){try{_t=e.target.dataset.questionTypeId}catch(t){console.log(t)}var n=e.data.el,i=Ee(this),r=i.next();r.toggle(),i.parent().toggleClass("open"),n.find(".link").css({color:Nt.unSelectCategoryFontColor,opacity:Nt.unSelectCategoryFontDiaphaneity}),e.data.multiple||(n.find(".submenu").not(r).hide().parent().removeClass("open"),n.find(".open > .link").css({color:Nt.selectCategoryFontColor,opacity:Nt.selectCategoryFontDiaphaneity}))};var Xt,Jt=!1;return{state:Be,init:xe,sendMsg:R,showMsgByLog:oe,showBtnTransfer:ie,tryShowBtnTransfer:re,agentTransferSelector:ue,showHistoryMsg:ae,agentTransferShow:de,destroy:le,renderAppBar:ye,initFooter:pe}}),function(e,t,n){$(function(){n(e,t)})}(this.udesk,this,function(e,t){function n(e,t){setTimeout(function(){var n=e.find("> .pull-right").outerWidth(),i=d(".ui-appbar").width(),r=e.find(".icon-arrow-left");e.find(".title-box").width((t.titleWidth||i)-n-50-(r.size()>0?30:0))},50)}function i(t){var i=p.isPC,r=p.isMob,o=p.isHeadless,a=p.themeColor,t=p.config,s=p.els;return{isInner:b,isCSSMob:h.isMob,themeColor:a,show:function(e){e&&e.find(">dt, .btn-yes").css("background",a),e&&e.find(">dt, .btn-yes").css("border-color",a),e&&e.find(".btn-no").css("border-color",a)},appBar:{container:s.header,getButtons:function(e){var t=[];t.push({act:"muted",iconName:e.muted?"stereos-off":"stereos-on",title:g("mesagePromptSound"),"data-toggle":"tooltip","data-placement":"bottom"}),b&&t.push({act:"minimize",iconName:"line",title:g("minimize"),"data-toggle":"tooltip","data-placement":"bottom"}),u&&!b&&t.push({id:"btnTransfer",act:"transfer",iconName:"ic-customer-service-kefu",text:f("agent.transfer"),"class":"btn-transfer"});var n=p.config.buttons_enable;return(i&&n.pc.customer_close_session||r&&n.mobile.customer_close_session)&&t.push({iconName:"guanbi",title:g("close"),"data-toggle":"tooltip","data-placement":"bottom","class":"btn-customer-close"}),t},onClick:function(t){if("minimize"===t)h.innerController.postMsg({type:"hidePanel"});else if("muted"===t){var n=h.tipsNewMessage;n.muted?n.unmute():n.mute(),e.ui.config({appBar:{muted:n.muted}}),e.ui.appBar.setMute(n.muted)}},onReady:function(t,i){e.ui.tooltip(t),n(t,i)}},editor:{container:s.footer,textarea:{rows:p&&p.isInner?4:1,placeholder:m("placeInputHere")},btnSend:{id:"btnSend",text:g("send")},btnVoice:function(){var n=t.buttons_enable||{},i="https:"===location.protocol;return i&&n.mobile.voice_enabled&&Recorder.Support()&&e.isMob()||e.isMob()&&e.isWxWork()&&y.qywx_corp_id||e.isMob()&&(e.isWeixin()||e.isMiniProgram())&&y.wx_appid?{id:"btnVoice",iconName:"ic-mic-maikefeng",title:m("voice"),otherText:g("enterVoice"),"data-toggle":"tooltip"}:""},getButtons:function(n){var o=t.buttons_enable||{},a=[];return(o.pc.emoji_enabled&&e.isPC()||o.mobile.emoji_enabled&&!e.isPC())&&a.push({id:"btnEmotion",iconName:"ic-smile",title:g("emoji"),tip:g("emoji")}),(o.robot_upload_enabled&&e.isPC()||o.pc.upload_enabled&&e.isPC()||o.mobile.upload_enabled&&!e.isIos()&&r)&&a.push({id:"btnFile",iconName:"ic-file-wenjian",title:g("upload"),tip:g("file"),capture:"camera"}),(o.robot_upload_enabled&&!e.isPC()||!e.isPC()&&o.mobile.image_enabled)&&a.push({id:"uploadPicture",iconName:"paizhao",title:g("upload"),tip:g("camera"),capture:"camera"}),!e.isPC()&&o.mobile.video_enabled&&a.push({id:"uploadVideo",iconName:"shipin",title:g("upload"),tip:g("video1"),capture:"camera"}),i&&o.pc.screenshot_enabled&&a.push({id:"btnScreenShot",iconName:"jietu",title:g("screenshot")}),i&&o.pc.download_logs_enabled&&a.push({id:"btnDownload",iconName:"ic-download-xiazai",title:m("downloadLastChats")}),a.push({id:"btnSurvey",act:"survey",iconName:"ic-thumb-up-zan",title:g("survey"),tip:g("evaluation")}),r&&o.mobile.agent_cellphone_enabled&&t.agent_cellphone&&a.push({id:"btnAgentTel",iconName:"call",href:"tel:"+t.agent_cellphone,tip:g("tell")}),o.mobile.vcall&&/^IOS|Android/.test(h.getSystem())&&a.push({id:"btnVideoCall",act:"video-call",iconName:"shipin",tip:g("video"),css:{display:"none"}}),b&&a.push({id:"btnTransfer",text:f("agent.transfer"),"class":"inner-btn-transfer btn-transfer ellipsis"}),e.map(a,function(e,t){return t.title&&(t["data-toggle"]="tooltip"),t})},onReady:function(t,n){var i={};h.btnSendEl=i.btnSend=t.find("#btnSend"),h.btnEmotionEl=i.btnEmotion=t.find("#btnEmotion"),h.btnFileEl=i.btnFile=t.find("#btnFile"),h.btnPictureEl=i.uploadPicture=t.find("#uploadPicture"),h.btnVideoEl=i.uploadVideo=t.find("#uploadVideo"),h.screenShotEl=i.btnScreenShot=t.find("#btnScreenShot"),h.btnDownloadEl=i.btnDownload=t.find("#btnDownload"),h.surveyEl=i.btnSurvey=t.find("#btnSurvey")||d(".ui-editor #btnSurvey"),h.btnAgentTelEl=i.btnAgentTel=t.find("#btnAgentTel"),h.txtMsgEl=i.txtMsg=t.find("textarea"),h.btnInnerTransferEl=i.btnInnerTransfer=t.find("#btnTransfer"),h.btnVideoCallEl=i.btnVideoCall=t.find("#btnVideoCall"),e.setContext({els:i}),e.ui.tooltip(t)}},board:{container:s.pages,themeColor:a,header:!o&&{getButtons:function(e){var t=[];return e.needClose?t.push({act:"close",iconName:"guanbi",title:g("close"),"data-toggle":"tooltip","data-placement":"bottom"}):b&&t.push({act:"minimize",iconName:"line",title:g("minimize"),"data-toggle":"tooltip","data-placement":"bottom"}),t}},onClick:function(e,t){"close"===e&&t.el.removeClass("open")},onReady:function(t,i){e.ui.tooltip(t),n(t,i)}},imgPreview:{title:g("sendImage"),sendText:g("sure")},tip:{container:s.main}}}function r(e){var t=!1,n=e.customer,i=e.company.robot||{},r=i.channel;return n.chatting||"faqrobot"!==r&&"udesk_robot"!==r&&"aicp_robot"!==r&&"zhuiyi_robot"!==r&&"custom_robot"!==r||(t=!0),(y.transfer||"agent"===h.chat_creator)&&(y.session_id&&d.get("/spa1/im/get_robot_session_id",{im_robot_session_id:y.session_id}).always(function(e){1e3===e.code&&e.robot_session_id&&h.doTransferCount(e.robot_session_id,function(){})}),t=!1),_&&(t=!0),t}function o(e){e=e||{},h.goFeedback({btnBack:!!y.transfer||!!y.backbutton});var t="Transfer||"+e.customer.username,n=h.sessionStore(t),i=n?n.split("||")[2]:"";i&&(h.sessionStore(t,""),h.doTransferTurnPage(3,i))}function a(e){y["uba[app_key]"]&&e&&e.id&&d.getScript("https://analytics.s4.udesk.cn/sdk/udesk-uba-tracker.js").done(function(){t.ut&&setTimeout(function(){t.uAnalytics=t.ut.initialize(y["uba[app_key]"],"udeskå®ç½","1.0.0",{apiHost:"https://analytics.s4.udesk.cn/uba/v1",autoTrack:!1,initialPageview:!1,autoPageView:!1,heartbeatInterval:-1}),t.uAnalytics.identify(e.user_id+"",{system:"im",consult_url:y.cur_url,imuid:e.user_id+""})})})}function s(e){var t=new RegExp("(^|&)"+e+"=([^&]*)(&|$)","i"),n=window.location.search.substr(1).match(t);return null!=n?unescape(n[2]):null}function c(t,n,i,r){void 0===r&&(r=!1);var o=d.Deferred(),a={customer_id:p.customer.user_id,im_web_plugin_id:y.web_plugin_id,agent_id:t||y.agent_id,group_id:n||y.group_id,menu_id:i.menu_id||p.menu_id};return p.isTransfer||"true"===s("transfer")||"agent"===h.chat_creator?(d(".appbar-right").append('<a class="btn-transfer icon icon-ic-customer-service-kefu" id="btnTransfer" data-act="transfer"><span>'+f("agent.transfer")+"</span></a>"),o.resolve(!1)):(d.get(h.apiPath+"im/confirm_manual_reception_strategy",a).always(function(t){if(t=t||{},"enable_robot"!==t.result||"ignore"===t.result)return o.resolve(!1);if(!r){h.company.robot=t.robot_info,p.els.btnEmotion.hide(),p.els.btnFile.hide(),p.els.btnScreenShot.hide();var n=e.chatRobot.create();d("body").addClass("robot "+(t.robot_info?t.robot_info.channel:"")),e.setContext({stage:"robot",hasRobot:!0,isRobotChat:!0,chatRobot:n,company:h.company,robotConfig:t.robot_info}),n.init(),setTimeout(function(){t.robot_info.manual_reception_strategy.manual_strategy_robot_msg&&p.els.messages.append(e.template.chat.titleRadiusItemTpl({id:"transferEventMsg",msg:t.robot_info.manual_reception_strategy.manual_strategy_robot_msg})),0===t.robot_info.show_robot_times&&t.robot_info.enable_agent?d(".appbar-right").append('<a class="btn-transfer icon icon-ic-customer-service-kefu" id="btnTransfer" data-act="transfer" style="display: flex;"><span>'+f("agent.transfer")+"</span></a>"):d(".appbar-right").append('<a class="btn-transfer icon icon-ic-customer-service-kefu" id="btnTransfer" data-act="transfer"><span>'+f("agent.transfer")+"</span></a>"),h.goBottom()},1500),o.resolve(!0)}}),o.promise())}function l(t){if(!w||t){w=!0;var n=[];x&&n.push("msie"),_&&n.push("hideHdr"),e.isMob()&&e.platform({weixin:function(e){n.push("weixin")},android:function(e){n.push("android")},ios:function(e){n.push("ios "+e)}}),"ar"===y.language&&n.push("arabic"),n.length&&v.addClass(n.join(" ")),h.init({onBefore:function(t){var n=h.flashChecker()||{},r=p.els;p.isLowIE&&(!n.f||n.v<29)&&r.main.find(">.tip-bar").show(),e.ui.config(i(t)),p.isHeadless||e.ui.appBar({title:f("agent.onlineAg")}),e.ui.editor()},onAfter:function(t){t=t||{},a(t.customer);var n=t.company,i=p.els,s=n.web_im_feedback||{},l=s.leave_message_type||"form",g=s.leave_enable,m=g&&"im"===l,b=e.chatRobot.create(),_=e.chatAgent.create();if(u=r(t),e.setContext({imFeedback:m}),n.show_banner&&!h.hasWinParent()&&(h.isCopyRight=!0,i.copyRight.show(),i.body.addClass("has-copy-right")),h.autoSize(),!p.isLowIE&&autosize(i.txtMsg),i.txtMsg.on("autosize:resized",function(){h.autoSize()}),i.sideBox.removeClass("hide"),h.tipsNewMessage.init(),e.setContext({isCopyRight:h.isCopyRight}),e.isIos()&&e.isMob()&&"inner"!==y.currentMode&&(d("#footer").css("position","fixed"),d("#copy-right").css("position","fixed")),u)v.addClass("robot "+(n.robot?n.robot.channel:"")),b.init(),e.setContext({stage:"robot"});else{if(e.setContext({workTime:n.work_time}),!n.agent_available||!n.work_time)return void(m?(e.setContext({stage:"chatFeedback"}),_.init()):c(p.km_rule_group_id||"",p.km_rule_agent_id||"",{}).then(function(e){e||o(t)}));p.isHeadless||e.ui.appBar({title:f("agent.onlineAg")}),e.setContext({stage:"agent"}),_.init()}e.setContext({hasRobot:u,isRobotChat:u,chatRobot:b,chatAgent:_}),h.imgViewerInit()}})}}var u,d=e.$,p=e.context,h=e.common,f=h.UDL.g,g=h.UDL.gl,m=h.UDL.gt,v=d("body"),y=e.urlParams(t.location.href)||{},b="inner"===y.currentMode,_=!!y.sdk_token,x=e.ifIE()||e.isIE11(),w=!1;h.innerController.listeneStorage(),b&&h.innerController.init(),y.merchant_list?h.goMerchant():b&&!y.transfer?(h.innerController.registeFn("chatting",function(e){h.agent_id=e.agent_id||"",h.chat_creator=e.chat_creator,h.invited=!!e.invited,l(e.reload)}),h.innerController.registeFn("queuing",function(e){h.agent_id=e.agent_id||"",h.chat_creator=e.chat_creator,l(e.reload)}),h.innerController.postMsg({type:"askPanelState"})):l()});